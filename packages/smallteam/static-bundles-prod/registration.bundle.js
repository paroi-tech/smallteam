!function(e){var t={};function n(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(o,s,function(t){return e[t]}.bind(null,s));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,...t){throw new Error('Configure the webpack loader or use "handledom/browser"')}},function(e,t,n){"use strict";function o(e){if(!e)return e;if("Map"===e[Symbol.toStringTag]){const t=["MAP"];for(let[n,s]of e)!s||"Map"!==s[Symbol.toStringTag]&&"Set"!==s[Symbol.toStringTag]||(s=o(s)),t.push([n,s]);return t}{const t=["SET"];for(let n of e.values())!n||"Map"!==n[Symbol.toStringTag]&&"Set"!==n[Symbol.toStringTag]||(n=o(n)),t.push(n);return t}}Object.defineProperty(t,"__esModule",{value:!0}),t.whyUsernameIsInvalid=t.whyTeamSubdomainIsInvalid=t.whyNewPasswordIsInvalid=t.toTitleCase=t.toDebugObj=t.toDebugStr=void 0,t.toDebugStr=function(e){return JSON.stringify(o(e),null,2)},t.toDebugObj=o,t.toTitleCase=function(e){return e.replace(/\w+/g,e=>e.charAt(0).toLocaleUpperCase()+e.substr(1))},t.whyNewPasswordIsInvalid=function(e){if(e.length<8)return"A password must have at least 8 characters"},t.whyTeamSubdomainIsInvalid=function(e){return e.length<2||e.length>16?"A team subdomain must have at least 2 characters and 16 characters at most":/^[0-9a-zA-Z]+(-[0-9a-zA-Z]+)*$/.test(e)?void 0:"A subdomain should only contains alphanumeric characters and dash and should not begin or end with dash."},t.whyUsernameIsInvalid=function(e){return e.length<1?"A username should have at least one character.":/\W/.test(e)?"A username can contain only letters, digits and underscore.":void 0}},function(e,t,n){e.exports=n(10)},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";function o(e){return"string"==typeof e?[e]:e}function s(e){return 1===e.length&&Array.isArray(e[0])?e[0]:e}n.r(t);class i{constructor(e,t){this.app=e,this.componentId=t,this.map=new Map}invokeOrder(e,t){for(let n of o(e))this.exec(n,t);let n=this.app.getChildrenOf(this.componentId);for(let o of n)o.getDOrders().invokeOrder(e,t)}listenToDescendingOrder(e,t,n=null){for(let s of o(e)){let e=this.map.get(s);e||this.map.set(s,e=[]),e.push({cb:t,thisArg:n})}}stopListeningDescendingOrder(e,t,n=null){for(let s of o(e)){let e=this.map.get(s);e&&this.map.set(s,e.filter(e=>e.cb!==t||e.thisArg!==n))}}exec(e,t){let n=this.map.get(e);n&&n.forEach(e=>function(e,t){e.thisArg?e.cb.call(e.thisArg,t):e.cb(t)}(e,t))}}function r(e,t){e.thisArg?e.cb.call(e.thisArg,t.data,t):e.cb(t.data,t)}class a{constructor(e,t){this.log=e,this.eventNames=new Set,this.strictEvents=!1,this.destroyed=!1,t&&this.exposeEvent(t,!1)}exposeEvent(e,t){if(this.destroyed)throw new Error("Cannot call exposeEvent in a destroyed transmitter");for(let t of e)this.eventNames.add(t);t&&(this.strictEvents=!0)}emit(e){if(this.destroyed||!this.listeners)return;if(this.strictEvents&&!this.eventNames.has(e.eventName))throw new Error("Unexposed event: "+e.eventName);let t=this.listeners.get(e.eventName);if(t)for(let n of t)try{r(n,e)}catch(e){this.log.error(e)}}on(e,t,n){if(!this.destroyed){this.listeners||(this.listeners=new Map);for(let o of e){let e=this.listeners.get(o);e||this.listeners.set(o,e=[]),e.push({cb:t,thisArg:n})}}}off(e,t,n){if(!this.destroyed&&this.listeners)for(let[o,s]of this.listeners)if(!e||e.has(o))for(let e=0;e<s.length;++e){let o=s[e];o.cb===t&&o.thisArg===n&&(s.splice(e,1),--e)}}destroy(){this.listeners=void 0,this.destroyed=!0}}class l{listenTo(e,t,n,o=null){e.on(t,n,o),this.map||(this.map=new Map);let s=this.map.get(n);s||this.map.set(n,s=new Map);let i=s.get(o);i||s.set(o,i=new Map);let r=i.get(e);r||i.set(e,r=new Set);for(let e of t)r.add(e)}stopListeningEverywhere(e,t=null){if(!this.map)return;let n=this.map.get(e);if(!n)return;let o=n.get(t);if(o){for(let[n,s]of o)n.off(s,e,t);n.delete(t),0===n.size&&this.map.delete(e)}}stopListening(e,t,n,o=null){if(!this.map)return;let s=this.map.get(n);if(!s)return;let i=s.get(o);if(!i)return;let r=i.get(e);if(!r)return;let a=new Set;for(let e of t)r.delete(e)&&a.add(e);e.off(a,n,o),0===r.size&&(i.delete(e),0===i.size&&(s.delete(o),0===s.size&&this.map.delete(n)))}destroy(){if(this.map){for(let[e,t]of this.map)for(let[n,o]of t)for(let[t,s]of o)t.off(s,e,n);this.map=void 0}}}const d=Symbol("canPropagate");class c{constructor(e,t){var n;this.app=e,this.componentId=t,this.subscriber=new l,this.emitter=new a(e.log,["destroy"]),this.pub=(n=this,Object.freeze({unmanagedListeners:Object.freeze({on:(e,t,s)=>{n.emitter.on(o(e),t,s)},off:(e,t,s)=>{n.emitter.off(new Set(o(e)),t,s)}}),getComponent:()=>n.getInstance(),children:(e={})=>n.getChildren(e),hasChildren:(e={})=>n.hasChildren(e),isChild:e=>n.isChild(e),destroy:()=>n.destroy(),invokeDescendingOrder(e,t){return n.getDOrders().invokeOrder(e,t),this},isComponent:e=>n.app.isComponent(e),getPublicDashOf:e=>n.app.getBkbByInst(e).pub,getParentOf(e){let t=n.app.getBkbByInst(e).getParent();return t?t.getInstance():void 0},log:n.app.log,get app(){return n.app.root.getInstance()}})),this.dash=function(e,t){let n={setInstance:t=>(e.setInstance(t),i),exposeEvent:(...t)=>(e.emitter.exposeEvent(s(t),!0),i),create:(t,n)=>e.createChild({asObj:!1,Class:t,opt:n}).getInstance(),registerComponent:t=>e.createChild({asObj:!0,obj:t}).dash,addToGroup:(t,...n)=>(e.addToGroup(t,s(n)),i),inGroup:(t,...n)=>e.inGroup(t,s(n)),emit(t,n,o){let s=Array.isArray(t)?t:[t];for(let t of s)e.emit(t,n,o);return i},broadcast:(t,n)=>(e.broadcast(t,n),i),listenTo:(...t)=>{let n,s,r,a;if(2===t.length||"string"==typeof t[0]||Array.isArray(t[0]))[s,r,a]=t,n=e;else{let o;[o,s,r,a]=t,n=e.app.getBkbByInst(o)}return e.subscriber.listenTo(n.emitter,o(s),r,a),i},stopListening:(...t)=>{let n,s,r,a,l=t.length;if("string"==typeof t[0]||Array.isArray(t[0]))[s,r,a]=t,n=e;else{if(1===l||2===l)return[r,a]=t,void e.subscriber.stopListeningEverywhere(r,a);{let o;[o,s,r,a]=t,n=e.app.getBkbByInst(o)}}return e.subscriber.stopListening(n.emitter,o(s),r,a),i},listenToDescendingOrder:(t,n,o)=>(e.getDOrders().listenToDescendingOrder(t,n,o),i),stopListeningDescendingOrder:(t,n,o)=>(e.getDOrders().stopListeningDescendingOrder(t,n,o),i),destroyChildren:(t={})=>(e.destroyChildren(t),i),publicDash:t},i=Object.assign(Object.create(t),n);return Object.assign(i,...e.app.augmentList.map(e=>e(i))),e.app.root&&e.app.root!==e||(i.addDashAugmentation=t=>{e.app.augmentList.push(t)}),Object.freeze(i),i}(this,this.pub)}makeInstance(e,t){if(this.inst)return;let n;try{n=new e(this.dash,t)}catch(e){throw this.destroy(),e}this.setInstance(n)}setInstance(e){if(!this.pub)throw new Error("Destroyed component");if(this.inst){if(e!==this.inst)throw new Error("Conflict between component instances")}else this.inst=e,this.app.setInstanceOf(this.componentId,this.inst)}getInstance(){if(!this.inst){if(this.pub)throw new Error("The component instance is still not initialized");throw new Error("Destroyed component")}return this.inst}destroy(){this.emit("destroy",void 0,{sync:!0,cancelPropagation:!0}),this.app.removeComponent(this,this.inst),this.childGroups&&this.childGroups.clear(),this.emitter.destroy(),this.subscriber.destroy(),this.pub=void 0,this.dash=void 0,this.inst=void 0}forgetChild(e){if(this.childGroups)for(let t of this.childGroups.values())t.delete(e)}createChild(e){return this.app.createComponent(e,this)}addToGroup(e,t){let n=this.app.getBkbByInst(e).componentId;if(this!==this.app.getParentOf(n))throw new Error(`The component ${n} is not a child of ${this.componentId}`);this.childGroups||(this.childGroups=new Map);for(let e of t){let t=this.childGroups.get(e);t||this.childGroups.set(e,t=new Set),t.add(n)}}inGroup(e,t){if(!this.childGroups)return!1;let n=this.app.getBkbByInst(e).componentId;for(let e of t){let t=this.childGroups.get(e);if(t&&t.has(n))return!0}return!1}broadcast(e,t={}){t.sync?this.emitter.emit(e):this.app.asyncCall(()=>this.emitter.emit(e))}emit(e,t,n={}){n.sync?this.emitSync(this.createEvent(e,t,n.cancelPropagation)):this.app.asyncCall(()=>this.emitSync(this.createEvent(e,t,n.cancelPropagation)))}getParent(){return this.app.getParentOf(this.componentId)}getParents(){let e=this,t=[];for(;e=this.app.getParentOf(e.componentId);)t.push(e);return t}getChildren(e){let t=this.getChildBkbs(e.group),n=[];for(let o of t)!o.inst||e.filter&&!e.filter(o)||n.push(o.inst);return n}hasChildren(e){return this.getChildren(e).length>0}isChild(e){let t=this.app.getBkbByInst(e).componentId;return this===this.app.getParentOf(t)}destroyChildren(e){let t=this.getChildBkbs(e.group);for(let n of t)e.filter&&!e.filter(n)||n.destroy()}getDOrders(){return this.dOrders||(this.dOrders=new i(this.app,this.componentId)),this.dOrders}createEvent(e,t,n){let o=this,s=!n;return Object.freeze({eventName:e,get source(){return o.getInstance()},data:t,stopPropagation:()=>{s=!1},[d]:()=>s})}emitSync(e){if(this.emitter.emit(e),e[d]&&e[d]()){let t=this.app.getParentOf(this.componentId);t&&t.emitSync(e)}}getChildBkbs(e){if(!e)return this.app.getChildrenOf(this.componentId);if(!this.childGroups)return[];let t="string"==typeof e?[e]:e,n=new Set;for(let e of t){let t=this.childGroups.get(e);if(t)for(let e of t.values())n.add(e)}let o=[];for(let e of n.values())o.push(this.app.getBkb(e));return o}}class h{constructor(e,t,n){this.augmentList=[],this.compCount=0,this.nodesByInst=new WeakMap,this.nodes=new Map,this.insideRmComp=!1;let o=this.newId();this.log=this.createLog(["error","warn","info","debug","trace"]),this.root=new c(this,o);let s={bkb:this.root};this.nodes.set(o,s),this.root.emitter.exposeEvent(["log","addComponent","removeComponent","changeComponent"],!1),t?this.root.setInstance(e):this.root.makeInstance(e,n),s.created=!0}setInstanceOf(e,t){let n=this.nodes.get(e);if(!n)throw new Error("Destroyed component");this.nodesByInst.set(t,n)}getParentOf(e){let t=this.findNode(e);return t.parent?t.parent.bkb:void 0}getChildrenOf(e){let t=[],n=this.findNode(e).children;if(n)for(let e of n.values())t.push(e.bkb);return t}getBkb(e){return this.findNode(e).bkb}getBkbByInst(e){return this.findNodeByInst(e).bkb}isComponent(e){return!!this.nodesByInst.get(e)}createComponent(e,t){if(!this.root.dash)throw new Error("Destroyed root component");let n=this.newId(),o=new c(this,n),s=this.findNode(t.componentId),i={bkb:o,parent:s};return this.nodes.set(n,i),s.children||(s.children=new Map),s.children.set(n,i),e.asObj?o.setInstance(e.obj):o.makeInstance(e.Class,e.opt),this.root.dash.emit(["addComponent","changeComponent"],{component:o.getInstance(),type:"add"}),i.created=!0,o}removeComponent(e,t){if(!this.root.dash)throw new Error("Destroyed root component");let n=!this.insideRmComp;try{let o=e.componentId,s=this.findNode(o);if(n&&(this.insideRmComp=!0,t&&s.created)){let e={component:t,type:"remove"};this.root.dash.emit(["removeComponent","changeComponent"],e,{sync:!0})}if(s.children){for(let e of s.children.values())e.parent=void 0,e.bkb.destroy();s.children.clear()}s.parent&&(s.parent.bkb.forgetChild(o),s.parent.children.delete(o)),this.nodes.delete(o),t&&this.nodesByInst.delete(t)}finally{n&&(this.insideRmComp=!1)}}asyncCall(e){this.tickList?this.tickList.push(e):(this.tickList=[e],setTimeout(()=>{if(this.tickList){for(let e of this.tickList)try{e()}catch(e){this.log.error(e)}this.tickList=void 0}},0))}findNode(e){let t=this.nodes.get(e);if(!t)throw new Error(`Missing node of component "${e}"`);return t}findNodeByInst(e){let t=this.nodesByInst.get(e);if(!t)throw new Error("Cannot find a component for the instance: "+e);return t}newId(){return this.compCount++}createLog(e){let t={},n=0;for(let o of e)t[o]=(...e)=>{if(!this.root.dash)throw new Error("Destroyed root component");this.root.dash.emit("log",{level:o,messages:e,levelNumber:++n},{sync:!0})};return Object.freeze(t)}}var u=n(1),p=window.CustomEvent;function m(e){for(;e;){if("dialog"===e.localName)return e;e=e.parentElement}return null}function f(e){for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;e&&e.blur&&e!==document.body&&e.blur()}function g(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1}function b(e){return!(!e||!e.hasAttribute("method"))&&"dialog"===e.getAttribute("method").toLowerCase()}function v(e){return e.isConnected||document.body.contains(e)}function w(e){if(this.dialog_=e,this.replacedStyleTop_=!1,this.openAsModal_=!1,e.hasAttribute("role")||e.setAttribute("role","dialog"),e.show=this.show.bind(this),e.showModal=this.showModal.bind(this),e.close=this.close.bind(this),"returnValue"in e||(e.returnValue=""),"MutationObserver"in window){new MutationObserver(this.maybeHideModal.bind(this)).observe(e,{attributes:!0,attributeFilter:["open"]})}else{var t,n=!1,o=function(){n?this.downgradeModal():this.maybeHideModal(),n=!1}.bind(this),s=function(s){if(s.target===e){var i="DOMNodeRemoved";n|=s.type.substr(0,i.length)===i,window.clearTimeout(t),t=window.setTimeout(o,0)}};["DOMAttrModified","DOMNodeRemoved","DOMNodeRemovedFromDocument"].forEach((function(t){e.addEventListener(t,s)}))}Object.defineProperty(e,"open",{set:this.setOpen.bind(this),get:e.hasAttribute.bind(e,"open")}),this.backdrop_=document.createElement("div"),this.backdrop_.className="backdrop",this.backdrop_.addEventListener("click",this.backdropClick_.bind(this))}p&&"object"!=typeof p||((p=function(e,t){t=t||{};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!!t.bubbles,!!t.cancelable,t.detail||null),n}).prototype=window.Event.prototype),w.prototype={get dialog(){return this.dialog_},maybeHideModal:function(){this.dialog_.hasAttribute("open")&&v(this.dialog_)||this.downgradeModal()},downgradeModal:function(){this.openAsModal_&&(this.openAsModal_=!1,this.dialog_.style.zIndex="",this.replacedStyleTop_&&(this.dialog_.style.top="",this.replacedStyleTop_=!1),this.backdrop_.parentNode&&this.backdrop_.parentNode.removeChild(this.backdrop_),y.dm.removeDialog(this))},setOpen:function(e){e?this.dialog_.hasAttribute("open")||this.dialog_.setAttribute("open",""):(this.dialog_.removeAttribute("open"),this.maybeHideModal())},backdropClick_:function(e){if(this.dialog_.hasAttribute("tabindex"))this.dialog_.focus();else{var t=document.createElement("div");this.dialog_.insertBefore(t,this.dialog_.firstChild),t.tabIndex=-1,t.focus(),this.dialog_.removeChild(t)}var n=document.createEvent("MouseEvents");n.initMouseEvent(e.type,e.bubbles,e.cancelable,window,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget),this.dialog_.dispatchEvent(n),e.stopPropagation()},focus_:function(){var e=this.dialog_.querySelector("[autofocus]:not([disabled])");!e&&this.dialog_.tabIndex>=0&&(e=this.dialog_),e||(e=function e(t){var n=["button","input","keygen","select","textarea"].map((function(e){return e+":not([disabled])"}));n.push('[tabindex]:not([disabled]):not([tabindex=""])');var o=t.querySelector(n.join(", "));if(!o&&"attachShadow"in Element.prototype)for(var s=t.querySelectorAll("*"),i=0;i<s.length&&!(s[i].tagName&&s[i].shadowRoot&&(o=e(s[i].shadowRoot)));i++);return o}(this.dialog_)),f(document.activeElement),e&&e.focus()},updateZIndex:function(e,t){if(e<t)throw new Error("dialogZ should never be < backdropZ");this.dialog_.style.zIndex=e,this.backdrop_.style.zIndex=t},show:function(){this.dialog_.open||(this.setOpen(!0),this.focus_())},showModal:function(){if(this.dialog_.hasAttribute("open"))throw new Error("Failed to execute 'showModal' on dialog: The element is already open, and therefore cannot be opened modally.");if(!v(this.dialog_))throw new Error("Failed to execute 'showModal' on dialog: The element is not in a Document.");if(!y.dm.pushDialog(this))throw new Error("Failed to execute 'showModal' on dialog: There are too many open modal dialogs.");(function(e){for(;e&&e!==document.body;){var t=window.getComputedStyle(e),n=function(e,n){return!(void 0===t[e]||t[e]===n)};if(t.opacity<1||n("zIndex","auto")||n("transform","none")||n("mixBlendMode","normal")||n("filter","none")||n("perspective","none")||"isolate"===t.isolation||"fixed"===t.position||"touch"===t.webkitOverflowScrolling)return!0;e=e.parentElement}return!1})(this.dialog_.parentElement)&&console.warn("A dialog is being shown inside a stacking context. This may cause it to be unusable. For more information, see this link: https://github.com/GoogleChrome/dialog-polyfill/#stacking-context"),this.setOpen(!0),this.openAsModal_=!0,y.needsCentering(this.dialog_)?(y.reposition(this.dialog_),this.replacedStyleTop_=!0):this.replacedStyleTop_=!1,this.dialog_.parentNode.insertBefore(this.backdrop_,this.dialog_.nextSibling),this.focus_()},close:function(e){if(!this.dialog_.hasAttribute("open"))throw new Error("Failed to execute 'close' on dialog: The element does not have an 'open' attribute, and therefore cannot be closed.");this.setOpen(!1),void 0!==e&&(this.dialog_.returnValue=e);var t=new p("close",{bubbles:!1,cancelable:!1});this.dialog_.dispatchEvent(t)}};var y={reposition:function(e){var t=document.body.scrollTop||document.documentElement.scrollTop,n=t+(window.innerHeight-e.offsetHeight)/2;e.style.top=Math.max(t,n)+"px"},isInlinePositionSetByStylesheet:function(e){for(var t=0;t<document.styleSheets.length;++t){var n=document.styleSheets[t],o=null;try{o=n.cssRules}catch(e){}if(o)for(var s=0;s<o.length;++s){var i=o[s],r=null;try{r=document.querySelectorAll(i.selectorText)}catch(e){}if(r&&g(r,e)){var a=i.style.getPropertyValue("top"),l=i.style.getPropertyValue("bottom");if(a&&"auto"!==a||l&&"auto"!==l)return!0}}}return!1},needsCentering:function(e){return"absolute"===window.getComputedStyle(e).position&&(!("auto"!==e.style.top&&""!==e.style.top||"auto"!==e.style.bottom&&""!==e.style.bottom)&&!y.isInlinePositionSetByStylesheet(e))},forceRegisterDialog:function(e){if((window.HTMLDialogElement||e.showModal)&&console.warn("This browser already supports <dialog>, the polyfill may not work correctly",e),"dialog"!==e.localName)throw new Error("Failed to register dialog: The element is not a dialog.");new w(e)},registerDialog:function(e){e.showModal||y.forceRegisterDialog(e)},DialogManager:function(){this.pendingDialogStack=[];var e=this.checkDOM_.bind(this);this.overlay=document.createElement("div"),this.overlay.className="_dialog_overlay",this.overlay.addEventListener("click",function(t){this.forwardTab_=void 0,t.stopPropagation(),e([])}.bind(this)),this.handleKey_=this.handleKey_.bind(this),this.handleFocus_=this.handleFocus_.bind(this),this.zIndexLow_=1e5,this.zIndexHigh_=100150,this.forwardTab_=void 0,"MutationObserver"in window&&(this.mo_=new MutationObserver((function(t){var n=[];t.forEach((function(e){for(var t,o=0;t=e.removedNodes[o];++o)t instanceof Element&&("dialog"===t.localName&&n.push(t),n=n.concat(t.querySelectorAll("dialog")))})),n.length&&e(n)})))}};if(y.DialogManager.prototype.blockDocument=function(){document.documentElement.addEventListener("focus",this.handleFocus_,!0),document.addEventListener("keydown",this.handleKey_),this.mo_&&this.mo_.observe(document,{childList:!0,subtree:!0})},y.DialogManager.prototype.unblockDocument=function(){document.documentElement.removeEventListener("focus",this.handleFocus_,!0),document.removeEventListener("keydown",this.handleKey_),this.mo_&&this.mo_.disconnect()},y.DialogManager.prototype.updateStacking=function(){for(var e,t=this.zIndexHigh_,n=0;e=this.pendingDialogStack[n];++n)e.updateZIndex(--t,--t),0===n&&(this.overlay.style.zIndex=--t);var o=this.pendingDialogStack[0];o?(o.dialog.parentNode||document.body).appendChild(this.overlay):this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay)},y.DialogManager.prototype.containedByTopDialog_=function(e){for(;e=m(e);){for(var t,n=0;t=this.pendingDialogStack[n];++n)if(t.dialog===e)return 0===n;e=e.parentElement}return!1},y.DialogManager.prototype.handleFocus_=function(e){if(!this.containedByTopDialog_(e.target)&&document.activeElement!==document.documentElement&&(e.preventDefault(),e.stopPropagation(),f(e.target),void 0!==this.forwardTab_)){var t=this.pendingDialogStack[0];return t.dialog.compareDocumentPosition(e.target)&Node.DOCUMENT_POSITION_PRECEDING&&(this.forwardTab_?t.focus_():e.target!==document.documentElement&&document.documentElement.focus()),!1}},y.DialogManager.prototype.handleKey_=function(e){if(this.forwardTab_=void 0,27===e.keyCode){e.preventDefault(),e.stopPropagation();var t=new p("cancel",{bubbles:!1,cancelable:!0}),n=this.pendingDialogStack[0];n&&n.dialog.dispatchEvent(t)&&n.dialog.close()}else 9===e.keyCode&&(this.forwardTab_=!e.shiftKey)},y.DialogManager.prototype.checkDOM_=function(e){this.pendingDialogStack.slice().forEach((function(t){-1!==e.indexOf(t.dialog)?t.downgradeModal():t.maybeHideModal()}))},y.DialogManager.prototype.pushDialog=function(e){var t=(this.zIndexHigh_-this.zIndexLow_)/2-1;return!(this.pendingDialogStack.length>=t)&&(1===this.pendingDialogStack.unshift(e)&&this.blockDocument(),this.updateStacking(),!0)},y.DialogManager.prototype.removeDialog=function(e){var t=this.pendingDialogStack.indexOf(e);-1!==t&&(this.pendingDialogStack.splice(t,1),0===this.pendingDialogStack.length&&this.unblockDocument(),this.updateStacking())},y.dm=new y.DialogManager,y.formSubmitter=null,y.useValue=null,void 0===window.HTMLDialogElement){var E=document.createElement("form");if(E.setAttribute("method","dialog"),"dialog"!==E.method){var C=Object.getOwnPropertyDescriptor(HTMLFormElement.prototype,"method");if(C){var D=C.get;C.get=function(){return b(this)?"dialog":D.call(this)};var A=C.set;C.set=function(e){return"string"==typeof e&&"dialog"===e.toLowerCase()?this.setAttribute("method",e):A.call(this,e)},Object.defineProperty(HTMLFormElement.prototype,"method",C)}}document.addEventListener("click",(function(e){if(y.formSubmitter=null,y.useValue=null,!e.defaultPrevented){var t=e.target;if(t&&b(t.form)){if(!("submit"===t.type&&["button","input"].indexOf(t.localName)>-1)){if("input"!==t.localName||"image"!==t.type)return;y.useValue=e.offsetX+","+e.offsetY}m(t)&&(y.formSubmitter=t)}}}),!1);var M=HTMLFormElement.prototype.submit;HTMLFormElement.prototype.submit=function(){if(!b(this))return M.call(this);var e=m(this);e&&e.close()},document.addEventListener("submit",(function(e){if(!e.defaultPrevented){var t=e.target;if(b(t)){e.preventDefault();var n=m(t);if(n){var o=y.formSubmitter;o&&o.form===t?n.close(y.useValue||o.value):n.close(),y.formSubmitter=null}}}}),!1)}var k=y;n(0);class I{constructor(){this.promise=new Promise((e,t)=>{this.resolveCb=e,this.rejectCb=t})}pipeTo(e){return e.then(e=>this.resolve(e),e=>this.reject(e)),this.promise}resolve(e){this.resolveCb(e)}reject(e){this.rejectCb(e)}}function _(e){for(;e.firstChild;)e.removeChild(e.firstChild)}n(4);class O{constructor(e){this.dash=e;const{root:t,ref:n}=function(){const e=document.createElement("dialog");e.setAttribute("class","ErrorDialog ModalDialog");const t=document.createElement("header");e.appendChild(t),t.setAttribute("class","ModalDialog-header");const n=document.createElement("div");e.appendChild(n),n.setAttribute("class","ModalDialog-content");const o=document.createElement("div");e.appendChild(o),o.setAttribute("class","ModalDialog-bottom");const s=document.createElement("div");t.appendChild(s),s.setAttribute("class","ModalDialog-headerLeft");const i=document.createElement("div");t.appendChild(i),i.setAttribute("class","ModalDialog-headerRight");const r=document.createElement("div");n.appendChild(r),r.setAttribute("class","ModalDialog-contentLeft ErrorDialog-contentLeft");const a=document.createElement("div");n.appendChild(a),a.setAttribute("class","ModalDialog-contentRight");const l=document.createElement("button");o.appendChild(l),l.setAttribute("class","ModalDialogOkButton");const d=document.createElement("span");s.appendChild(d);const c=document.createElement("span");i.appendChild(c),c.setAttribute("class","fas fa-times fa-1x ModalDialogCloseItem");const h=document.createElement("span");r.appendChild(h),h.setAttribute("class","fas fa-3x fa-exclamation-circle");const u=document.createElement("div");a.appendChild(u);const p=document.createTextNode("OK");l.appendChild(p);const m={button:l,title:d,close:c,message:u};return{root:e,refs:m,ref:e=>{if(!m[e])throw new Error(`Missing handle: '${e}'`);return m[e]},update:()=>{}}}();this.el=t,this.msgEl=n("message"),this.titleEl=n("title"),k.registerDialog(this.el);const o=()=>this.close();n("button").addEventListener("click",o),n("close").addEventListener("click",o),this.el.addEventListener("cancel",e=>{e.preventDefault(),this.close()}),this.el.addEventListener("keydown",e=>{"Enter"===e.key&&this.close()})}show(e,t="Error"){this.currDfd=new I,this.titleEl.textContent=t,_(this.msgEl);const n="string"==typeof e?[e]:e;for(const e of n){const t=document.createElement("p");t.textContent=e,this.msgEl.appendChild(t)}return document.body.appendChild(this.el),this.el,this.el.showModal(),this.currDfd.promise}close(){this.currDfd&&this.currDfd.resolve(!0),this.currDfd=void 0,this.el.close(),document.body.removeChild(this.el)}}n(5);class S{constructor(e){this.dash=e;const{root:t,ref:n}=function(){const e=document.createElement("dialog");e.setAttribute("class","ModalDialog InfoDialog");const t=document.createElement("header");e.appendChild(t),t.setAttribute("class","ModalDialog-header");const n=document.createElement("div");e.appendChild(n),n.setAttribute("class","ModalDialog-content");const o=document.createElement("div");e.appendChild(o),o.setAttribute("class","ModalDialog-bottom");const s=document.createElement("div");t.appendChild(s),s.setAttribute("class","ModalDialog-headerLeft");const i=document.createElement("div");t.appendChild(i),i.setAttribute("class","ModalDialog-headerRight");const r=document.createElement("div");n.appendChild(r),r.setAttribute("class","ModalDialog-contentLeft InfoDialog-contentLeft");const a=document.createElement("div");n.appendChild(a),a.setAttribute("class","ModalDialog-contentRight");const l=document.createElement("button");o.appendChild(l),l.setAttribute("class","ModalDialogOkButton");const d=document.createElement("span");s.appendChild(d);const c=document.createElement("span");i.appendChild(c),c.setAttribute("class","fas fa-times fa-1x ModalDialogCloseItem");const h=document.createElement("span");r.appendChild(h),h.setAttribute("class","fas fa-3x fa-info-circle");const u=document.createElement("div");a.appendChild(u);const p=document.createTextNode("OK");l.appendChild(p);const m={button:l,title:d,close:c,message:u};return{root:e,refs:m,ref:e=>{if(!m[e])throw new Error(`Missing handle: '${e}'`);return m[e]},update:()=>{}}}();this.el=t,this.msgEl=n("message"),this.titleEl=n("title"),k.registerDialog(this.el);const o=()=>this.close();n("button").addEventListener("click",o),n("close").addEventListener("click",o),this.el.addEventListener("cancel",e=>{e.preventDefault(),this.close()}),this.el.addEventListener("keydown",e=>{"Enter"===e.key&&(e.stopPropagation(),this.close())})}show(e,t="Information"){this.currDfd=new I,this.titleEl.textContent=t,_(this.msgEl);const n="string"==typeof e?[e]:e;for(const e of n){const t=document.createElement("p");t.textContent=e,this.msgEl.appendChild(t)}return document.body.appendChild(this.el),this.el,this.el.showModal(),this.currDfd.promise}close(){this.currDfd&&this.currDfd.resolve(!0),this.currDfd=void 0,this.el.close(),document.body.removeChild(this.el)}}n(6);class T{constructor(e){this.dash=e;const{root:t,ref:n}=function(){const e=document.createElement("dialog");e.setAttribute("class","ModalDialog WarningDialog");const t=document.createElement("header");e.appendChild(t),t.setAttribute("class","ModalDialog-header");const n=document.createElement("div");e.appendChild(n),n.setAttribute("class","ModalDialog-content");const o=document.createElement("div");e.appendChild(o),o.setAttribute("class","ModalDialog-bottom");const s=document.createElement("div");t.appendChild(s),s.setAttribute("class","ModalDialog-headerLeft");const i=document.createElement("div");t.appendChild(i),i.setAttribute("class","ModalDialog-headerRight");const r=document.createElement("div");n.appendChild(r),r.setAttribute("class","ModalDialog-contentLeft WarningDialog-contentLeft");const a=document.createElement("div");n.appendChild(a),a.setAttribute("class","ModalDialog-contentRight");const l=document.createElement("button");o.appendChild(l),l.setAttribute("class","ModalDialogOkButton");const d=document.createElement("span");s.appendChild(d);const c=document.createElement("span");i.appendChild(c),c.setAttribute("class","fas fa-times fa-lg ModalDialogCloseItem");const h=document.createElement("span");r.appendChild(h),h.setAttribute("class","fas fa-3x fa-exclamation-triangle");const u=document.createElement("div");a.appendChild(u);const p=document.createTextNode("OK");l.appendChild(p);const m={button:l,title:d,close:c,message:u};return{root:e,refs:m,ref:e=>{if(!m[e])throw new Error(`Missing handle: '${e}'`);return m[e]},update:()=>{}}}();this.el=t,this.msgEl=n("message"),this.titleEl=n("title"),k.registerDialog(this.el);const o=()=>this.close();n("button").addEventListener("click",o),n("close").addEventListener("click",o),this.el.addEventListener("cancel",e=>{e.preventDefault(),this.close()}),this.el.addEventListener("keydown",e=>{"Enter"===e.key&&this.close()})}show(e,t="Warning"){this.currDfd=new I,this.titleEl.textContent=t,_(this.msgEl);const n="string"==typeof e?[e]:e;for(const e of n){const t=document.createElement("p");t.textContent=e,this.msgEl.appendChild(t)}return document.body.appendChild(this.el),this.el,this.el.showModal(),this.currDfd.promise}close(){this.currDfd&&this.currDfd.resolve(!0),this.currDfd=void 0,this.el.close(),document.body.removeChild(this.el)}}n(7);class x{constructor(e,t){this.dash=e,this.options=t;const{root:n,ref:o}=function(){const e=document.createElement("dialog");e.setAttribute("class","RegistrationForm");const t=document.createElement("div");e.appendChild(t),t.setAttribute("class","FieldGroup");const n=document.createElement("label");t.appendChild(n),n.setAttribute("class","FieldGroup-item Field");const o=document.createElement("label");t.appendChild(o),o.setAttribute("class","FieldGroup-item Field");const s=document.createElement("label");t.appendChild(s),s.setAttribute("class","FieldGroup-item Field");const i=document.createElement("label");t.appendChild(i),i.setAttribute("class","FieldGroup-item Field");const r=document.createElement("label");t.appendChild(r),r.setAttribute("class","FieldGroup-item Field");const a=document.createElement("div");t.appendChild(a);const l=document.createElement("span");n.appendChild(l),l.setAttribute("class","Field-lbl");const d=document.createElement("span");n.appendChild(d),d.setAttribute("class","Field-deco -leftBlue");const c=document.createElement("span");o.appendChild(c),c.setAttribute("class","Field-lbl");const h=document.createElement("span");o.appendChild(h),h.setAttribute("class","Field-deco -leftBlue");const u=document.createElement("span");s.appendChild(u),u.setAttribute("class","Field-lbl");const p=document.createElement("span");s.appendChild(p),p.setAttribute("class","Field-deco -leftBlue");const m=document.createElement("span");i.appendChild(m),m.setAttribute("class","Field-lbl");const f=document.createElement("span");i.appendChild(f),f.setAttribute("class","Field-deco -leftBlue");const g=document.createElement("span");r.appendChild(g),g.setAttribute("class","Field-lbl");const b=document.createElement("span");r.appendChild(b),b.setAttribute("class","Field-deco -leftBlue");const v=document.createElement("button");a.appendChild(v),v.setAttribute("class","FieldGroup-action Btn WithLoader -right"),v.setAttribute("type","button");const w=document.createTextNode("\n       \n      ");a.appendChild(w);const y=document.createElement("button");a.appendChild(y),y.setAttribute("class","Btn"),y.setAttribute("type","button");const E=document.createTextNode("Name");l.appendChild(E);const C=document.createElement("input");d.appendChild(C),C.setAttribute("class","Field-input"),C.setAttribute("type","text"),C.setAttribute("placeholder","Name");const D=document.createTextNode("Choose your username");c.appendChild(D);const A=document.createElement("input");h.appendChild(A),A.setAttribute("class","Field-input"),A.setAttribute("type","text"),A.setAttribute("placeholder","Username");const M=document.createTextNode("Create a password");u.appendChild(M);const k=document.createElement("input");p.appendChild(k),k.setAttribute("class","Field-input"),k.setAttribute("type","password"),k.setAttribute("placeholder","Password");const I=document.createTextNode("Confirm your password");m.appendChild(I);const _=document.createElement("input");f.appendChild(_),_.setAttribute("class","Field-input"),_.setAttribute("type","password"),_.setAttribute("placeholder","Password confirmation");const O=document.createTextNode("Your email address");g.appendChild(O);const S=document.createElement("input");b.appendChild(S),S.setAttribute("class","Field-input"),S.setAttribute("type","email"),S.setAttribute("placeholder","Email");const T=document.createTextNode("\n        Submit\n        ");v.appendChild(T);const x=document.createElement("span");v.appendChild(x),x.setAttribute("class","WithLoader-l");const L=document.createTextNode("Cancel");y.appendChild(L);const P={submitBtn:v,cancelBtn:y,name:C,username:A,password:k,confirm:_,email:S,spinner:x};return{root:e,refs:P,ref:e=>{if(!P[e])throw new Error(`Missing handle: '${e}'`);return P[e]},update:()=>{}}}();this.el=n,this.nameEl=o("name"),this.usernameEl=o("username"),this.passwordEl=o("password"),this.confirmEl=o("confirm"),this.emailEl=o("email"),k.registerDialog(this.el),o("submitBtn").addEventListener("click",()=>this.onSubmit()),o("cancelBtn").addEventListener("click",()=>{this.curDfd&&(this.curDfd.reject("Process canceled"),this.curDfd=void 0,this.el.close())}),this.usernameEl.value=t.username||"",this.el.addEventListener("cancel",e=>e.preventDefault()),document.body.appendChild(this.el)}async open(){return this.el.showModal(),this.curDfd=new I,this.curDfd.promise}async onSubmit(){const e=this.dash.create(T);let t;const n=this.nameEl.value.trim();if(0===n.length)return await e.show("Please enter your name."),void this.nameEl.focus();const o=this.usernameEl.value.trim();if(t=Object(u.whyUsernameIsInvalid)(o),t)return await e.show(t),void this.usernameEl.focus();const s=this.passwordEl.value;if(t=Object(u.whyNewPasswordIsInvalid)(s),t)return await e.show(t),void this.passwordEl.focus();if(this.confirmEl.value!==s)return await e.show("Passwords do not match."),void this.confirmEl.focus();const i=this.emailEl.value.trim();if(0===i.length||!function(e){return null!==/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.exec(e)}(i))return await e.show("Please enter a valid email address."),void this.emailEl.focus();await this.register(n,o,s,i)&&this.curDfd&&(this.curDfd.resolve(!0),this.curDfd=void 0,this.el.close())}async register(e,t,n,o){try{const s=await fetch(this.dash.app.baseUrl+"/api/registration/register",{method:"post",credentials:"same-origin",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({name:e,login:t,password:n,email:o,token:this.options.token})});if(!s.ok)throw new Error("Our server did not process the request.");return(await s.json()).done?(this.dash.create(S).show("You have been successfully registred."),!0):(this.dash.create(S).show("Registration failed. Try again later or contact the admin."),!1)}catch(e){this.dash.create(O).show("Something went wrong. We are sorry for the inconvenience. Try again later."),this.dash.log.error(e)}return!1}}n(8);class L{constructor(){const{root:e,ref:t}=function(){const e=document.createElement("div");e.setAttribute("class","PasswordEdit FieldGroup");const t=document.createElement("label");e.appendChild(t),t.setAttribute("class","FieldGroup-item Field");const n=document.createElement("label");e.appendChild(n),n.setAttribute("class","FieldGroup-item Field");const o=document.createElement("span");t.appendChild(o),o.setAttribute("class","Field-lbl");const s=document.createElement("input");t.appendChild(s),s.setAttribute("class","Field-input"),s.setAttribute("type","password");const i=document.createElement("span");n.appendChild(i),i.setAttribute("class","Field-lbl");const r=document.createElement("input");n.appendChild(r),r.setAttribute("class","Field-input"),r.setAttribute("type","password");const a=document.createTextNode("Password");o.appendChild(a);const l=document.createTextNode("Confirm password");i.appendChild(l);const d={primary:s,confirm:r};return{root:e,refs:d,ref:e=>{if(!d[e])throw new Error(`Missing handle: '${e}'`);return d[e]},update:()=>{}}}();this.el=e,this.primaryEl=t("primary"),this.confirmEl=t("confirm")}focus(){this.primaryEl.focus()}clear(){this.primaryEl.value="",this.confirmEl.value=""}passwordsMatch(){return this.confirmEl.value===this.primaryEl.value}getPasswordIfMatch(){const e=this.primaryEl.value;return e===this.confirmEl.value?e:void 0}getPassword(){return this.primaryEl.value}hasPassword(){return""!==this.getPassword()}}n(9);class P{constructor(e,t){this.dash=e,this.options=t;const{root:n,ref:o}=function(){const e=document.createElement("dialog");e.setAttribute("class","PasswordResetDialog");const t=document.createElement("header");e.appendChild(t),t.setAttribute("class","PasswordResetDialog-header");const n=document.createElement("div");e.appendChild(n);const o=document.createElement("div");e.appendChild(o),o.setAttribute("class","PasswordResetDialog-div");const s=document.createTextNode("Password change");t.appendChild(s);const i=document.createElement("button");o.appendChild(i),i.setAttribute("class","Btn WithLoader -right"),i.setAttribute("type","button");const r=document.createTextNode("\n      Submit\n      ");i.appendChild(r);const a=document.createElement("span");i.appendChild(a),a.setAttribute("class","WithLoader-l"),a.setAttribute("hidden","");const l={container:n,submitBtn:i,spinner:a};return{root:e,refs:l,ref:e=>{if(!l[e])throw new Error(`Missing handle: '${e}'`);return l[e]},update:()=>{}}}();this.el=n,k.registerDialog(this.el),this.spinnerEl=o("spinner"),this.edit=this.dash.create(L),o("container").appendChild(this.edit.el);o("submitBtn").addEventListener("click",()=>this.onSubmit()),this.el.addEventListener("keyup",e=>{"Enter"===e.key&&this.onSubmit().catch(e=>this.dash.log.error(e))}),this.el.addEventListener("cancel",e=>e.preventDefault())}open(){document.body.appendChild(this.el),this.el.showModal()}async onSubmit(){const e=this.edit.getPasswordIfMatch();if(void 0===e)return await this.dash.create(S).show("Passwords do not match."),void this.edit.focus();const t=Object(u.whyNewPasswordIsInvalid)(e);if(t)return await this.dash.create(S).show(t),void this.edit.focus();this.spinnerEl.hidden=!1,await this.doPasswordChange(e),this.spinnerEl.hidden=!0}async doPasswordChange(e){try{if(await this.doFetch(e)){setTimeout(()=>window.location.href=this.dash.app.baseUrl+"/",4e3),await this.dash.create(S).show("Password changed. You will be redirected to the login page.")}}catch(e){await this.dash.create(O).show("Impossible to change the password. Error on server."),this.dash.app.log.warn(e)}}async doFetch(e){try{const t=await fetch(this.dash.app.baseUrl+"/api/registration/reset-password",{method:"post",credentials:"same-origin",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({accountId:this.options.accountId,token:this.options.token,password:e})});if(!t.ok)return await this.dash.create(O).show("Unable to get a response from server."),!1;const n=await t.json();if(!n.done)return await this.dash.create(S).show("Sorry. Impossible to change your password. "+n.reason),!1}catch(e){return await this.dash.create(O).show("Impossible to change the password. Error on server."),!1}return!0}}class N{constructor(e,t){var n;this.dash=e,this.params=t,this.log=e.log,this.baseUrl=document.documentElement.dataset.baseUrl||"";const o=null!==(n=document.documentElement.dataset.env)&&void 0!==n?n:"prod";this.dash.listenTo("log",e=>{console&&("local"!==o&&"error"!==e.level&&"warn"!==e.level||(console[e.level]?console[e.level](...e.messages):console.log(`[${e.level}]`,...e.messages)))})}start(){if("passwordreset"===this.params.action)this.handlePasswordReset();else{if("registration"!==this.params.action)throw new Error("Unknown action: "+this.params.action);this.handleUserRegistration()}}handlePasswordReset(){if(!this.params.accountId)throw new Error("User ID not provided");this.dash.create(P,{accountId:this.params.accountId,token:this.params.token}).open()}async handleUserRegistration(){const e=this.dash.create(x,{token:this.params.token,username:this.params.username});await e.open()&&(window.location.href=this.baseUrl+"/")}}n(3),document.addEventListener("DOMContentLoaded",()=>{const e=new URL(window.location.href),t=e.searchParams.get("action");if(!t)throw new Error("Missing parameter 'action'");const n=e.searchParams.get("action");if(!n)throw new Error("Missing parameter 'token'");(function(e,t){return new h(e,!1,t).root.getInstance()})(N,{action:t,token:n,accountId:e.searchParams.get("uid")||void 0,username:e.searchParams.get("username")||void 0}).start()})}]);