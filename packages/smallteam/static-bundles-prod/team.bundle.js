!function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=6)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,...t){throw new Error('Configure the webpack loader or use "handledom/browser"')}},function(e,t,s){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.toIdentifier=t.getFragmentMeta=t.types=void 0;const r=n(s(34)),i=n(s(35)),o=n(s(36)),a=n(s(37)),l=n(s(38)),c=n(s(39)),d=n(s(40)),h=n(s(41)),u=n(s(42)),p=n(s(43));t.types=Object.freeze(["Comment","Account","Flag","Project","Step","Task","TaskLogEntry","Media","MediaVariant","GitCommit"]);const m={Comment:i.default,Account:r.default,Flag:o.default,Project:d.default,Step:h.default,Task:u.default,TaskLogEntry:p.default,Media:l.default,MediaVariant:c.default,GitCommit:a.default};function f(e,t="read"){const s=m[e];if(!s)throw new Error(`Unknown type "${e}" for fragment meta`);const n=s[t];if(!n)throw new Error(`Missing variant "${t}" of fragment meta for type: ${e}`);return n}t.getFragmentMeta=f,t.toIdentifier=function(e,t){const s=f(t,"id");let n,r;for(const t of Object.keys(s.fields)){if(void 0===e[t])throw new Error(`[${s.type}] Missing value for field: ${t} in ${JSON.stringify(e)}`);r?n=void 0:(n=e[t],r={}),r[t]=e[t]}if(!r)throw new Error(`[${s.type}] No identifier`);return void 0!==n?n:r}},function(e,t,s){"use strict";function n(e,t,s,n=!1){for(const r of s){if(!t.fields[r])throw new Error(`Unknown field "${r}" in meta ${t.type}`);if(e[r])throw new Error(`Conflict with field "${r}" in meta ${t.type}`);e[r]=n?{...t.fields[r],optional:!0}:t.fields[r]}}Object.defineProperty(t,"__esModule",{value:!0}),t.searchPickFragmentMeta=t.pickUpdateFragmentMeta=t.pickFragmentMeta=void 0,t.pickFragmentMeta=function(e,t,s){const n={};for(const e of s){if(!t.fields[e])throw new Error(`Unknown field "${e}" in meta ${t.type}`);n[e]=t.fields[e]}return{type:t.type,variant:e,fields:n,orderFieldName:t.orderFieldName}},t.pickUpdateFragmentMeta=function(e,t,s,r){const i={};return n(i,t,s),n(i,t,r,!0),{type:t.type,variant:e,fields:i,orderFieldName:t.orderFieldName}},t.searchPickFragmentMeta=function(e,t,s,r=!0){const i={};return r&&(i.search={dataType:"string",optional:!0}),n(i,t,s,!0),{type:t.type,variant:e,fields:i,orderFieldName:t.orderFieldName}}},function(e,t,s){"use strict";function n(e,t){const s=e();return{[Symbol.iterator]:()=>n(e,t),next:e=>{const{done:n,value:r}=s.next(e);if(null==r)return{done:n,value:r};let i;if("key"===t)i=JSON.parse(r);else{const[e,s]=r;if("keyVal"===t)i=[JSON.parse(e),s];else{const t=JSON.parse(e);i=[t,t]}}return{done:n,value:i}}}}function r(e){const t=[],s=function e(s,n,r){if(r&&r.toJSON&&"function"==typeof r.toJSON&&(r=r.toJSON()),void 0!==r){if("object"!=typeof r||null===r)return JSON.stringify(r);if(Array.isArray(r)){const t=[];for(let s=0;s<r.length;s++)t.push(e(r,s,r[s])||JSON.stringify(null));return"["+t.join(",")+"]"}{if(-1!==t.indexOf(r))throw new TypeError("Converting circular structure to JSON");t.push(r);const s=Object.keys(r).sort(),n=[];for(const t of s){const s=e(r,t,r[t]);void 0!==s&&n.push(JSON.stringify(t)+":"+s)}return t.splice(t.indexOf(r),1),"{"+n.join(",")+"}"}}}(0,0,e);return void 0===s?JSON.stringify(void 0):s}Object.defineProperty(t,"__esModule",{value:!0}),t.makeHKSet=t.makeHKMap=void 0,t.makeHKMap=function(e){const t=new Map,s={clear:()=>t.clear(),delete:e=>t.delete(r(e)),forEach:(e,s)=>{t.forEach((t,s)=>e(t,JSON.parse(s),this),s)},get:e=>t.get(r(e)),has:e=>t.has(r(e)),set:(e,s)=>(t.set(r(e),s),this),get size(){return t.size},get[Symbol.toStringTag](){return t[Symbol.toStringTag]},[Symbol.iterator]:()=>n(()=>t[Symbol.iterator](),"keyVal"),entries:()=>n(()=>t.entries(),"keyVal"),keys:()=>n(()=>t.keys(),"key"),values:()=>t.values()};if(e)for(const[t,n]of e)s.set(t,n);return s},t.makeHKSet=function(e){const t=new Set,s={clear:()=>t.clear(),delete:e=>t.delete(r(e)),forEach:(e,s)=>{t.forEach((t,s)=>e(JSON.parse(t),JSON.parse(s),this),s)},has:e=>t.has(r(e)),add:e=>(t.add(r(e)),this),get size(){return t.size},get[Symbol.toStringTag](){return t[Symbol.toStringTag]},[Symbol.iterator]:()=>n(()=>t[Symbol.iterator](),"key"),entries:()=>n(()=>t.entries(),"keyKey"),keys:()=>n(()=>t.keys(),"key"),values:()=>n(()=>t.keys(),"key")};if(e)for(const t of e)s.add(t);return s}},function(e,t,s){"use strict";function n(e){if(!e)return e;if("Map"===e[Symbol.toStringTag]){const t=["MAP"];for(let[s,r]of e)!r||"Map"!==r[Symbol.toStringTag]&&"Set"!==r[Symbol.toStringTag]||(r=n(r)),t.push([s,r]);return t}{const t=["SET"];for(let s of e.values())!s||"Map"!==s[Symbol.toStringTag]&&"Set"!==s[Symbol.toStringTag]||(s=n(s)),t.push(s);return t}}Object.defineProperty(t,"__esModule",{value:!0}),t.whyUsernameIsInvalid=t.whyTeamSubdomainIsInvalid=t.whyNewPasswordIsInvalid=t.toTitleCase=t.toDebugObj=t.toDebugStr=void 0,t.toDebugStr=function(e){return JSON.stringify(n(e),null,2)},t.toDebugObj=n,t.toTitleCase=function(e){return e.replace(/\w+/g,e=>e.charAt(0).toLocaleUpperCase()+e.substr(1))},t.whyNewPasswordIsInvalid=function(e){if(e.length<8)return"A password must have at least 8 characters"},t.whyTeamSubdomainIsInvalid=function(e){return e.length<2||e.length>16?"A team subdomain must have at least 2 characters and 16 characters at most":/^[0-9a-zA-Z]+(-[0-9a-zA-Z]+)*$/.test(e)?void 0:"A subdomain should only contains alphanumeric characters and dash and should not begin or end with dash."},t.whyUsernameIsInvalid=function(e){return e.length<1?"A username should have at least one character.":/\W/.test(e)?"A username can contain only letters, digits and underscore.":void 0}},function(e,t,s){var n;/*! showdown v 1.9.1 - 02-11-2019 */
(function(){function r(e){"use strict";var t={omitExtraWLInCodeBlocks:{defaultValue:!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{defaultValue:!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{defaultValue:!1,describe:"Add a prefix to the generated header ids. Passing a string will prefix that string to the header id. Setting to true will add a generic 'section-' prefix",type:"string"},rawPrefixHeaderId:{defaultValue:!1,describe:'Setting this option to true will prevent showdown from modifying the prefix. This might result in malformed IDs (if, for instance, the " char is used in the prefix)',type:"boolean"},ghCompatibleHeaderId:{defaultValue:!1,describe:"Generate header ids compatible with github style (spaces are replaced with dashes, a bunch of non alphanumeric chars are removed)",type:"boolean"},rawHeaderId:{defaultValue:!1,describe:"Remove only spaces, ' and \" from generated header ids (including prefixes), replacing them with dashes (-). WARNING: This might result in malformed ids",type:"boolean"},headerLevelStart:{defaultValue:!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{defaultValue:!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{defaultValue:!1,describe:"Turn on/off GFM autolink style",type:"boolean"},excludeTrailingPunctuationFromURLs:{defaultValue:!1,describe:"Excludes trailing punctuation from links generated with autoLinking",type:"boolean"},literalMidWordUnderscores:{defaultValue:!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},literalMidWordAsterisks:{defaultValue:!1,describe:"Parse midword asterisks as literal asterisks",type:"boolean"},strikethrough:{defaultValue:!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{defaultValue:!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{defaultValue:!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{defaultValue:!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{defaultValue:!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{defaultValue:!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"},smartIndentationFix:{defaultValue:!1,description:"Tries to smartly fix indentation in es6 strings",type:"boolean"},disableForced4SpacesIndentedSublists:{defaultValue:!1,description:"Disables the requirement of indenting nested sublists by 4 spaces",type:"boolean"},simpleLineBreaks:{defaultValue:!1,description:"Parses simple line breaks as <br> (GFM Style)",type:"boolean"},requireSpaceBeforeHeadingText:{defaultValue:!1,description:"Makes adding a space between `#` and the header text mandatory (GFM Style)",type:"boolean"},ghMentions:{defaultValue:!1,description:"Enables github @mentions",type:"boolean"},ghMentionsLink:{defaultValue:"https://github.com/{u}",description:"Changes the link generated by @mentions. Only applies if ghMentions option is enabled.",type:"string"},encodeEmails:{defaultValue:!0,description:"Encode e-mail addresses through the use of Character Entities, transforming ASCII e-mail addresses into its equivalent decimal entities",type:"boolean"},openLinksInNewWindow:{defaultValue:!1,description:"Open all links in new windows",type:"boolean"},backslashEscapesHTMLTags:{defaultValue:!1,description:"Support for HTML Tag escaping. ex: <div>foo</div>",type:"boolean"},emoji:{defaultValue:!1,description:"Enable emoji support. Ex: `this is a :smile: emoji`",type:"boolean"},underline:{defaultValue:!1,description:"Enable support for underline. Syntax is double or triple underscores: `__underline word__`. With this option enabled, underscores no longer parses into `<em>` and `<strong>`",type:"boolean"},completeHTMLDocument:{defaultValue:!1,description:"Outputs a complete html document, including `<html>`, `<head>` and `<body>` tags",type:"boolean"},metadata:{defaultValue:!1,description:"Enable support for document metadata (defined at the top of the document between `«««` and `»»»` or between `---` and `---`).",type:"boolean"},splitAdjacentBlockquotes:{defaultValue:!1,description:"Split adjacent blockquote blocks",type:"boolean"}};if(!1===e)return JSON.parse(JSON.stringify(t));var s={};for(var n in t)t.hasOwnProperty(n)&&(s[n]=t[n].defaultValue);return s}var i={},o={},a={},l=r(!0),c="vanilla",d={github:{omitExtraWLInCodeBlocks:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,disableForced4SpacesIndentedSublists:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghCompatibleHeaderId:!0,ghMentions:!0,backslashEscapesHTMLTags:!0,emoji:!0,splitAdjacentBlockquotes:!0},original:{noHeaderId:!0,ghCodeBlocks:!1},ghost:{omitExtraWLInCodeBlocks:!0,parseImgDimensions:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,smoothLivePreview:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghMentions:!1,encodeEmails:!0},vanilla:r(!0),allOn:function(){"use strict";var e=r(!0),t={};for(var s in e)e.hasOwnProperty(s)&&(t[s]=!0);return t}()};function h(e,t){"use strict";var s=t?"Error in "+t+" extension->":"Error in unnamed extension",n={valid:!0,error:""};i.helper.isArray(e)||(e=[e]);for(var r=0;r<e.length;++r){var o=s+" sub-extension "+r+": ",a=e[r];if("object"!=typeof a)return n.valid=!1,n.error=o+"must be an object, but "+typeof a+" given",n;if(!i.helper.isString(a.type))return n.valid=!1,n.error=o+'property "type" must be a string, but '+typeof a.type+" given",n;var l=a.type=a.type.toLowerCase();if("language"===l&&(l=a.type="lang"),"html"===l&&(l=a.type="output"),"lang"!==l&&"output"!==l&&"listener"!==l)return n.valid=!1,n.error=o+"type "+l+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',n;if("listener"===l){if(i.helper.isUndefined(a.listeners))return n.valid=!1,n.error=o+'. Extensions of type "listener" must have a property called "listeners"',n}else if(i.helper.isUndefined(a.filter)&&i.helper.isUndefined(a.regex))return n.valid=!1,n.error=o+l+' extensions must define either a "regex" property or a "filter" method',n;if(a.listeners){if("object"!=typeof a.listeners)return n.valid=!1,n.error=o+'"listeners" property must be an object but '+typeof a.listeners+" given",n;for(var c in a.listeners)if(a.listeners.hasOwnProperty(c)&&"function"!=typeof a.listeners[c])return n.valid=!1,n.error=o+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+c+" must be a function but "+typeof a.listeners[c]+" given",n}if(a.filter){if("function"!=typeof a.filter)return n.valid=!1,n.error=o+'"filter" must be a function, but '+typeof a.filter+" given",n}else if(a.regex){if(i.helper.isString(a.regex)&&(a.regex=new RegExp(a.regex,"g")),!(a.regex instanceof RegExp))return n.valid=!1,n.error=o+'"regex" property must either be a string or a RegExp object, but '+typeof a.regex+" given",n;if(i.helper.isUndefined(a.replace))return n.valid=!1,n.error=o+'"regex" extensions must implement a replace string or function',n}}return n}function u(e,t){"use strict";return"¨E"+t.charCodeAt(0)+"E"}i.helper={},i.extensions={},i.setOption=function(e,t){"use strict";return l[e]=t,this},i.getOption=function(e){"use strict";return l[e]},i.getOptions=function(){"use strict";return l},i.resetOptions=function(){"use strict";l=r(!0)},i.setFlavor=function(e){"use strict";if(!d.hasOwnProperty(e))throw Error(e+" flavor was not found");i.resetOptions();var t=d[e];for(var s in c=e,t)t.hasOwnProperty(s)&&(l[s]=t[s])},i.getFlavor=function(){"use strict";return c},i.getFlavorOptions=function(e){"use strict";if(d.hasOwnProperty(e))return d[e]},i.getDefaultOptions=function(e){"use strict";return r(e)},i.subParser=function(e,t){"use strict";if(i.helper.isString(e)){if(void 0===t){if(o.hasOwnProperty(e))return o[e];throw Error("SubParser named "+e+" not registered!")}o[e]=t}},i.extension=function(e,t){"use strict";if(!i.helper.isString(e))throw Error("Extension 'name' must be a string");if(e=i.helper.stdExtName(e),i.helper.isUndefined(t)){if(!a.hasOwnProperty(e))throw Error("Extension named "+e+" is not registered!");return a[e]}"function"==typeof t&&(t=t()),i.helper.isArray(t)||(t=[t]);var s=h(t,e);if(!s.valid)throw Error(s.error);a[e]=t},i.getAllExtensions=function(){"use strict";return a},i.removeExtension=function(e){"use strict";delete a[e]},i.resetExtensions=function(){"use strict";a={}},i.validateExtension=function(e){"use strict";var t=h(e,null);return!!t.valid||(console.warn(t.error),!1)},i.hasOwnProperty("helper")||(i.helper={}),i.helper.isString=function(e){"use strict";return"string"==typeof e||e instanceof String},i.helper.isFunction=function(e){"use strict";return e&&"[object Function]"==={}.toString.call(e)},i.helper.isArray=function(e){"use strict";return Array.isArray(e)},i.helper.isUndefined=function(e){"use strict";return void 0===e},i.helper.forEach=function(e,t){"use strict";if(i.helper.isUndefined(e))throw new Error("obj param is required");if(i.helper.isUndefined(t))throw new Error("callback param is required");if(!i.helper.isFunction(t))throw new Error("callback param must be a function/closure");if("function"==typeof e.forEach)e.forEach(t);else if(i.helper.isArray(e))for(var s=0;s<e.length;s++)t(e[s],s,e);else{if("object"!=typeof e)throw new Error("obj does not seem to be an array or an iterable object");for(var n in e)e.hasOwnProperty(n)&&t(e[n],n,e)}},i.helper.stdExtName=function(e){"use strict";return e.replace(/[_?*+\/\\.^-]/g,"").replace(/\s/g,"").toLowerCase()},i.helper.escapeCharactersCallback=u,i.helper.escapeCharacters=function(e,t,s){"use strict";var n="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";s&&(n="\\\\"+n);var r=new RegExp(n,"g");return e=e.replace(r,u)},i.helper.unescapeHTMLEntities=function(e){"use strict";return e.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};var p=function(e,t,s,n){"use strict";var r,i,o,a,l,c=n||"",d=c.indexOf("g")>-1,h=new RegExp(t+"|"+s,"g"+c.replace(/g/g,"")),u=new RegExp(t,c.replace(/g/g,"")),p=[];do{for(r=0;o=h.exec(e);)if(u.test(o[0]))r++||(a=(i=h.lastIndex)-o[0].length);else if(r&&!--r){l=o.index+o[0].length;var m={left:{start:a,end:i},match:{start:i,end:o.index},right:{start:o.index,end:l},wholeMatch:{start:a,end:l}};if(p.push(m),!d)return p}}while(r&&(h.lastIndex=i));return p};i.helper.matchRecursiveRegExp=function(e,t,s,n){"use strict";for(var r=p(e,t,s,n),i=[],o=0;o<r.length;++o)i.push([e.slice(r[o].wholeMatch.start,r[o].wholeMatch.end),e.slice(r[o].match.start,r[o].match.end),e.slice(r[o].left.start,r[o].left.end),e.slice(r[o].right.start,r[o].right.end)]);return i},i.helper.replaceRecursiveRegExp=function(e,t,s,n,r){"use strict";if(!i.helper.isFunction(t)){var o=t;t=function(){return o}}var a=p(e,s,n,r),l=e,c=a.length;if(c>0){var d=[];0!==a[0].wholeMatch.start&&d.push(e.slice(0,a[0].wholeMatch.start));for(var h=0;h<c;++h)d.push(t(e.slice(a[h].wholeMatch.start,a[h].wholeMatch.end),e.slice(a[h].match.start,a[h].match.end),e.slice(a[h].left.start,a[h].left.end),e.slice(a[h].right.start,a[h].right.end))),h<c-1&&d.push(e.slice(a[h].wholeMatch.end,a[h+1].wholeMatch.start));a[c-1].wholeMatch.end<e.length&&d.push(e.slice(a[c-1].wholeMatch.end)),l=d.join("")}return l},i.helper.regexIndexOf=function(e,t,s){"use strict";if(!i.helper.isString(e))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";if(t instanceof RegExp==!1)throw"InvalidArgumentError: second parameter of showdown.helper.regexIndexOf function must be an instance of RegExp";var n=e.substring(s||0).search(t);return n>=0?n+(s||0):n},i.helper.splitAtIndex=function(e,t){"use strict";if(!i.helper.isString(e))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";return[e.substring(0,t),e.substring(t)]},i.helper.encodeEmailAddress=function(e){"use strict";var t=[function(e){return"&#"+e.charCodeAt(0)+";"},function(e){return"&#x"+e.charCodeAt(0).toString(16)+";"},function(e){return e}];return e=e.replace(/./g,(function(e){if("@"===e)e=t[Math.floor(2*Math.random())](e);else{var s=Math.random();e=s>.9?t[2](e):s>.45?t[1](e):t[0](e)}return e}))},i.helper.padEnd=function(e,t,s){"use strict";return t>>=0,s=String(s||" "),e.length>t?String(e):((t-=e.length)>s.length&&(s+=s.repeat(t/s.length)),String(e)+s.slice(0,t))},"undefined"==typeof console&&(console={warn:function(e){"use strict";alert(e)},log:function(e){"use strict";alert(e)},error:function(e){"use strict";throw e}}),i.helper.regexes={asteriskDashAndColon:/([*_:~])/g},i.helper.emojis={"+1":"👍","-1":"👎",100:"💯",1234:"🔢","1st_place_medal":"🥇","2nd_place_medal":"🥈","3rd_place_medal":"🥉","8ball":"🎱",a:"🅰️",ab:"🆎",abc:"🔤",abcd:"🔡",accept:"🉑",aerial_tramway:"🚡",airplane:"✈️",alarm_clock:"⏰",alembic:"⚗️",alien:"👽",ambulance:"🚑",amphora:"🏺",anchor:"⚓️",angel:"👼",anger:"💢",angry:"😠",anguished:"😧",ant:"🐜",apple:"🍎",aquarius:"♒️",aries:"♈️",arrow_backward:"◀️",arrow_double_down:"⏬",arrow_double_up:"⏫",arrow_down:"⬇️",arrow_down_small:"🔽",arrow_forward:"▶️",arrow_heading_down:"⤵️",arrow_heading_up:"⤴️",arrow_left:"⬅️",arrow_lower_left:"↙️",arrow_lower_right:"↘️",arrow_right:"➡️",arrow_right_hook:"↪️",arrow_up:"⬆️",arrow_up_down:"↕️",arrow_up_small:"🔼",arrow_upper_left:"↖️",arrow_upper_right:"↗️",arrows_clockwise:"🔃",arrows_counterclockwise:"🔄",art:"🎨",articulated_lorry:"🚛",artificial_satellite:"🛰",astonished:"😲",athletic_shoe:"👟",atm:"🏧",atom_symbol:"⚛️",avocado:"🥑",b:"🅱️",baby:"👶",baby_bottle:"🍼",baby_chick:"🐤",baby_symbol:"🚼",back:"🔙",bacon:"🥓",badminton:"🏸",baggage_claim:"🛄",baguette_bread:"🥖",balance_scale:"⚖️",balloon:"🎈",ballot_box:"🗳",ballot_box_with_check:"☑️",bamboo:"🎍",banana:"🍌",bangbang:"‼️",bank:"🏦",bar_chart:"📊",barber:"💈",baseball:"⚾️",basketball:"🏀",basketball_man:"⛹️",basketball_woman:"⛹️&zwj;♀️",bat:"🦇",bath:"🛀",bathtub:"🛁",battery:"🔋",beach_umbrella:"🏖",bear:"🐻",bed:"🛏",bee:"🐝",beer:"🍺",beers:"🍻",beetle:"🐞",beginner:"🔰",bell:"🔔",bellhop_bell:"🛎",bento:"🍱",biking_man:"🚴",bike:"🚲",biking_woman:"🚴&zwj;♀️",bikini:"👙",biohazard:"☣️",bird:"🐦",birthday:"🎂",black_circle:"⚫️",black_flag:"🏴",black_heart:"🖤",black_joker:"🃏",black_large_square:"⬛️",black_medium_small_square:"◾️",black_medium_square:"◼️",black_nib:"✒️",black_small_square:"▪️",black_square_button:"🔲",blonde_man:"👱",blonde_woman:"👱&zwj;♀️",blossom:"🌼",blowfish:"🐡",blue_book:"📘",blue_car:"🚙",blue_heart:"💙",blush:"😊",boar:"🐗",boat:"⛵️",bomb:"💣",book:"📖",bookmark:"🔖",bookmark_tabs:"📑",books:"📚",boom:"💥",boot:"👢",bouquet:"💐",bowing_man:"🙇",bow_and_arrow:"🏹",bowing_woman:"🙇&zwj;♀️",bowling:"🎳",boxing_glove:"🥊",boy:"👦",bread:"🍞",bride_with_veil:"👰",bridge_at_night:"🌉",briefcase:"💼",broken_heart:"💔",bug:"🐛",building_construction:"🏗",bulb:"💡",bullettrain_front:"🚅",bullettrain_side:"🚄",burrito:"🌯",bus:"🚌",business_suit_levitating:"🕴",busstop:"🚏",bust_in_silhouette:"👤",busts_in_silhouette:"👥",butterfly:"🦋",cactus:"🌵",cake:"🍰",calendar:"📆",call_me_hand:"🤙",calling:"📲",camel:"🐫",camera:"📷",camera_flash:"📸",camping:"🏕",cancer:"♋️",candle:"🕯",candy:"🍬",canoe:"🛶",capital_abcd:"🔠",capricorn:"♑️",car:"🚗",card_file_box:"🗃",card_index:"📇",card_index_dividers:"🗂",carousel_horse:"🎠",carrot:"🥕",cat:"🐱",cat2:"🐈",cd:"💿",chains:"⛓",champagne:"🍾",chart:"💹",chart_with_downwards_trend:"📉",chart_with_upwards_trend:"📈",checkered_flag:"🏁",cheese:"🧀",cherries:"🍒",cherry_blossom:"🌸",chestnut:"🌰",chicken:"🐔",children_crossing:"🚸",chipmunk:"🐿",chocolate_bar:"🍫",christmas_tree:"🎄",church:"⛪️",cinema:"🎦",circus_tent:"🎪",city_sunrise:"🌇",city_sunset:"🌆",cityscape:"🏙",cl:"🆑",clamp:"🗜",clap:"👏",clapper:"🎬",classical_building:"🏛",clinking_glasses:"🥂",clipboard:"📋",clock1:"🕐",clock10:"🕙",clock1030:"🕥",clock11:"🕚",clock1130:"🕦",clock12:"🕛",clock1230:"🕧",clock130:"🕜",clock2:"🕑",clock230:"🕝",clock3:"🕒",clock330:"🕞",clock4:"🕓",clock430:"🕟",clock5:"🕔",clock530:"🕠",clock6:"🕕",clock630:"🕡",clock7:"🕖",clock730:"🕢",clock8:"🕗",clock830:"🕣",clock9:"🕘",clock930:"🕤",closed_book:"📕",closed_lock_with_key:"🔐",closed_umbrella:"🌂",cloud:"☁️",cloud_with_lightning:"🌩",cloud_with_lightning_and_rain:"⛈",cloud_with_rain:"🌧",cloud_with_snow:"🌨",clown_face:"🤡",clubs:"♣️",cocktail:"🍸",coffee:"☕️",coffin:"⚰️",cold_sweat:"😰",comet:"☄️",computer:"💻",computer_mouse:"🖱",confetti_ball:"🎊",confounded:"😖",confused:"😕",congratulations:"㊗️",construction:"🚧",construction_worker_man:"👷",construction_worker_woman:"👷&zwj;♀️",control_knobs:"🎛",convenience_store:"🏪",cookie:"🍪",cool:"🆒",policeman:"👮",copyright:"©️",corn:"🌽",couch_and_lamp:"🛋",couple:"👫",couple_with_heart_woman_man:"💑",couple_with_heart_man_man:"👨&zwj;❤️&zwj;👨",couple_with_heart_woman_woman:"👩&zwj;❤️&zwj;👩",couplekiss_man_man:"👨&zwj;❤️&zwj;💋&zwj;👨",couplekiss_man_woman:"💏",couplekiss_woman_woman:"👩&zwj;❤️&zwj;💋&zwj;👩",cow:"🐮",cow2:"🐄",cowboy_hat_face:"🤠",crab:"🦀",crayon:"🖍",credit_card:"💳",crescent_moon:"🌙",cricket:"🏏",crocodile:"🐊",croissant:"🥐",crossed_fingers:"🤞",crossed_flags:"🎌",crossed_swords:"⚔️",crown:"👑",cry:"😢",crying_cat_face:"😿",crystal_ball:"🔮",cucumber:"🥒",cupid:"💘",curly_loop:"➰",currency_exchange:"💱",curry:"🍛",custard:"🍮",customs:"🛃",cyclone:"🌀",dagger:"🗡",dancer:"💃",dancing_women:"👯",dancing_men:"👯&zwj;♂️",dango:"🍡",dark_sunglasses:"🕶",dart:"🎯",dash:"💨",date:"📅",deciduous_tree:"🌳",deer:"🦌",department_store:"🏬",derelict_house:"🏚",desert:"🏜",desert_island:"🏝",desktop_computer:"🖥",male_detective:"🕵️",diamond_shape_with_a_dot_inside:"💠",diamonds:"♦️",disappointed:"😞",disappointed_relieved:"😥",dizzy:"💫",dizzy_face:"😵",do_not_litter:"🚯",dog:"🐶",dog2:"🐕",dollar:"💵",dolls:"🎎",dolphin:"🐬",door:"🚪",doughnut:"🍩",dove:"🕊",dragon:"🐉",dragon_face:"🐲",dress:"👗",dromedary_camel:"🐪",drooling_face:"🤤",droplet:"💧",drum:"🥁",duck:"🦆",dvd:"📀","e-mail":"📧",eagle:"🦅",ear:"👂",ear_of_rice:"🌾",earth_africa:"🌍",earth_americas:"🌎",earth_asia:"🌏",egg:"🥚",eggplant:"🍆",eight_pointed_black_star:"✴️",eight_spoked_asterisk:"✳️",electric_plug:"🔌",elephant:"🐘",email:"✉️",end:"🔚",envelope_with_arrow:"📩",euro:"💶",european_castle:"🏰",european_post_office:"🏤",evergreen_tree:"🌲",exclamation:"❗️",expressionless:"😑",eye:"👁",eye_speech_bubble:"👁&zwj;🗨",eyeglasses:"👓",eyes:"👀",face_with_head_bandage:"🤕",face_with_thermometer:"🤒",fist_oncoming:"👊",factory:"🏭",fallen_leaf:"🍂",family_man_woman_boy:"👪",family_man_boy:"👨&zwj;👦",family_man_boy_boy:"👨&zwj;👦&zwj;👦",family_man_girl:"👨&zwj;👧",family_man_girl_boy:"👨&zwj;👧&zwj;👦",family_man_girl_girl:"👨&zwj;👧&zwj;👧",family_man_man_boy:"👨&zwj;👨&zwj;👦",family_man_man_boy_boy:"👨&zwj;👨&zwj;👦&zwj;👦",family_man_man_girl:"👨&zwj;👨&zwj;👧",family_man_man_girl_boy:"👨&zwj;👨&zwj;👧&zwj;👦",family_man_man_girl_girl:"👨&zwj;👨&zwj;👧&zwj;👧",family_man_woman_boy_boy:"👨&zwj;👩&zwj;👦&zwj;👦",family_man_woman_girl:"👨&zwj;👩&zwj;👧",family_man_woman_girl_boy:"👨&zwj;👩&zwj;👧&zwj;👦",family_man_woman_girl_girl:"👨&zwj;👩&zwj;👧&zwj;👧",family_woman_boy:"👩&zwj;👦",family_woman_boy_boy:"👩&zwj;👦&zwj;👦",family_woman_girl:"👩&zwj;👧",family_woman_girl_boy:"👩&zwj;👧&zwj;👦",family_woman_girl_girl:"👩&zwj;👧&zwj;👧",family_woman_woman_boy:"👩&zwj;👩&zwj;👦",family_woman_woman_boy_boy:"👩&zwj;👩&zwj;👦&zwj;👦",family_woman_woman_girl:"👩&zwj;👩&zwj;👧",family_woman_woman_girl_boy:"👩&zwj;👩&zwj;👧&zwj;👦",family_woman_woman_girl_girl:"👩&zwj;👩&zwj;👧&zwj;👧",fast_forward:"⏩",fax:"📠",fearful:"😨",feet:"🐾",female_detective:"🕵️&zwj;♀️",ferris_wheel:"🎡",ferry:"⛴",field_hockey:"🏑",file_cabinet:"🗄",file_folder:"📁",film_projector:"📽",film_strip:"🎞",fire:"🔥",fire_engine:"🚒",fireworks:"🎆",first_quarter_moon:"🌓",first_quarter_moon_with_face:"🌛",fish:"🐟",fish_cake:"🍥",fishing_pole_and_fish:"🎣",fist_raised:"✊",fist_left:"🤛",fist_right:"🤜",flags:"🎏",flashlight:"🔦",fleur_de_lis:"⚜️",flight_arrival:"🛬",flight_departure:"🛫",floppy_disk:"💾",flower_playing_cards:"🎴",flushed:"😳",fog:"🌫",foggy:"🌁",football:"🏈",footprints:"👣",fork_and_knife:"🍴",fountain:"⛲️",fountain_pen:"🖋",four_leaf_clover:"🍀",fox_face:"🦊",framed_picture:"🖼",free:"🆓",fried_egg:"🍳",fried_shrimp:"🍤",fries:"🍟",frog:"🐸",frowning:"😦",frowning_face:"☹️",frowning_man:"🙍&zwj;♂️",frowning_woman:"🙍",middle_finger:"🖕",fuelpump:"⛽️",full_moon:"🌕",full_moon_with_face:"🌝",funeral_urn:"⚱️",game_die:"🎲",gear:"⚙️",gem:"💎",gemini:"♊️",ghost:"👻",gift:"🎁",gift_heart:"💝",girl:"👧",globe_with_meridians:"🌐",goal_net:"🥅",goat:"🐐",golf:"⛳️",golfing_man:"🏌️",golfing_woman:"🏌️&zwj;♀️",gorilla:"🦍",grapes:"🍇",green_apple:"🍏",green_book:"📗",green_heart:"💚",green_salad:"🥗",grey_exclamation:"❕",grey_question:"❔",grimacing:"😬",grin:"😁",grinning:"😀",guardsman:"💂",guardswoman:"💂&zwj;♀️",guitar:"🎸",gun:"🔫",haircut_woman:"💇",haircut_man:"💇&zwj;♂️",hamburger:"🍔",hammer:"🔨",hammer_and_pick:"⚒",hammer_and_wrench:"🛠",hamster:"🐹",hand:"✋",handbag:"👜",handshake:"🤝",hankey:"💩",hatched_chick:"🐥",hatching_chick:"🐣",headphones:"🎧",hear_no_evil:"🙉",heart:"❤️",heart_decoration:"💟",heart_eyes:"😍",heart_eyes_cat:"😻",heartbeat:"💓",heartpulse:"💗",hearts:"♥️",heavy_check_mark:"✔️",heavy_division_sign:"➗",heavy_dollar_sign:"💲",heavy_heart_exclamation:"❣️",heavy_minus_sign:"➖",heavy_multiplication_x:"✖️",heavy_plus_sign:"➕",helicopter:"🚁",herb:"🌿",hibiscus:"🌺",high_brightness:"🔆",high_heel:"👠",hocho:"🔪",hole:"🕳",honey_pot:"🍯",horse:"🐴",horse_racing:"🏇",hospital:"🏥",hot_pepper:"🌶",hotdog:"🌭",hotel:"🏨",hotsprings:"♨️",hourglass:"⌛️",hourglass_flowing_sand:"⏳",house:"🏠",house_with_garden:"🏡",houses:"🏘",hugs:"🤗",hushed:"😯",ice_cream:"🍨",ice_hockey:"🏒",ice_skate:"⛸",icecream:"🍦",id:"🆔",ideograph_advantage:"🉐",imp:"👿",inbox_tray:"📥",incoming_envelope:"📨",tipping_hand_woman:"💁",information_source:"ℹ️",innocent:"😇",interrobang:"⁉️",iphone:"📱",izakaya_lantern:"🏮",jack_o_lantern:"🎃",japan:"🗾",japanese_castle:"🏯",japanese_goblin:"👺",japanese_ogre:"👹",jeans:"👖",joy:"😂",joy_cat:"😹",joystick:"🕹",kaaba:"🕋",key:"🔑",keyboard:"⌨️",keycap_ten:"🔟",kick_scooter:"🛴",kimono:"👘",kiss:"💋",kissing:"😗",kissing_cat:"😽",kissing_closed_eyes:"😚",kissing_heart:"😘",kissing_smiling_eyes:"😙",kiwi_fruit:"🥝",koala:"🐨",koko:"🈁",label:"🏷",large_blue_circle:"🔵",large_blue_diamond:"🔷",large_orange_diamond:"🔶",last_quarter_moon:"🌗",last_quarter_moon_with_face:"🌜",latin_cross:"✝️",laughing:"😆",leaves:"🍃",ledger:"📒",left_luggage:"🛅",left_right_arrow:"↔️",leftwards_arrow_with_hook:"↩️",lemon:"🍋",leo:"♌️",leopard:"🐆",level_slider:"🎚",libra:"♎️",light_rail:"🚈",link:"🔗",lion:"🦁",lips:"👄",lipstick:"💄",lizard:"🦎",lock:"🔒",lock_with_ink_pen:"🔏",lollipop:"🍭",loop:"➿",loud_sound:"🔊",loudspeaker:"📢",love_hotel:"🏩",love_letter:"💌",low_brightness:"🔅",lying_face:"🤥",m:"Ⓜ️",mag:"🔍",mag_right:"🔎",mahjong:"🀄️",mailbox:"📫",mailbox_closed:"📪",mailbox_with_mail:"📬",mailbox_with_no_mail:"📭",man:"👨",man_artist:"👨&zwj;🎨",man_astronaut:"👨&zwj;🚀",man_cartwheeling:"🤸&zwj;♂️",man_cook:"👨&zwj;🍳",man_dancing:"🕺",man_facepalming:"🤦&zwj;♂️",man_factory_worker:"👨&zwj;🏭",man_farmer:"👨&zwj;🌾",man_firefighter:"👨&zwj;🚒",man_health_worker:"👨&zwj;⚕️",man_in_tuxedo:"🤵",man_judge:"👨&zwj;⚖️",man_juggling:"🤹&zwj;♂️",man_mechanic:"👨&zwj;🔧",man_office_worker:"👨&zwj;💼",man_pilot:"👨&zwj;✈️",man_playing_handball:"🤾&zwj;♂️",man_playing_water_polo:"🤽&zwj;♂️",man_scientist:"👨&zwj;🔬",man_shrugging:"🤷&zwj;♂️",man_singer:"👨&zwj;🎤",man_student:"👨&zwj;🎓",man_teacher:"👨&zwj;🏫",man_technologist:"👨&zwj;💻",man_with_gua_pi_mao:"👲",man_with_turban:"👳",tangerine:"🍊",mans_shoe:"👞",mantelpiece_clock:"🕰",maple_leaf:"🍁",martial_arts_uniform:"🥋",mask:"😷",massage_woman:"💆",massage_man:"💆&zwj;♂️",meat_on_bone:"🍖",medal_military:"🎖",medal_sports:"🏅",mega:"📣",melon:"🍈",memo:"📝",men_wrestling:"🤼&zwj;♂️",menorah:"🕎",mens:"🚹",metal:"🤘",metro:"🚇",microphone:"🎤",microscope:"🔬",milk_glass:"🥛",milky_way:"🌌",minibus:"🚐",minidisc:"💽",mobile_phone_off:"📴",money_mouth_face:"🤑",money_with_wings:"💸",moneybag:"💰",monkey:"🐒",monkey_face:"🐵",monorail:"🚝",moon:"🌔",mortar_board:"🎓",mosque:"🕌",motor_boat:"🛥",motor_scooter:"🛵",motorcycle:"🏍",motorway:"🛣",mount_fuji:"🗻",mountain:"⛰",mountain_biking_man:"🚵",mountain_biking_woman:"🚵&zwj;♀️",mountain_cableway:"🚠",mountain_railway:"🚞",mountain_snow:"🏔",mouse:"🐭",mouse2:"🐁",movie_camera:"🎥",moyai:"🗿",mrs_claus:"🤶",muscle:"💪",mushroom:"🍄",musical_keyboard:"🎹",musical_note:"🎵",musical_score:"🎼",mute:"🔇",nail_care:"💅",name_badge:"📛",national_park:"🏞",nauseated_face:"🤢",necktie:"👔",negative_squared_cross_mark:"❎",nerd_face:"🤓",neutral_face:"😐",new:"🆕",new_moon:"🌑",new_moon_with_face:"🌚",newspaper:"📰",newspaper_roll:"🗞",next_track_button:"⏭",ng:"🆖",no_good_man:"🙅&zwj;♂️",no_good_woman:"🙅",night_with_stars:"🌃",no_bell:"🔕",no_bicycles:"🚳",no_entry:"⛔️",no_entry_sign:"🚫",no_mobile_phones:"📵",no_mouth:"😶",no_pedestrians:"🚷",no_smoking:"🚭","non-potable_water":"🚱",nose:"👃",notebook:"📓",notebook_with_decorative_cover:"📔",notes:"🎶",nut_and_bolt:"🔩",o:"⭕️",o2:"🅾️",ocean:"🌊",octopus:"🐙",oden:"🍢",office:"🏢",oil_drum:"🛢",ok:"🆗",ok_hand:"👌",ok_man:"🙆&zwj;♂️",ok_woman:"🙆",old_key:"🗝",older_man:"👴",older_woman:"👵",om:"🕉",on:"🔛",oncoming_automobile:"🚘",oncoming_bus:"🚍",oncoming_police_car:"🚔",oncoming_taxi:"🚖",open_file_folder:"📂",open_hands:"👐",open_mouth:"😮",open_umbrella:"☂️",ophiuchus:"⛎",orange_book:"📙",orthodox_cross:"☦️",outbox_tray:"📤",owl:"🦉",ox:"🐂",package:"📦",page_facing_up:"📄",page_with_curl:"📃",pager:"📟",paintbrush:"🖌",palm_tree:"🌴",pancakes:"🥞",panda_face:"🐼",paperclip:"📎",paperclips:"🖇",parasol_on_ground:"⛱",parking:"🅿️",part_alternation_mark:"〽️",partly_sunny:"⛅️",passenger_ship:"🛳",passport_control:"🛂",pause_button:"⏸",peace_symbol:"☮️",peach:"🍑",peanuts:"🥜",pear:"🍐",pen:"🖊",pencil2:"✏️",penguin:"🐧",pensive:"😔",performing_arts:"🎭",persevere:"😣",person_fencing:"🤺",pouting_woman:"🙎",phone:"☎️",pick:"⛏",pig:"🐷",pig2:"🐖",pig_nose:"🐽",pill:"💊",pineapple:"🍍",ping_pong:"🏓",pisces:"♓️",pizza:"🍕",place_of_worship:"🛐",plate_with_cutlery:"🍽",play_or_pause_button:"⏯",point_down:"👇",point_left:"👈",point_right:"👉",point_up:"☝️",point_up_2:"👆",police_car:"🚓",policewoman:"👮&zwj;♀️",poodle:"🐩",popcorn:"🍿",post_office:"🏣",postal_horn:"📯",postbox:"📮",potable_water:"🚰",potato:"🥔",pouch:"👝",poultry_leg:"🍗",pound:"💷",rage:"😡",pouting_cat:"😾",pouting_man:"🙎&zwj;♂️",pray:"🙏",prayer_beads:"📿",pregnant_woman:"🤰",previous_track_button:"⏮",prince:"🤴",princess:"👸",printer:"🖨",purple_heart:"💜",purse:"👛",pushpin:"📌",put_litter_in_its_place:"🚮",question:"❓",rabbit:"🐰",rabbit2:"🐇",racehorse:"🐎",racing_car:"🏎",radio:"📻",radio_button:"🔘",radioactive:"☢️",railway_car:"🚃",railway_track:"🛤",rainbow:"🌈",rainbow_flag:"🏳️&zwj;🌈",raised_back_of_hand:"🤚",raised_hand_with_fingers_splayed:"🖐",raised_hands:"🙌",raising_hand_woman:"🙋",raising_hand_man:"🙋&zwj;♂️",ram:"🐏",ramen:"🍜",rat:"🐀",record_button:"⏺",recycle:"♻️",red_circle:"🔴",registered:"®️",relaxed:"☺️",relieved:"😌",reminder_ribbon:"🎗",repeat:"🔁",repeat_one:"🔂",rescue_worker_helmet:"⛑",restroom:"🚻",revolving_hearts:"💞",rewind:"⏪",rhinoceros:"🦏",ribbon:"🎀",rice:"🍚",rice_ball:"🍙",rice_cracker:"🍘",rice_scene:"🎑",right_anger_bubble:"🗯",ring:"💍",robot:"🤖",rocket:"🚀",rofl:"🤣",roll_eyes:"🙄",roller_coaster:"🎢",rooster:"🐓",rose:"🌹",rosette:"🏵",rotating_light:"🚨",round_pushpin:"📍",rowing_man:"🚣",rowing_woman:"🚣&zwj;♀️",rugby_football:"🏉",running_man:"🏃",running_shirt_with_sash:"🎽",running_woman:"🏃&zwj;♀️",sa:"🈂️",sagittarius:"♐️",sake:"🍶",sandal:"👡",santa:"🎅",satellite:"📡",saxophone:"🎷",school:"🏫",school_satchel:"🎒",scissors:"✂️",scorpion:"🦂",scorpius:"♏️",scream:"😱",scream_cat:"🙀",scroll:"📜",seat:"💺",secret:"㊙️",see_no_evil:"🙈",seedling:"🌱",selfie:"🤳",shallow_pan_of_food:"🥘",shamrock:"☘️",shark:"🦈",shaved_ice:"🍧",sheep:"🐑",shell:"🐚",shield:"🛡",shinto_shrine:"⛩",ship:"🚢",shirt:"👕",shopping:"🛍",shopping_cart:"🛒",shower:"🚿",shrimp:"🦐",signal_strength:"📶",six_pointed_star:"🔯",ski:"🎿",skier:"⛷",skull:"💀",skull_and_crossbones:"☠️",sleeping:"😴",sleeping_bed:"🛌",sleepy:"😪",slightly_frowning_face:"🙁",slightly_smiling_face:"🙂",slot_machine:"🎰",small_airplane:"🛩",small_blue_diamond:"🔹",small_orange_diamond:"🔸",small_red_triangle:"🔺",small_red_triangle_down:"🔻",smile:"😄",smile_cat:"😸",smiley:"😃",smiley_cat:"😺",smiling_imp:"😈",smirk:"😏",smirk_cat:"😼",smoking:"🚬",snail:"🐌",snake:"🐍",sneezing_face:"🤧",snowboarder:"🏂",snowflake:"❄️",snowman:"⛄️",snowman_with_snow:"☃️",sob:"😭",soccer:"⚽️",soon:"🔜",sos:"🆘",sound:"🔉",space_invader:"👾",spades:"♠️",spaghetti:"🍝",sparkle:"❇️",sparkler:"🎇",sparkles:"✨",sparkling_heart:"💖",speak_no_evil:"🙊",speaker:"🔈",speaking_head:"🗣",speech_balloon:"💬",speedboat:"🚤",spider:"🕷",spider_web:"🕸",spiral_calendar:"🗓",spiral_notepad:"🗒",spoon:"🥄",squid:"🦑",stadium:"🏟",star:"⭐️",star2:"🌟",star_and_crescent:"☪️",star_of_david:"✡️",stars:"🌠",station:"🚉",statue_of_liberty:"🗽",steam_locomotive:"🚂",stew:"🍲",stop_button:"⏹",stop_sign:"🛑",stopwatch:"⏱",straight_ruler:"📏",strawberry:"🍓",stuck_out_tongue:"😛",stuck_out_tongue_closed_eyes:"😝",stuck_out_tongue_winking_eye:"😜",studio_microphone:"🎙",stuffed_flatbread:"🥙",sun_behind_large_cloud:"🌥",sun_behind_rain_cloud:"🌦",sun_behind_small_cloud:"🌤",sun_with_face:"🌞",sunflower:"🌻",sunglasses:"😎",sunny:"☀️",sunrise:"🌅",sunrise_over_mountains:"🌄",surfing_man:"🏄",surfing_woman:"🏄&zwj;♀️",sushi:"🍣",suspension_railway:"🚟",sweat:"😓",sweat_drops:"💦",sweat_smile:"😅",sweet_potato:"🍠",swimming_man:"🏊",swimming_woman:"🏊&zwj;♀️",symbols:"🔣",synagogue:"🕍",syringe:"💉",taco:"🌮",tada:"🎉",tanabata_tree:"🎋",taurus:"♉️",taxi:"🚕",tea:"🍵",telephone_receiver:"📞",telescope:"🔭",tennis:"🎾",tent:"⛺️",thermometer:"🌡",thinking:"🤔",thought_balloon:"💭",ticket:"🎫",tickets:"🎟",tiger:"🐯",tiger2:"🐅",timer_clock:"⏲",tipping_hand_man:"💁&zwj;♂️",tired_face:"😫",tm:"™️",toilet:"🚽",tokyo_tower:"🗼",tomato:"🍅",tongue:"👅",top:"🔝",tophat:"🎩",tornado:"🌪",trackball:"🖲",tractor:"🚜",traffic_light:"🚥",train:"🚋",train2:"🚆",tram:"🚊",triangular_flag_on_post:"🚩",triangular_ruler:"📐",trident:"🔱",triumph:"😤",trolleybus:"🚎",trophy:"🏆",tropical_drink:"🍹",tropical_fish:"🐠",truck:"🚚",trumpet:"🎺",tulip:"🌷",tumbler_glass:"🥃",turkey:"🦃",turtle:"🐢",tv:"📺",twisted_rightwards_arrows:"🔀",two_hearts:"💕",two_men_holding_hands:"👬",two_women_holding_hands:"👭",u5272:"🈹",u5408:"🈴",u55b6:"🈺",u6307:"🈯️",u6708:"🈷️",u6709:"🈶",u6e80:"🈵",u7121:"🈚️",u7533:"🈸",u7981:"🈲",u7a7a:"🈳",umbrella:"☔️",unamused:"😒",underage:"🔞",unicorn:"🦄",unlock:"🔓",up:"🆙",upside_down_face:"🙃",v:"✌️",vertical_traffic_light:"🚦",vhs:"📼",vibration_mode:"📳",video_camera:"📹",video_game:"🎮",violin:"🎻",virgo:"♍️",volcano:"🌋",volleyball:"🏐",vs:"🆚",vulcan_salute:"🖖",walking_man:"🚶",walking_woman:"🚶&zwj;♀️",waning_crescent_moon:"🌘",waning_gibbous_moon:"🌖",warning:"⚠️",wastebasket:"🗑",watch:"⌚️",water_buffalo:"🐃",watermelon:"🍉",wave:"👋",wavy_dash:"〰️",waxing_crescent_moon:"🌒",wc:"🚾",weary:"😩",wedding:"💒",weight_lifting_man:"🏋️",weight_lifting_woman:"🏋️&zwj;♀️",whale:"🐳",whale2:"🐋",wheel_of_dharma:"☸️",wheelchair:"♿️",white_check_mark:"✅",white_circle:"⚪️",white_flag:"🏳️",white_flower:"💮",white_large_square:"⬜️",white_medium_small_square:"◽️",white_medium_square:"◻️",white_small_square:"▫️",white_square_button:"🔳",wilted_flower:"🥀",wind_chime:"🎐",wind_face:"🌬",wine_glass:"🍷",wink:"😉",wolf:"🐺",woman:"👩",woman_artist:"👩&zwj;🎨",woman_astronaut:"👩&zwj;🚀",woman_cartwheeling:"🤸&zwj;♀️",woman_cook:"👩&zwj;🍳",woman_facepalming:"🤦&zwj;♀️",woman_factory_worker:"👩&zwj;🏭",woman_farmer:"👩&zwj;🌾",woman_firefighter:"👩&zwj;🚒",woman_health_worker:"👩&zwj;⚕️",woman_judge:"👩&zwj;⚖️",woman_juggling:"🤹&zwj;♀️",woman_mechanic:"👩&zwj;🔧",woman_office_worker:"👩&zwj;💼",woman_pilot:"👩&zwj;✈️",woman_playing_handball:"🤾&zwj;♀️",woman_playing_water_polo:"🤽&zwj;♀️",woman_scientist:"👩&zwj;🔬",woman_shrugging:"🤷&zwj;♀️",woman_singer:"👩&zwj;🎤",woman_student:"👩&zwj;🎓",woman_teacher:"👩&zwj;🏫",woman_technologist:"👩&zwj;💻",woman_with_turban:"👳&zwj;♀️",womans_clothes:"👚",womans_hat:"👒",women_wrestling:"🤼&zwj;♀️",womens:"🚺",world_map:"🗺",worried:"😟",wrench:"🔧",writing_hand:"✍️",x:"❌",yellow_heart:"💛",yen:"💴",yin_yang:"☯️",yum:"😋",zap:"⚡️",zipper_mouth_face:"🤐",zzz:"💤",octocat:'<img alt=":octocat:" height="20" width="20" align="absmiddle" src="https://assets-cdn.github.com/images/icons/emoji/octocat.png">',showdown:"<span style=\"font-family: 'Anonymous Pro', monospace; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #3e8b8a;text-underline-position: under;\">S</span>"},i.Converter=function(e){"use strict";var t={},s=[],n=[],r={},o=c,u={parsed:{},raw:"",format:""};function p(e,t){if(t=t||null,i.helper.isString(e)){if(t=e=i.helper.stdExtName(e),i.extensions[e])return console.warn("DEPRECATION WARNING: "+e+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!"),void function(e,t){"function"==typeof e&&(e=e(new i.Converter));i.helper.isArray(e)||(e=[e]);var r=h(e,t);if(!r.valid)throw Error(r.error);for(var o=0;o<e.length;++o)switch(e[o].type){case"lang":s.push(e[o]);break;case"output":n.push(e[o]);break;default:throw Error("Extension loader error: Type unrecognized!!!")}}(i.extensions[e],e);if(i.helper.isUndefined(a[e]))throw Error('Extension "'+e+'" could not be loaded. It was either not found or is not a valid extension.');e=a[e]}"function"==typeof e&&(e=e()),i.helper.isArray(e)||(e=[e]);var r=h(e,t);if(!r.valid)throw Error(r.error);for(var o=0;o<e.length;++o){switch(e[o].type){case"lang":s.push(e[o]);break;case"output":n.push(e[o])}if(e[o].hasOwnProperty("listeners"))for(var l in e[o].listeners)e[o].listeners.hasOwnProperty(l)&&m(l,e[o].listeners[l])}}function m(e,t){if(!i.helper.isString(e))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof e+" given");if("function"!=typeof t)throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof t+" given");r.hasOwnProperty(e)||(r[e]=[]),r[e].push(t)}!function(){for(var s in e=e||{},l)l.hasOwnProperty(s)&&(t[s]=l[s]);if("object"!=typeof e)throw Error("Converter expects the passed parameter to be an object, but "+typeof e+" was passed instead.");for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.extensions&&i.helper.forEach(t.extensions,p)}(),this._dispatch=function(e,t,s,n){if(r.hasOwnProperty(e))for(var i=0;i<r[e].length;++i){var o=r[e][i](e,t,this,s,n);o&&void 0!==o&&(t=o)}return t},this.listen=function(e,t){return m(e,t),this},this.makeHtml=function(e){if(!e)return e;var r={gHtmlBlocks:[],gHtmlMdBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:s,outputModifiers:n,converter:this,ghCodeBlocks:[],metadata:{parsed:{},raw:"",format:""}};return e=(e=(e=(e=(e=e.replace(/¨/g,"¨T")).replace(/\$/g,"¨D")).replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).replace(/\u00A0/g,"&nbsp;"),t.smartIndentationFix&&(e=function(e){var t=e.match(/^\s*/)[0].length,s=new RegExp("^\\s{0,"+t+"}","gm");return e.replace(s,"")}(e)),e="\n\n"+e+"\n\n",e=(e=i.subParser("detab")(e,t,r)).replace(/^[ \t]+$/gm,""),i.helper.forEach(s,(function(s){e=i.subParser("runExtension")(s,e,t,r)})),e=i.subParser("metadata")(e,t,r),e=i.subParser("hashPreCodeTags")(e,t,r),e=i.subParser("githubCodeBlocks")(e,t,r),e=i.subParser("hashHTMLBlocks")(e,t,r),e=i.subParser("hashCodeTags")(e,t,r),e=i.subParser("stripLinkDefinitions")(e,t,r),e=i.subParser("blockGamut")(e,t,r),e=i.subParser("unhashHTMLSpans")(e,t,r),e=(e=(e=i.subParser("unescapeSpecialChars")(e,t,r)).replace(/¨D/g,"$$")).replace(/¨T/g,"¨"),e=i.subParser("completeHTMLDocument")(e,t,r),i.helper.forEach(n,(function(s){e=i.subParser("runExtension")(s,e,t,r)})),u=r.metadata,e},this.makeMarkdown=this.makeMd=function(e,t){if(e=(e=(e=e.replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).replace(/>[ \t]+</,">¨NBSP;<"),!t){if(!window||!window.document)throw new Error("HTMLParser is undefined. If in a webworker or nodejs environment, you need to provide a WHATWG DOM and HTML such as JSDOM");t=window.document}var s=t.createElement("div");s.innerHTML=e;var n={preList:function(e){for(var t=e.querySelectorAll("pre"),s=[],n=0;n<t.length;++n)if(1===t[n].childElementCount&&"code"===t[n].firstChild.tagName.toLowerCase()){var r=t[n].firstChild.innerHTML.trim(),o=t[n].firstChild.getAttribute("data-language")||"";if(""===o)for(var a=t[n].firstChild.className.split(" "),l=0;l<a.length;++l){var c=a[l].match(/^language-(.+)$/);if(null!==c){o=c[1];break}}r=i.helper.unescapeHTMLEntities(r),s.push(r),t[n].outerHTML='<precode language="'+o+'" precodenum="'+n.toString()+'"></precode>'}else s.push(t[n].innerHTML),t[n].innerHTML="",t[n].setAttribute("prenum",n.toString());return s}(s)};!function e(t){for(var s=0;s<t.childNodes.length;++s){var n=t.childNodes[s];3===n.nodeType?/\S/.test(n.nodeValue)?(n.nodeValue=n.nodeValue.split("\n").join(" "),n.nodeValue=n.nodeValue.replace(/(\s)+/g,"$1")):(t.removeChild(n),--s):1===n.nodeType&&e(n)}}(s);for(var r=s.childNodes,o="",a=0;a<r.length;a++)o+=i.subParser("makeMarkdown.node")(r[a],n);return o},this.setOption=function(e,s){t[e]=s},this.getOption=function(e){return t[e]},this.getOptions=function(){return t},this.addExtension=function(e,t){p(e,t=t||null)},this.useExtension=function(e){p(e)},this.setFlavor=function(e){if(!d.hasOwnProperty(e))throw Error(e+" flavor was not found");var s=d[e];for(var n in o=e,s)s.hasOwnProperty(n)&&(t[n]=s[n])},this.getFlavor=function(){return o},this.removeExtension=function(e){i.helper.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t){for(var r=e[t],o=0;o<s.length;++o)s[o]===r&&s[o].splice(o,1);for(;0<n.length;++o)n[0]===r&&n[0].splice(o,1)}},this.getAllExtensions=function(){return{language:s,output:n}},this.getMetadata=function(e){return e?u.raw:u.parsed},this.getMetadataFormat=function(){return u.format},this._setMetadataPair=function(e,t){u.parsed[e]=t},this._setMetadataFormat=function(e){u.format=e},this._setMetadataRaw=function(e){u.raw=e}},i.subParser("anchors",(function(e,t,s){"use strict";var n=function(e,n,r,o,a,l,c){if(i.helper.isUndefined(c)&&(c=""),r=r.toLowerCase(),e.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)o="";else if(!o){if(r||(r=n.toLowerCase().replace(/ ?\n/g," ")),o="#"+r,i.helper.isUndefined(s.gUrls[r]))return e;o=s.gUrls[r],i.helper.isUndefined(s.gTitles[r])||(c=s.gTitles[r])}var d='<a href="'+(o=o.replace(i.helper.regexes.asteriskDashAndColon,i.helper.escapeCharactersCallback))+'"';return""!==c&&null!==c&&(d+=' title="'+(c=(c=c.replace(/"/g,"&quot;")).replace(i.helper.regexes.asteriskDashAndColon,i.helper.escapeCharactersCallback))+'"'),t.openLinksInNewWindow&&!/^#/.test(o)&&(d+=' rel="noopener noreferrer" target="¨E95Eblank"'),d+=">"+n+"</a>"};return e=(e=(e=(e=(e=s.converter._dispatch("anchors.before",e,t,s)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)] ?(?:\n *)?\[(.*?)]()()()()/g,n)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<([^>]*)>(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,n)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,n)).replace(/\[([^\[\]]+)]()()()()()/g,n),t.ghMentions&&(e=e.replace(/(^|\s)(\\)?(@([a-z\d]+(?:[a-z\d.-]+?[a-z\d]+)*))/gim,(function(e,s,n,r,o){if("\\"===n)return s+r;if(!i.helper.isString(t.ghMentionsLink))throw new Error("ghMentionsLink option must be a string");var a=t.ghMentionsLink.replace(/\{u}/g,o),l="";return t.openLinksInNewWindow&&(l=' rel="noopener noreferrer" target="¨E95Eblank"'),s+'<a href="'+a+'"'+l+">"+r+"</a>"}))),e=s.converter._dispatch("anchors.after",e,t,s)}));var m=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+?\.[^'">\s]+?)()(\1)?(?=\s|$)(?!["<>])/gi,f=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+?)([.!?,()\[\]])?(\1)?(?=\s|$)(?!["<>])/gi,g=/()<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)()>()/gi,b=/(^|\s)(?:mailto:)?([A-Za-z0-9!#$%&'*+-/=?^_`{|}~.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?=$|\s)/gim,w=/<()(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,v=function(e){"use strict";return function(t,s,n,r,o,a,l){var c=n=n.replace(i.helper.regexes.asteriskDashAndColon,i.helper.escapeCharactersCallback),d="",h="",u=s||"",p=l||"";return/^www\./i.test(n)&&(n=n.replace(/^www\./i,"http://www.")),e.excludeTrailingPunctuationFromURLs&&a&&(d=a),e.openLinksInNewWindow&&(h=' rel="noopener noreferrer" target="¨E95Eblank"'),u+'<a href="'+n+'"'+h+">"+c+"</a>"+d+p}},y=function(e,t){"use strict";return function(s,n,r){var o="mailto:";return n=n||"",r=i.subParser("unescapeSpecialChars")(r,e,t),e.encodeEmails?(o=i.helper.encodeEmailAddress(o+r),r=i.helper.encodeEmailAddress(r)):o+=r,n+'<a href="'+o+'">'+r+"</a>"}};i.subParser("autoLinks",(function(e,t,s){"use strict";return e=(e=(e=s.converter._dispatch("autoLinks.before",e,t,s)).replace(g,v(t))).replace(w,y(t,s)),e=s.converter._dispatch("autoLinks.after",e,t,s)})),i.subParser("simplifiedAutoLinks",(function(e,t,s){"use strict";return t.simplifiedAutoLink?(e=s.converter._dispatch("simplifiedAutoLinks.before",e,t,s),e=(e=t.excludeTrailingPunctuationFromURLs?e.replace(f,v(t)):e.replace(m,v(t))).replace(b,y(t,s)),e=s.converter._dispatch("simplifiedAutoLinks.after",e,t,s)):e})),i.subParser("blockGamut",(function(e,t,s){"use strict";return e=s.converter._dispatch("blockGamut.before",e,t,s),e=i.subParser("blockQuotes")(e,t,s),e=i.subParser("headers")(e,t,s),e=i.subParser("horizontalRule")(e,t,s),e=i.subParser("lists")(e,t,s),e=i.subParser("codeBlocks")(e,t,s),e=i.subParser("tables")(e,t,s),e=i.subParser("hashHTMLBlocks")(e,t,s),e=i.subParser("paragraphs")(e,t,s),e=s.converter._dispatch("blockGamut.after",e,t,s)})),i.subParser("blockQuotes",(function(e,t,s){"use strict";e=s.converter._dispatch("blockQuotes.before",e,t,s),e+="\n\n";var n=/(^ {0,3}>[ \t]?.+\n(.+\n)*\n*)+/gm;return t.splitAdjacentBlockquotes&&(n=/^ {0,3}>[\s\S]*?(?:\n\n)/gm),e=e.replace(n,(function(e){return e=(e=(e=e.replace(/^[ \t]*>[ \t]?/gm,"")).replace(/¨0/g,"")).replace(/^[ \t]+$/gm,""),e=i.subParser("githubCodeBlocks")(e,t,s),e=(e=(e=i.subParser("blockGamut")(e,t,s)).replace(/(^|\n)/g,"$1  ")).replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,(function(e,t){var s=t;return s=(s=s.replace(/^  /gm,"¨0")).replace(/¨0/g,"")})),i.subParser("hashBlock")("<blockquote>\n"+e+"\n</blockquote>",t,s)})),e=s.converter._dispatch("blockQuotes.after",e,t,s)})),i.subParser("codeBlocks",(function(e,t,s){"use strict";e=s.converter._dispatch("codeBlocks.before",e,t,s);return e=(e=(e+="¨0").replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=¨0))/g,(function(e,n,r){var o=n,a=r,l="\n";return o=i.subParser("outdent")(o,t,s),o=i.subParser("encodeCode")(o,t,s),o=(o=(o=i.subParser("detab")(o,t,s)).replace(/^\n+/g,"")).replace(/\n+$/g,""),t.omitExtraWLInCodeBlocks&&(l=""),o="<pre><code>"+o+l+"</code></pre>",i.subParser("hashBlock")(o,t,s)+a}))).replace(/¨0/,""),e=s.converter._dispatch("codeBlocks.after",e,t,s)})),i.subParser("codeSpans",(function(e,t,s){"use strict";return void 0===(e=s.converter._dispatch("codeSpans.before",e,t,s))&&(e=""),e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,(function(e,n,r,o){var a=o;return a=(a=a.replace(/^([ \t]*)/g,"")).replace(/[ \t]*$/g,""),a=n+"<code>"+(a=i.subParser("encodeCode")(a,t,s))+"</code>",a=i.subParser("hashHTMLSpans")(a,t,s)})),e=s.converter._dispatch("codeSpans.after",e,t,s)})),i.subParser("completeHTMLDocument",(function(e,t,s){"use strict";if(!t.completeHTMLDocument)return e;e=s.converter._dispatch("completeHTMLDocument.before",e,t,s);var n="html",r="<!DOCTYPE HTML>\n",i="",o='<meta charset="utf-8">\n',a="",l="";for(var c in void 0!==s.metadata.parsed.doctype&&(r="<!DOCTYPE "+s.metadata.parsed.doctype+">\n","html"!==(n=s.metadata.parsed.doctype.toString().toLowerCase())&&"html5"!==n||(o='<meta charset="utf-8">')),s.metadata.parsed)if(s.metadata.parsed.hasOwnProperty(c))switch(c.toLowerCase()){case"doctype":break;case"title":i="<title>"+s.metadata.parsed.title+"</title>\n";break;case"charset":o="html"===n||"html5"===n?'<meta charset="'+s.metadata.parsed.charset+'">\n':'<meta name="charset" content="'+s.metadata.parsed.charset+'">\n';break;case"language":case"lang":a=' lang="'+s.metadata.parsed[c]+'"',l+='<meta name="'+c+'" content="'+s.metadata.parsed[c]+'">\n';break;default:l+='<meta name="'+c+'" content="'+s.metadata.parsed[c]+'">\n'}return e=r+"<html"+a+">\n<head>\n"+i+o+l+"</head>\n<body>\n"+e.trim()+"\n</body>\n</html>",e=s.converter._dispatch("completeHTMLDocument.after",e,t,s)})),i.subParser("detab",(function(e,t,s){"use strict";return e=(e=(e=(e=(e=(e=s.converter._dispatch("detab.before",e,t,s)).replace(/\t(?=\t)/g,"    ")).replace(/\t/g,"¨A¨B")).replace(/¨B(.+?)¨A/g,(function(e,t){for(var s=t,n=4-s.length%4,r=0;r<n;r++)s+=" ";return s}))).replace(/¨A/g,"    ")).replace(/¨B/g,""),e=s.converter._dispatch("detab.after",e,t,s)})),i.subParser("ellipsis",(function(e,t,s){"use strict";return e=(e=s.converter._dispatch("ellipsis.before",e,t,s)).replace(/\.\.\./g,"…"),e=s.converter._dispatch("ellipsis.after",e,t,s)})),i.subParser("emoji",(function(e,t,s){"use strict";if(!t.emoji)return e;return e=(e=s.converter._dispatch("emoji.before",e,t,s)).replace(/:([\S]+?):/g,(function(e,t){return i.helper.emojis.hasOwnProperty(t)?i.helper.emojis[t]:e})),e=s.converter._dispatch("emoji.after",e,t,s)})),i.subParser("encodeAmpsAndAngles",(function(e,t,s){"use strict";return e=(e=(e=(e=(e=s.converter._dispatch("encodeAmpsAndAngles.before",e,t,s)).replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;")).replace(/<(?![a-z\/?$!])/gi,"&lt;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;"),e=s.converter._dispatch("encodeAmpsAndAngles.after",e,t,s)})),i.subParser("encodeBackslashEscapes",(function(e,t,s){"use strict";return e=(e=(e=s.converter._dispatch("encodeBackslashEscapes.before",e,t,s)).replace(/\\(\\)/g,i.helper.escapeCharactersCallback)).replace(/\\([`*_{}\[\]()>#+.!~=|-])/g,i.helper.escapeCharactersCallback),e=s.converter._dispatch("encodeBackslashEscapes.after",e,t,s)})),i.subParser("encodeCode",(function(e,t,s){"use strict";return e=(e=s.converter._dispatch("encodeCode.before",e,t,s)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/([*_{}\[\]\\=~-])/g,i.helper.escapeCharactersCallback),e=s.converter._dispatch("encodeCode.after",e,t,s)})),i.subParser("escapeSpecialCharsWithinTagAttributes",(function(e,t,s){"use strict";return e=(e=(e=s.converter._dispatch("escapeSpecialCharsWithinTagAttributes.before",e,t,s)).replace(/<\/?[a-z\d_:-]+(?:[\s]+[\s\S]+?)?>/gi,(function(e){return e.replace(/(.)<\/?code>(?=.)/g,"$1`").replace(/([\\`*_~=|])/g,i.helper.escapeCharactersCallback)}))).replace(/<!(--(?:(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>/gi,(function(e){return e.replace(/([\\`*_~=|])/g,i.helper.escapeCharactersCallback)})),e=s.converter._dispatch("escapeSpecialCharsWithinTagAttributes.after",e,t,s)})),i.subParser("githubCodeBlocks",(function(e,t,s){"use strict";return t.ghCodeBlocks?(e=s.converter._dispatch("githubCodeBlocks.before",e,t,s),e=(e=(e+="¨0").replace(/(?:^|\n)(?: {0,3})(```+|~~~+)(?: *)([^\s`~]*)\n([\s\S]*?)\n(?: {0,3})\1/g,(function(e,n,r,o){var a=t.omitExtraWLInCodeBlocks?"":"\n";return o=i.subParser("encodeCode")(o,t,s),o="<pre><code"+(r?' class="'+r+" language-"+r+'"':"")+">"+(o=(o=(o=i.subParser("detab")(o,t,s)).replace(/^\n+/g,"")).replace(/\n+$/g,""))+a+"</code></pre>",o=i.subParser("hashBlock")(o,t,s),"\n\n¨G"+(s.ghCodeBlocks.push({text:e,codeblock:o})-1)+"G\n\n"}))).replace(/¨0/,""),s.converter._dispatch("githubCodeBlocks.after",e,t,s)):e})),i.subParser("hashBlock",(function(e,t,s){"use strict";return e=(e=s.converter._dispatch("hashBlock.before",e,t,s)).replace(/(^\n+|\n+$)/g,""),e="\n\n¨K"+(s.gHtmlBlocks.push(e)-1)+"K\n\n",e=s.converter._dispatch("hashBlock.after",e,t,s)})),i.subParser("hashCodeTags",(function(e,t,s){"use strict";e=s.converter._dispatch("hashCodeTags.before",e,t,s);return e=i.helper.replaceRecursiveRegExp(e,(function(e,n,r,o){var a=r+i.subParser("encodeCode")(n,t,s)+o;return"¨C"+(s.gHtmlSpans.push(a)-1)+"C"}),"<code\\b[^>]*>","</code>","gim"),e=s.converter._dispatch("hashCodeTags.after",e,t,s)})),i.subParser("hashElement",(function(e,t,s){"use strict";return function(e,t){var n=t;return n=(n=(n=n.replace(/\n\n/g,"\n")).replace(/^\n/,"")).replace(/\n+$/g,""),n="\n\n¨K"+(s.gHtmlBlocks.push(n)-1)+"K\n\n"}})),i.subParser("hashHTMLBlocks",(function(e,t,s){"use strict";e=s.converter._dispatch("hashHTMLBlocks.before",e,t,s);var n=["pre","div","h1","h2","h3","h4","h5","h6","blockquote","table","dl","ol","ul","script","noscript","form","fieldset","iframe","math","style","section","header","footer","nav","article","aside","address","audio","canvas","figure","hgroup","output","video","p"],r=function(e,t,n,r){var i=e;return-1!==n.search(/\bmarkdown\b/)&&(i=n+s.converter.makeHtml(t)+r),"\n\n¨K"+(s.gHtmlBlocks.push(i)-1)+"K\n\n"};t.backslashEscapesHTMLTags&&(e=e.replace(/\\<(\/?[^>]+?)>/g,(function(e,t){return"&lt;"+t+"&gt;"})));for(var o=0;o<n.length;++o)for(var a,l=new RegExp("^ {0,3}(<"+n[o]+"\\b[^>]*>)","im"),c="<"+n[o]+"\\b[^>]*>",d="</"+n[o]+">";-1!==(a=i.helper.regexIndexOf(e,l));){var h=i.helper.splitAtIndex(e,a),u=i.helper.replaceRecursiveRegExp(h[1],r,c,d,"im");if(u===h[1])break;e=h[0].concat(u)}return e=e.replace(/(\n {0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,i.subParser("hashElement")(e,t,s)),e=(e=i.helper.replaceRecursiveRegExp(e,(function(e){return"\n\n¨K"+(s.gHtmlBlocks.push(e)-1)+"K\n\n"}),"^ {0,3}\x3c!--","--\x3e","gm")).replace(/(?:\n\n)( {0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,i.subParser("hashElement")(e,t,s)),e=s.converter._dispatch("hashHTMLBlocks.after",e,t,s)})),i.subParser("hashHTMLSpans",(function(e,t,s){"use strict";function n(e){return"¨C"+(s.gHtmlSpans.push(e)-1)+"C"}return e=(e=(e=(e=(e=s.converter._dispatch("hashHTMLSpans.before",e,t,s)).replace(/<[^>]+?\/>/gi,(function(e){return n(e)}))).replace(/<([^>]+?)>[\s\S]*?<\/\1>/g,(function(e){return n(e)}))).replace(/<([^>]+?)\s[^>]+?>[\s\S]*?<\/\1>/g,(function(e){return n(e)}))).replace(/<[^>]+?>/gi,(function(e){return n(e)})),e=s.converter._dispatch("hashHTMLSpans.after",e,t,s)})),i.subParser("unhashHTMLSpans",(function(e,t,s){"use strict";e=s.converter._dispatch("unhashHTMLSpans.before",e,t,s);for(var n=0;n<s.gHtmlSpans.length;++n){for(var r=s.gHtmlSpans[n],i=0;/¨C(\d+)C/.test(r);){var o=RegExp.$1;if(r=r.replace("¨C"+o+"C",s.gHtmlSpans[o]),10===i){console.error("maximum nesting of 10 spans reached!!!");break}++i}e=e.replace("¨C"+n+"C",r)}return e=s.converter._dispatch("unhashHTMLSpans.after",e,t,s)})),i.subParser("hashPreCodeTags",(function(e,t,s){"use strict";e=s.converter._dispatch("hashPreCodeTags.before",e,t,s);return e=i.helper.replaceRecursiveRegExp(e,(function(e,n,r,o){var a=r+i.subParser("encodeCode")(n,t,s)+o;return"\n\n¨G"+(s.ghCodeBlocks.push({text:e,codeblock:a})-1)+"G\n\n"}),"^ {0,3}<pre\\b[^>]*>\\s*<code\\b[^>]*>","^ {0,3}</code>\\s*</pre>","gim"),e=s.converter._dispatch("hashPreCodeTags.after",e,t,s)})),i.subParser("headers",(function(e,t,s){"use strict";e=s.converter._dispatch("headers.before",e,t,s);var n=isNaN(parseInt(t.headerLevelStart))?1:parseInt(t.headerLevelStart),r=t.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,o=t.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;e=(e=e.replace(r,(function(e,r){var o=i.subParser("spanGamut")(r,t,s),a=t.noHeaderId?"":' id="'+l(r)+'"',c="<h"+n+a+">"+o+"</h"+n+">";return i.subParser("hashBlock")(c,t,s)}))).replace(o,(function(e,r){var o=i.subParser("spanGamut")(r,t,s),a=t.noHeaderId?"":' id="'+l(r)+'"',c=n+1,d="<h"+c+a+">"+o+"</h"+c+">";return i.subParser("hashBlock")(d,t,s)}));var a=t.requireSpaceBeforeHeadingText?/^(#{1,6})[ \t]+(.+?)[ \t]*#*\n+/gm:/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm;function l(e){var n,r;if(t.customizedHeaderId){var o=e.match(/\{([^{]+?)}\s*$/);o&&o[1]&&(e=o[1])}return n=e,r=i.helper.isString(t.prefixHeaderId)?t.prefixHeaderId:!0===t.prefixHeaderId?"section-":"",t.rawPrefixHeaderId||(n=r+n),n=t.ghCompatibleHeaderId?n.replace(/ /g,"-").replace(/&amp;/g,"").replace(/¨T/g,"").replace(/¨D/g,"").replace(/[&+$,\/:;=?@"#{}|^¨~\[\]`\\*)(%.!'<>]/g,"").toLowerCase():t.rawHeaderId?n.replace(/ /g,"-").replace(/&amp;/g,"&").replace(/¨T/g,"¨").replace(/¨D/g,"$").replace(/["']/g,"-").toLowerCase():n.replace(/[^\w]/g,"").toLowerCase(),t.rawPrefixHeaderId&&(n=r+n),s.hashLinkCounts[n]?n=n+"-"+s.hashLinkCounts[n]++:s.hashLinkCounts[n]=1,n}return e=e.replace(a,(function(e,r,o){var a=o;t.customizedHeaderId&&(a=o.replace(/\s?\{([^{]+?)}\s*$/,""));var c=i.subParser("spanGamut")(a,t,s),d=t.noHeaderId?"":' id="'+l(o)+'"',h=n-1+r.length,u="<h"+h+d+">"+c+"</h"+h+">";return i.subParser("hashBlock")(u,t,s)})),e=s.converter._dispatch("headers.after",e,t,s)})),i.subParser("horizontalRule",(function(e,t,s){"use strict";e=s.converter._dispatch("horizontalRule.before",e,t,s);var n=i.subParser("hashBlock")("<hr />",t,s);return e=(e=(e=e.replace(/^ {0,2}( ?-){3,}[ \t]*$/gm,n)).replace(/^ {0,2}( ?\*){3,}[ \t]*$/gm,n)).replace(/^ {0,2}( ?_){3,}[ \t]*$/gm,n),e=s.converter._dispatch("horizontalRule.after",e,t,s)})),i.subParser("images",(function(e,t,s){"use strict";function n(e,t,n,r,o,a,l,c){var d=s.gUrls,h=s.gTitles,u=s.gDimensions;if(n=n.toLowerCase(),c||(c=""),e.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)r="";else if(""===r||null===r){if(""!==n&&null!==n||(n=t.toLowerCase().replace(/ ?\n/g," ")),r="#"+n,i.helper.isUndefined(d[n]))return e;r=d[n],i.helper.isUndefined(h[n])||(c=h[n]),i.helper.isUndefined(u[n])||(o=u[n].width,a=u[n].height)}t=t.replace(/"/g,"&quot;").replace(i.helper.regexes.asteriskDashAndColon,i.helper.escapeCharactersCallback);var p='<img src="'+(r=r.replace(i.helper.regexes.asteriskDashAndColon,i.helper.escapeCharactersCallback))+'" alt="'+t+'"';return c&&i.helper.isString(c)&&(p+=' title="'+(c=c.replace(/"/g,"&quot;").replace(i.helper.regexes.asteriskDashAndColon,i.helper.escapeCharactersCallback))+'"'),o&&a&&(p+=' width="'+(o="*"===o?"auto":o)+'"',p+=' height="'+(a="*"===a?"auto":a)+'"'),p+=" />"}return e=(e=(e=(e=(e=(e=s.converter._dispatch("images.before",e,t,s)).replace(/!\[([^\]]*?)] ?(?:\n *)?\[([\s\S]*?)]()()()()()/g,n)).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,(function(e,t,s,r,i,o,a,l){return n(e,t,s,r=r.replace(/\s/g,""),i,o,a,l)}))).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<([^>]*)>(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(?:(["'])([^"]*?)\6))?[ \t]?\)/g,n)).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,n)).replace(/!\[([^\[\]]+)]()()()()()/g,n),e=s.converter._dispatch("images.after",e,t,s)})),i.subParser("italicsAndBold",(function(e,t,s){"use strict";function n(e,t,s){return t+e+s}return e=s.converter._dispatch("italicsAndBold.before",e,t,s),e=t.literalMidWordUnderscores?(e=(e=e.replace(/\b___(\S[\s\S]*?)___\b/g,(function(e,t){return n(t,"<strong><em>","</em></strong>")}))).replace(/\b__(\S[\s\S]*?)__\b/g,(function(e,t){return n(t,"<strong>","</strong>")}))).replace(/\b_(\S[\s\S]*?)_\b/g,(function(e,t){return n(t,"<em>","</em>")})):(e=(e=e.replace(/___(\S[\s\S]*?)___/g,(function(e,t){return/\S$/.test(t)?n(t,"<strong><em>","</em></strong>"):e}))).replace(/__(\S[\s\S]*?)__/g,(function(e,t){return/\S$/.test(t)?n(t,"<strong>","</strong>"):e}))).replace(/_([^\s_][\s\S]*?)_/g,(function(e,t){return/\S$/.test(t)?n(t,"<em>","</em>"):e})),e=t.literalMidWordAsterisks?(e=(e=e.replace(/([^*]|^)\B\*\*\*(\S[\s\S]*?)\*\*\*\B(?!\*)/g,(function(e,t,s){return n(s,t+"<strong><em>","</em></strong>")}))).replace(/([^*]|^)\B\*\*(\S[\s\S]*?)\*\*\B(?!\*)/g,(function(e,t,s){return n(s,t+"<strong>","</strong>")}))).replace(/([^*]|^)\B\*(\S[\s\S]*?)\*\B(?!\*)/g,(function(e,t,s){return n(s,t+"<em>","</em>")})):(e=(e=e.replace(/\*\*\*(\S[\s\S]*?)\*\*\*/g,(function(e,t){return/\S$/.test(t)?n(t,"<strong><em>","</em></strong>"):e}))).replace(/\*\*(\S[\s\S]*?)\*\*/g,(function(e,t){return/\S$/.test(t)?n(t,"<strong>","</strong>"):e}))).replace(/\*([^\s*][\s\S]*?)\*/g,(function(e,t){return/\S$/.test(t)?n(t,"<em>","</em>"):e})),e=s.converter._dispatch("italicsAndBold.after",e,t,s)})),i.subParser("lists",(function(e,t,s){"use strict";function n(e,n){s.gListLevel++,e=e.replace(/\n{2,}$/,"\n");var r=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0| {0,3}([*+-]|\d+[.])[ \t]+))/gm,o=/\n[ \t]*\n(?!¨0)/.test(e+="¨0");return t.disableForced4SpacesIndentedSublists&&(r=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0|\2([*+-]|\d+[.])[ \t]+))/gm),e=(e=e.replace(r,(function(e,n,r,a,l,c,d){d=d&&""!==d.trim();var h=i.subParser("outdent")(l,t,s),u="";return c&&t.tasklists&&(u=' class="task-list-item" style="list-style-type: none;"',h=h.replace(/^[ \t]*\[(x|X| )?]/m,(function(){var e='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return d&&(e+=" checked"),e+=">"}))),h=h.replace(/^([-*+]|\d\.)[ \t]+[\S\n ]*/g,(function(e){return"¨A"+e})),n||h.search(/\n{2,}/)>-1?(h=i.subParser("githubCodeBlocks")(h,t,s),h=i.subParser("blockGamut")(h,t,s)):(h=(h=i.subParser("lists")(h,t,s)).replace(/\n$/,""),h=(h=i.subParser("hashHTMLBlocks")(h,t,s)).replace(/\n\n+/g,"\n\n"),h=o?i.subParser("paragraphs")(h,t,s):i.subParser("spanGamut")(h,t,s)),h="<li"+u+">"+(h=h.replace("¨A",""))+"</li>\n"}))).replace(/¨0/g,""),s.gListLevel--,n&&(e=e.replace(/\s+$/,"")),e}function r(e,t){if("ol"===t){var s=e.match(/^ *(\d+)\./);if(s&&"1"!==s[1])return' start="'+s[1]+'"'}return""}function o(e,s,i){var o=t.disableForced4SpacesIndentedSublists?/^ ?\d+\.[ \t]/gm:/^ {0,3}\d+\.[ \t]/gm,a=t.disableForced4SpacesIndentedSublists?/^ ?[*+-][ \t]/gm:/^ {0,3}[*+-][ \t]/gm,l="ul"===s?o:a,c="";if(-1!==e.search(l))!function t(d){var h=d.search(l),u=r(e,s);-1!==h?(c+="\n\n<"+s+u+">\n"+n(d.slice(0,h),!!i)+"</"+s+">\n",l="ul"===(s="ul"===s?"ol":"ul")?o:a,t(d.slice(h))):c+="\n\n<"+s+u+">\n"+n(d,!!i)+"</"+s+">\n"}(e);else{var d=r(e,s);c="\n\n<"+s+d+">\n"+n(e,!!i)+"</"+s+">\n"}return c}return e=s.converter._dispatch("lists.before",e,t,s),e+="¨0",e=(e=s.gListLevel?e.replace(/^(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,(function(e,t,s){return o(t,s.search(/[*+-]/g)>-1?"ul":"ol",!0)})):e.replace(/(\n\n|^\n?)(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,(function(e,t,s,n){return o(s,n.search(/[*+-]/g)>-1?"ul":"ol",!1)}))).replace(/¨0/,""),e=s.converter._dispatch("lists.after",e,t,s)})),i.subParser("metadata",(function(e,t,s){"use strict";if(!t.metadata)return e;function n(e){s.metadata.raw=e,(e=(e=e.replace(/&/g,"&amp;").replace(/"/g,"&quot;")).replace(/\n {4}/g," ")).replace(/^([\S ]+): +([\s\S]+?)$/gm,(function(e,t,n){return s.metadata.parsed[t]=n,""}))}return e=(e=(e=(e=s.converter._dispatch("metadata.before",e,t,s)).replace(/^\s*«««+(\S*?)\n([\s\S]+?)\n»»»+\n/,(function(e,t,s){return n(s),"¨M"}))).replace(/^\s*---+(\S*?)\n([\s\S]+?)\n---+\n/,(function(e,t,r){return t&&(s.metadata.format=t),n(r),"¨M"}))).replace(/¨M/g,""),e=s.converter._dispatch("metadata.after",e,t,s)})),i.subParser("outdent",(function(e,t,s){"use strict";return e=(e=(e=s.converter._dispatch("outdent.before",e,t,s)).replace(/^(\t|[ ]{1,4})/gm,"¨0")).replace(/¨0/g,""),e=s.converter._dispatch("outdent.after",e,t,s)})),i.subParser("paragraphs",(function(e,t,s){"use strict";for(var n=(e=(e=(e=s.converter._dispatch("paragraphs.before",e,t,s)).replace(/^\n+/g,"")).replace(/\n+$/g,"")).split(/\n{2,}/g),r=[],o=n.length,a=0;a<o;a++){var l=n[a];l.search(/¨(K|G)(\d+)\1/g)>=0?r.push(l):l.search(/\S/)>=0&&(l=(l=i.subParser("spanGamut")(l,t,s)).replace(/^([ \t]*)/g,"<p>"),l+="</p>",r.push(l))}for(o=r.length,a=0;a<o;a++){for(var c="",d=r[a],h=!1;/¨(K|G)(\d+)\1/.test(d);){var u=RegExp.$1,p=RegExp.$2;c=(c="K"===u?s.gHtmlBlocks[p]:h?i.subParser("encodeCode")(s.ghCodeBlocks[p].text,t,s):s.ghCodeBlocks[p].codeblock).replace(/\$/g,"$$$$"),d=d.replace(/(\n\n)?¨(K|G)\d+\2(\n\n)?/,c),/^<pre\b[^>]*>\s*<code\b[^>]*>/.test(d)&&(h=!0)}r[a]=d}return e=(e=(e=r.join("\n")).replace(/^\n+/g,"")).replace(/\n+$/g,""),s.converter._dispatch("paragraphs.after",e,t,s)})),i.subParser("runExtension",(function(e,t,s,n){"use strict";if(e.filter)t=e.filter(t,n.converter,s);else if(e.regex){var r=e.regex;r instanceof RegExp||(r=new RegExp(r,"g")),t=t.replace(r,e.replace)}return t})),i.subParser("spanGamut",(function(e,t,s){"use strict";return e=s.converter._dispatch("spanGamut.before",e,t,s),e=i.subParser("codeSpans")(e,t,s),e=i.subParser("escapeSpecialCharsWithinTagAttributes")(e,t,s),e=i.subParser("encodeBackslashEscapes")(e,t,s),e=i.subParser("images")(e,t,s),e=i.subParser("anchors")(e,t,s),e=i.subParser("autoLinks")(e,t,s),e=i.subParser("simplifiedAutoLinks")(e,t,s),e=i.subParser("emoji")(e,t,s),e=i.subParser("underline")(e,t,s),e=i.subParser("italicsAndBold")(e,t,s),e=i.subParser("strikethrough")(e,t,s),e=i.subParser("ellipsis")(e,t,s),e=i.subParser("hashHTMLSpans")(e,t,s),e=i.subParser("encodeAmpsAndAngles")(e,t,s),t.simpleLineBreaks?/\n\n¨K/.test(e)||(e=e.replace(/\n+/g,"<br />\n")):e=e.replace(/  +\n/g,"<br />\n"),e=s.converter._dispatch("spanGamut.after",e,t,s)})),i.subParser("strikethrough",(function(e,t,s){"use strict";return t.strikethrough&&(e=(e=s.converter._dispatch("strikethrough.before",e,t,s)).replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,(function(e,n){return function(e){return t.simplifiedAutoLink&&(e=i.subParser("simplifiedAutoLinks")(e,t,s)),"<del>"+e+"</del>"}(n)})),e=s.converter._dispatch("strikethrough.after",e,t,s)),e})),i.subParser("stripLinkDefinitions",(function(e,t,s){"use strict";var n=function(e,n,r,o,a,l,c){return n=n.toLowerCase(),r.match(/^data:.+?\/.+?;base64,/)?s.gUrls[n]=r.replace(/\s/g,""):s.gUrls[n]=i.subParser("encodeAmpsAndAngles")(r,t,s),l?l+c:(c&&(s.gTitles[n]=c.replace(/"|'/g,"&quot;")),t.parseImgDimensions&&o&&a&&(s.gDimensions[n]={width:o,height:a}),"")};return e=(e=(e=(e+="¨0").replace(/^ {0,3}\[(.+)]:[ \t]*\n?[ \t]*<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n\n|(?=¨0)|(?=\n\[))/gm,n)).replace(/^ {0,3}\[(.+)]:[ \t]*\n?[ \t]*<?([^>\s]+)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=¨0))/gm,n)).replace(/¨0/,"")})),i.subParser("tables",(function(e,t,s){"use strict";if(!t.tables)return e;function n(e,n){return"<td"+n+">"+i.subParser("spanGamut")(e,t,s)+"</td>\n"}function r(e){var r,o=e.split("\n");for(r=0;r<o.length;++r)/^ {0,3}\|/.test(o[r])&&(o[r]=o[r].replace(/^ {0,3}\|/,"")),/\|[ \t]*$/.test(o[r])&&(o[r]=o[r].replace(/\|[ \t]*$/,"")),o[r]=i.subParser("codeSpans")(o[r],t,s);var a,l,c,d,h=o[0].split("|").map((function(e){return e.trim()})),u=o[1].split("|").map((function(e){return e.trim()})),p=[],m=[],f=[],g=[];for(o.shift(),o.shift(),r=0;r<o.length;++r)""!==o[r].trim()&&p.push(o[r].split("|").map((function(e){return e.trim()})));if(h.length<u.length)return e;for(r=0;r<u.length;++r)f.push((a=u[r],/^:[ \t]*--*$/.test(a)?' style="text-align:left;"':/^--*[ \t]*:[ \t]*$/.test(a)?' style="text-align:right;"':/^:[ \t]*--*[ \t]*:$/.test(a)?' style="text-align:center;"':""));for(r=0;r<h.length;++r)i.helper.isUndefined(f[r])&&(f[r]=""),m.push((l=h[r],c=f[r],d=void 0,d="",l=l.trim(),(t.tablesHeaderId||t.tableHeaderId)&&(d=' id="'+l.replace(/ /g,"_").toLowerCase()+'"'),"<th"+d+c+">"+(l=i.subParser("spanGamut")(l,t,s))+"</th>\n"));for(r=0;r<p.length;++r){for(var b=[],w=0;w<m.length;++w)i.helper.isUndefined(p[r][w]),b.push(n(p[r][w],f[w]));g.push(b)}return function(e,t){for(var s="<table>\n<thead>\n<tr>\n",n=e.length,r=0;r<n;++r)s+=e[r];for(s+="</tr>\n</thead>\n<tbody>\n",r=0;r<t.length;++r){s+="<tr>\n";for(var i=0;i<n;++i)s+=t[r][i];s+="</tr>\n"}return s+="</tbody>\n</table>\n"}(m,g)}return e=(e=(e=(e=s.converter._dispatch("tables.before",e,t,s)).replace(/\\(\|)/g,i.helper.escapeCharactersCallback)).replace(/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|¨0)/gm,r)).replace(/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|¨0)/gm,r),e=s.converter._dispatch("tables.after",e,t,s)})),i.subParser("underline",(function(e,t,s){"use strict";return t.underline?(e=s.converter._dispatch("underline.before",e,t,s),e=(e=t.literalMidWordUnderscores?(e=e.replace(/\b___(\S[\s\S]*?)___\b/g,(function(e,t){return"<u>"+t+"</u>"}))).replace(/\b__(\S[\s\S]*?)__\b/g,(function(e,t){return"<u>"+t+"</u>"})):(e=e.replace(/___(\S[\s\S]*?)___/g,(function(e,t){return/\S$/.test(t)?"<u>"+t+"</u>":e}))).replace(/__(\S[\s\S]*?)__/g,(function(e,t){return/\S$/.test(t)?"<u>"+t+"</u>":e}))).replace(/(_)/g,i.helper.escapeCharactersCallback),e=s.converter._dispatch("underline.after",e,t,s)):e})),i.subParser("unescapeSpecialChars",(function(e,t,s){"use strict";return e=(e=s.converter._dispatch("unescapeSpecialChars.before",e,t,s)).replace(/¨E(\d+)E/g,(function(e,t){var s=parseInt(t);return String.fromCharCode(s)})),e=s.converter._dispatch("unescapeSpecialChars.after",e,t,s)})),i.subParser("makeMarkdown.blockquote",(function(e,t){"use strict";var s="";if(e.hasChildNodes())for(var n=e.childNodes,r=n.length,o=0;o<r;++o){var a=i.subParser("makeMarkdown.node")(n[o],t);""!==a&&(s+=a)}return s="> "+(s=s.trim()).split("\n").join("\n> ")})),i.subParser("makeMarkdown.codeBlock",(function(e,t){"use strict";var s=e.getAttribute("language"),n=e.getAttribute("precodenum");return"```"+s+"\n"+t.preList[n]+"\n```"})),i.subParser("makeMarkdown.codeSpan",(function(e){"use strict";return"`"+e.innerHTML+"`"})),i.subParser("makeMarkdown.emphasis",(function(e,t){"use strict";var s="";if(e.hasChildNodes()){s+="*";for(var n=e.childNodes,r=n.length,o=0;o<r;++o)s+=i.subParser("makeMarkdown.node")(n[o],t);s+="*"}return s})),i.subParser("makeMarkdown.header",(function(e,t,s){"use strict";var n=new Array(s+1).join("#"),r="";if(e.hasChildNodes()){r=n+" ";for(var o=e.childNodes,a=o.length,l=0;l<a;++l)r+=i.subParser("makeMarkdown.node")(o[l],t)}return r})),i.subParser("makeMarkdown.hr",(function(){"use strict";return"---"})),i.subParser("makeMarkdown.image",(function(e){"use strict";var t="";return e.hasAttribute("src")&&(t+="!["+e.getAttribute("alt")+"](",t+="<"+e.getAttribute("src")+">",e.hasAttribute("width")&&e.hasAttribute("height")&&(t+=" ="+e.getAttribute("width")+"x"+e.getAttribute("height")),e.hasAttribute("title")&&(t+=' "'+e.getAttribute("title")+'"'),t+=")"),t})),i.subParser("makeMarkdown.links",(function(e,t){"use strict";var s="";if(e.hasChildNodes()&&e.hasAttribute("href")){var n=e.childNodes,r=n.length;s="[";for(var o=0;o<r;++o)s+=i.subParser("makeMarkdown.node")(n[o],t);s+="](",s+="<"+e.getAttribute("href")+">",e.hasAttribute("title")&&(s+=' "'+e.getAttribute("title")+'"'),s+=")"}return s})),i.subParser("makeMarkdown.list",(function(e,t,s){"use strict";var n="";if(!e.hasChildNodes())return"";for(var r=e.childNodes,o=r.length,a=e.getAttribute("start")||1,l=0;l<o;++l)if(void 0!==r[l].tagName&&"li"===r[l].tagName.toLowerCase()){n+=("ol"===s?a.toString()+". ":"- ")+i.subParser("makeMarkdown.listItem")(r[l],t),++a}return(n+="\n\x3c!-- --\x3e\n").trim()})),i.subParser("makeMarkdown.listItem",(function(e,t){"use strict";for(var s="",n=e.childNodes,r=n.length,o=0;o<r;++o)s+=i.subParser("makeMarkdown.node")(n[o],t);return/\n$/.test(s)?s=s.split("\n").join("\n    ").replace(/^ {4}$/gm,"").replace(/\n\n+/g,"\n\n"):s+="\n",s})),i.subParser("makeMarkdown.node",(function(e,t,s){"use strict";s=s||!1;var n="";if(3===e.nodeType)return i.subParser("makeMarkdown.txt")(e,t);if(8===e.nodeType)return"\x3c!--"+e.data+"--\x3e\n\n";if(1!==e.nodeType)return"";switch(e.tagName.toLowerCase()){case"h1":s||(n=i.subParser("makeMarkdown.header")(e,t,1)+"\n\n");break;case"h2":s||(n=i.subParser("makeMarkdown.header")(e,t,2)+"\n\n");break;case"h3":s||(n=i.subParser("makeMarkdown.header")(e,t,3)+"\n\n");break;case"h4":s||(n=i.subParser("makeMarkdown.header")(e,t,4)+"\n\n");break;case"h5":s||(n=i.subParser("makeMarkdown.header")(e,t,5)+"\n\n");break;case"h6":s||(n=i.subParser("makeMarkdown.header")(e,t,6)+"\n\n");break;case"p":s||(n=i.subParser("makeMarkdown.paragraph")(e,t)+"\n\n");break;case"blockquote":s||(n=i.subParser("makeMarkdown.blockquote")(e,t)+"\n\n");break;case"hr":s||(n=i.subParser("makeMarkdown.hr")(e,t)+"\n\n");break;case"ol":s||(n=i.subParser("makeMarkdown.list")(e,t,"ol")+"\n\n");break;case"ul":s||(n=i.subParser("makeMarkdown.list")(e,t,"ul")+"\n\n");break;case"precode":s||(n=i.subParser("makeMarkdown.codeBlock")(e,t)+"\n\n");break;case"pre":s||(n=i.subParser("makeMarkdown.pre")(e,t)+"\n\n");break;case"table":s||(n=i.subParser("makeMarkdown.table")(e,t)+"\n\n");break;case"code":n=i.subParser("makeMarkdown.codeSpan")(e,t);break;case"em":case"i":n=i.subParser("makeMarkdown.emphasis")(e,t);break;case"strong":case"b":n=i.subParser("makeMarkdown.strong")(e,t);break;case"del":n=i.subParser("makeMarkdown.strikethrough")(e,t);break;case"a":n=i.subParser("makeMarkdown.links")(e,t);break;case"img":n=i.subParser("makeMarkdown.image")(e,t);break;default:n=e.outerHTML+"\n\n"}return n})),i.subParser("makeMarkdown.paragraph",(function(e,t){"use strict";var s="";if(e.hasChildNodes())for(var n=e.childNodes,r=n.length,o=0;o<r;++o)s+=i.subParser("makeMarkdown.node")(n[o],t);return s=s.trim()})),i.subParser("makeMarkdown.pre",(function(e,t){"use strict";var s=e.getAttribute("prenum");return"<pre>"+t.preList[s]+"</pre>"})),i.subParser("makeMarkdown.strikethrough",(function(e,t){"use strict";var s="";if(e.hasChildNodes()){s+="~~";for(var n=e.childNodes,r=n.length,o=0;o<r;++o)s+=i.subParser("makeMarkdown.node")(n[o],t);s+="~~"}return s})),i.subParser("makeMarkdown.strong",(function(e,t){"use strict";var s="";if(e.hasChildNodes()){s+="**";for(var n=e.childNodes,r=n.length,o=0;o<r;++o)s+=i.subParser("makeMarkdown.node")(n[o],t);s+="**"}return s})),i.subParser("makeMarkdown.table",(function(e,t){"use strict";var s,n,r="",o=[[],[]],a=e.querySelectorAll("thead>tr>th"),l=e.querySelectorAll("tbody>tr");for(s=0;s<a.length;++s){var c=i.subParser("makeMarkdown.tableCell")(a[s],t),d="---";if(a[s].hasAttribute("style"))switch(a[s].getAttribute("style").toLowerCase().replace(/\s/g,"")){case"text-align:left;":d=":---";break;case"text-align:right;":d="---:";break;case"text-align:center;":d=":---:"}o[0][s]=c.trim(),o[1][s]=d}for(s=0;s<l.length;++s){var h=o.push([])-1,u=l[s].getElementsByTagName("td");for(n=0;n<a.length;++n){var p=" ";void 0!==u[n]&&(p=i.subParser("makeMarkdown.tableCell")(u[n],t)),o[h].push(p)}}var m=3;for(s=0;s<o.length;++s)for(n=0;n<o[s].length;++n){var f=o[s][n].length;f>m&&(m=f)}for(s=0;s<o.length;++s){for(n=0;n<o[s].length;++n)1===s?":"===o[s][n].slice(-1)?o[s][n]=i.helper.padEnd(o[s][n].slice(-1),m-1,"-")+":":o[s][n]=i.helper.padEnd(o[s][n],m,"-"):o[s][n]=i.helper.padEnd(o[s][n],m);r+="| "+o[s].join(" | ")+" |\n"}return r.trim()})),i.subParser("makeMarkdown.tableCell",(function(e,t){"use strict";var s="";if(!e.hasChildNodes())return"";for(var n=e.childNodes,r=n.length,o=0;o<r;++o)s+=i.subParser("makeMarkdown.node")(n[o],t,!0);return s.trim()})),i.subParser("makeMarkdown.txt",(function(e){"use strict";var t=e.nodeValue;return t=(t=t.replace(/ +/g," ")).replace(/¨NBSP;/g," "),t=(t=(t=(t=(t=(t=(t=(t=(t=i.helper.unescapeHTMLEntities(t)).replace(/([*_~|`])/g,"\\$1")).replace(/^(\s*)>/g,"\\$1>")).replace(/^#/gm,"\\#")).replace(/^(\s*)([-=]{3,})(\s*)$/,"$1\\$2$3")).replace(/^( {0,3}\d+)\./gm,"$1\\.")).replace(/^( {0,3})([+-])/gm,"$1\\$2")).replace(/]([\s]*)\(/g,"\\]$1\\(")).replace(/^ {0,3}\[([\S \t]*?)]:/gm,"\\[$1]:")}));void 0===(n=function(){"use strict";return i}.call(t,s,t,e))||(e.exports=n)}).call(this)},function(e,t,s){e.exports=s(62)},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),r={type:"Account",variant:"read",fields:{id:{dataType:"string",id:!0},name:{dataType:"string",update:!0},login:{dataType:"string",update:!0},email:{dataType:"string",update:!0},role:{dataType:"string",update:!0},avatarId:{dataType:"string"}}};t.default={read:r,create:n.pickFragmentMeta("create",r,["name","login","email","role"]),update:n.pickUpdateFragmentMeta("update",r,["id"],["name","login","email","role"]),id:n.pickFragmentMeta("id",r,["id"]),fetch:n.searchPickFragmentMeta("fetch",r,["name","login","email","role"])}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),r={type:"Comment",variant:"read",fields:{id:{dataType:"string",id:!0},taskId:{dataType:"string"},writtenById:{dataType:"string"},body:{dataType:"string",update:!0},createTs:{dataType:"number"},updateTs:{dataType:"number"}}};t.default={read:r,create:n.pickFragmentMeta("create",r,["taskId","body"]),update:n.pickUpdateFragmentMeta("update",r,["id"],["body"]),id:n.pickFragmentMeta("id",r,["id"]),fetch:n.pickFragmentMeta("fetch",r,["taskId"])}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),r={type:"Flag",variant:"read",fields:{id:{dataType:"string",id:!0},label:{dataType:"string",update:!0},color:{dataType:"string",update:!0},orderNum:{dataType:"number",update:!0,optional:!0}},orderFieldName:"orderNum"};t.default={read:r,create:n.pickFragmentMeta("create",r,["label","color","orderNum"]),update:n.pickUpdateFragmentMeta("update",r,["id"],["label","color","orderNum"]),id:n.pickFragmentMeta("id",r,["id"])}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),r={type:"GitCommit",variant:"read",fields:{id:{dataType:"string",id:!0},externalId:{dataType:"string"},message:{dataType:"string"},authorName:{dataType:"string"},url:{dataType:"string"},ts:{dataType:"string"}},orderFieldName:"orderNum"};t.default={read:r,id:n.pickFragmentMeta("id",r,["id"])}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),r={type:"Media",variant:"read",fields:{id:{dataType:"string",id:!0},ts:{dataType:"number"},baseName:{dataType:"string",optional:!0},originalName:{dataType:"string",optional:!0},ownerId:{dataType:"string",optional:!0},externalType:{dataType:"string",optional:!0},externalId:{dataType:"string",optional:!0}},orderFieldName:"ts"};t.default={read:r,id:n.pickFragmentMeta("id",r,["id"])}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),r={type:"MediaVariant",variant:"read",fields:{id:{dataType:"string",id:!0},mediaId:{dataType:"string"},code:{dataType:"string"},weightB:{dataType:"number"},mediaType:{dataType:"string"},url:{dataType:"string"},imgWidth:{dataType:"number",optional:!0},imgHeight:{dataType:"number",optional:!0},imgDpi:{dataType:"number",optional:!0}},orderFieldName:"imgWidth"};t.default={read:r,id:n.pickFragmentMeta("id",r,["id"])}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),r={type:"Project",variant:"read",fields:{id:{dataType:"string",id:!0},code:{dataType:"string",update:!0},name:{dataType:"string",update:!0},description:{dataType:"string",optional:!0,update:!0},archived:{dataType:"boolean",update:!0},rootTaskId:{dataType:"string"},stepIds:{dataType:"string[]",update:!0}}};t.default={read:r,create:n.pickFragmentMeta("create",r,["code","name","description","stepIds"]),update:n.pickUpdateFragmentMeta("update",r,["id"],["code","name","description","archived","stepIds"]),id:n.pickFragmentMeta("id",r,["id"]),fetch:n.searchPickFragmentMeta("fetch",r,["code","name","description","archived"])}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),r={type:"Step",variant:"read",fields:{id:{dataType:"string",id:!0},label:{dataType:"string",update:!0},orderNum:{dataType:"number",update:!0,optional:!0}},orderFieldName:"orderNum"};t.default={read:r,create:n.pickFragmentMeta("create",r,["label","orderNum"]),update:n.pickUpdateFragmentMeta("update",r,["id"],["label","orderNum"]),id:n.pickFragmentMeta("id",r,["id"])}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),r={type:"Task",variant:"read",fields:{id:{dataType:"string",id:!0},projectId:{dataType:"string"},curStepId:{dataType:"string",update:!0},code:{dataType:"string"},label:{dataType:"string",update:!0},description:{dataType:"string",optional:!0,update:!0},createdById:{dataType:"string"},parentTaskId:{dataType:"string",update:!0},orderNum:{dataType:"number",update:!0},createTs:{dataType:"number"},updateTs:{dataType:"number"},affectedToIds:{dataType:"string[]",optional:!0,update:!0},flagIds:{dataType:"string[]",optional:!0,update:!0},commentCount:{dataType:"number",optional:!0},attachedMediaIds:{dataType:"string[]",optional:!0},gitCommitIds:{dataType:"string[]",optional:!0}},orderFieldName:"orderNum"};t.default={read:r,create:n.pickFragmentMeta("create",r,["curStepId","label","description","parentTaskId","orderNum","affectedToIds","flagIds"]),update:n.pickUpdateFragmentMeta("update",r,["id"],["curStepId","label","description","parentTaskId","orderNum","affectedToIds","flagIds"]),id:n.pickFragmentMeta("id",r,["id"]),fetch:n.searchPickFragmentMeta("fetch",r,["projectId","curStepId","label","description","createdById","parentTaskId","affectedToIds","flagIds"])}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),r={type:"TaskLogEntry",variant:"read",fields:{id:{dataType:"string",id:!0},taskId:{dataType:"string"},stepId:{dataType:"string"},entryTs:{dataType:"number"},accountId:{dataType:"string"}}};t.default={read:r,id:n.pickFragmentMeta("id",r,["id"]),fetch:n.pickFragmentMeta("fetch",r,["taskId"])}},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){"use strict";function n(e){return"string"==typeof e?[e]:e}function r(e){return 1===e.length&&Array.isArray(e[0])?e[0]:e}s.r(t);class i{constructor(e,t){this.app=e,this.componentId=t,this.map=new Map}invokeOrder(e,t){for(let s of n(e))this.exec(s,t);let s=this.app.getChildrenOf(this.componentId);for(let n of s)n.getDOrders().invokeOrder(e,t)}listenToDescendingOrder(e,t,s=null){for(let r of n(e)){let e=this.map.get(r);e||this.map.set(r,e=[]),e.push({cb:t,thisArg:s})}}stopListeningDescendingOrder(e,t,s=null){for(let r of n(e)){let e=this.map.get(r);e&&this.map.set(r,e.filter(e=>e.cb!==t||e.thisArg!==s))}}exec(e,t){let s=this.map.get(e);s&&s.forEach(e=>function(e,t){e.thisArg?e.cb.call(e.thisArg,t):e.cb(t)}(e,t))}}function o(e,t){e.thisArg?e.cb.call(e.thisArg,t.data,t):e.cb(t.data,t)}class a{constructor(e,t){this.log=e,this.eventNames=new Set,this.strictEvents=!1,this.destroyed=!1,t&&this.exposeEvent(t,!1)}exposeEvent(e,t){if(this.destroyed)throw new Error("Cannot call exposeEvent in a destroyed transmitter");for(let t of e)this.eventNames.add(t);t&&(this.strictEvents=!0)}emit(e){if(this.destroyed||!this.listeners)return;if(this.strictEvents&&!this.eventNames.has(e.eventName))throw new Error("Unexposed event: "+e.eventName);let t=this.listeners.get(e.eventName);if(t)for(let s of t)try{o(s,e)}catch(e){this.log.error(e)}}on(e,t,s){if(!this.destroyed){this.listeners||(this.listeners=new Map);for(let n of e){let e=this.listeners.get(n);e||this.listeners.set(n,e=[]),e.push({cb:t,thisArg:s})}}}off(e,t,s){if(!this.destroyed&&this.listeners)for(let[n,r]of this.listeners)if(!e||e.has(n))for(let e=0;e<r.length;++e){let n=r[e];n.cb===t&&n.thisArg===s&&(r.splice(e,1),--e)}}destroy(){this.listeners=void 0,this.destroyed=!0}}class l{listenTo(e,t,s,n=null){e.on(t,s,n),this.map||(this.map=new Map);let r=this.map.get(s);r||this.map.set(s,r=new Map);let i=r.get(n);i||r.set(n,i=new Map);let o=i.get(e);o||i.set(e,o=new Set);for(let e of t)o.add(e)}stopListeningEverywhere(e,t=null){if(!this.map)return;let s=this.map.get(e);if(!s)return;let n=s.get(t);if(n){for(let[s,r]of n)s.off(r,e,t);s.delete(t),0===s.size&&this.map.delete(e)}}stopListening(e,t,s,n=null){if(!this.map)return;let r=this.map.get(s);if(!r)return;let i=r.get(n);if(!i)return;let o=i.get(e);if(!o)return;let a=new Set;for(let e of t)o.delete(e)&&a.add(e);e.off(a,s,n),0===o.size&&(i.delete(e),0===i.size&&(r.delete(n),0===r.size&&this.map.delete(s)))}destroy(){if(this.map){for(let[e,t]of this.map)for(let[s,n]of t)for(let[t,r]of n)t.off(r,e,s);this.map=void 0}}}const c=Symbol("canPropagate");class d{constructor(e,t){var s;this.app=e,this.componentId=t,this.subscriber=new l,this.emitter=new a(e.log,["destroy"]),this.pub=(s=this,Object.freeze({unmanagedListeners:Object.freeze({on:(e,t,r)=>{s.emitter.on(n(e),t,r)},off:(e,t,r)=>{s.emitter.off(new Set(n(e)),t,r)}}),getComponent:()=>s.getInstance(),children:(e={})=>s.getChildren(e),hasChildren:(e={})=>s.hasChildren(e),isChild:e=>s.isChild(e),destroy:()=>s.destroy(),invokeDescendingOrder(e,t){return s.getDOrders().invokeOrder(e,t),this},isComponent:e=>s.app.isComponent(e),getPublicDashOf:e=>s.app.getBkbByInst(e).pub,getParentOf(e){let t=s.app.getBkbByInst(e).getParent();return t?t.getInstance():void 0},log:s.app.log,get app(){return s.app.root.getInstance()}})),this.dash=function(e,t){let s={setInstance:t=>(e.setInstance(t),i),exposeEvent:(...t)=>(e.emitter.exposeEvent(r(t),!0),i),create:(t,s)=>e.createChild({asObj:!1,Class:t,opt:s}).getInstance(),registerComponent:t=>e.createChild({asObj:!0,obj:t}).dash,addToGroup:(t,...s)=>(e.addToGroup(t,r(s)),i),inGroup:(t,...s)=>e.inGroup(t,r(s)),emit(t,s,n){let r=Array.isArray(t)?t:[t];for(let t of r)e.emit(t,s,n);return i},broadcast:(t,s)=>(e.broadcast(t,s),i),listenTo:(...t)=>{let s,r,o,a;if(2===t.length||"string"==typeof t[0]||Array.isArray(t[0]))[r,o,a]=t,s=e;else{let n;[n,r,o,a]=t,s=e.app.getBkbByInst(n)}return e.subscriber.listenTo(s.emitter,n(r),o,a),i},stopListening:(...t)=>{let s,r,o,a,l=t.length;if("string"==typeof t[0]||Array.isArray(t[0]))[r,o,a]=t,s=e;else{if(1===l||2===l)return[o,a]=t,void e.subscriber.stopListeningEverywhere(o,a);{let n;[n,r,o,a]=t,s=e.app.getBkbByInst(n)}}return e.subscriber.stopListening(s.emitter,n(r),o,a),i},listenToDescendingOrder:(t,s,n)=>(e.getDOrders().listenToDescendingOrder(t,s,n),i),stopListeningDescendingOrder:(t,s,n)=>(e.getDOrders().stopListeningDescendingOrder(t,s,n),i),destroyChildren:(t={})=>(e.destroyChildren(t),i),publicDash:t},i=Object.assign(Object.create(t),s);return Object.assign(i,...e.app.augmentList.map(e=>e(i))),e.app.root&&e.app.root!==e||(i.addDashAugmentation=t=>{e.app.augmentList.push(t)}),Object.freeze(i),i}(this,this.pub)}makeInstance(e,t){if(this.inst)return;let s;try{s=new e(this.dash,t)}catch(e){throw this.destroy(),e}this.setInstance(s)}setInstance(e){if(!this.pub)throw new Error("Destroyed component");if(this.inst){if(e!==this.inst)throw new Error("Conflict between component instances")}else this.inst=e,this.app.setInstanceOf(this.componentId,this.inst)}getInstance(){if(!this.inst){if(this.pub)throw new Error("The component instance is still not initialized");throw new Error("Destroyed component")}return this.inst}destroy(){this.emit("destroy",void 0,{sync:!0,cancelPropagation:!0}),this.app.removeComponent(this,this.inst),this.childGroups&&this.childGroups.clear(),this.emitter.destroy(),this.subscriber.destroy(),this.pub=void 0,this.dash=void 0,this.inst=void 0}forgetChild(e){if(this.childGroups)for(let t of this.childGroups.values())t.delete(e)}createChild(e){return this.app.createComponent(e,this)}addToGroup(e,t){let s=this.app.getBkbByInst(e).componentId;if(this!==this.app.getParentOf(s))throw new Error(`The component ${s} is not a child of ${this.componentId}`);this.childGroups||(this.childGroups=new Map);for(let e of t){let t=this.childGroups.get(e);t||this.childGroups.set(e,t=new Set),t.add(s)}}inGroup(e,t){if(!this.childGroups)return!1;let s=this.app.getBkbByInst(e).componentId;for(let e of t){let t=this.childGroups.get(e);if(t&&t.has(s))return!0}return!1}broadcast(e,t={}){t.sync?this.emitter.emit(e):this.app.asyncCall(()=>this.emitter.emit(e))}emit(e,t,s={}){s.sync?this.emitSync(this.createEvent(e,t,s.cancelPropagation)):this.app.asyncCall(()=>this.emitSync(this.createEvent(e,t,s.cancelPropagation)))}getParent(){return this.app.getParentOf(this.componentId)}getParents(){let e=this,t=[];for(;e=this.app.getParentOf(e.componentId);)t.push(e);return t}getChildren(e){let t=this.getChildBkbs(e.group),s=[];for(let n of t)!n.inst||e.filter&&!e.filter(n)||s.push(n.inst);return s}hasChildren(e){return this.getChildren(e).length>0}isChild(e){let t=this.app.getBkbByInst(e).componentId;return this===this.app.getParentOf(t)}destroyChildren(e){let t=this.getChildBkbs(e.group);for(let s of t)e.filter&&!e.filter(s)||s.destroy()}getDOrders(){return this.dOrders||(this.dOrders=new i(this.app,this.componentId)),this.dOrders}createEvent(e,t,s){let n=this,r=!s;return Object.freeze({eventName:e,get source(){return n.getInstance()},data:t,stopPropagation:()=>{r=!1},[c]:()=>r})}emitSync(e){if(this.emitter.emit(e),e[c]&&e[c]()){let t=this.app.getParentOf(this.componentId);t&&t.emitSync(e)}}getChildBkbs(e){if(!e)return this.app.getChildrenOf(this.componentId);if(!this.childGroups)return[];let t="string"==typeof e?[e]:e,s=new Set;for(let e of t){let t=this.childGroups.get(e);if(t)for(let e of t.values())s.add(e)}let n=[];for(let e of s.values())n.push(this.app.getBkb(e));return n}}class h{constructor(e,t,s){this.augmentList=[],this.compCount=0,this.nodesByInst=new WeakMap,this.nodes=new Map,this.insideRmComp=!1;let n=this.newId();this.log=this.createLog(["error","warn","info","debug","trace"]),this.root=new d(this,n);let r={bkb:this.root};this.nodes.set(n,r),this.root.emitter.exposeEvent(["log","addComponent","removeComponent","changeComponent"],!1),t?this.root.setInstance(e):this.root.makeInstance(e,s),r.created=!0}setInstanceOf(e,t){let s=this.nodes.get(e);if(!s)throw new Error("Destroyed component");this.nodesByInst.set(t,s)}getParentOf(e){let t=this.findNode(e);return t.parent?t.parent.bkb:void 0}getChildrenOf(e){let t=[],s=this.findNode(e).children;if(s)for(let e of s.values())t.push(e.bkb);return t}getBkb(e){return this.findNode(e).bkb}getBkbByInst(e){return this.findNodeByInst(e).bkb}isComponent(e){return!!this.nodesByInst.get(e)}createComponent(e,t){if(!this.root.dash)throw new Error("Destroyed root component");let s=this.newId(),n=new d(this,s),r=this.findNode(t.componentId),i={bkb:n,parent:r};return this.nodes.set(s,i),r.children||(r.children=new Map),r.children.set(s,i),e.asObj?n.setInstance(e.obj):n.makeInstance(e.Class,e.opt),this.root.dash.emit(["addComponent","changeComponent"],{component:n.getInstance(),type:"add"}),i.created=!0,n}removeComponent(e,t){if(!this.root.dash)throw new Error("Destroyed root component");let s=!this.insideRmComp;try{let n=e.componentId,r=this.findNode(n);if(s&&(this.insideRmComp=!0,t&&r.created)){let e={component:t,type:"remove"};this.root.dash.emit(["removeComponent","changeComponent"],e,{sync:!0})}if(r.children){for(let e of r.children.values())e.parent=void 0,e.bkb.destroy();r.children.clear()}r.parent&&(r.parent.bkb.forgetChild(n),r.parent.children.delete(n)),this.nodes.delete(n),t&&this.nodesByInst.delete(t)}finally{s&&(this.insideRmComp=!1)}}asyncCall(e){this.tickList?this.tickList.push(e):(this.tickList=[e],setTimeout(()=>{if(this.tickList){for(let e of this.tickList)try{e()}catch(e){this.log.error(e)}this.tickList=void 0}},0))}findNode(e){let t=this.nodes.get(e);if(!t)throw new Error(`Missing node of component "${e}"`);return t}findNodeByInst(e){let t=this.nodesByInst.get(e);if(!t)throw new Error("Cannot find a component for the instance: "+e);return t}newId(){return this.compCount++}createLog(e){let t={},s=0;for(let n of e)t[n]=(...e)=>{if(!this.root.dash)throw new Error("Destroyed root component");this.root.dash.emit("log",{level:n,messages:e,levelNumber:++s},{sync:!0})};return Object.freeze(t)}}function u(e,t){return e.length===t.length&&e.every((e,s)=>e===t[s])}function p(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function m(e){return(...t)=>{try{let s=e(...t);return s&&"function"==typeof s.then&&"function"==typeof s.catch&&(s=s.catch(e=>{console.log("[catchAndLog async]",e)})),s}catch(e){console.log("[catchAndLog]",e)}}}function f(e,t){t&&(t="string"==typeof t?[t]:t,e.classList.add(...t))}var g=window.CustomEvent;function b(e){for(;e;){if("dialog"===e.localName)return e;e=e.parentElement}return null}function w(e){for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;e&&e.blur&&e!==document.body&&e.blur()}function v(e,t){for(var s=0;s<e.length;++s)if(e[s]===t)return!0;return!1}function y(e){return!(!e||!e.hasAttribute("method"))&&"dialog"===e.getAttribute("method").toLowerCase()}function E(e){return e.isConnected||document.body.contains(e)}function k(e){if(this.dialog_=e,this.replacedStyleTop_=!1,this.openAsModal_=!1,e.hasAttribute("role")||e.setAttribute("role","dialog"),e.show=this.show.bind(this),e.showModal=this.showModal.bind(this),e.close=this.close.bind(this),"returnValue"in e||(e.returnValue=""),"MutationObserver"in window){new MutationObserver(this.maybeHideModal.bind(this)).observe(e,{attributes:!0,attributeFilter:["open"]})}else{var t,s=!1,n=function(){s?this.downgradeModal():this.maybeHideModal(),s=!1}.bind(this),r=function(r){if(r.target===e){var i="DOMNodeRemoved";s|=r.type.substr(0,i.length)===i,window.clearTimeout(t),t=window.setTimeout(n,0)}};["DOMAttrModified","DOMNodeRemoved","DOMNodeRemovedFromDocument"].forEach((function(t){e.addEventListener(t,r)}))}Object.defineProperty(e,"open",{set:this.setOpen.bind(this),get:e.hasAttribute.bind(e,"open")}),this.backdrop_=document.createElement("div"),this.backdrop_.className="backdrop",this.backdrop_.addEventListener("click",this.backdropClick_.bind(this))}g&&"object"!=typeof g||((g=function(e,t){t=t||{};var s=document.createEvent("CustomEvent");return s.initCustomEvent(e,!!t.bubbles,!!t.cancelable,t.detail||null),s}).prototype=window.Event.prototype),k.prototype={get dialog(){return this.dialog_},maybeHideModal:function(){this.dialog_.hasAttribute("open")&&E(this.dialog_)||this.downgradeModal()},downgradeModal:function(){this.openAsModal_&&(this.openAsModal_=!1,this.dialog_.style.zIndex="",this.replacedStyleTop_&&(this.dialog_.style.top="",this.replacedStyleTop_=!1),this.backdrop_.parentNode&&this.backdrop_.parentNode.removeChild(this.backdrop_),C.dm.removeDialog(this))},setOpen:function(e){e?this.dialog_.hasAttribute("open")||this.dialog_.setAttribute("open",""):(this.dialog_.removeAttribute("open"),this.maybeHideModal())},backdropClick_:function(e){if(this.dialog_.hasAttribute("tabindex"))this.dialog_.focus();else{var t=document.createElement("div");this.dialog_.insertBefore(t,this.dialog_.firstChild),t.tabIndex=-1,t.focus(),this.dialog_.removeChild(t)}var s=document.createEvent("MouseEvents");s.initMouseEvent(e.type,e.bubbles,e.cancelable,window,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget),this.dialog_.dispatchEvent(s),e.stopPropagation()},focus_:function(){var e=this.dialog_.querySelector("[autofocus]:not([disabled])");!e&&this.dialog_.tabIndex>=0&&(e=this.dialog_),e||(e=function e(t){var s=["button","input","keygen","select","textarea"].map((function(e){return e+":not([disabled])"}));s.push('[tabindex]:not([disabled]):not([tabindex=""])');var n=t.querySelector(s.join(", "));if(!n&&"attachShadow"in Element.prototype)for(var r=t.querySelectorAll("*"),i=0;i<r.length&&!(r[i].tagName&&r[i].shadowRoot&&(n=e(r[i].shadowRoot)));i++);return n}(this.dialog_)),w(document.activeElement),e&&e.focus()},updateZIndex:function(e,t){if(e<t)throw new Error("dialogZ should never be < backdropZ");this.dialog_.style.zIndex=e,this.backdrop_.style.zIndex=t},show:function(){this.dialog_.open||(this.setOpen(!0),this.focus_())},showModal:function(){if(this.dialog_.hasAttribute("open"))throw new Error("Failed to execute 'showModal' on dialog: The element is already open, and therefore cannot be opened modally.");if(!E(this.dialog_))throw new Error("Failed to execute 'showModal' on dialog: The element is not in a Document.");if(!C.dm.pushDialog(this))throw new Error("Failed to execute 'showModal' on dialog: There are too many open modal dialogs.");(function(e){for(;e&&e!==document.body;){var t=window.getComputedStyle(e),s=function(e,s){return!(void 0===t[e]||t[e]===s)};if(t.opacity<1||s("zIndex","auto")||s("transform","none")||s("mixBlendMode","normal")||s("filter","none")||s("perspective","none")||"isolate"===t.isolation||"fixed"===t.position||"touch"===t.webkitOverflowScrolling)return!0;e=e.parentElement}return!1})(this.dialog_.parentElement)&&console.warn("A dialog is being shown inside a stacking context. This may cause it to be unusable. For more information, see this link: https://github.com/GoogleChrome/dialog-polyfill/#stacking-context"),this.setOpen(!0),this.openAsModal_=!0,C.needsCentering(this.dialog_)?(C.reposition(this.dialog_),this.replacedStyleTop_=!0):this.replacedStyleTop_=!1,this.dialog_.parentNode.insertBefore(this.backdrop_,this.dialog_.nextSibling),this.focus_()},close:function(e){if(!this.dialog_.hasAttribute("open"))throw new Error("Failed to execute 'close' on dialog: The element does not have an 'open' attribute, and therefore cannot be closed.");this.setOpen(!1),void 0!==e&&(this.dialog_.returnValue=e);var t=new g("close",{bubbles:!1,cancelable:!1});this.dialog_.dispatchEvent(t)}};var C={reposition:function(e){var t=document.body.scrollTop||document.documentElement.scrollTop,s=t+(window.innerHeight-e.offsetHeight)/2;e.style.top=Math.max(t,s)+"px"},isInlinePositionSetByStylesheet:function(e){for(var t=0;t<document.styleSheets.length;++t){var s=document.styleSheets[t],n=null;try{n=s.cssRules}catch(e){}if(n)for(var r=0;r<n.length;++r){var i=n[r],o=null;try{o=document.querySelectorAll(i.selectorText)}catch(e){}if(o&&v(o,e)){var a=i.style.getPropertyValue("top"),l=i.style.getPropertyValue("bottom");if(a&&"auto"!==a||l&&"auto"!==l)return!0}}}return!1},needsCentering:function(e){return"absolute"===window.getComputedStyle(e).position&&(!("auto"!==e.style.top&&""!==e.style.top||"auto"!==e.style.bottom&&""!==e.style.bottom)&&!C.isInlinePositionSetByStylesheet(e))},forceRegisterDialog:function(e){if((window.HTMLDialogElement||e.showModal)&&console.warn("This browser already supports <dialog>, the polyfill may not work correctly",e),"dialog"!==e.localName)throw new Error("Failed to register dialog: The element is not a dialog.");new k(e)},registerDialog:function(e){e.showModal||C.forceRegisterDialog(e)},DialogManager:function(){this.pendingDialogStack=[];var e=this.checkDOM_.bind(this);this.overlay=document.createElement("div"),this.overlay.className="_dialog_overlay",this.overlay.addEventListener("click",function(t){this.forwardTab_=void 0,t.stopPropagation(),e([])}.bind(this)),this.handleKey_=this.handleKey_.bind(this),this.handleFocus_=this.handleFocus_.bind(this),this.zIndexLow_=1e5,this.zIndexHigh_=100150,this.forwardTab_=void 0,"MutationObserver"in window&&(this.mo_=new MutationObserver((function(t){var s=[];t.forEach((function(e){for(var t,n=0;t=e.removedNodes[n];++n)t instanceof Element&&("dialog"===t.localName&&s.push(t),s=s.concat(t.querySelectorAll("dialog")))})),s.length&&e(s)})))}};if(C.DialogManager.prototype.blockDocument=function(){document.documentElement.addEventListener("focus",this.handleFocus_,!0),document.addEventListener("keydown",this.handleKey_),this.mo_&&this.mo_.observe(document,{childList:!0,subtree:!0})},C.DialogManager.prototype.unblockDocument=function(){document.documentElement.removeEventListener("focus",this.handleFocus_,!0),document.removeEventListener("keydown",this.handleKey_),this.mo_&&this.mo_.disconnect()},C.DialogManager.prototype.updateStacking=function(){for(var e,t=this.zIndexHigh_,s=0;e=this.pendingDialogStack[s];++s)e.updateZIndex(--t,--t),0===s&&(this.overlay.style.zIndex=--t);var n=this.pendingDialogStack[0];n?(n.dialog.parentNode||document.body).appendChild(this.overlay):this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay)},C.DialogManager.prototype.containedByTopDialog_=function(e){for(;e=b(e);){for(var t,s=0;t=this.pendingDialogStack[s];++s)if(t.dialog===e)return 0===s;e=e.parentElement}return!1},C.DialogManager.prototype.handleFocus_=function(e){if(!this.containedByTopDialog_(e.target)&&document.activeElement!==document.documentElement&&(e.preventDefault(),e.stopPropagation(),w(e.target),void 0!==this.forwardTab_)){var t=this.pendingDialogStack[0];return t.dialog.compareDocumentPosition(e.target)&Node.DOCUMENT_POSITION_PRECEDING&&(this.forwardTab_?t.focus_():e.target!==document.documentElement&&document.documentElement.focus()),!1}},C.DialogManager.prototype.handleKey_=function(e){if(this.forwardTab_=void 0,27===e.keyCode){e.preventDefault(),e.stopPropagation();var t=new g("cancel",{bubbles:!1,cancelable:!0}),s=this.pendingDialogStack[0];s&&s.dialog.dispatchEvent(t)&&s.dialog.close()}else 9===e.keyCode&&(this.forwardTab_=!e.shiftKey)},C.DialogManager.prototype.checkDOM_=function(e){this.pendingDialogStack.slice().forEach((function(t){-1!==e.indexOf(t.dialog)?t.downgradeModal():t.maybeHideModal()}))},C.DialogManager.prototype.pushDialog=function(e){var t=(this.zIndexHigh_-this.zIndexLow_)/2-1;return!(this.pendingDialogStack.length>=t)&&(1===this.pendingDialogStack.unshift(e)&&this.blockDocument(),this.updateStacking(),!0)},C.DialogManager.prototype.removeDialog=function(e){var t=this.pendingDialogStack.indexOf(e);-1!==t&&(this.pendingDialogStack.splice(t,1),0===this.pendingDialogStack.length&&this.unblockDocument(),this.updateStacking())},C.dm=new C.DialogManager,C.formSubmitter=null,C.useValue=null,void 0===window.HTMLDialogElement){var _=document.createElement("form");if(_.setAttribute("method","dialog"),"dialog"!==_.method){var T=Object.getOwnPropertyDescriptor(HTMLFormElement.prototype,"method");if(T){var S=T.get;T.get=function(){return y(this)?"dialog":S.call(this)};var A=T.set;T.set=function(e){return"string"==typeof e&&"dialog"===e.toLowerCase()?this.setAttribute("method",e):A.call(this,e)},Object.defineProperty(HTMLFormElement.prototype,"method",T)}}document.addEventListener("click",(function(e){if(C.formSubmitter=null,C.useValue=null,!e.defaultPrevented){var t=e.target;if(t&&y(t.form)){if(!("submit"===t.type&&["button","input"].indexOf(t.localName)>-1)){if("input"!==t.localName||"image"!==t.type)return;C.useValue=e.offsetX+","+e.offsetY}b(t)&&(C.formSubmitter=t)}}}),!1);var x=HTMLFormElement.prototype.submit;HTMLFormElement.prototype.submit=function(){if(!y(this))return x.call(this);var e=b(this);e&&e.close()},document.addEventListener("submit",(function(e){if(!e.defaultPrevented){var t=e.target;if(y(t)){e.preventDefault();var s=b(t);if(s){var n=C.formSubmitter;n&&n.form===t?s.close(C.useValue||n.value):s.close(),C.formSubmitter=null}}}}),!1)}var M=C;s(0);class L{constructor(){this.promise=new Promise((e,t)=>{this.resolveCb=e,this.rejectCb=t})}pipeTo(e){return e.then(e=>this.resolve(e),e=>this.reject(e)),this.promise}resolve(e){this.resolveCb(e)}reject(e){this.rejectCb(e)}}s(9);class I{constructor(e){this.dash=e;const{root:t,ref:s}=function(){const e=document.createElement("dialog");e.setAttribute("class","ErrorDialog ModalDialog");const t=document.createElement("header");e.appendChild(t),t.setAttribute("class","ModalDialog-header");const s=document.createElement("div");e.appendChild(s),s.setAttribute("class","ModalDialog-content");const n=document.createElement("div");e.appendChild(n),n.setAttribute("class","ModalDialog-bottom");const r=document.createElement("div");t.appendChild(r),r.setAttribute("class","ModalDialog-headerLeft");const i=document.createElement("div");t.appendChild(i),i.setAttribute("class","ModalDialog-headerRight");const o=document.createElement("div");s.appendChild(o),o.setAttribute("class","ModalDialog-contentLeft ErrorDialog-contentLeft");const a=document.createElement("div");s.appendChild(a),a.setAttribute("class","ModalDialog-contentRight");const l=document.createElement("button");n.appendChild(l),l.setAttribute("class","ModalDialogOkButton");const c=document.createElement("span");r.appendChild(c);const d=document.createElement("span");i.appendChild(d),d.setAttribute("class","fas fa-times fa-1x ModalDialogCloseItem");const h=document.createElement("span");o.appendChild(h),h.setAttribute("class","fas fa-3x fa-exclamation-circle");const u=document.createElement("div");a.appendChild(u);const p=document.createTextNode("OK");l.appendChild(p);const m={button:l,title:c,close:d,message:u};return{root:e,refs:m,ref:e=>{if(!m[e])throw new Error(`Missing handle: '${e}'`);return m[e]},update:()=>{}}}();this.el=t,this.msgEl=s("message"),this.titleEl=s("title"),M.registerDialog(this.el);const n=()=>this.close();s("button").addEventListener("click",n),s("close").addEventListener("click",n),this.el.addEventListener("cancel",e=>{e.preventDefault(),this.close()}),this.el.addEventListener("keydown",e=>{"Enter"===e.key&&this.close()})}show(e,t="Error"){this.currDfd=new L,this.titleEl.textContent=t,p(this.msgEl);const s="string"==typeof e?[e]:e;for(const e of s){const t=document.createElement("p");t.textContent=e,this.msgEl.appendChild(t)}return document.body.appendChild(this.el),this.el,this.el.showModal(),this.currDfd.promise}close(){this.currDfd&&this.currDfd.resolve(!0),this.currDfd=void 0,this.el.close(),document.body.removeChild(this.el)}}s(10);class P{constructor(e){this.dash=e;const{root:t,ref:s}=function(){const e=document.createElement("dialog");e.setAttribute("class","ModalDialog WarningDialog");const t=document.createElement("header");e.appendChild(t),t.setAttribute("class","ModalDialog-header");const s=document.createElement("div");e.appendChild(s),s.setAttribute("class","ModalDialog-content");const n=document.createElement("div");e.appendChild(n),n.setAttribute("class","ModalDialog-bottom");const r=document.createElement("div");t.appendChild(r),r.setAttribute("class","ModalDialog-headerLeft");const i=document.createElement("div");t.appendChild(i),i.setAttribute("class","ModalDialog-headerRight");const o=document.createElement("div");s.appendChild(o),o.setAttribute("class","ModalDialog-contentLeft WarningDialog-contentLeft");const a=document.createElement("div");s.appendChild(a),a.setAttribute("class","ModalDialog-contentRight");const l=document.createElement("button");n.appendChild(l),l.setAttribute("class","ModalDialogOkButton");const c=document.createElement("span");r.appendChild(c);const d=document.createElement("span");i.appendChild(d),d.setAttribute("class","fas fa-times fa-lg ModalDialogCloseItem");const h=document.createElement("span");o.appendChild(h),h.setAttribute("class","fas fa-3x fa-exclamation-triangle");const u=document.createElement("div");a.appendChild(u);const p=document.createTextNode("OK");l.appendChild(p);const m={button:l,title:c,close:d,message:u};return{root:e,refs:m,ref:e=>{if(!m[e])throw new Error(`Missing handle: '${e}'`);return m[e]},update:()=>{}}}();this.el=t,this.msgEl=s("message"),this.titleEl=s("title"),M.registerDialog(this.el);const n=()=>this.close();s("button").addEventListener("click",n),s("close").addEventListener("click",n),this.el.addEventListener("cancel",e=>{e.preventDefault(),this.close()}),this.el.addEventListener("keydown",e=>{"Enter"===e.key&&this.close()})}show(e,t="Warning"){this.currDfd=new L,this.titleEl.textContent=t,p(this.msgEl);const s="string"==typeof e?[e]:e;for(const e of s){const t=document.createElement("p");t.textContent=e,this.msgEl.appendChild(t)}return document.body.appendChild(this.el),this.el,this.el.showModal(),this.currDfd.promise}close(){this.currDfd&&this.currDfd.resolve(!0),this.currDfd=void 0,this.el.close(),document.body.removeChild(this.el)}}s(11);class j{constructor(e,t={}){this.dash=e,this.options=t,this.content=t.content,e.exposeEvent("open","close");const{root:s,ref:n,update:r}=function(e){const t=new Map,s=document.createElement("dialog");s.setAttribute("class","Dialog"),s.setAttribute("draggable","true");const n=document.createElement("div");s.appendChild(n),n.setAttribute("class","Dialog-box");const r=document.createElement("header");n.appendChild(r),r.setAttribute("class","Dialog-header");const i=document.createElement("div");n.appendChild(i);const o=document.createElement("span");r.appendChild(o),o.setAttribute("class","Dialog-title");const a=document.createElement("button");r.appendChild(a),a.setAttribute("class","Dialog-closeBtn"),a.setAttribute("title","Close");const l=document.createTextNode("");o.appendChild(l),(e=>{let s=t.get(e);return s||(s=[],t.set(e,s)),s})("title").push(e=>l.nodeValue=e);const c=document.createElement("span");a.appendChild(c),c.setAttribute("class","fa fa-1x fa-times");const d={body:i,close:a},h=e=>{for(const[s,n]of t.entries())s in e&&n.forEach(t=>t(e[s]))};return e&&h(e),{root:s,refs:d,ref:e=>{if(!d[e])throw new Error(`Missing handle: '${e}'`);return d[e]},update:h}}();this.update=r,this.el=s,this.bodyEl=n("body"),M.registerDialog(this.el),n("close").addEventListener("click",()=>this.close()),this.el.addEventListener("cancel",e=>{e.preventDefault(),this.close()}),this.el.addEventListener("click",e=>{e.target===this.el&&this.close()}),document.body.appendChild(this.el),e.listenTo("destroy",()=>{document.body.removeChild(this.el)}),this.el.addEventListener("dragstart",e=>this.lastDragStart=e),this.el.addEventListener("dragend",e=>{if(!this.lastDragStart)return;const t=e.clientX-this.lastDragStart.clientX,s=e.clientY-this.lastDragStart.clientY,n=this.el.getBoundingClientRect(),r=n.left+t,i=n.top+s;this.el.style.position="absolute",this.el.style.top=i+"px",this.el.style.left=r+"px",this.lastDragStart=void 0})}open(e={}){return this.el.open||this.resolveCb?Promise.resolve():(this.update({title:e.title||this.options.title||""}),e.content?(p(this.bodyEl),this.bodyEl.appendChild(e.content.el)):this.bodyContainsDefaultEl()||(p(this.bodyEl),this.options.content&&this.bodyEl.appendChild(this.options.content.el)),this.el.showModal(),this.dash.emit("open"),new Promise(e=>this.resolveCb=e))}close(){if(!this.el.open||!this.resolveCb)return;this.el.close(),this.bodyContainsDefaultEl()||p(this.bodyEl);const e=this.resolveCb;this.resolveCb=void 0,e(),this.dash.emit("close")}bodyContainsDefaultEl(){const e=this.bodyEl.children;return this.options.content?1===e.length&&e[0]===this.options.content.el:0===e.length}}s(12);class B{constructor(e){this.dash=e,this.model=this.dash.app.model,this.bgCmdManager=this.dash.app.model.bgManager;const{root:t,ref:s}=function(){const e=document.createElement("div");e.setAttribute("class","BgCommandManager");const t=document.createElement("table");e.appendChild(t),t.setAttribute("class","BgCommandManager-table");const s=document.createElement("thead");t.appendChild(s);const n=document.createElement("tbody");t.appendChild(n);const r=document.createElement("tr");s.appendChild(r);const i=document.createElement("td");r.appendChild(i);const o=document.createElement("td");r.appendChild(o);const a=document.createElement("td");r.appendChild(a);const l=document.createElement("td");r.appendChild(l);const c=document.createTextNode("Label");i.appendChild(c);const d=document.createTextNode("Start date");o.appendChild(d);const h=document.createTextNode("In progress");a.appendChild(h);const u=document.createTextNode("Done");l.appendChild(u);const p={table:t};return{root:e,refs:p,ref:e=>{if(!p[e])throw new Error(`Missing handle: '${e}'`);return p[e]},update:()=>{}}}();this.el=t,this.tableEl=s("table"),this.buttonEl=this.createHtmlMenuButtonElement(),this.dialog=this.dash.create(j,{title:"Background Tasks",content:this}),this.dash.listenToModel("bgCommandError",e=>this.onBgCommandError(e))}createHtmlMenuButtonElement(){const{root:e}=function(){const e=document.createElement("button");e.setAttribute("class","BgCommandManagerBtn");const t=document.createTextNode("Bg");e.appendChild(t);const s={};return{root:e,refs:s,ref:e=>{if(!s[e])throw new Error(`Missing handle: '${e}'`);return s[e]},update:()=>{}}}(),t=e;return t.addEventListener("click",()=>this.dialog.open()),t}onBgCommandError(e){this.buttonEl.style.backgroundColor="orange";const t=this.tableEl.tBodies[0].insertRow();t.insertCell().textContent=e.label,t.insertCell().textContent=e.startDt.toLocaleTimeString();const s=document.createElement("input");s.setAttribute("type","checkbox"),s.disabled=!0,s.checked=!!e.done,t.insertCell().appendChild(s);const n=document.createElement("input");n.setAttribute("type","checkbox"),n.disabled=!0,n.checked=!!e.done,t.insertCell().appendChild(n)}}s(13);class N{constructor(e,t){this.dash=e,this.options=t;const s=t.canHaveAlert?"alert":t.innerEl?"inner":void 0;this.btnEl=function(){const e=document.createElement("button");e.setAttribute("class","NavBtn"),e.setAttribute("type","button");const t={};return{root:e,refs:t,ref:e=>{if(!t[e])throw new Error(`Missing handle: '${e}'`);return t[e]},update:()=>{}}}().root,s?(t.innerEl&&(this.innerEl=function(){const e=document.createElement("span");e.setAttribute("class","NavBtn-inner");const t={};return{root:e,refs:t,ref:e=>{if(!t[e])throw new Error(`Missing handle: '${e}'`);return t[e]},update:()=>{}}}().root,this.innerEl.classList.add("-"+t.innerEl.position),t.innerEl.cssClass&&this.innerEl.classList.add(t.innerEl.cssClass),this.btnEl.classList.add(`-${t.innerEl.position}Inner`),this.btnEl.appendChild(this.innerEl)),this.labelEl=function(){const e=document.createElement("span");e.setAttribute("class","NavBtn-lbl");const t={};return{root:e,refs:t,ref:e=>{if(!t[e])throw new Error(`Missing handle: '${e}'`);return t[e]},update:()=>{}}}().root,this.btnEl.appendChild(this.labelEl),t.canHaveAlert&&(this.alertEl=function(){const e=document.createElement("b");e.setAttribute("class","NavBtn-alert"),e.setAttribute("hidden","");const t={};return{root:e,refs:t,ref:e=>{if(!t[e])throw new Error(`Missing handle: '${e}'`);return t[e]},update:()=>{}}}().root,this.btnEl.appendChild(this.alertEl))):(this.btnEl.classList.add("NavBtn-lbl"),this.labelEl=this.btnEl),t.label&&this.setLabel(t.label),t.icon22&&this.btnEl.classList.add("-icon22","-"+t.icon22.position,t.icon22.cssClass),f(this.btnEl,t.cssClass),t.onClick&&this.btnEl.addEventListener("click",m(t.onClick)),t.withWrapper?(this.el=function(){const e=document.createElement("div");e.setAttribute("class","DdMenuWrapper");const t={};return{root:e,refs:t,ref:e=>{if(!t[e])throw new Error(`Missing handle: '${e}'`);return t[e]},update:()=>{}}}().root,this.el.appendChild(this.btnEl)):this.el=this.btnEl}setAlertCount(e){if(!this.alertEl)throw new Error(`The button '${this.options.label}' cannot have an alert`);this.alertEl.textContent=""+e,this.alertEl.style.display=0===e?"none":"block"}setLabel(e){this.labelEl.textContent=e}addCssClass(e){f(this.el,e)}}s(14);const D=function(){const e=document.createElement("li"),t={};return{root:e,refs:t,ref:e=>{if(!t[e])throw new Error(`Missing handle: '${e}'`);return t[e]},update:()=>{}}};class F{constructor(e,t={}){this.dash=e,this.options=t;const{root:s}=function(){const e=document.createElement("ul");e.setAttribute("class","NavMenu FlexBar");const t={};return{root:e,refs:t,ref:e=>{if(!t[e])throw new Error(`Missing handle: '${e}'`);return t[e]},update:()=>{}}}();this.el=s,this.options.direction&&this.el.classList.add("-"+this.options.direction),f(this.el,this.options.cssClass),this.el.addEventListener("click",m(()=>this.dash.emit("click")))}createNavBtn(...e){this.addItem(...e.map(e=>this.dash.create(N,e)))}addItem(...e){for(const t of e){this.options.btnCssClass&&t.addCssClass(this.options.btnCssClass);const e=D().root;e.appendChild(t.el),this.el.appendChild(e)}}}s(15);class O{constructor(e,t){this.dash=e,this.options=t,this.detached=!0,this.isVisible=!1,this.el=function(){const e=document.createElement("nav");e.setAttribute("class","DropdownMenu"),e.setAttribute("hidden","");const t={};return{root:e,refs:t,ref:e=>{if(!t[e])throw new Error(`Missing handle: '${e}'`);return t[e]},update:()=>{}}}().root,this.btnEl=t.btnEl,this.entries=e.create(F,function(e){let t=e.navMenuOptions?e.navMenuOptions.btnCssClass:void 0;return t=t?"string"==typeof t?[t]:t:[],t.push("DdMenuBtn"),{direction:"column",...e.navMenuOptions,btnCssClass:t}}(t)),this.el.appendChild(this.entries.el),this.el.classList.add("left"===t.align?"-left":"-right"),this.btnEl.addEventListener("click",m(()=>this.toggle())),e.listenTo("click",()=>this.hide())}toggle(){this.isVisible?this.hide():this.show()}enable(){this.btnEl.style.pointerEvents="initial"}disable(){this.btnEl.style.pointerEvents="none"}show(){this.isVisible||(this.detached&&this.attachInDom(),this.isVisible=!0,this.el.style.display="block",this.el.focus(),this.showBackdrop(!0))}hide(){this.isVisible&&(this.isVisible=!1,this.el.style.display="none",this.showBackdrop(!1))}attachInDom(){this.detached=!1;const e=this.btnEl.parentElement;if(!e)throw new Error("The DropdownMenu cannot insert in the DOM, the button element is detached");e.insertBefore(this.el,this.options.btnEl.nextSibling)}showBackdrop(e){this.backdropEl||(this.backdropEl=function(){const e=document.createElement("div");e.setAttribute("class","Backdrop"),e.setAttribute("hidden","");const t={};return{root:e,refs:t,ref:e=>{if(!t[e])throw new Error(`Missing handle: '${e}'`);return t[e]},update:()=>{}}}().root,this.backdropEl.addEventListener("click",()=>this.hide()),this.el.parentElement.appendChild(this.backdropEl)),this.backdropEl.hidden=!e}}s(16);class ${constructor(e){this.dash=e;const{root:t,ref:s}=function(){const e=document.createElement("section");e.setAttribute("class","HeaderBar FlexBar");const t=document.createElement("div");e.appendChild(t),t.setAttribute("class","Center");const s=document.createElement("img");t.appendChild(s),s.setAttribute("src","logo.png"),s.setAttribute("srcset","logo.png 1x, logo-2x.png 2x"),s.setAttribute("width","150"),s.setAttribute("height","40"),s.setAttribute("alt","SmallTeam");const n={teamName:t};return{root:e,refs:n,ref:e=>{if(!n[e])throw new Error(`Missing handle: '${e}'`);return n[e]},update:()=>{}}}();this.el=t,this.teamNameEl=s("teamName"),this.entries=e.create(F),this.el.appendChild(this.entries.el)}}s(17);class U{constructor(e){this.dash=e,this.model=this.dash.app.model,this.log=this.dash.app.log;const{root:t}=function(){const e=document.createElement("div");e.setAttribute("class","HomeWorkspace");const t=document.createElement("header");e.appendChild(t),t.setAttribute("class","HomeWorkspace-header");const s=document.createElement("div");e.appendChild(s),s.setAttribute("class","HomeWorkspace-divLogo");const n=document.createTextNode("Welcome");t.appendChild(n);const r={};return{root:e,refs:r,ref:e=>{if(!r[e])throw new Error(`Missing handle: '${e}'`);return r[e]},update:()=>{}}}();this.el=t}activate(e){this.ctrl=e,e.setContentEl(this.el).setTitle("Home")}}
/**!
 * Sortable 1.10.2
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function H(){return(H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e}).apply(this,arguments)}function W(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{},n=Object.keys(s);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(s).filter((function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable})))),n.forEach((function(t){R(e,t,s[t])}))}return e}function V(e,t){if(null==e)return{};var s,n,r=function(e,t){if(null==e)return{};var s,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)s=i[n],t.indexOf(s)>=0||(r[s]=e[s]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)s=i[n],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(r[s]=e[s])}return r}function G(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var q=G(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Q=G(/Edge/i),J=G(/firefox/i),X=G(/safari/i)&&!G(/chrome/i)&&!G(/android/i),Y=G(/iP(ad|od|hone)/i),K=G(/chrome/i)&&G(/android/i),Z={capture:!1,passive:!1};function ee(e,t,s){e.addEventListener(t,s,!q&&Z)}function te(e,t,s){e.removeEventListener(t,s,!q&&Z)}function se(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}}function ne(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function re(e,t,s,n){if(e){s=s||document;do{if(null!=t&&(">"===t[0]?e.parentNode===s&&se(e,t):se(e,t))||n&&e===s)return e;if(e===s)break}while(e=ne(e))}return null}var ie,oe=/\s+/g;function ae(e,t,s){if(e&&t)if(e.classList)e.classList[s?"add":"remove"](t);else{var n=(" "+e.className+" ").replace(oe," ").replace(" "+t+" "," ");e.className=(n+(s?" "+t:"")).replace(oe," ")}}function le(e,t,s){var n=e&&e.style;if(n){if(void 0===s)return document.defaultView&&document.defaultView.getComputedStyle?s=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(s=e.currentStyle),void 0===t?s:s[t];t in n||-1!==t.indexOf("webkit")||(t="-webkit-"+t),n[t]=s+("string"==typeof s?"":"px")}}function ce(e,t){var s="";if("string"==typeof e)s=e;else do{var n=le(e,"transform");n&&"none"!==n&&(s=n+" "+s)}while(!t&&(e=e.parentNode));var r=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return r&&new r(s)}function de(e,t,s){if(e){var n=e.getElementsByTagName(t),r=0,i=n.length;if(s)for(;r<i;r++)s(n[r],r);return n}return[]}function he(){var e=document.scrollingElement;return e||document.documentElement}function ue(e,t,s,n,r){if(e.getBoundingClientRect||e===window){var i,o,a,l,c,d,h;if(e!==window&&e!==he()?(o=(i=e.getBoundingClientRect()).top,a=i.left,l=i.bottom,c=i.right,d=i.height,h=i.width):(o=0,a=0,l=window.innerHeight,c=window.innerWidth,d=window.innerHeight,h=window.innerWidth),(t||s)&&e!==window&&(r=r||e.parentNode,!q))do{if(r&&r.getBoundingClientRect&&("none"!==le(r,"transform")||s&&"static"!==le(r,"position"))){var u=r.getBoundingClientRect();o-=u.top+parseInt(le(r,"border-top-width")),a-=u.left+parseInt(le(r,"border-left-width")),l=o+i.height,c=a+i.width;break}}while(r=r.parentNode);if(n&&e!==window){var p=ce(r||e),m=p&&p.a,f=p&&p.d;p&&(l=(o/=f)+(d/=f),c=(a/=m)+(h/=m))}return{top:o,left:a,bottom:l,right:c,width:h,height:d}}}function pe(e,t,s){for(var n=we(e,!0),r=ue(e)[t];n;){var i=ue(n)[s];if(!("top"===s||"left"===s?r>=i:r<=i))return n;if(n===he())break;n=we(n,!1)}return!1}function me(e,t,s){for(var n=0,r=0,i=e.children;r<i.length;){if("none"!==i[r].style.display&&i[r]!==Et.ghost&&i[r]!==Et.dragged&&re(i[r],s.draggable,e,!1)){if(n===t)return i[r];n++}r++}return null}function fe(e,t){for(var s=e.lastElementChild;s&&(s===Et.ghost||"none"===le(s,"display")||t&&!se(s,t));)s=s.previousElementSibling;return s||null}function ge(e,t){var s=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===Et.clone||t&&!se(e,t)||s++;return s}function be(e){var t=0,s=0,n=he();if(e)do{var r=ce(e),i=r.a,o=r.d;t+=e.scrollLeft*i,s+=e.scrollTop*o}while(e!==n&&(e=e.parentNode));return[t,s]}function we(e,t){if(!e||!e.getBoundingClientRect)return he();var s=e,n=!1;do{if(s.clientWidth<s.scrollWidth||s.clientHeight<s.scrollHeight){var r=le(s);if(s.clientWidth<s.scrollWidth&&("auto"==r.overflowX||"scroll"==r.overflowX)||s.clientHeight<s.scrollHeight&&("auto"==r.overflowY||"scroll"==r.overflowY)){if(!s.getBoundingClientRect||s===document.body)return he();if(n||t)return s;n=!0}}}while(s=s.parentNode);return he()}function ve(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function ye(e,t){return function(){if(!ie){var s=arguments,n=this;1===s.length?e.call(n,s[0]):e.apply(n,s),ie=setTimeout((function(){ie=void 0}),t)}}}function Ee(e,t,s){e.scrollLeft+=t,e.scrollTop+=s}function ke(e){var t=window.Polymer,s=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):s?s(e).clone(!0)[0]:e.cloneNode(!0)}var Ce="Sortable"+(new Date).getTime();function _e(){var e,t=[];return{captureAnimationState:function(){(t=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(e){if("none"!==le(e,"display")&&e!==Et.ghost){t.push({target:e,rect:ue(e)});var s=W({},t[t.length-1].rect);if(e.thisAnimationDuration){var n=ce(e,!0);n&&(s.top-=n.f,s.left-=n.e)}e.fromRect=s}}))},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var s in e)if(e.hasOwnProperty(s))for(var n in t)if(t.hasOwnProperty(n)&&t[n]===e[s][n])return Number(s);return-1}(t,{target:e}),1)},animateAll:function(s){var n=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof s&&s());var r=!1,i=0;t.forEach((function(e){var t=0,s=e.target,o=s.fromRect,a=ue(s),l=s.prevFromRect,c=s.prevToRect,d=e.rect,h=ce(s,!0);h&&(a.top-=h.f,a.left-=h.e),s.toRect=a,s.thisAnimationDuration&&ve(l,a)&&!ve(o,a)&&(d.top-a.top)/(d.left-a.left)==(o.top-a.top)/(o.left-a.left)&&(t=function(e,t,s,n){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-s.top,2)+Math.pow(t.left-s.left,2))*n.animation}(d,l,c,n.options)),ve(a,o)||(s.prevFromRect=o,s.prevToRect=a,t||(t=n.options.animation),n.animate(s,d,a,t)),t&&(r=!0,i=Math.max(i,t),clearTimeout(s.animationResetTimer),s.animationResetTimer=setTimeout((function(){s.animationTime=0,s.prevFromRect=null,s.fromRect=null,s.prevToRect=null,s.thisAnimationDuration=null}),t),s.thisAnimationDuration=t)})),clearTimeout(e),r?e=setTimeout((function(){"function"==typeof s&&s()}),i):"function"==typeof s&&s(),t=[]},animate:function(e,t,s,n){if(n){le(e,"transition",""),le(e,"transform","");var r=ce(this.el),i=r&&r.a,o=r&&r.d,a=(t.left-s.left)/(i||1),l=(t.top-s.top)/(o||1);e.animatingX=!!a,e.animatingY=!!l,le(e,"transform","translate3d("+a+"px,"+l+"px,0)"),function(e){e.offsetWidth}(e),le(e,"transition","transform "+n+"ms"+(this.options.easing?" "+this.options.easing:"")),le(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){le(e,"transition",""),le(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),n)}}}}var Te=[],Se={initializeByDefault:!0},Ae={mount:function(e){for(var t in Se)Se.hasOwnProperty(t)&&!(t in e)&&(e[t]=Se[t]);Te.push(e)},pluginEvent:function(e,t,s){var n=this;this.eventCanceled=!1,s.cancel=function(){n.eventCanceled=!0};var r=e+"Global";Te.forEach((function(n){t[n.pluginName]&&(t[n.pluginName][r]&&t[n.pluginName][r](W({sortable:t},s)),t.options[n.pluginName]&&t[n.pluginName][e]&&t[n.pluginName][e](W({sortable:t},s)))}))},initializePlugins:function(e,t,s,n){for(var r in Te.forEach((function(n){var r=n.pluginName;if(e.options[r]||n.initializeByDefault){var i=new n(e,t,e.options);i.sortable=e,i.options=e.options,e[r]=i,H(s,i.defaults)}})),e.options)if(e.options.hasOwnProperty(r)){var i=this.modifyOption(e,r,e.options[r]);void 0!==i&&(e.options[r]=i)}},getEventProperties:function(e,t){var s={};return Te.forEach((function(n){"function"==typeof n.eventProperties&&H(s,n.eventProperties.call(t[n.pluginName],e))})),s},modifyOption:function(e,t,s){var n;return Te.forEach((function(r){e[r.pluginName]&&r.optionListeners&&"function"==typeof r.optionListeners[t]&&(n=r.optionListeners[t].call(e[r.pluginName],s))})),n}};function xe(e){var t=e.sortable,s=e.rootEl,n=e.name,r=e.targetEl,i=e.cloneEl,o=e.toEl,a=e.fromEl,l=e.oldIndex,c=e.newIndex,d=e.oldDraggableIndex,h=e.newDraggableIndex,u=e.originalEvent,p=e.putSortable,m=e.extraEventProperties;if(t=t||s&&s[Ce]){var f,g=t.options,b="on"+n.charAt(0).toUpperCase()+n.substr(1);!window.CustomEvent||q||Q?(f=document.createEvent("Event")).initEvent(n,!0,!0):f=new CustomEvent(n,{bubbles:!0,cancelable:!0}),f.to=o||s,f.from=a||s,f.item=r||s,f.clone=i,f.oldIndex=l,f.newIndex=c,f.oldDraggableIndex=d,f.newDraggableIndex=h,f.originalEvent=u,f.pullMode=p?p.lastPutMode:void 0;var w=W({},m,Ae.getEventProperties(n,t));for(var v in w)f[v]=w[v];s&&s.dispatchEvent(f),g[b]&&g[b].call(t,f)}}var Me=function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=s.evt,r=V(s,["evt"]);Ae.pluginEvent.bind(Et)(e,t,W({dragEl:Ie,parentEl:Pe,ghostEl:je,rootEl:Be,nextEl:Ne,lastDownEl:De,cloneEl:Fe,cloneHidden:Oe,dragStarted:Ye,putSortable:We,activeSortable:Et.active,originalEvent:n,oldIndex:$e,oldDraggableIndex:ze,newIndex:Ue,newDraggableIndex:Re,hideGhostForTarget:bt,unhideGhostForTarget:wt,cloneNowHidden:function(){Oe=!0},cloneNowShown:function(){Oe=!1},dispatchSortableEvent:function(e){Le({sortable:t,name:e,originalEvent:n})}},r))};function Le(e){xe(W({putSortable:We,cloneEl:Fe,targetEl:Ie,rootEl:Be,oldIndex:$e,oldDraggableIndex:ze,newIndex:Ue,newDraggableIndex:Re},e))}var Ie,Pe,je,Be,Ne,De,Fe,Oe,$e,Ue,ze,Re,He,We,Ve,Ge,qe,Qe,Je,Xe,Ye,Ke,Ze,et,tt,st=!1,nt=!1,rt=[],it=!1,ot=!1,at=[],lt=!1,ct=[],dt="undefined"!=typeof document,ht=Y,ut=Q||q?"cssFloat":"float",pt=dt&&!K&&!Y&&"draggable"in document.createElement("div"),mt=function(){if(dt){if(q)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),ft=function(e,t){var s=le(e),n=parseInt(s.width)-parseInt(s.paddingLeft)-parseInt(s.paddingRight)-parseInt(s.borderLeftWidth)-parseInt(s.borderRightWidth),r=me(e,0,t),i=me(e,1,t),o=r&&le(r),a=i&&le(i),l=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+ue(r).width,c=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+ue(i).width;if("flex"===s.display)return"column"===s.flexDirection||"column-reverse"===s.flexDirection?"vertical":"horizontal";if("grid"===s.display)return s.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(r&&o.float&&"none"!==o.float){var d="left"===o.float?"left":"right";return!i||"both"!==a.clear&&a.clear!==d?"horizontal":"vertical"}return r&&("block"===o.display||"flex"===o.display||"table"===o.display||"grid"===o.display||l>=n&&"none"===s[ut]||i&&"none"===s[ut]&&l+c>n)?"vertical":"horizontal"},gt=function(e){function t(e,s){return function(n,r,i,o){var a=n.options.group.name&&r.options.group.name&&n.options.group.name===r.options.group.name;if(null==e&&(s||a))return!0;if(null==e||!1===e)return!1;if(s&&"clone"===e)return e;if("function"==typeof e)return t(e(n,r,i,o),s)(n,r,i,o);var l=(s?n:r).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&e.indexOf(l)>-1}}var s={},n=e.group;n&&"object"==z(n)||(n={name:n}),s.name=n.name,s.checkPull=t(n.pull,!0),s.checkPut=t(n.put),s.revertClone=n.revertClone,e.group=s},bt=function(){!mt&&je&&le(je,"display","none")},wt=function(){!mt&&je&&le(je,"display","")};dt&&document.addEventListener("click",(function(e){if(nt)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),nt=!1,!1}),!0);var vt=function(e){if(Ie){e=e.touches?e.touches[0]:e;var t=(r=e.clientX,i=e.clientY,rt.some((function(e){if(!fe(e)){var t=ue(e),s=e[Ce].options.emptyInsertThreshold,n=r>=t.left-s&&r<=t.right+s,a=i>=t.top-s&&i<=t.bottom+s;return s&&n&&a?o=e:void 0}})),o);if(t){var s={};for(var n in e)e.hasOwnProperty(n)&&(s[n]=e[n]);s.target=s.rootEl=t,s.preventDefault=void 0,s.stopPropagation=void 0,t[Ce]._onDragOver(s)}}var r,i,o},yt=function(e){Ie&&Ie.parentNode[Ce]._isOutsideThisEl(e.target)};function Et(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=H({},t),e[Ce]=this;var s={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return ft(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Et.supportPointer&&"PointerEvent"in window,emptyInsertThreshold:5};for(var n in Ae.initializePlugins(this,e,s),s)!(n in t)&&(t[n]=s[n]);for(var r in gt(t),this)"_"===r.charAt(0)&&"function"==typeof this[r]&&(this[r]=this[r].bind(this));this.nativeDraggable=!t.forceFallback&&pt,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?ee(e,"pointerdown",this._onTapStart):(ee(e,"mousedown",this._onTapStart),ee(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(ee(e,"dragover",this),ee(e,"dragenter",this)),rt.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),H(this,_e())}function kt(e,t,s,n,r,i,o,a){var l,c,d=e[Ce],h=d.options.onMove;return!window.CustomEvent||q||Q?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=t,l.from=e,l.dragged=s,l.draggedRect=n,l.related=r||t,l.relatedRect=i||ue(t),l.willInsertAfter=a,l.originalEvent=o,e.dispatchEvent(l),h&&(c=h.call(d,l,o)),c}function Ct(e){e.draggable=!1}function _t(){lt=!1}function Tt(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,s=t.length,n=0;s--;)n+=t.charCodeAt(s);return n.toString(36)}function St(e){return setTimeout(e,0)}function At(e){return clearTimeout(e)}Et.prototype={constructor:Et,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(Ke=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,Ie):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,s=this.el,n=this.options,r=n.preventOnFilter,i=e.type,o=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,a=(o||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||a,c=n.filter;if(function(e){ct.length=0;var t=e.getElementsByTagName("input"),s=t.length;for(;s--;){var n=t[s];n.checked&&ct.push(n)}}(s),!Ie&&!(/mousedown|pointerdown/.test(i)&&0!==e.button||n.disabled||l.isContentEditable||(a=re(a,n.draggable,s,!1))&&a.animated||De===a)){if($e=ge(a),ze=ge(a,n.draggable),"function"==typeof c){if(c.call(this,e,a,this))return Le({sortable:t,rootEl:l,name:"filter",targetEl:a,toEl:s,fromEl:s}),Me("filter",t,{evt:e}),void(r&&e.cancelable&&e.preventDefault())}else if(c&&(c=c.split(",").some((function(n){if(n=re(l,n.trim(),s,!1))return Le({sortable:t,rootEl:n,name:"filter",targetEl:a,fromEl:s,toEl:s}),Me("filter",t,{evt:e}),!0}))))return void(r&&e.cancelable&&e.preventDefault());n.handle&&!re(l,n.handle,s,!1)||this._prepareDragStart(e,o,a)}}},_prepareDragStart:function(e,t,s){var n,r=this,i=r.el,o=r.options,a=i.ownerDocument;if(s&&!Ie&&s.parentNode===i){var l=ue(s);if(Be=i,Pe=(Ie=s).parentNode,Ne=Ie.nextSibling,De=s,He=o.group,Et.dragged=Ie,Ve={target:Ie,clientX:(t||e).clientX,clientY:(t||e).clientY},Je=Ve.clientX-l.left,Xe=Ve.clientY-l.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,Ie.style["will-change"]="all",n=function(){Me("delayEnded",r,{evt:e}),Et.eventCanceled?r._onDrop():(r._disableDelayedDragEvents(),!J&&r.nativeDraggable&&(Ie.draggable=!0),r._triggerDragStart(e,t),Le({sortable:r,name:"choose",originalEvent:e}),ae(Ie,o.chosenClass,!0))},o.ignore.split(",").forEach((function(e){de(Ie,e.trim(),Ct)})),ee(a,"dragover",vt),ee(a,"mousemove",vt),ee(a,"touchmove",vt),ee(a,"mouseup",r._onDrop),ee(a,"touchend",r._onDrop),ee(a,"touchcancel",r._onDrop),J&&this.nativeDraggable&&(this.options.touchStartThreshold=4,Ie.draggable=!0),Me("delayStart",this,{evt:e}),!o.delay||o.delayOnTouchOnly&&!t||this.nativeDraggable&&(Q||q))n();else{if(Et.eventCanceled)return void this._onDrop();ee(a,"mouseup",r._disableDelayedDrag),ee(a,"touchend",r._disableDelayedDrag),ee(a,"touchcancel",r._disableDelayedDrag),ee(a,"mousemove",r._delayedDragTouchMoveHandler),ee(a,"touchmove",r._delayedDragTouchMoveHandler),o.supportPointer&&ee(a,"pointermove",r._delayedDragTouchMoveHandler),r._dragStartTimer=setTimeout(n,o.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){Ie&&Ct(Ie),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;te(e,"mouseup",this._disableDelayedDrag),te(e,"touchend",this._disableDelayedDrag),te(e,"touchcancel",this._disableDelayedDrag),te(e,"mousemove",this._delayedDragTouchMoveHandler),te(e,"touchmove",this._delayedDragTouchMoveHandler),te(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?ee(document,"pointermove",this._onTouchMove):ee(document,t?"touchmove":"mousemove",this._onTouchMove):(ee(Ie,"dragend",this),ee(Be,"dragstart",this._onDragStart));try{document.selection?St((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(e,t){if(st=!1,Be&&Ie){Me("dragStarted",this,{evt:t}),this.nativeDraggable&&ee(document,"dragover",yt);var s=this.options;!e&&ae(Ie,s.dragClass,!1),ae(Ie,s.ghostClass,!0),Et.active=this,e&&this._appendGhost(),Le({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(Ge){this._lastX=Ge.clientX,this._lastY=Ge.clientY,bt();for(var e=document.elementFromPoint(Ge.clientX,Ge.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(Ge.clientX,Ge.clientY))!==t;)t=e;if(Ie.parentNode[Ce]._isOutsideThisEl(e),t)do{if(t[Ce]){if(t[Ce]._onDragOver({clientX:Ge.clientX,clientY:Ge.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break}e=t}while(t=t.parentNode);wt()}},_onTouchMove:function(e){if(Ve){var t=this.options,s=t.fallbackTolerance,n=t.fallbackOffset,r=e.touches?e.touches[0]:e,i=je&&ce(je,!0),o=je&&i&&i.a,a=je&&i&&i.d,l=ht&&tt&&be(tt),c=(r.clientX-Ve.clientX+n.x)/(o||1)+(l?l[0]-at[0]:0)/(o||1),d=(r.clientY-Ve.clientY+n.y)/(a||1)+(l?l[1]-at[1]:0)/(a||1);if(!Et.active&&!st){if(s&&Math.max(Math.abs(r.clientX-this._lastX),Math.abs(r.clientY-this._lastY))<s)return;this._onDragStart(e,!0)}if(je){i?(i.e+=c-(qe||0),i.f+=d-(Qe||0)):i={a:1,b:0,c:0,d:1,e:c,f:d};var h="matrix(".concat(i.a,",").concat(i.b,",").concat(i.c,",").concat(i.d,",").concat(i.e,",").concat(i.f,")");le(je,"webkitTransform",h),le(je,"mozTransform",h),le(je,"msTransform",h),le(je,"transform",h),qe=c,Qe=d,Ge=r}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!je){var e=this.options.fallbackOnBody?document.body:Be,t=ue(Ie,!0,ht,!0,e),s=this.options;if(ht){for(tt=e;"static"===le(tt,"position")&&"none"===le(tt,"transform")&&tt!==document;)tt=tt.parentNode;tt!==document.body&&tt!==document.documentElement?(tt===document&&(tt=he()),t.top+=tt.scrollTop,t.left+=tt.scrollLeft):tt=he(),at=be(tt)}ae(je=Ie.cloneNode(!0),s.ghostClass,!1),ae(je,s.fallbackClass,!0),ae(je,s.dragClass,!0),le(je,"transition",""),le(je,"transform",""),le(je,"box-sizing","border-box"),le(je,"margin",0),le(je,"top",t.top),le(je,"left",t.left),le(je,"width",t.width),le(je,"height",t.height),le(je,"opacity","0.8"),le(je,"position",ht?"absolute":"fixed"),le(je,"zIndex","100000"),le(je,"pointerEvents","none"),Et.ghost=je,e.appendChild(je),le(je,"transform-origin",Je/parseInt(je.style.width)*100+"% "+Xe/parseInt(je.style.height)*100+"%")}},_onDragStart:function(e,t){var s=this,n=e.dataTransfer,r=s.options;Me("dragStart",this,{evt:e}),Et.eventCanceled?this._onDrop():(Me("setupClone",this),Et.eventCanceled||((Fe=ke(Ie)).draggable=!1,Fe.style["will-change"]="",this._hideClone(),ae(Fe,this.options.chosenClass,!1),Et.clone=Fe),s.cloneId=St((function(){Me("clone",s),Et.eventCanceled||(s.options.removeCloneOnHide||Be.insertBefore(Fe,Ie),s._hideClone(),Le({sortable:s,name:"clone"}))})),!t&&ae(Ie,r.dragClass,!0),t?(nt=!0,s._loopId=setInterval(s._emulateDragOver,50)):(te(document,"mouseup",s._onDrop),te(document,"touchend",s._onDrop),te(document,"touchcancel",s._onDrop),n&&(n.effectAllowed="move",r.setData&&r.setData.call(s,n,Ie)),ee(document,"drop",s),le(Ie,"transform","translateZ(0)")),st=!0,s._dragStartId=St(s._dragStarted.bind(s,t,e)),ee(document,"selectstart",s),Ye=!0,X&&le(document.body,"user-select","none"))},_onDragOver:function(e){var t,s,n,r,i=this.el,o=e.target,a=this.options,l=a.group,c=Et.active,d=He===l,h=a.sort,u=We||c,p=this,m=!1;if(!lt){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),o=re(o,a.draggable,i,!0),x("dragOver"),Et.eventCanceled)return m;if(Ie.contains(e.target)||o.animated&&o.animatingX&&o.animatingY||p._ignoreWhileAnimating===o)return L(!1);if(nt=!1,c&&!a.disabled&&(d?h||(n=!Be.contains(Ie)):We===this||(this.lastPutMode=He.checkPull(this,c,Ie,e))&&l.checkPut(this,c,Ie,e))){if(r="vertical"===this._getDirection(e,o),t=ue(Ie),x("dragOverValid"),Et.eventCanceled)return m;if(n)return Pe=Be,M(),this._hideClone(),x("revert"),Et.eventCanceled||(Ne?Be.insertBefore(Ie,Ne):Be.appendChild(Ie)),L(!0);var f=fe(i,a.draggable);if(!f||function(e,t,s){var n=ue(fe(s.el,s.options.draggable));return t?e.clientX>n.right+10||e.clientX<=n.right&&e.clientY>n.bottom&&e.clientX>=n.left:e.clientX>n.right&&e.clientY>n.top||e.clientX<=n.right&&e.clientY>n.bottom+10}(e,r,this)&&!f.animated){if(f===Ie)return L(!1);if(f&&i===e.target&&(o=f),o&&(s=ue(o)),!1!==kt(Be,i,Ie,t,o,s,e,!!o))return M(),i.appendChild(Ie),Pe=i,I(),L(!0)}else if(o.parentNode===i){s=ue(o);var g,b,w,v=Ie.parentNode!==i,y=!function(e,t,s){var n=s?e.left:e.top,r=s?e.right:e.bottom,i=s?e.width:e.height,o=s?t.left:t.top,a=s?t.right:t.bottom,l=s?t.width:t.height;return n===o||r===a||n+i/2===o+l/2}(Ie.animated&&Ie.toRect||t,o.animated&&o.toRect||s,r),E=r?"top":"left",k=pe(o,"top","top")||pe(Ie,"top","top"),C=k?k.scrollTop:void 0;if(Ke!==o&&(b=s[E],it=!1,ot=!y&&a.invertSwap||v),0!==(g=function(e,t,s,n,r,i,o,a){var l=n?e.clientY:e.clientX,c=n?s.height:s.width,d=n?s.top:s.left,h=n?s.bottom:s.right,u=!1;if(!o)if(a&&et<c*r){if(!it&&(1===Ze?l>d+c*i/2:l<h-c*i/2)&&(it=!0),it)u=!0;else if(1===Ze?l<d+et:l>h-et)return-Ze}else if(l>d+c*(1-r)/2&&l<h-c*(1-r)/2)return function(e){return ge(Ie)<ge(e)?1:-1}(t);if((u=u||o)&&(l<d+c*i/2||l>h-c*i/2))return l>d+c/2?1:-1;return 0}(e,o,s,r,y?1:a.swapThreshold,null==a.invertedSwapThreshold?a.swapThreshold:a.invertedSwapThreshold,ot,Ke===o))){var _=ge(Ie);do{_-=g,w=Pe.children[_]}while(w&&("none"===le(w,"display")||w===je))}if(0===g||w===o)return L(!1);Ke=o,Ze=g;var T=o.nextElementSibling,S=!1,A=kt(Be,i,Ie,t,o,s,e,S=1===g);if(!1!==A)return 1!==A&&-1!==A||(S=1===A),lt=!0,setTimeout(_t,30),M(),S&&!T?i.appendChild(Ie):o.parentNode.insertBefore(Ie,S?T:o),k&&Ee(k,0,C-k.scrollTop),Pe=Ie.parentNode,void 0===b||ot||(et=Math.abs(b-ue(o)[E])),I(),L(!0)}if(i.contains(Ie))return L(!1)}return!1}function x(a,l){Me(a,p,W({evt:e,isOwner:d,axis:r?"vertical":"horizontal",revert:n,dragRect:t,targetRect:s,canSort:h,fromSortable:u,target:o,completed:L,onMove:function(s,n){return kt(Be,i,Ie,t,s,ue(s),e,n)},changed:I},l))}function M(){x("dragOverAnimationCapture"),p.captureAnimationState(),p!==u&&u.captureAnimationState()}function L(t){return x("dragOverCompleted",{insertion:t}),t&&(d?c._hideClone():c._showClone(p),p!==u&&(ae(Ie,We?We.options.ghostClass:c.options.ghostClass,!1),ae(Ie,a.ghostClass,!0)),We!==p&&p!==Et.active?We=p:p===Et.active&&We&&(We=null),u===p&&(p._ignoreWhileAnimating=o),p.animateAll((function(){x("dragOverAnimationComplete"),p._ignoreWhileAnimating=null})),p!==u&&(u.animateAll(),u._ignoreWhileAnimating=null)),(o===Ie&&!Ie.animated||o===i&&!o.animated)&&(Ke=null),a.dragoverBubble||e.rootEl||o===document||(Ie.parentNode[Ce]._isOutsideThisEl(e.target),!t&&vt(e)),!a.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),m=!0}function I(){Ue=ge(Ie),Re=ge(Ie,a.draggable),Le({sortable:p,name:"change",toEl:i,newIndex:Ue,newDraggableIndex:Re,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){te(document,"mousemove",this._onTouchMove),te(document,"touchmove",this._onTouchMove),te(document,"pointermove",this._onTouchMove),te(document,"dragover",vt),te(document,"mousemove",vt),te(document,"touchmove",vt)},_offUpEvents:function(){var e=this.el.ownerDocument;te(e,"mouseup",this._onDrop),te(e,"touchend",this._onDrop),te(e,"pointerup",this._onDrop),te(e,"touchcancel",this._onDrop),te(document,"selectstart",this)},_onDrop:function(e){var t=this.el,s=this.options;Ue=ge(Ie),Re=ge(Ie,s.draggable),Me("drop",this,{evt:e}),Pe=Ie&&Ie.parentNode,Ue=ge(Ie),Re=ge(Ie,s.draggable),Et.eventCanceled||(st=!1,ot=!1,it=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),At(this.cloneId),At(this._dragStartId),this.nativeDraggable&&(te(document,"drop",this),te(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),X&&le(document.body,"user-select",""),le(Ie,"transform",""),e&&(Ye&&(e.cancelable&&e.preventDefault(),!s.dropBubble&&e.stopPropagation()),je&&je.parentNode&&je.parentNode.removeChild(je),(Be===Pe||We&&"clone"!==We.lastPutMode)&&Fe&&Fe.parentNode&&Fe.parentNode.removeChild(Fe),Ie&&(this.nativeDraggable&&te(Ie,"dragend",this),Ct(Ie),Ie.style["will-change"]="",Ye&&!st&&ae(Ie,We?We.options.ghostClass:this.options.ghostClass,!1),ae(Ie,this.options.chosenClass,!1),Le({sortable:this,name:"unchoose",toEl:Pe,newIndex:null,newDraggableIndex:null,originalEvent:e}),Be!==Pe?(Ue>=0&&(Le({rootEl:Pe,name:"add",toEl:Pe,fromEl:Be,originalEvent:e}),Le({sortable:this,name:"remove",toEl:Pe,originalEvent:e}),Le({rootEl:Pe,name:"sort",toEl:Pe,fromEl:Be,originalEvent:e}),Le({sortable:this,name:"sort",toEl:Pe,originalEvent:e})),We&&We.save()):Ue!==$e&&Ue>=0&&(Le({sortable:this,name:"update",toEl:Pe,originalEvent:e}),Le({sortable:this,name:"sort",toEl:Pe,originalEvent:e})),Et.active&&(null!=Ue&&-1!==Ue||(Ue=$e,Re=ze),Le({sortable:this,name:"end",toEl:Pe,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){Me("nulling",this),Be=Ie=Pe=je=Ne=Fe=De=Oe=Ve=Ge=Ye=Ue=Re=$e=ze=Ke=Ze=We=He=Et.dragged=Et.ghost=Et.clone=Et.active=null,ct.forEach((function(e){e.checked=!0})),ct.length=qe=Qe=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":Ie&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],s=this.el.children,n=0,r=s.length,i=this.options;n<r;n++)re(e=s[n],i.draggable,this.el,!1)&&t.push(e.getAttribute(i.dataIdAttr)||Tt(e));return t},sort:function(e){var t={},s=this.el;this.toArray().forEach((function(e,n){var r=s.children[n];re(r,this.options.draggable,s,!1)&&(t[e]=r)}),this),e.forEach((function(e){t[e]&&(s.removeChild(t[e]),s.appendChild(t[e]))}))},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return re(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var s=this.options;if(void 0===t)return s[e];var n=Ae.modifyOption(this,e,t);s[e]=void 0!==n?n:t,"group"===e&&gt(s)},destroy:function(){Me("destroy",this);var e=this.el;e[Ce]=null,te(e,"mousedown",this._onTapStart),te(e,"touchstart",this._onTapStart),te(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(te(e,"dragover",this),te(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),rt.splice(rt.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Oe){if(Me("hideClone",this),Et.eventCanceled)return;le(Fe,"display","none"),this.options.removeCloneOnHide&&Fe.parentNode&&Fe.parentNode.removeChild(Fe),Oe=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(Oe){if(Me("showClone",this),Et.eventCanceled)return;Be.contains(Ie)&&!this.options.group.revertClone?Be.insertBefore(Fe,Ie):Ne?Be.insertBefore(Fe,Ne):Be.appendChild(Fe),this.options.group.revertClone&&this.animate(Ie,Fe),le(Fe,"display",""),Oe=!1}}else this._hideClone()}},dt&&ee(document,"touchmove",(function(e){(Et.active||st)&&e.cancelable&&e.preventDefault()})),Et.utils={on:ee,off:te,css:le,find:de,is:function(e,t){return!!re(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);return e},throttle:ye,closest:re,toggleClass:ae,clone:ke,index:ge,nextTick:St,cancelNextTick:At,detectDirection:ft,getChild:me},Et.get=function(e){return e[Ce]},Et.mount=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(Et.utils=W({},Et.utils,e.utils)),Ae.mount(e)}))},Et.create=function(e,t){return new Et(e,t)},Et.version="1.10.2";var xt,Mt,Lt,It,Pt,jt,Bt=[],Nt=!1;function Dt(){Bt.forEach((function(e){clearInterval(e.pid)})),Bt=[]}function Ft(){clearInterval(jt)}var Ot=ye((function(e,t,s,n){if(t.scroll){var r,i=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,a=t.scrollSensitivity,l=t.scrollSpeed,c=he(),d=!1;Mt!==s&&(Mt=s,Dt(),xt=t.scroll,r=t.scrollFn,!0===xt&&(xt=we(s,!0)));var h=0,u=xt;do{var p=u,m=ue(p),f=m.top,g=m.bottom,b=m.left,w=m.right,v=m.width,y=m.height,E=void 0,k=void 0,C=p.scrollWidth,_=p.scrollHeight,T=le(p),S=p.scrollLeft,A=p.scrollTop;p===c?(E=v<C&&("auto"===T.overflowX||"scroll"===T.overflowX||"visible"===T.overflowX),k=y<_&&("auto"===T.overflowY||"scroll"===T.overflowY||"visible"===T.overflowY)):(E=v<C&&("auto"===T.overflowX||"scroll"===T.overflowX),k=y<_&&("auto"===T.overflowY||"scroll"===T.overflowY));var x=E&&(Math.abs(w-i)<=a&&S+v<C)-(Math.abs(b-i)<=a&&!!S),M=k&&(Math.abs(g-o)<=a&&A+y<_)-(Math.abs(f-o)<=a&&!!A);if(!Bt[h])for(var L=0;L<=h;L++)Bt[L]||(Bt[L]={});Bt[h].vx==x&&Bt[h].vy==M&&Bt[h].el===p||(Bt[h].el=p,Bt[h].vx=x,Bt[h].vy=M,clearInterval(Bt[h].pid),0==x&&0==M||(d=!0,Bt[h].pid=setInterval(function(){n&&0===this.layer&&Et.active._onTouchMove(Pt);var t=Bt[this.layer].vy?Bt[this.layer].vy*l:0,s=Bt[this.layer].vx?Bt[this.layer].vx*l:0;"function"==typeof r&&"continue"!==r.call(Et.dragged.parentNode[Ce],s,t,e,Pt,Bt[this.layer].el)||Ee(Bt[this.layer].el,s,t)}.bind({layer:h}),24))),h++}while(t.bubbleScroll&&u!==c&&(u=we(u,!1)));Nt=d}}),30),$t=function(e){var t=e.originalEvent,s=e.putSortable,n=e.dragEl,r=e.activeSortable,i=e.dispatchSortableEvent,o=e.hideGhostForTarget,a=e.unhideGhostForTarget;if(t){var l=s||r;o();var c=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,d=document.elementFromPoint(c.clientX,c.clientY);a(),l&&!l.el.contains(d)&&(i("spill"),this.onSpill({dragEl:n,putSortable:s}))}};function Ut(){}function zt(){}Ut.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,s=e.putSortable;this.sortable.captureAnimationState(),s&&s.captureAnimationState();var n=me(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(t,n):this.sortable.el.appendChild(t),this.sortable.animateAll(),s&&s.animateAll()},drop:$t},H(Ut,{pluginName:"revertOnSpill"}),zt.prototype={onSpill:function(e){var t=e.dragEl,s=e.putSortable||this.sortable;s.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),s.animateAll()},drop:$t},H(zt,{pluginName:"removeOnSpill"});Et.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?ee(document,"dragover",this._handleAutoScroll):this.options.supportPointer?ee(document,"pointermove",this._handleFallbackAutoScroll):t.touches?ee(document,"touchmove",this._handleFallbackAutoScroll):ee(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?te(document,"dragover",this._handleAutoScroll):(te(document,"pointermove",this._handleFallbackAutoScroll),te(document,"touchmove",this._handleFallbackAutoScroll),te(document,"mousemove",this._handleFallbackAutoScroll)),Ft(),Dt(),clearTimeout(ie),ie=void 0},nulling:function(){Pt=Mt=xt=Nt=jt=Lt=It=null,Bt.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var s=this,n=(e.touches?e.touches[0]:e).clientX,r=(e.touches?e.touches[0]:e).clientY,i=document.elementFromPoint(n,r);if(Pt=e,t||Q||q||X){Ot(e,this.options,i,t);var o=we(i,!0);!Nt||jt&&n===Lt&&r===It||(jt&&Ft(),jt=setInterval((function(){var i=we(document.elementFromPoint(n,r),!0);i!==o&&(o=i,Dt()),Ot(e,s.options,i,t)}),10),Lt=n,It=r)}else{if(!this.options.bubbleScroll||we(i,!0)===he())return void Dt();Ot(e,this.options,we(i,!1),!1)}}},H(e,{pluginName:"scroll",initializeByDefault:!0})}),Et.mount(zt,Ut);var Rt=Et;s(18);const Ht=function(){const e=document.createElement("li");e.setAttribute("class","BoxList-li MovableBox");const t=document.createElement("span");e.appendChild(t),t.setAttribute("class","MovableBox-content");const s={content:t};return{root:e,refs:s,ref:e=>{if(!s[e])throw new Error(`Missing handle: '${e}'`);return s[e]},update:()=>{}}},Wt=function(){const e=document.createElement("li");e.setAttribute("class","BoxList-inlineLi");const t={};return{root:e,refs:t,ref:e=>{if(!t[e])throw new Error(`Missing handle: '${e}'`);return t[e]},update:()=>{}}};class Vt{constructor(e,t={}){this.dash=e,this.options=t,this.boxes=new Map;const{root:s,ref:n}=function(){const e=document.createElement("div");e.setAttribute("class","BoxList");const t=document.createElement("div");e.appendChild(t);const s=document.createElement("ul");e.appendChild(s),s.setAttribute("class","BoxList-ul");const n={header:t,ul:s};return{root:e,refs:n,ref:e=>{if(!n[e])throw new Error(`Missing handle: '${e}'`);return n[e]},update:()=>{}}}();if(this.el=s,this.ulEl=n("ul"),!t.noHeader){const{root:e,ref:s,update:r}=function(e){const t=new Map,s=document.createElement("header");s.setAttribute("class","BoxList-header WithLoader -right");const n=document.createElement("span");s.appendChild(n);const r=document.createElement("span");s.appendChild(r),r.setAttribute("class","BoxList-spinner WithLoader-l"),r.setAttribute("hidden","");const i=document.createTextNode("");n.appendChild(i),(e=>{let s=t.get(e);return s||(s=[],t.set(e,s)),s})("title").push(e=>i.nodeValue=e);const o={busyIcon:r},a=e=>{for(const[s,n]of t.entries())s in e&&n.forEach(t=>t(e[s]))};return e&&a(e),{root:s,refs:o,ref:e=>{if(!o[e])throw new Error(`Missing handle: '${e}'`);return o[e]},update:a}}({title:t.title});this.update=r,this.spinnerEl=s("busyIcon"),n("header").appendChild(e)}this.options.inline&&this.el.classList.add("inline"),this.sortable=this.makeSortable()}addBox(e){const t=this.options.inline?Wt:Ht,{root:s,ref:n}=t(),r=s;r.setAttribute("data-id",e.id),this.options.inline?r.appendChild(e.el):n("content").appendChild(e.el),this.ulEl.appendChild(r),this.boxes.set(e.id,r)}hasBox(e){return this.boxes.has(e)}removeBox(e){const t=this.boxes.get(e);return!!t&&(this.ulEl.removeChild(t),this.boxes.delete(e),!0)}clear(){for(const e of this.boxes.keys())this.removeBox(e)}setTitle(e){this.update&&this.update({title:e||this.options.title||""})}sort(e){this.sortable.sort(e)}getOrder(){return this.sortable.toArray()}enable(e=!1){this.el.style.pointerEvents=this.el.style.pointerEvents="auto",this.el.style.opacity="1.0",e&&this.showSpinner(!1)}disable(e=!1){this.el.style.pointerEvents=this.el.style.pointerEvents="none",this.el.style.opacity="0.4",e&&this.showSpinner(!0)}enableSort(e=!1){this.options.sort&&this.sortable.option("disabled")&&(this.sortable.option("disabled",!1),e&&this.showSpinner(!1))}disableSort(e=!1){this.options.sort&&!this.sortable.option("disabled")&&(this.sortable.option("disabled",!0),e&&this.showSpinner(!0))}makeSortable(){return Rt.create(this.ulEl,{filter:"button",group:this.options.group,animation:150,sort:this.options.sort,disabled:!!this.options.disabled,onAdd:e=>{void 0!==e.item.dataset.id&&(this.boxes.set(e.item.dataset.id,e.item),this.dash.emit("boxListItemAdded",{boxListId:this.options.id,boxId:e.item.dataset.id}))},onRemove:e=>{void 0!==e.item.dataset.id&&(this.boxes.delete(e.item.dataset.id),this.dash.emit("boxListItemRemoved",{boxListId:this.options.id,boxId:e.item.dataset.id}))},onUpdate:e=>{this.dash.emit("boxListSortingUpdated",{boxListId:this.options.id,boxId:e.item.dataset.id,boxIds:this.sortable.toArray()})},onMove:e=>{if(!this.options.obj||!this.options.onMove)return!0;const t=e.dragged.dataset.id,s=this.options.id;return void 0!==t&&void 0!==s&&this.options.onMove.call(this.options.obj,{boxId:t,boxListId:s})}})}showSpinner(e){this.spinnerEl&&(this.spinnerEl.hidden=!e)}}s(19);class Gt{constructor(e,t){this.dash=e,this.invitation=t;const{root:s,ref:n}=function(){const e=document.createElement("div");e.setAttribute("class","InvitationBox");const t=document.createElement("div");e.appendChild(t),t.setAttribute("class","InvitationBox-top");const s=document.createElement("div");e.appendChild(s),s.setAttribute("class","InvitationBox-bottom");const n=document.createElement("section");t.appendChild(n);const r=document.createElement("section");t.appendChild(r);const i=document.createElement("section");t.appendChild(i);const o=document.createElement("section");t.appendChild(o);const a=document.createElement("span");s.appendChild(a),a.setAttribute("class","fas fa-redo fa-xs"),a.setAttribute("title","Resend invitation");const l=document.createElement("span");s.appendChild(l),l.setAttribute("class","fas fa-minus fa-xs"),l.setAttribute("title","Cancel invitation");const c=document.createElement("span");n.appendChild(c),c.setAttribute("class","fas fa-envelope");const d=document.createElement("span");n.appendChild(d),d.setAttribute("class","InvitationBox-lbl");const h=document.createElement("span");r.appendChild(h),h.setAttribute("class","fas fa-user-ninja");const u=document.createElement("span");r.appendChild(u),u.setAttribute("class","InvitationBox-lbl");const p=document.createElement("span");i.appendChild(p),p.setAttribute("class","fa fas fa-calendar-check"),p.setAttribute("style","color: green");const m=document.createElement("span");i.appendChild(m),m.setAttribute("class","InvitationBox-lbl");const f=document.createElement("span");o.appendChild(f),f.setAttribute("class","fas fa-calendar-minus"),f.setAttribute("style","color: red");const g=document.createElement("span");o.appendChild(g),g.setAttribute("class","InvitationBox-lbl");const b={resend:a,cancel:l,email:d,username:u,creation:m,expiration:g};return{root:e,refs:b,ref:e=>{if(!b[e])throw new Error(`Missing handle: '${e}'`);return b[e]},update:()=>{}}}();this.el=s,n("email").textContent=this.invitation.email,n("username").textContent=this.invitation.username||"<not defined>",n("creation").textContent=new Date(this.invitation.creationTs).toDateString(),n("expiration").textContent=new Date(this.invitation.expirationTs).toDateString(),n("resend").addEventListener("click",()=>this.dash.emit("resendInvitation",this.invitation.id)),n("cancel").addEventListener("click",()=>this.dash.emit("cancelInvitation",this.invitation.id))}get id(){return this.invitation.id}setWithFocus(e){e?this.el.classList.add("focus"):this.el.classList.remove("focus")}}class qt{constructor(e){this.dash=e;const{root:t,ref:s}=function(){const e=document.createElement("div");e.setAttribute("class","FieldGroup");const t=document.createElement("label");e.appendChild(t),t.setAttribute("class","FieldGroup-item Field");const s=document.createElement("label");e.appendChild(s),s.setAttribute("class","FieldGroup-item Field");const n=document.createElement("label");e.appendChild(n),n.setAttribute("class","FieldGroup-item Field");const r=document.createElement("button");e.appendChild(r),r.setAttribute("class","FieldGroup-action Btn WithLoader -right"),r.setAttribute("type","button");const i=document.createElement("span");t.appendChild(i),i.setAttribute("class","Field-lbl");const o=document.createElement("input");t.appendChild(o),o.setAttribute("class","Field-input"),o.setAttribute("type","text"),o.setAttribute("placeholder","Email");const a=document.createElement("span");s.appendChild(a),a.setAttribute("class","Field-lbl");const l=document.createElement("input");s.appendChild(l),l.setAttribute("class","Field-input"),l.setAttribute("type","text"),l.setAttribute("placeholder","Username");const c=document.createElement("span");n.appendChild(c),c.setAttribute("class","Field-lbl");const d=document.createElement("span");n.appendChild(d),d.setAttribute("class","Field-deco");const h=document.createTextNode("\n    Submit\n    ");r.appendChild(h);const u=document.createElement("span");r.appendChild(u),u.setAttribute("class","WithLoader-l");const p=document.createTextNode("Email");i.appendChild(p);const m=document.createTextNode("Username");a.appendChild(m);const f=document.createTextNode("Invitation validity");c.appendChild(f);const g=document.createElement("input");d.appendChild(g),g.setAttribute("class","Field-input"),g.setAttribute("type","number"),g.setAttribute("step","1"),g.setAttribute("min","1"),g.setAttribute("max","30"),g.setAttribute("pattern","d+"),g.setAttribute("placeholder","Days");const b={submitBtn:r,email:o,username:l,spinner:u,validity:g};return{root:e,refs:b,ref:e=>{if(!b[e])throw new Error(`Missing handle: '${e}'`);return b[e]},update:()=>{}}}();this.el=t,this.usernameEl=s("username"),this.emailEl=s("email"),this.validityEl=s("validity"),this.spinnerEl=s("spinner"),s("submitBtn").addEventListener("click",()=>this.onSubmit())}async onSubmit(){const e=this.usernameEl.value.trim(),t=this.emailEl.value,s=this.validityEl.value;this.validate(e,t,s)?await this.doFetch(e||void 0,t,s):await this.dash.create(P).show("Please check the values you type in the form.")}async doFetch(e,t,s){try{const n=await fetch(this.dash.app.baseUrl+"/api/registration/send-invitation",{method:"post",credentials:"same-origin",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({username:e,email:t,validity:s})});if(n.ok)return this.handleFetchResult(await n.json());await this.dash.create(I).show(`The server does not handle your request: ${n.status} code.`)}catch(e){await this.dash.create(I).show("Unable to complete the task. Network Error.")}}async handleFetchResult(e){e.done?(this.clear(),this.dash.emit("invitationSent",e.invitation)):await this.dash.create(I).show("The server does not fulfill your request for an unknown reason.")}validate(e,t,s){if(""!==e&&(e.length<4||e.length>30))return!1;if(""===t)return!1;const n=parseInt(s);return!(n<=0||n>30)}clear(){this.usernameEl.value="",this.emailEl.value="",this.validityEl.value="1"}}s(20);class Qt{constructor(e){this.dash=e,this.map=new Map,this.needFetch=!0,this.model=this.dash.app.model,this.log=this.dash.app.log,this.form=this.dash.create(qt),this.boxList=this.dash.create(Vt,{title:"Invitations",sort:!1});const{root:t,ref:s}=function(){const e=document.createElement("div");e.setAttribute("class","InvitationWorkspace");const t=document.createElement("div");e.appendChild(t);const s=document.createElement("div");e.appendChild(s);const n={boxList:t,form:s};return{root:e,refs:n,ref:e=>{if(!n[e])throw new Error(`Missing handle: '${e}'`);return n[e]},update:()=>{}}}();this.el=t,s("form").appendChild(this.form.el),s("boxList").appendChild(this.boxList.el),this.fetchInvitations().catch(e=>this.dash.log.error(e)),this.dash.listenTo("invitationSent",e=>this.addInvitation(e)),this.dash.listenTo("resendInvitation",e=>this.resendInvitation(e)),this.dash.listenTo("cancelInvitation",e=>this.cancelInvitation(e))}activate(e){this.ctrl=e,e.setContentEl(this.el).setTitle("Manage invitations"),this.needFetch||this.fetchInvitations().then(e=>this.needFetch=e).catch(e=>this.dash.log.error(e))}async fetchInvitations(){try{const e=await fetch(this.dash.app.baseUrl+"/api/registration/fetch-invitations",{method:"post",credentials:"include",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({})});if(!e.ok)return this.dash.create(I).show("Something went wrong. We can not get pending invitations from server."),!1;const t=await e.json();for(const e of t.data)this.addInvitation(e);return!0}catch(e){this.dash.create(I).show("We cannot reach our server. Check your internet connection.")}return!1}addInvitation(e){this.map.set(e.id,e),this.boxList.addBox(this.dash.create(Gt,e))}removeInvitation(e){this.map.delete(e),this.boxList.removeBox(e)}async resendInvitation(e){const t=this.map.get(e);if(!t)return void this.log.error(`Invitation with ID ${e} not found in InvitationWorkspace`);try{const s=await fetch(this.dash.app.baseUrl+"/api/registration/resend-invitation",{method:"post",credentials:"include",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({invitationId:e,username:t.username||void 0,email:t.email,validity:Math.floor((t.expirationTs-t.creationTs)/864e5)})});if(!s.ok){const e=this.dash.create(I),t=`Error while resending invitation. Response status: ${s.status} ${s.statusText}`;return await e.show("Something went wrong. The server did not handle the request correctly."),void this.log.error(t)}const n=await s.json();if(this.removeInvitation(t.id),!n.done){const e=this.dash.create(I);return void await e.show("There is a problem with the invitation. Try to create a new one.")}this.addInvitation(n.invitation)}catch(e){const t=this.dash.create(I);await t.show("Something went wrong. Network is not working properly."),this.log.error(e)}}async cancelInvitation(e){const t=this.map.get(e);if(t)try{const s=await fetch(this.dash.app.baseUrl+"/api/registration/cancel-invitation",{method:"post",credentials:"include",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({invitationId:e})});if(!s.ok){const e=this.dash.create(I),t=`Error while canceling invitation. Response status: ${s.status} ${s.statusText}`;return await e.show("Something went wrong. The server did not handle the request correctly."),void this.log.error(t)}(await s.json()).done&&this.removeInvitation(t.id)}catch(e){const t=this.dash.create(I);await t.show("Something went wrong. Network is not working properly."),this.log.error(e)}else this.log.error(`Invitation with ID ${e} not dound in InvitationWorkspace`)}}s(21);class Jt{constructor(e){this.dash=e,this.el=function(){const e=document.createElement("section");e.setAttribute("class","StatusBar");const t={};return{root:e,refs:t,ref:e=>{if(!t[e])throw new Error(`Missing handle: '${e}'`);return t[e]},update:()=>{}}}().root}addItem(e){this.el.appendChild(e)}}s(22);class Xt{constructor(e){this.dash=e;const{root:t,ref:s}=function(){const e=document.createElement("dialog");e.setAttribute("class","ModalDialog InfoDialog");const t=document.createElement("header");e.appendChild(t),t.setAttribute("class","ModalDialog-header");const s=document.createElement("div");e.appendChild(s),s.setAttribute("class","ModalDialog-content");const n=document.createElement("div");e.appendChild(n),n.setAttribute("class","ModalDialog-bottom");const r=document.createElement("div");t.appendChild(r),r.setAttribute("class","ModalDialog-headerLeft");const i=document.createElement("div");t.appendChild(i),i.setAttribute("class","ModalDialog-headerRight");const o=document.createElement("div");s.appendChild(o),o.setAttribute("class","ModalDialog-contentLeft InfoDialog-contentLeft");const a=document.createElement("div");s.appendChild(a),a.setAttribute("class","ModalDialog-contentRight");const l=document.createElement("button");n.appendChild(l),l.setAttribute("class","ModalDialogOkButton");const c=document.createElement("span");r.appendChild(c);const d=document.createElement("span");i.appendChild(d),d.setAttribute("class","fas fa-times fa-1x ModalDialogCloseItem");const h=document.createElement("span");o.appendChild(h),h.setAttribute("class","fas fa-3x fa-info-circle");const u=document.createElement("div");a.appendChild(u);const p=document.createTextNode("OK");l.appendChild(p);const m={button:l,title:c,close:d,message:u};return{root:e,refs:m,ref:e=>{if(!m[e])throw new Error(`Missing handle: '${e}'`);return m[e]},update:()=>{}}}();this.el=t,this.msgEl=s("message"),this.titleEl=s("title"),M.registerDialog(this.el);const n=()=>this.close();s("button").addEventListener("click",n),s("close").addEventListener("click",n),this.el.addEventListener("cancel",e=>{e.preventDefault(),this.close()}),this.el.addEventListener("keydown",e=>{"Enter"===e.key&&(e.stopPropagation(),this.close())})}show(e,t="Information"){this.currDfd=new L,this.titleEl.textContent=t,p(this.msgEl);const s="string"==typeof e?[e]:e;for(const e of s){const t=document.createElement("p");t.textContent=e,this.msgEl.appendChild(t)}return document.body.appendChild(this.el),this.el,this.el.showModal(),this.currDfd.promise}close(){this.currDfd&&this.currDfd.resolve(!0),this.currDfd=void 0,this.el.close(),document.body.removeChild(this.el)}}s(23);class Yt{constructor(e){this.dash=e;const{root:t,ref:s}=function(){const e=document.createElement("dialog");e.setAttribute("class","ModalDialog QuestionDialog");const t=document.createElement("header");e.appendChild(t),t.setAttribute("class","ModalDialog-header");const s=document.createElement("div");e.appendChild(s),s.setAttribute("class","ModalDialog-content");const n=document.createElement("div");e.appendChild(n),n.setAttribute("class","ModalDialog-bottom");const r=document.createElement("div");t.appendChild(r),r.setAttribute("class","ModalDialog-headerLeft");const i=document.createElement("div");t.appendChild(i),i.setAttribute("class","ModalDialog-headerRight");const o=document.createElement("div");s.appendChild(o),o.setAttribute("class","ModalDialog-contentLeft InfoDialog-contentLeft");const a=document.createElement("div");s.appendChild(a),a.setAttribute("class","ModalDialog-contentRight");const l=document.createElement("button");n.appendChild(l),l.setAttribute("class","ModalDialogCancelButton");const c=document.createElement("pre");n.appendChild(c);const d=document.createElement("button");n.appendChild(d),d.setAttribute("class","ModalDialogOkButton");const h=document.createElement("span");r.appendChild(h);const u=document.createElement("span");i.appendChild(u),u.setAttribute("class","fas fa-times fa-1x ModalDialogCloseItem");const p=document.createElement("span");o.appendChild(p),p.setAttribute("class","fas fa-3x fa-question-circle");const m=document.createElement("div");a.appendChild(m);const f=document.createTextNode("No");l.appendChild(f);const g=document.createTextNode(" ");c.appendChild(g);const b=document.createTextNode("Yes");d.appendChild(b);const w={cancelBtn:l,okBtn:d,title:h,close:u,message:m};return{root:e,refs:w,ref:e=>{if(!w[e])throw new Error(`Missing handle: '${e}'`);return w[e]},update:()=>{}}}();this.el=t,this.msgEl=s("message"),this.titleEl=s("title"),M.registerDialog(this.el),s("okBtn").addEventListener("click",()=>this.close(!0)),s("cancelBtn").addEventListener("click",()=>this.close(!1)),s("close").addEventListener("click",()=>this.close(!1)),this.el.addEventListener("cancel",e=>{e.preventDefault(),this.close(!1)}),this.el.addEventListener("keydown",e=>{"Enter"===e.key&&this.close(!0)})}show(e,t="Question"){this.currDfd=new L,this.titleEl.textContent=t,p(this.msgEl);const s="string"==typeof e?[e]:e;for(const e of s){const t=document.createElement("p");t.textContent=e,this.msgEl.appendChild(t)}return document.body.appendChild(this.el),this.el,this.el.showModal(),this.currDfd.promise}close(e){this.currDfd&&this.currDfd.resolve(e),this.currDfd=void 0,this.el.close(),document.body.removeChild(this.el)}}class Kt{constructor(e,t){this.dash=e,this.webhook=t,this.log=this.dash.log;const{root:s,ref:n}=function(){const e=document.createElement("tr"),t=document.createElement("td");e.appendChild(t);const s=document.createElement("td");e.appendChild(s);const n=document.createElement("td");e.appendChild(n);const r=document.createElement("td");e.appendChild(r);const i=document.createElement("td");e.appendChild(i);const o=document.createElement("button");n.appendChild(o);const a=document.createElement("button");r.appendChild(a);const l=document.createElement("button");i.appendChild(l);const c=document.createTextNode("Show secret");o.appendChild(c);const d=document.createTextNode("Delete");l.appendChild(d);const h={provider:t,url:s,secret:o,toggle:a,delete:l};return{root:e,refs:h,ref:e=>{if(!h[e])throw new Error(`Missing handle: '${e}'`);return h[e]},update:()=>{}}}();this.el=s,this.providerEl=n("provider"),this.urlEl=n("url"),this.btnSecretEl=n("secret"),this.btnToggleEl=n("toggle"),this.btnDeleteEl=n("delete"),this.providerEl.textContent=this.webhook.provider,this.urlEl.textContent=this.webhook.url,this.btnToggleEl.textContent=this.webhook.active?"Deactivate":"Activate",this.btnDeleteEl.addEventListener("click",()=>this.dispatch("delete")),this.btnSecretEl.addEventListener("click",()=>this.dispatch("showSecret")),this.btnToggleEl.addEventListener("click",()=>this.dispatch("toggle"))}dispatch(e){"showSecret"===e?this.showWebhookSecret().catch(e=>this.dash.log.error(e)):"toggle"===e?this.toggleWebhook().catch(e=>this.dash.log.error(e)):"delete"===e?this.deleteWebhook().catch(e=>this.dash.log.error(e)):this.log.warn("Unknown action: "+e)}async showWebhookSecret(){if(this.webhook.inProcessing)this.log.info("Cannot perform this action now.");else{this.webhook.inProcessing=!0;try{const e=await fetch(this.dash.app.baseUrl+"/api/notifications/github/get-webhook-secret",{method:"post",credentials:"same-origin",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({subscriptionId:this.webhook.id})});if(e.ok){const t=await e.json();t.done?this.dash.create(Xt).show(t.secret,"Hook secret"):this.dash.create(I).show("Something went wrong. Hook secret can't be displayed. Try again later.")}else this.dash.create(I).show("Something went wrong. Server did not fulfill our request.")}catch(e){this.dash.create(I).show("Unable to reach server. Network error.")}this.webhook.inProcessing=!1}}async toggleWebhook(){if(this.webhook.inProcessing)this.dash.create(Xt).show("Cannot perform this action now.");else{this.webhook.inProcessing=!0;try{const e=this.webhook.active?"deactivate-webhook":"activate-webhook",t=`${this.dash.app.baseUrl}/api/notifications/github/${e}`,s=await fetch(t,{method:"post",credentials:"same-origin",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({subscriptionId:this.webhook.id})});if(s.ok){(await s.json()).done?(this.webhook.active=!this.webhook.active,this.btnToggleEl.textContent=this.webhook.active?"Deactivate":"Activate"):this.dash.create(I).show("Something went wrong. Cannot perform this action now. Try again later.")}else this.dash.create(I).show("Something went wrong. The server did not fulfill the request.")}catch(e){this.log.error("Unable to reach server. Network error.")}this.webhook.inProcessing=!1}}async deleteWebhook(){if(await this.dash.create(Yt).show("Do you really want to delete this hook?"))if(this.webhook.inProcessing)this.dash.create(Xt).show("Cannot perform this action now.");else{this.webhook.inProcessing=!0;try{const e=await fetch(this.dash.app.baseUrl+"/api/notifications/github/delete-webhook",{method:"post",credentials:"same-origin",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({subscriptionId:this.webhook.id})});if(e.ok){(await e.json()).done?(this.el.hidden=!0,this.dash.emit("webhookDeleted",this.webhook.id)):this.dash.create(I).show("Something went wrong. Cannot remove hook. Try again later.")}else await this.dash.create(I).show("Something went wrong. Our server did not fulfill the request.")}catch(e){this.dash.create(I).show("Unable to reach server. Network error.")}this.webhook.inProcessing=!1}}}s(24);class Zt{constructor(e){this.dash=e,this.itemMap=new Map,this.needFetch=!0,this.log=this.dash.log;const{root:t,ref:s}=function(){const e=document.createElement("div");e.setAttribute("class","HookWorkspace");const t=document.createElement("table");e.appendChild(t),t.setAttribute("class","HookWorkspace-table");const s=document.createElement("div");e.appendChild(s);const n=document.createElement("caption");t.appendChild(n);const r=document.createElement("thead");t.appendChild(r);const i=document.createElement("tbody");t.appendChild(i);const o=document.createElement("button");s.appendChild(o);const a=document.createTextNode("Available hooks");n.appendChild(a);const l=document.createElement("tr");r.appendChild(l);const c=document.createTextNode("Add hook");o.appendChild(c);const d=document.createElement("td");l.appendChild(d);const h=document.createElement("td");l.appendChild(h);const u=document.createElement("td");l.appendChild(u);const p=document.createTextNode("Provider");d.appendChild(p);const m=document.createTextNode("URL");h.appendChild(m);const f=document.createTextNode("Show secret");u.appendChild(f);const g={table:t,add:o};return{root:e,refs:g,ref:e=>{if(!g[e])throw new Error(`Missing handle: '${e}'`);return g[e]},update:()=>{}}}();this.el=t,this.tableEl=s("table"),this.btnEl=s("add"),this.btnEl.addEventListener("click",()=>this.createWebhook()),this.dash.listenTo("webhookDeleted",e=>{const t=this.itemMap.get(e);t&&(this.tableEl.tBodies[0].removeChild(t.el),this.itemMap.delete(e))})}activate(e){this.ctrl=e,this.ctrl.setContentEl(this.el).setTitle("Github subscriptions"),this.needFetch&&this.fetchWebhooks().then(e=>this.needFetch=e).catch(e=>this.dash.log.error(e))}async fetchWebhooks(){try{const e=await fetch(this.dash.app.baseUrl+"/api/notifications/github/fetch-webhooks",{method:"post",credentials:"same-origin",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({})});if(!e.ok)return this.dash.create(I).show("Something went wrong. The server did not fulfill the request."),!1;const t=await e.json();return t.done?(this.processHooks(t.webhooks),!0):(this.dash.create(I).show("Something went wrong. We can not display hooks. Try again later."),!1)}catch(e){this.log.error("Unable to get list of hooks from server. Network error.")}return!1}processHooks(e){for(const t of e)t.inProcessing=!1,this.addHookToTable(t)}addHookToTable(e){const t=this.dash.create(Kt,e);this.itemMap.set(e.id,t),this.tableEl.tBodies[0].appendChild(t.el)}async createWebhook(){try{const e=await fetch(this.dash.app.baseUrl+"/api/notifications/github/create-webhook",{method:"post",credentials:"same-origin",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({})});if(!e.ok)return void this.dash.create(I).show("Something went wrong. Server did not fulfill our request.");const t=await e.json();if(!t.done)return void this.log.error("Something went wrong. Cannot create webhook. Try again later.");t.webhook.inProcessing=!1,this.addHookToTable(t.webhook)}catch(e){this.log.error("Unable to get list of webhooks from server. Network error.")}}}s(25);class es{constructor(e){this.dash=e,this.el=function(){const e=document.createElement("div");e.setAttribute("class","Workspace404");const t=document.createElement("span");e.appendChild(t),t.setAttribute("class","Workspace404-span");const s=document.createElement("p");e.appendChild(s),s.setAttribute("class","Workspace404-p");const n=document.createElement("i");t.appendChild(n),n.setAttribute("class","fa fa-frown-o fa-5x");const r=document.createTextNode("404: Not Found");s.appendChild(r);const i={};return{root:e,refs:i,ref:e=>{if(!i[e])throw new Error(`Missing handle: '${e}'`);return i[e]},update:()=>{}}}().root}activate(e){this.ctrl=e,e.setContentEl(this.el).setTitle("Oups!!!")}}
/* !
 * Public domain
 * © 2016 Paleo; Released under the CC0 License.
 * http://creativecommons.org/publicdomain/zero/1.0/
 * @license
 */function ts(){return ss(new is,rs)}function ss(e,t){const s={};for(const n of t)s[n]=(...t)=>e[n](...t);return s._getSource=()=>e,s}function ns(e){return e._getSource()}const rs=["addAsyncErrorListener","addRejectListener","addUnknownRouteListener","map","mapUnknownRoutes","addCanNavigateListener","removeCanNavigateListener","addNavigateListener","removeNavigateListener","navigate","navigateToUnknown","navigateBack","addCanLeaveListener","removeCanLeaveListener","addLeaveListener","removeLeaveListener"];class is{constructor(){this.isStarted=!1,this.children=[],this.routes=[],this.listeners={},this.errListeners={},this.onNavRmListeners={},this.curQuery=null,this.curActivator=null,this.curChild=null,this.working=!1}static makeCompletedQuery(e,t,s){const n=t.regexp.exec(e.queryString);if(null===n)return null;const r={},i=t.pNames.length;let o,a,l=0;for(;l<i;)o=t.pNames[l],a=n[++l],r[o]=void 0===a?void 0:decodeURIComponent(a);const c=n.length-1,d=c>i?n[c]:null,h=d?e.queryString.slice(0,-d.length):e.queryString,u={queryString:e.queryString,queryHash:e.queryHash,queryParams:e.queryParams,route:s.route,routeParams:r,processedQueryString:h,remainingQueryString:d,title:null};return e.parent&&(u.parent=e.parent),s.useQueryString&&(u.redirectedFrom=u.queryString,u.queryString=s.useQueryString),Object.freeze&&Object.freeze(u),u}static makeFinalQuery(e,t){if(!t)return e;const s={queryString:e.queryString,queryHash:e.queryHash,queryParams:e.queryParams,route:e.route,routeParams:e.routeParams,processedQueryString:e.processedQueryString,remainingQueryString:e.remainingQueryString,title:t};return e.parent&&(s.parent=e.parent),Object.freeze&&Object.freeze(s),s}static getDefaultFirstQueryString(e){if(!1!==e.hashMode){let e=window.location.hash;return e?(e.length>=1&&"#"===e[0]&&(e=e.slice(1)),e):""}const t=window.location.pathname,s=e.baseUrl.length;return t.length<=s||t.slice(0,s)!==e.baseUrl?"":t.slice(s)}static compileRoute(e){const t=[],s=e.length>0&&"*"===e[e.length-1];return s&&(e=e.slice(0,-1)),e=e.replace(/\(/g,"==par_open==").replace(/\)/g,"==par_close==").replace(/([\/\?&=])?:(\w+)/g,(function(e,s,n){return t.push(n),s||(s=""),s+"([^/\\?&=]+)"})).replace(/==par_open==/g,"(?:").replace(/==par_close==/g,")?").replace(/\*/g,"\\*"),s&&(e+="(.*)"),{regexp:new RegExp("^"+e+"$"),pNames:t,withStar:s}}start(e){if(void 0!==this.isRoot)throw Error("Cannot call start(), the router is "+(this.isRoot?"already root":"a child"));this.isStarted=!0,this.isRoot=!0,this.rootQSStack=[],this.rootBaseUrl=e.baseUrl,!1!==e.hashMode&&(this.rootBaseUrl+="#"),this.withHistory=!e.noHistory;const t=window.history.state||e.firstQueryString||is.getDefaultFirstQueryString(e);this.withHistory&&(window.onpopstate=this.makeOnPopState(),window.onhashchange=this.makeOnHashChange());for(let e=0,t=this.children.length;e<t;++e)this.children[e].startAsChild(this,this.withHistory);return this.doNavigate(t,!1).then(e=>{if(!e)throw this.callOnRejectCb(Error(`Fail to navigate to the first URL: "${t}"`));this.withHistory&&this.curQuery&&window.history.replaceState(this.curQuery.redirectedFrom||this.curQuery.queryString,this.curQuery.title||"",this.toUrl(this.curQuery.queryString,null))})}addAsyncErrorListener(e){return this.doAddErrorListener("asyncError",e)}addRejectListener(e){return this.doAddErrorListener("reject",e)}addUnknownRouteListener(e){return this.doAddErrorListener("unknownRoute",e)}map(...e){let t,s;for(let n=0,r=e.length;n<r;++n){if(t=e[n],"string"==typeof t.route)s=is.compileRoute(t.route);else{if(!t.canActivate)throw Error("Missing route: "+JSON.stringify(t));s=null}if(Object.freeze&&Object.freeze(t),this.routes.push({activator:t,compiledRoute:s}),t.child){const e=ns(t.child);this.children.push(e),this.isStarted&&e.startAsChild(this,this.withHistory)}}return this}mapUnknownRoutes(e){return Object.freeze&&Object.freeze(e),this.unknownActivator=e,this}parentNavigateToUnknown(e){return this.doNavigate(null,e,null,null,!0)}startAsChild(e,t){if(this.isRoot)throw Error("Cannot call startAsChild() on the root router");if(this.parent){if(this.parent!==e)throw Error("Router cannot have several parents")}else{this.isStarted=!0,this.parent=e,this.isRoot=!1,this.withHistory=t;for(let e=0,t=this.children.length;e<t;++e)this.children[e].startAsChild(this,this.withHistory)}}childNavigate(e,t,s,n){return this.doNavigate(e,t,s,n)}leaveChildRouter(){return this.curQuery?this.canLeaveCurrent().then(e=>!!e&&this.setNewQuery(null,null).then(()=>!0)):Promise.resolve(!0)}navigate(e){return this.doNavigate(e,!0)}navigateToUnknown(){return this.doNavigate(null,!0)}navigateBack(e=1){if(!this.isRoot)throw Error("Method navigateBack() is available for root router only");if(0===e)return Promise.resolve(!0);if(e<0)return Promise.resolve(!1);const t=this.rootQSStack[this.rootQSStack.length-e-1];return void 0===t?Promise.resolve(!1):this.doNavigate(t,!0)}addCanLeaveListener(e,t=!1){return this.addListener("canLeave",e,t)}removeCanLeaveListener(e){return this.removeListener("canLeave",e)}addLeaveListener(e,t=!1){return this.addListener("leave",e,t)}removeLeaveListener(e){return this.removeListener("leave",e)}addCanNavigateListener(e,t=!1){return this.addListener("canNavigate",e,t)}removeCanNavigateListener(e){return this.removeListener("canNavigate",e)}addNavigateListener(e,t=!1){return this.addListener("navigate",e,t)}removeNavigateListener(e){return this.removeListener("navigate",e)}fireErrorListeners(e,...t){const s=this.listeners[e];if(void 0!==s){for(const n in s)if(s.hasOwnProperty(n))try{s[n](...t)}catch(t){"asyncError"!==e?this.fireErrorListeners("asyncError",t):"undefined"!=typeof console&&console.log(t.message,t.stack)}}else this.parent&&this.parent.fireErrorListeners(e,...t)}doNavigate(e,t,s=null,n=null,r=!1){if(!r){if(this.working)return Promise.resolve(!1);this.working=!0}this.isRoot&&this.rootQSStack.push(e);const i=this.makeQuery(e,n);if(this.curQuery&&this.curQuery.queryString===i.queryString)return this.working=!1,Promise.resolve(!0);let o=this.canLeaveCurrent();return o=o.then(e=>!!e&&this.searchRoute(i).then(e=>null===e?!!this.parent&&this.parent.parentNavigateToUnknown(t):this.fireListeners("canNavigate",e.completedQuery,!0).then(r=>!!r&&(e.activator.redirectTo?this.doNavigate(e.activator.redirectTo,t,s,n):this.doNavigateToMatching(e,t,s))))),r||(o=o.then(e=>(this.working=!1,e),e=>{throw this.working=!1,e})),o}canLeaveCurrent(){const e=[];if(this.curActivator&&this.curActivator.canDeactivate){let t;try{t=this.curActivator.canDeactivate()}catch(e){this.callOnRejectCb(e,this.curQuery),t=!1}if(!t)return Promise.resolve(!1);!0!==t&&e.push(t)}return e.push(this.fireListeners("canLeave",void 0,!0)),Promise.all(e).then(e=>{for(let t=0,s=e.length;t<s;++t)if(!e[t])return!1;return!0})}doNavigateToMatching(e,t,s){const n=e.activator,r=e.completedQuery;let i;if(n.child){const e=ns(n.child);return n===this.unknownActivator&&this.callUnknownRouteCb(r),i=this.curChild&&this.curChild!==e?this.curChild.leaveChildRouter():Promise.resolve(!0),i.then(s=>{if(!s)return!1;if(n.activate){this.wrapUserCbOnErrorReject(n.activate,this.curQuery,this.curQuery)}const i=this.toUrl(r.processedQueryString,null),o=r.remainingQueryString;return e.childNavigate(o,t,i,r).then(t=>(this.curChild=e,t?this.setNewQuery(r,n).then(()=>t):t))})}return this.curChild?(i=this.curChild.leaveChildRouter(),this.curChild=null):i=Promise.resolve(!0),i.then(e=>{if(!e)return!1;let i;i=n.title?"string"==typeof n.title?n.title:this.wrapUserCbOnErrorReject(n.title,r,r):null;const o=is.makeFinalQuery(r,i);return n===this.unknownActivator&&this.callUnknownRouteCb(o),this.setNewQuery(o,n).then(()=>{t&&this.pushState(this.curQuery,s),document.title=this.curQuery.title||"SmallTeam";const e=this.wrapUserCbOnErrorReject(n.activate,this.curQuery,this.curQuery);return!e||e.then(()=>!0)})})}pushState(e,t){if(!this.withHistory)return;let s=e;for(;s.parent;)s=s.parent;window.history.pushState(s.redirectedFrom||s.queryString,e.title||"",this.toUrl(e.queryString,t))}toUrl(e,t){let s=e||"";return s=t?t+s:s,this.rootBaseUrl?this.rootBaseUrl+s:s}setNewQuery(e,t){let s=null;if(this.curActivator&&this.curActivator.deactivate){const t=this.wrapUserCbOnErrorReject(this.curActivator.deactivate,e);t&&(s=t)}this.curActivator=t,this.curQuery=e,this.fireListeners("leave",void 0,!1).catch(e=>{this.fireErrorListeners("asyncError",e)}),e&&this.fireListeners("navigate",e,!1).catch(e=>{this.fireErrorListeners("asyncError",e)});for(const e in this.onNavRmListeners)this.onNavRmListeners.hasOwnProperty(e)&&this.removeListener(this.onNavRmListeners[e].type,this.onNavRmListeners[e].handle);return s||Promise.resolve()}searchRoute(e){const t=[];let s,n,r,i;if(null!==e.queryString)for(const o in this.routes)if(this.routes.hasOwnProperty(o)&&(s=this.routes[o],n=this.matchActivator(e,s.activator,s.compiledRoute),r=n[0],!1!==r)){if(i=n[1],!0===r){if(0===t.length)return Promise.resolve(i);t.push([Promise.resolve(!0),i]);break}t.push([r,i])}this.unknownActivator&&(n=this.matchActivator(e,this.unknownActivator),r=n[0],!1!==r&&(i=n[1],t.push([!0===r?Promise.resolve(!0):r,i])));const o=function(e,t){return function(s){return s?e:t}};let a,l=Promise.resolve(null);for(let e=t.length-1;e>=0;--e)a=t[e],l=a[0].then(o(a[1],l));return l}matchActivator(e,t,s=null){let n;if(s){if(n=is.makeCompletedQuery(e,s,t),!n)return[!1]}else n=e;const r={completedQuery:n,activator:t,compiledRoute:s};if(!t.canActivate)return[!0,r];return[this.wrapUserCbOnErrorReject(t.canActivate,n,n),r]}makeQuery(e,t){let s,n;if(null==e)e=null,s=null,n=null;else{if(this.curQuery&&this.curQuery.queryString===e)return this.curQuery;const t=e.indexOf("#");s=-1===t?null:e.slice(t+1),""===s&&(s=null);const r=e.indexOf("?");if(-1===r)n=null;else{const s=(-1===t?e.slice(r+1):e.slice(r+1,t)).split("&");let i;n={};for(let e=0,t=s.length;e<t;++e)i=s[e].split("="),n[i[0]]=i[1]||""}}const r={queryString:e,queryHash:s,queryParams:n};return t&&(r.parent=t),Object.freeze&&Object.freeze(r),r}doAddErrorListener(e,t){let s=this.errListeners[e];void 0===s&&(s=this.listeners[e]=[]);const n=s.length;return s[n]=t,n}addListener(e,t,s=!1){let n=this.listeners[e];void 0===n&&(n=this.listeners[e]=[]);const r=n.length;return n[r]=t,s&&(this.onNavRmListeners[e+"~"+r]={type:e,handle:r}),r}removeListener(e,t){const s=this.listeners[e];if(void 0===s||void 0===s[t])throw Error(`Unknown listener "${e}": "${t}"`);delete s[t];const n=e+"~"+t;this.onNavRmListeners[n]&&delete this.onNavRmListeners[n]}fireListeners(e,t,s){const n=this.listeners[e];if(void 0===n)return s?Promise.resolve(!0):Promise.resolve();const r=[];for(const e in n)n.hasOwnProperty(e)&&r.push(void 0===t?n[e]():n[e](t));let i=Promise.all(r);return s&&(i=i.then((function(e){for(let t=0,s=e.length;t<s;++t)if(!e[t])return!1;return!0}))),i}makeOnPopState(){return e=>{if(null!==e.state&&void 0!==e.state)try{this.doNavigate(e.state,!1)}catch(e){this.fireErrorListeners("asyncError",e)}}}makeOnHashChange(){return()=>{try{let e=window.location.hash;e.length>=1&&"#"===e[0]&&(e=e.slice(1)),this.doNavigate(e,!1)}catch(e){this.fireErrorListeners("asyncError",e)}}}callUnknownRouteCb(e){try{this.fireErrorListeners("unknownRoute",e)}catch(e){this.fireErrorListeners("asyncError",e)}}wrapUserCbOnErrorReject(e,t,s){let n;try{n=void 0===s?e():e(s)}catch(e){throw this.callOnRejectCb(e,t)}return"object"==typeof n&&n.then&&n.catch&&(n=n.catch(e=>{throw this.callOnRejectCb(e)})),n}callOnRejectCb(e,t){try{this.fireErrorListeners("reject",e,t)}catch(e){this.fireErrorListeners("asyncError",e)}return e}}s(26);class os{constructor(e){this.dash=e,this.symb404=Symbol("404"),this.workspaces=new Map,e.exposeEvent("navigate");const{root:t,ref:s}=function(){const e=document.createElement("section");e.setAttribute("class","WorkspaceViewer");const t=document.createElement("header");e.appendChild(t),t.setAttribute("class","WorkspaceViewer-title TitleBar");const s=document.createElement("div");e.appendChild(s),s.setAttribute("class","WorkspaceViewer-body");const n=document.createElement("div");t.appendChild(n),n.setAttribute("class","Row");const r=document.createElement("h1");n.appendChild(r);const i=document.createElement("span");n.appendChild(i),i.setAttribute("class","DropdownMenuWrapper -asSuffix");const o={titleBar:t,body:s,h1:r,customMenu:i};return{root:e,refs:o,ref:e=>{if(!o[e])throw new Error(`Missing handle: '${e}'`);return o[e]},update:()=>{}}}();this.el=t,this.h1El=s("h1"),this.customMenuPlaceEl=s("customMenu"),this.bodyEl=s("body"),this.router=ss(new is,[...rs,"start"]),this.router.addAsyncErrorListener(t=>e.log.error(t)),this.router.addNavigateListener(t=>{e.emit("navigate",t)})}start(){this.router.start({baseUrl:this.dash.app.baseUrl+"/",hashMode:!0,firstQueryString:""})}addHomeWorkspace(e,t,s){const n=s||"";this.workspaces.set(n,{workspace:t,path:n,defaultTitle:e}),this.router.map({route:n,activate:()=>{this.activateWorkspace(n)}})}add404Workspace(e,t){this.workspaces.set(this.symb404,{workspace:t,defaultTitle:e}),this.router.mapUnknownRoutes({useQueryString:"404",activate:()=>{this.activateWorkspace(this.symb404)},title:e})}addWorkspace(e,t,s,n){this.workspaces.set(e,{workspace:n,path:e,menu:t,defaultTitle:s}),this.router.map({route:e,activate:()=>{this.activateWorkspace(e)},title:s}),n.childRouter&&this.router.map({route:e+"/*",child:n.childRouter,activate:()=>{this.activateWorkspace(e)}})}removeWorkspace(e){const t=this.workspaces.get(e);t&&(this.workspaces.delete(e),t===this.currentWInfo&&this.router.navigate(""))}activateWorkspace(e){const t=this.workspaces.get(e);if(!t)throw new Error("Unknown workspace path: "+("string"==typeof e?e:"(symbol)"));this.currentWInfo&&(this.currentWInfo.workspace.deactivate&&this.currentWInfo.workspace.deactivate(),this.h1El.textContent=t.defaultTitle,p(this.bodyEl),p(this.customMenuPlaceEl)),this.showTitleBar(!0),t.workspace.activate(this.createViewController()),this.currentWInfo=t}createViewController(){const e={showTitleBar:t=>(this.showTitleBar(t),e),setTitle:t=>(this.showTitleBar(!0),this.h1El.textContent=t,e),setContentEl:t=>(p(this.bodyEl),this.bodyEl.appendChild(t),e),setTitleRightEl:t=>(p(this.customMenuPlaceEl),this.customMenuPlaceEl.appendChild(t),e)};return e}showTitleBar(e){e?this.el.classList.remove("-noTitleBar"):this.el.classList.add("-noTitleBar")}}s(27);class as{constructor(e,t){this.dash=e;const{root:s,ref:n}=function(){const e=document.createElement("div");e.setAttribute("class","ImagePicker"),e.setAttribute("title","Click to change");const t=document.createElement("input");e.appendChild(t),t.setAttribute("type","file"),t.setAttribute("accept","image/png, image/jpeg, image/webp, image/gif, image/svg+xml"),t.setAttribute("hidden","");const s={input:t};return{root:e,refs:s,ref:e=>{if(!s[e])throw new Error(`Missing handle: '${e}'`);return s[e]},update:()=>{}}}();this.el=s,this.inputEl=n("input"),this.el.style.width=t.width+"px",this.el.style.height=t.height+"px",this.el.addEventListener("click",()=>this.inputEl.click()),this.inputEl.addEventListener("change",()=>this.onImageChange())}setImage(e){this.el.style.backgroundImage=e}onImageChange(){const e=this.inputEl.files;if(!e||0===e.length)return;const t=e.item(0);if(!t)return;const s=URL.createObjectURL(t);this.el.style.backgroundImage=`url("${s}")`,this.dash.emit("changed",{imgURL:s,f:t})}}s(28);class ls{constructor(){const{root:e,ref:t}=function(){const e=document.createElement("div");e.setAttribute("class","PasswordEdit FieldGroup");const t=document.createElement("label");e.appendChild(t),t.setAttribute("class","FieldGroup-item Field");const s=document.createElement("label");e.appendChild(s),s.setAttribute("class","FieldGroup-item Field");const n=document.createElement("span");t.appendChild(n),n.setAttribute("class","Field-lbl");const r=document.createElement("input");t.appendChild(r),r.setAttribute("class","Field-input"),r.setAttribute("type","password");const i=document.createElement("span");s.appendChild(i),i.setAttribute("class","Field-lbl");const o=document.createElement("input");s.appendChild(o),o.setAttribute("class","Field-input"),o.setAttribute("type","password");const a=document.createTextNode("Password");n.appendChild(a);const l=document.createTextNode("Confirm password");i.appendChild(l);const c={primary:r,confirm:o};return{root:e,refs:c,ref:e=>{if(!c[e])throw new Error(`Missing handle: '${e}'`);return c[e]},update:()=>{}}}();this.el=e,this.primaryEl=t("primary"),this.confirmEl=t("confirm")}focus(){this.primaryEl.focus()}clear(){this.primaryEl.value="",this.confirmEl.value=""}passwordsMatch(){return this.confirmEl.value===this.primaryEl.value}getPasswordIfMatch(){const e=this.primaryEl.value;return e===this.confirmEl.value?e:void 0}getPassword(){return this.primaryEl.value}hasPassword(){return""!==this.getPassword()}}var cs=s(4);s(29);class ds{constructor(e,t=!0){this.dash=e,this.state={login:"",name:"",email:"",role:""},this.canClearForm=!1,this.model=this.dash.app.model,this.log=this.dash.app.log;const{root:s,ref:n,update:r}=function(e){const t=new Map,s=e=>{let s=t.get(e);return s||(s=[],t.set(e,s)),s},n=document.createElement("section");n.setAttribute("class","AccountForm");const r=document.createElement("h1");n.appendChild(r),r.setAttribute("class","TitleBar");const i=document.createElement("fieldset");n.appendChild(i),i.setAttribute("class","FieldGroup");const o=document.createTextNode("Account details");r.appendChild(o);const a=document.createElement("label");i.appendChild(a),a.setAttribute("class","FieldGroup-item Field");const l=document.createElement("label");i.appendChild(l),l.setAttribute("class","FieldGroup-item Field");const c=document.createElement("label");i.appendChild(c),c.setAttribute("class","FieldGroup-item Field");const d=document.createElement("label");i.appendChild(d),d.setAttribute("class","FieldGroup-item Field");const h=document.createElement("div");i.appendChild(h),h.setAttribute("class","FieldGroup-item");const u=document.createElement("div");i.appendChild(u),u.setAttribute("class","FieldGroup-action");const p=document.createElement("span");a.appendChild(p),p.setAttribute("class","Field-lbl");const m=document.createElement("input");a.appendChild(m),m.setAttribute("class","Field-input"),m.setAttribute("type","text"),s("name").push(e=>m.setAttribute("value",e));const f=document.createElement("span");l.appendChild(f),f.setAttribute("class","Field-lbl");const g=document.createElement("input");l.appendChild(g),g.setAttribute("class","Field-input"),g.setAttribute("type","text"),s("login").push(e=>g.setAttribute("value",e));const b=document.createElement("span");c.appendChild(b),b.setAttribute("class","Field-lbl");const w=document.createElement("input");c.appendChild(w),w.setAttribute("class","Field-input"),w.setAttribute("type","email"),s("email").push(e=>w.setAttribute("value",e)),w.setAttribute("placeholder","john.doe@example.com");const v=document.createElement("span");d.appendChild(v),v.setAttribute("class","Field-lbl");const y=document.createElement("select");d.appendChild(y),y.setAttribute("class","Field-input");const E=document.createElement("button");u.appendChild(E),E.setAttribute("class","Btn WithLoader -right"),E.setAttribute("type","button");const k=document.createTextNode("Name");p.appendChild(k);const C=document.createTextNode("Login");f.appendChild(C);const _=document.createTextNode("Email");b.appendChild(_);const T=document.createTextNode("Role");v.appendChild(T);const S=document.createElement("option");y.appendChild(S),S.setAttribute("value","admin");const A=document.createElement("option");y.appendChild(A),A.setAttribute("value","contrib"),A.setAttribute("selected","selected");const x=document.createTextNode("\n        Save changes ");E.appendChild(x);const M=document.createElement("span");E.appendChild(M),M.setAttribute("class","WithLoader-l"),M.setAttribute("hidden","");const L=document.createTextNode("Admin");S.appendChild(L);const I=document.createTextNode("Contributor");A.appendChild(I);const P={header:r,fieldset:i,password:h,name:m,login:g,email:w,role:y,submitBtn:E,submitSpinner:M},j=e=>{for(const[s,n]of t.entries())s in e&&n.forEach(t=>t(e[s]))};return e&&j(e),{root:n,refs:P,ref:e=>{if(!P[e])throw new Error(`Missing handle: '${e}'`);return P[e]},update:j}}(this.state);this.update=r,this.el=s,this.fieldsetEl=n("fieldset"),this.nameEl=n("name"),this.loginEl=n("login"),this.emailEl=n("email"),this.roleEl=n("role"),this.submitSpinnerEl=n("submitSpinner"),n("submitBtn").addEventListener("click",()=>this.onSubmit()),this.passwordEdit=this.dash.create(ls),"admin"===this.model.session.account.role&&t&&n("password").appendChild(this.passwordEdit.el),this.dash.listenToModel("updateAccount",e=>this.onAccountUpdate(e.model)),this.dash.listenToModel("endProcessingAccount",e=>this.onEndProcessing(e.model)),this.dash.listenToModel("processingAccount",e=>this.onProcessing(e.model))}reset(){this.account=void 0,this.resetState(),this.update(this.state),this.unlockForm(),this.nameEl.focus()}setAccount(e){if(!e)return this.canClearForm=!1,void this.reset();this.account=e,this.state=e.updateTools.toFragment("update"),this.update(this.state),this.roleEl.value=this.state.role,this.passwordEdit.clear(),e.updateTools.processing?this.lockForm():this.unlockForm()}getAccount(){return this.account}async onSubmit(){const e=this.checkUserInput();if(!e)return;if(!this.account)return this.canClearForm=!0,void await this.createAccount(e);if("admin"===this.model.session.account.role&&this.passwordEdit.hasPassword()){if(!this.passwordEdit.passwordsMatch())return await this.dash.create(P).show("Passwords do not match."),void this.passwordEdit.focus();const e=this.passwordEdit.getPassword(),t=Object(cs.whyNewPasswordIsInvalid)(e);if(t)return await this.dash.create(P).show(t),void this.passwordEdit.focus();await this.updatePassword(this.account.id,this.account.login,e),this.passwordEdit.clear()}const t=this.account.id,s=this.account.updateTools.getDiffToUpdate({id:t,...e});!s||0===Object.keys(s).length&&s.constructor===Object||await this.updateAccount({...s,id:t})}onProcessing(e){this.account&&this.account.id===e.id&&this.lockForm()}onEndProcessing(e){this.account&&this.account.id===e.id&&this.unlockForm()}onAccountUpdate(e){this.account&&this.account.id===e.id&&(this.canClearForm=!1,this.state=e.updateTools.toFragment("update"),this.update(this.state),this.roleEl.value=this.state.role,this.passwordEdit.clear())}async createAccount(e){this.lockForm();try{if(await this.model.exec("create","Account",e),this.canClearForm)return void this.reset()}catch(e){this.log.error("Unable to create new account...",e)}this.unlockForm()}async updateAccount(e){if(this.account){this.lockForm();try{await this.model.exec("update","Account",e)}catch(e){this.log.error("Unable to update account...")}this.unlockForm()}}async updatePassword(e,t,s){try{const t=await fetch(this.dash.app.baseUrl+"/api/registration/set-password",{method:"post",credentials:"same-origin",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({accountId:e,password:s})});if(!t.ok)return void this.dash.log.warn("Unable to get a response from server.");(await t.json()).done?this.dash.log.info("Password successfully updated."):this.dash.log.error("Password not changed.")}catch(e){this.dash.log.error(`Impossible to change the password for user '${t}'. Error on server`)}}checkUserInput(){const e={name:this.nameEl.value.trim(),login:this.loginEl.value.trim(),email:this.emailEl.value.trim(),role:this.roleEl.value};if(e.name.length<1)return this.log.warn("Name should have at least one character..."),void this.nameEl.focus();const t=Object(cs.whyUsernameIsInvalid)(e.login);return t?(this.log.warn(t),void this.loginEl.focus()):this.checkEmail(e.email)?"admin"!==e.role&&"contrib"!==e.role?(this.log.warn("Account role not defined..."),void this.roleEl.focus()):e:(this.log.warn("Invalid email..."),void this.emailEl.focus())}resetState(){this.state.login="",this.state.email="",this.state.name="",this.state.role=""}checkEmail(e){return e.length>0&&e.length<=254&&function(e){return null!==/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.exec(e)}(e)}showIndicator(){this.submitSpinnerEl.hidden=!1}hideIndicator(){this.submitSpinnerEl.hidden=!0}lockForm(){this.fieldsetEl.disabled=!0,this.showIndicator()}unlockForm(){this.fieldsetEl.disabled=!1,this.hideIndicator()}}class hs{constructor(e,t){this.dash=e,this.account=t,this.log=this.dash.app.log;const{root:s,ref:n}=function(){const e=document.createElement("div"),t=document.createElement("h1");e.appendChild(t),t.setAttribute("class","TitleBar");const s=document.createElement("div");e.appendChild(s),s.setAttribute("class","FieldGroup");const n=document.createTextNode("Change your password");t.appendChild(n);const r=document.createElement("label");s.appendChild(r),r.setAttribute("class","FieldGroup-item Field");const i=document.createElement("div");s.appendChild(i),i.setAttribute("class","FieldGroup-item");const o=document.createElement("div");s.appendChild(o),o.setAttribute("class","FieldGroup-action");const a=document.createElement("span");r.appendChild(a),a.setAttribute("class","Field-lbl");const l=document.createElement("input");r.appendChild(l),l.setAttribute("class","Field-input"),l.setAttribute("type","password");const c=document.createElement("button");o.appendChild(c),c.setAttribute("class","Btn"),c.setAttribute("type","button");const d=document.createTextNode("\n       \n      ");o.appendChild(d);const h=document.createElement("button");o.appendChild(h),h.setAttribute("class","Btn WithLoader -right"),h.setAttribute("type","button");const u=document.createTextNode("Current password");a.appendChild(u);const p=document.createTextNode("Cancel");c.appendChild(p);const m=document.createTextNode("\n        Submit\n        ");h.appendChild(m);const f=document.createElement("span");h.appendChild(f),f.setAttribute("class","WithLoader-l"),f.setAttribute("hidden","");const g={field:i,actions:o,currentPassword:l,cancelBtn:c,submitBtn:h,spinner:f};return{root:e,refs:g,ref:e=>{if(!g[e])throw new Error(`Missing handle: '${e}'`);return g[e]},update:()=>{}}}();this.el=s,this.currentPasswordEl=n("currentPassword"),this.spinnerEl=n("spinner"),this.passwordEdit=this.dash.create(ls),n("field").appendChild(this.passwordEdit.el),n("submitBtn").addEventListener("click",()=>this.onSubmit()),n("cancelBtn").addEventListener("click",()=>this.onCancel())}async onSubmit(){const e=await this.checkUserInput();e&&(this.showSpinner(),await this.doPasswordUpdate(e.currentPassword,e.newPassword),this.hideSpinner())}async checkUserInput(){const e=this.currentPasswordEl.value,t=this.passwordEdit.getPasswordIfMatch();if(!t)return await this.dash.create(Xt).show("Passwords do not match."),void this.passwordEdit.focus();const s=Object(cs.whyNewPasswordIsInvalid)(t);return s?(await this.dash.create(Xt).show(s),void this.passwordEdit.focus()):{currentPassword:e,newPassword:t}}async doPasswordUpdate(e,t){try{const s=await fetch(this.dash.app.baseUrl+"/api/registration/change-password",{method:"post",credentials:"same-origin",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({currentPassword:e,newPassword:t})});if(!s.ok)return this.log.warn("Password change request was not processed by server."),void await this.dash.create(I).show("Request was not processed by server.");if((await s.json()).done)this.clearFields(),await this.dash.create(Xt).show("Password successfully updated.");else{const e="Password was not changed. Maybe you mistyped your current password.";await this.dash.create(Xt).show(e)}}catch(e){this.log.error("Error while updating password.",e),await this.dash.create(I).show("Unable to update password.")}}onCancel(){this.clearFields()}showSpinner(){this.spinnerEl.hidden=!1}hideSpinner(){this.spinnerEl.hidden=!0}clearFields(){this.currentPasswordEl.value="",this.passwordEdit.clear()}}s(30);class us{constructor(e,t){this.dash=e,this.account=t,this.log=this.dash.app.log,this.model=this.dash.app.model;const{root:s,ref:n}=function(){const e=document.createElement("div");e.setAttribute("class","AccountHome");const t=document.createElement("div");e.appendChild(t);const s=document.createElement("div");e.appendChild(s);const n=document.createElement("h1");e.appendChild(n),n.setAttribute("class","TitleBar");const r=document.createElement("div");e.appendChild(r),r.setAttribute("class","AccountHome-avatarArea");const i=document.createTextNode("Change your profile picture");n.appendChild(i);const o={formContainer:t,pwdArea:s,avatarArea:r};return{root:e,refs:o,ref:e=>{if(!o[e])throw new Error(`Missing handle: '${e}'`);return o[e]},update:()=>{}}}();this.el=s,this.picker=this.dash.create(as,{width:128,height:128}),this.dash.listenTo(this.picker,"changed",e=>this.onAvatarChange(e));const r=this.dash.create(ds,!1),i=this.dash.create(hs,this.account);r.setAccount(this.account),n("formContainer").appendChild(r.el),n("pwdArea").appendChild(i.el),n("avatarArea").appendChild(this.picker.el),this.setPickerToAccountAvatar()}activate(e){e.setTitle("Personal space").setContentEl(this.el)}setPickerToAccountAvatar(){const e=this.model.session.account.avatar;if(e){const t=e.getVariant("orig");t&&this.picker.setImage(`url(${t.url})`)}}async onAvatarChange(e){const t={ref:{type:"accountAvatar",id:this.dash.app.model.session.account.id},overwrite:!0},s=new FormData;s.append("f",e.f),s.append("meta",JSON.stringify(t));try{const e=await fetch(this.dash.app.baseUrl+"/medias/upload",{method:"post",credentials:"same-origin",body:s});if(e.ok){const t=await e.json();t.modelUpd&&this.model.processModelUpdate(t.modelUpd),t.done?this.log.info("Avatar successfully updloaded."):this.log.error("Error while uploading image.")}else this.dash.create(I).show("Something went wrong. Try to change avatar later."),this.log.error("Unable to change avatar",e.statusText),this.setPickerToAccountAvatar()}catch(e){this.dash.create(I).show("Unable to change avatar. Network error."),this.log.error("Unable to change avatar",e)}this.setPickerToAccountAvatar()}}function ps(){return function(){const e=document.createElement("button");e.setAttribute("class","CustomMenuBtn"),e.setAttribute("type","button");const t=document.createTextNode("…");e.appendChild(t);const s={};return{root:e,refs:s,ref:e=>{if(!s[e])throw new Error(`Missing handle: '${e}'`);return s[e]},update:()=>{}}}().root}function ms(e,t,s){let n,r=10**9;for(const i of e.variants.filter(e=>e.imgWidth&&e.imgHeight)){const e=Math.abs(t-i.imgWidth)**2+Math.abs(s-i.imgHeight)**2;e<r&&(n=i,r=e)}return n}s(31);class fs{constructor(e,t){this.dash=e,this.options={account:t.account,width:t.width||48,height:t.height||48},this.el=function(){const e=document.createElement("span");e.setAttribute("class","AccountAvatar");const t={};return{root:e,refs:t,ref:e=>{if(!t[e])throw new Error(`Missing handle: '${e}'`);return t[e]},update:()=>{}}}().root,this.el.style.width=this.options.width+"px",this.el.style.height=this.options.height+"px",this.update(),this.dash.listenToModel("updateAccount",e=>{e.model.id===this.options.account.id&&this.update()})}update(){const e=this.options.account.avatar,t=e?this.findBestVariant(e):void 0;this.el.style.backgroundImage="",p(this.el),this.el.title=this.options.account.name,t?this.el.style.backgroundImage=`url(${t.url})`:this.el.textContent=this.options.account.login.charAt(0).toLocaleUpperCase()}findBestVariant(e){return ms(e,this.options.width,this.options.height)}}class gs{constructor(e,t){this.dash=e,this.account=t;const{root:s,ref:n,update:r}=function(e){const t=new Map,s=document.createElement("div");s.setAttribute("class","AccountBox");const n=document.createElement("span");s.appendChild(n);const r=document.createElement("span");s.appendChild(r),r.setAttribute("class","AccountBox-name");const i=document.createTextNode("");r.appendChild(i),(e=>{let s=t.get(e);return s||(s=[],t.set(e,s)),s})("name").push(e=>i.nodeValue=e);const o={avatar:n},a=e=>{for(const[s,n]of t.entries())s in e&&n.forEach(t=>t(e[s]))};return e&&a(e),{root:s,refs:o,ref:e=>{if(!o[e])throw new Error(`Missing handle: '${e}'`);return o[e]},update:a}}();r(this.account),this.el=s,this.el.addEventListener("click",()=>this.dash.emit("accountBoxSelected",this.account));const i=this.dash.create(fs,{account:this.account,height:16,width:16});n("avatar").appendChild(i.el),this.dash.listenToModel("updateAccount",e=>{e.model.id===this.account.id&&r(this.account)})}get id(){return this.account.id}setWithFocus(e){e?this.el.classList.add("focus"):this.el.classList.remove("focus")}}s(32);class bs{constructor(e){this.dash=e,this.accounts=new Map,this.boxes=new Map,this.model=this.dash.app.model,this.log=this.dash.app.log;const{root:t,ref:s}=function(){const e=document.createElement("section");e.setAttribute("class","AccountWorkspace");const t=document.createElement("div");e.appendChild(t);const s=document.createElement("div");e.appendChild(s);const n={list:t,form:s};return{root:e,refs:n,ref:e=>{if(!n[e])throw new Error(`Missing handle: '${e}'`);return n[e]},update:()=>{}}}();this.el=t,this.form=this.dash.create(ds),s("form").appendChild(this.form.el),this.boxList=this.dash.create(Vt,{id:"accountBoxList",title:"Accounts",sort:!1}),s("list").appendChild(this.boxList.el),this.menu=this.dash.create(O,{btnEl:ps(),align:"left"}),this.menu.entries.createNavBtn({label:"Add account",onClick:()=>this.form.reset()}),this.dash.listenToModel("createAccount",e=>{const t=e.model,s=this.createBoxFor(t);this.accounts.set(t.id,t),this.boxList.addBox(s)}),this.dash.listenTo("accountBoxSelected",e=>{this.form.setAccount(e)}),this.fillBoxList(),this.childRouter=ts(),this.childRouter.addAsyncErrorListener(e=>this.log.error(e)),this.childRouter.map({route:"my-profile",activate:()=>{this.form.setAccount(this.model.session.account)},title:"My Profile"})}activate(e){e.setContentEl(this.el).setTitleRightEl(this.menu.btnEl).setTitle("Accounts")}fillBoxList(){this.model.global.accounts.forEach(e=>{const t=this.createBoxFor(e);this.accounts.set(e.id,e),this.boxList.addBox(t)})}createBoxFor(e){const t=this.dash.create(gs,e);return this.boxes.set(e.id,t),t}}class ws{constructor(e,t){this.dash=e,this.flag=t;const{root:s,ref:n,update:r}=function(e){const t=new Map,s=document.createElement("div");s.setAttribute("class","FlagBox");const n=document.createElement("span");s.appendChild(n),n.setAttribute("class","FlagBox-span");const r=document.createTextNode("\n   \n  ");s.appendChild(r);const i=document.createElement("span");s.appendChild(i),i.setAttribute("class","fa fa-circle fa-1x");const o=document.createTextNode("");n.appendChild(o),(e=>{let s=t.get(e);return s||(s=[],t.set(e,s)),s})("label").push(e=>o.nodeValue=e);const a={boxColor:i},l=e=>{for(const[s,n]of t.entries())s in e&&n.forEach(t=>t(e[s]))};return e&&l(e),{root:s,refs:a,ref:e=>{if(!a[e])throw new Error(`Missing handle: '${e}'`);return a[e]},update:l}}(),i=n("boxColor");this.el=s,i.style.color=this.flag.color,this.el.addEventListener("click",()=>this.dash.emit("flagBoxSelected",this.flag)),r(this.flag),this.dash.listenToModel("updateFlag",e=>{e.model.id===this.flag.id&&(r(this.flag),i.style.color=this.flag.color)})}setWithFocus(e){e?this.el.classList.add("focus"):this.el.classList.remove("focus")}get id(){return this.flag.id}}class vs{constructor(e){this.dash=e,this.frag={label:"",color:"#000",orderNum:""},this.canClearForm=!1,this.model=this.dash.app.model,this.log=this.dash.app.log;const{root:t,ref:s,update:n}=function(e){const t=new Map,s=e=>{let s=t.get(e);return s||(s=[],t.set(e,s)),s},n=document.createElement("div");n.setAttribute("class","FlagForm");const r=document.createElement("fieldset");n.appendChild(r),r.setAttribute("class","FieldGroup");const i=document.createElement("label");r.appendChild(i),i.setAttribute("class","FieldGroup-item Field");const o=document.createElement("label");r.appendChild(o),o.setAttribute("class","FieldGroup-item Field");const a=document.createElement("label");r.appendChild(a),a.setAttribute("class","FieldGroup-item Field");const l=document.createElement("div");r.appendChild(l),l.setAttribute("class","FieldGroup-action");const c=document.createElement("span");i.appendChild(c),c.setAttribute("class","Field-lbl");const d=document.createElement("input");i.appendChild(d),d.setAttribute("class","Field-input"),d.setAttribute("type","text"),d.setAttribute("required",""),s("label").push(e=>d.setAttribute("value",e));const h=document.createElement("span");o.appendChild(h),h.setAttribute("class","Field-lbl");const u=document.createElement("input");o.appendChild(u),u.setAttribute("class","Field-input"),u.setAttribute("type","color"),s("color").push(e=>u.setAttribute("value",e));const p=document.createElement("span");a.appendChild(p),p.setAttribute("class","Field-lbl");const m=document.createElement("input");a.appendChild(m),m.setAttribute("class","Field-input"),m.setAttribute("type","number"),m.setAttribute("disabled",""),s("orderNum").push(e=>m.setAttribute("value",e));const f=document.createElement("button");l.appendChild(f),f.setAttribute("class","Btn"),f.setAttribute("type","button");const g=document.createElement("button");l.appendChild(g),g.setAttribute("class","Btn WithLoader -right"),g.setAttribute("type","button");const b=document.createTextNode("Label");c.appendChild(b);const w=document.createTextNode("Color");h.appendChild(w);const v=document.createTextNode("Index");p.appendChild(v);const y=document.createTextNode("Cancel");f.appendChild(y);const E=document.createTextNode("\n        Submit\n        ");g.appendChild(E);const k=document.createElement("span");g.appendChild(k),k.setAttribute("class","WithLoader-l"),k.setAttribute("hidden","");const C={fieldset:r,label:d,color:u,orderNum:m,cancelBtn:f,submitBtn:g,spinner:k},_=e=>{for(const[s,n]of t.entries())s in e&&n.forEach(t=>t(e[s]))};return e&&_(e),{root:n,refs:C,ref:e=>{if(!C[e])throw new Error(`Missing handle: '${e}'`);return C[e]},update:_}}();this.update=n,this.el=t,this.fieldsetEl=s("fieldset"),this.labelEl=s("label"),this.colorEl=s("color"),this.orderNumEl=s("orderNum"),this.spinnerEl=s("spinner"),s("submitBtn").addEventListener("click",()=>this.onSubmit()),this.dash.listenToModel("deleteFlag",e=>{const t=e.id;this.flag&&this.flag.id===t&&this.reset()}),this.dash.listenToModel("updateFlag",e=>{const t=e.id;this.flag&&this.flag.id===t&&this.updateView()}),this.dash.listenToModel("endProcessingAccount",e=>this.onEndProcessing(e.model)),this.dash.listenToModel("processingAccount",e=>this.onProcessing(e.model))}getFlag(){return this.flag}setFlag(e){this.canClearForm=!1,this.flag=e,this.updateView()}reset(){this.flag=void 0,this.frag.color="#000000",this.frag.label="",this.frag.orderNum="",this.update(this.frag)}switchToCreationMode(){this.reset(),this.labelEl.focus()}updateView(){this.flag&&(this.frag.color=this.flag.color,this.frag.label=this.flag.label,this.frag.orderNum=(this.flag.orderNum||"").toString(),this.update(this.frag))}onProcessing(e){this.flag&&this.flag.id===e.id&&this.lockForm()}onEndProcessing(e){this.flag&&this.flag.id===e.id&&this.unlockForm()}onSubmit(){const e=this.labelEl.value.trim(),t=this.colorEl.value.trim();if(this.checkUserInput(e,t))if(this.flag){const s=this.flag.id,n=this.flag.updateTools.getDiffToUpdate({id:s,label:e,color:t});!n||0===Object.keys(n).length&&n.constructor===Object||this.updateFlag({...n,id:s}).catch(e=>this.dash.log.error(e))}else this.canClearForm=!0,this.createFlag({label:e,color:t}).catch(e=>this.dash.log.error(e))}checkUserInput(e,t){return e.length<1?(this.log.warn("Label should have at least one character..."),this.labelEl.focus(),!1):""!==t||(this.log.warn("Please select a color..."),this.colorEl.focus(),!1)}async createFlag(e){this.showSpinner();try{await this.model.exec("create","Flag",e),this.canClearForm&&this.reset()}catch(e){this.log.error("Unable to create new flag...",e),this.labelEl.focus()}this.hideSpinner()}async updateFlag(e){if(this.showSpinner(),this.flag){try{await this.model.exec("update","Flag",e),this.updateView()}catch(e){this.log.error("Unable to update account...")}this.hideSpinner()}}lockForm(){this.fieldsetEl.disabled=!0,this.showSpinner()}unlockForm(){this.fieldsetEl.disabled=!1,this.hideSpinner()}showSpinner(){this.spinnerEl.hidden=!1}hideSpinner(){this.spinnerEl.hidden=!0}}class ys{constructor(e){this.dash=e,this.model=this.dash.app.model,this.log=this.dash.app.log;const{root:t,ref:s}=function(){const e=document.createElement("div");e.setAttribute("class","FlagWorkspace");const t=document.createElement("div");e.appendChild(t);const s=document.createElement("div");e.appendChild(s);const n={list:t,form:s};return{root:e,refs:n,ref:e=>{if(!n[e])throw new Error(`Missing handle: '${e}'`);return n[e]},update:()=>{}}}();this.el=t,this.boxList=this.dash.create(Vt,{title:"Flags",sort:!0}),s("list").appendChild(this.boxList.el),this.form=this.dash.create(vs),s("form").appendChild(this.form.el),this.menu=this.dash.create(O,{btnEl:ps(),align:"left"}),this.menu.entries.createNavBtn({label:"Add new flag",onClick:()=>this.form.switchToCreationMode()}),this.fillBoxList(),this.dash.listenTo("flagBoxSelected",e=>this.form.setFlag(e)),this.dash.listenTo("boxListSortingUpdated",e=>this.scheduleFlagReordering(e)),this.dash.listenToModel("deleteFlag",e=>this.boxList.removeBox(e.id)),this.dash.listenToModel("createFlag",e=>{const t=e.model,s=this.dash.create(ws,t);this.boxList.addBox(s)})}activate(e){e.setContentEl(this.el).setTitleRightEl(this.menu.btnEl).setTitle("Flags")}scheduleFlagReordering(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>this.doUpdate(e.boxIds),2e3)}async doUpdate(e){const t=this.boxList.getOrder();this.boxList.disable(!0);try{const t=await this.dash.app.model.reorder("Flag",e);u(t,e)||(this.log.error("Sorry. Server rejected new order of flags...",t,e),this.boxList.sort(t))}catch(e){this.log.info("Sorry. Unable to save the new order of flags on server.",e),this.boxList.sort(t)}this.boxList.enable(!0),this.form.reset()}fillBoxList(){this.model.global.flags.forEach(e=>this.boxList.addBox(this.dash.create(ws,e)))}}s(33);class Es{constructor(e,{title:t,createItem:s}){this.dash=e,this.items=new Map,this.checkboxes=new WeakMap,this.createSticker=s;const{root:n,ref:r}=function(e){const t=new Map,s=document.createElement("section");s.setAttribute("class","MultiSelect");const n=document.createElement("h1");s.appendChild(n),n.setAttribute("class","MultiSelect-h1");const r=document.createElement("fieldset");s.appendChild(r);const i=document.createTextNode("");n.appendChild(i),(e=>{let s=t.get(e);return s||(s=[],t.set(e,s)),s})("title").push(e=>i.nodeValue=e);const o=document.createElement("ol");r.appendChild(o),o.setAttribute("class","MultiSelect-ol");const a={fieldset:r,ol:o},l=e=>{for(const[s,n]of t.entries())s in e&&n.forEach(t=>t(e[s]))};return e&&l(e),{root:s,refs:a,ref:e=>{if(!a[e])throw new Error(`Missing handle: '${e}'`);return a[e]},update:l}}({title:t});this.el=n,this.olEl=r("ol"),this.fieldsetEl=r("fieldset"),this.olEl.addEventListener("change",e=>{const t=this.checkboxes.get(e.target);t&&this.dash.emit("change",{type:"Flag",data:t.data,checked:e.target.checked})}),e.listenTo("destroy",()=>{for(const e of this.items.values())this.dash.getPublicDashOf(e.comp).destroy()})}fillWith(e){const t=new Set(e);Array.from(this.items.values()).filter(e=>!t.has(e.data)).forEach(e=>this.removeItem(e)),p(this.olEl);for(const t of e){let e=this.items.get(t);e||(e=this.createItem(t)),this.olEl.appendChild(e.listItemEl)}}selectItems(e){const t=new Set(e);for(const[e,s]of this.items)s.checkboxEl.checked=t.has(e)}getSelected(){return Array.from(this.items.values()).filter(e=>e.checkboxEl.checked).map(e=>e.data)}setEnabled(e){this.fieldsetEl.disabled=!e}createItem(e){const{root:t,ref:s}=function(){const e=document.createElement("li"),t=document.createElement("input");e.appendChild(t),t.setAttribute("class","MultiSelect-input"),t.setAttribute("type","checkbox");const s=document.createElement("div");e.appendChild(s),s.setAttribute("class","MultiSelect-itemContent");const n={checkbox:t};return{root:e,refs:n,ref:e=>{if(!n[e])throw new Error(`Missing handle: '${e}'`);return n[e]},update:()=>{}}}(),n=t,r=s("checkbox"),i=this.createSticker(e),o={listItemEl:n,checkboxEl:r,data:e,comp:i};return n.appendChild(i.el),this.olEl.appendChild(n),this.items.set(e,o),this.checkboxes.set(r,o),o}removeItem(e){e.listItemEl.parentElement===this.olEl&&this.olEl.removeChild(e.listItemEl),this.dash.getPublicDashOf(e.comp).destroy(),this.items.delete(e.data),this.checkboxes.delete(e.checkboxEl)}}class ks{constructor(e,t){this.dash=e,this.step=t;const{root:s,ref:n}=function(){const e=document.createElement("div");e.setAttribute("class","LblSticker");const t=document.createElement("span");e.appendChild(t),t.setAttribute("class","LblSticker-lbl");const s=document.createElement("button");e.appendChild(s),s.setAttribute("class","RightOpenBtn"),s.setAttribute("type","button");const n=document.createTextNode("▶");s.appendChild(n);const r={span:t};return{root:e,refs:r,ref:e=>{if(!r[e])throw new Error(`Missing handle: '${e}'`);return r[e]},update:()=>{}}}();this.el=s,this.spanEl=n("span"),this.spanEl.textContent=this.step.label,this.el.addEventListener("click",()=>this.dash.emit("stepBoxSelected",this.step)),this.dash.listenToModel("updateStep",e=>{e.model===this.step&&(this.spanEl.textContent=this.step.label)})}get id(){return this.step.id}setWithFocus(e){e?this.el.classList.add("focus"):this.el.classList.remove("focus")}}class Cs{constructor(e,t=!1){this.dash=e,this.reusable=t,this.state={code:"",name:"",description:""},this.generateCode=!0,this.model=this.dash.app.model,this.log=this.dash.app.log;const{root:s,ref:n,update:r}=function(e){const t=new Map,s=e=>{let s=t.get(e);return s||(s=[],t.set(e,s)),s},n=document.createElement("div");n.setAttribute("class","ProjectForm");const r=document.createElement("div");n.appendChild(r),r.setAttribute("class","FieldGroup");const i=document.createElement("label");r.appendChild(i),i.setAttribute("class","FieldGroup-item Field");const o=document.createElement("label");r.appendChild(o),o.setAttribute("class","FieldGroup-item Field");const a=document.createElement("label");r.appendChild(a),a.setAttribute("class","FieldGroup-item Field");const l=document.createElement("div");r.appendChild(l),l.setAttribute("class","FieldGroup-item");const c=document.createElement("div");r.appendChild(c),c.setAttribute("class","FieldGroup-action");const d=document.createElement("span");i.appendChild(d),d.setAttribute("class","Field-lbl");const h=document.createElement("input");i.appendChild(h),h.setAttribute("class","Field-input"),h.setAttribute("type","text"),s("name").push(e=>h.setAttribute("value",e));const u=document.createElement("span");o.appendChild(u),u.setAttribute("class","Field-lbl");const p=document.createElement("input");o.appendChild(p),p.setAttribute("class","Field-input"),p.setAttribute("type","text"),s("code").push(e=>p.setAttribute("value",e));const m=document.createElement("span");a.appendChild(m),m.setAttribute("class","Field-lbl");const f=document.createElement("textarea");a.appendChild(f),f.setAttribute("class","Field-input -textarea"),s("description").push(e=>f.setAttribute("value",e));const g=document.createElement("button");c.appendChild(g),g.setAttribute("class","Btn WithLoader -right"),g.setAttribute("type","button");const b=document.createTextNode("Project Name");d.appendChild(b);const w=document.createTextNode("Project Code");u.appendChild(w);const v=document.createTextNode("Description");m.appendChild(v);const y=document.createTextNode("\n        Submit\n        ");g.appendChild(y);const E=document.createElement("span");g.appendChild(E),E.setAttribute("class","WithLoader-l"),E.setAttribute("hidden","");const k={form:r,steps:l,name:h,code:p,description:f,submitBtn:g,spinner:E},C=e=>{for(const[s,n]of t.entries())s in e&&n.forEach(t=>t(e[s]))};return e&&C(e),{root:n,refs:k,ref:e=>{if(!k[e])throw new Error(`Missing handle: '${e}'`);return k[e]},update:C}}();this.update=r,this.el=s,this.codeEl=n("code"),this.nameEl=n("name"),this.descriptionEl=n("description"),this.spinnerEl=n("spinner"),n("submitBtn").addEventListener("click",()=>this.onSubmit()),this.menu=this.createDropdownMenu(),this.stepSelector=e.create(Es,{title:"Steps",createItem:t=>e.create(ks,t)}),e.listenToModel(["changeStep","reorderStep"],()=>{this.stepSelector.fillWith(this.model.global.steps),this.project&&this.stepSelector.selectItems(this.project.steps)}),this.stepSelector.fillWith(this.model.global.steps),n("steps").appendChild(this.stepSelector.el),this.codeEl.addEventListener("input",()=>this.generateCode=!1),this.nameEl.addEventListener("input",()=>{!this.project&&this.generateCode&&this.nameEl.value.length>0&&(this.codeEl.value=this.nameEl.value.replace(/\s/g,"").slice(0,5).toUpperCase())})}refresh(){this.project&&(this.state.code=this.project.code,this.state.name=this.project.name,this.state.description=this.project.description||"",this.update(this.state))}clearContent(){this.state.code="",this.state.name="",this.state.description="",this.update(this.state)}hasProject(){return void 0!==this.project}getProject(){return this.project}setProject(e){this.project=e,this.stepSelector.selectItems(e?e.steps:[]),e?(this.codeEl.setAttribute("readonly","true"),this.generateCode=!1,this.refresh()):(this.codeEl.removeAttribute("readonly"),this.clearContent(),this.generateCode=!0)}activate(e){this.reusable&&(this.project=void 0),e.setContentEl(this.el),e.setTitle(this.hasProject()?"Edit ptoject":"Create new project"),e.setTitleRightEl(this.menu.btnEl),this.nameEl.focus()}createDropdownMenu(){const e=this.dash.create(O,{btnEl:ps()});return e.entries.createNavBtn({label:"Create another project",onClick:()=>{this.project=void 0,this.nameEl.focus()}}),e}async onSubmit(){this.spinnerEl.hidden=!1;const e=this.codeEl.value.trim(),t=this.nameEl.value.trim(),s=this.descriptionEl.value.trim();if(e.length<4&&0===t.length)return void(this.spinnerEl.hidden=!0);const n=this.stepSelector.getSelected().map(e=>e.id);this.project?await this.updateProject(t,s,n):await this.createProject(e,t,s,n),this.spinnerEl.hidden=!0}async createProject(e,t,s,n){try{const r=await this.model.exec("create","Project",{code:e,name:t,description:s,stepIds:n});this.project=r}catch(e){await this.dash.create(P).show("Unable to create new project."),this.log.error("Error while creating new project",e)}}async updateProject(e,t,s){if(this.project){try{await this.model.exec("update","Project",{id:this.project.id,name:e,description:t,stepIds:s})}catch(e){await this.dash.create(P).show("Unable to update project."),this.log.error("Error while creating new project",e)}this.refresh()}}}class _s{constructor(e){this.engine=e,this.commands=[]}exec(...e){const t=new L;return this.commands.push({method:"exec",args:e,deferred:t}),t.promise}fetch(...e){const t=new L;return this.commands.push({method:"fetch",args:e,deferred:t}),t.promise}reorder(e,t,s){const n=new L;return this.commands.push({method:"reorder",args:[e,{idList:t,groupId:s}],deferred:n}),n.promise}async sendAll(){const e=this.commands.length;try{this.engine.startBatchRecord();const t=[];for(const e of this.commands)t.push(this.engine[e.method](...e.args));await this.engine.sendBatchRecord();for(let s=0;s<e;++s)this.commands[s].deferred.pipeTo(t[s]);return Promise.all(t)}catch(e){this.engine.cancelBatchRecord(e);for(const t of this.commands)t.deferred.reject(e);throw e}}}var Ts=s(3),Ss=s(1);class As{constructor(e){this.dash=e,this.inProgressCommands=new Set,this.errorCommands=new Set,this.dash.exposeEvent("bgCommandAdded","bgCommandDone","bgCommandError")}add(e,t){const s=function(e,t){let s,n,r=!0;const i=new L;function o(e,t=new Error(e)){r&&(r=!1,s=!1,n=e,i.reject(t))}return e.then((function(e){if(!r)return;r=!1,s=!0,i.resolve(e)}),e=>{o("string"==typeof e?e:e instanceof Error?e.message:"Unexpected error",e)}),{label:t,startDt:new Date,get inProgress(){return r},get done(){return s},get errorMessage(){return n},promise:i.promise,cancel:()=>new Promise(e=>{r&&o("Command is canceled"),e()})}}(e,t);return this.inProgressCommands.add(s),s.promise.then(()=>{this.inProgressCommands.delete(s),this.dash.emit("bgCommandDone",s)},()=>{this.inProgressCommands.delete(s),this.errorCommands.add(s),this.dash.emit("bgCommandError",s)}),this.dash.emit("bgCommandAdded",s),s}getInProgressCommands(){return this.inProgressCommands.values()}getErrorCommands(){return this.errorCommands.values()}}class xs{constructor(e,t,s){this.dash=e,this.baseUrl=t,this.frontendId=s,this.store=Object(Ts.makeHKMap)(),this.dependencies=new Map,this.triggers={before:new Map,after:new Map},this.batch=null,this.processing=new Set,this.dash.exposeEvent("change","create","update","delete","reorder","processing","endProcessing"),this.bgManager=new As(e)}registerType(e,t){this.store.set(e,{entities:Object(Ts.makeHKMap)(),indexes:Object(Ts.makeHKMap)(),modelMaker:t}),this.dash.exposeEvent("change"+e,"create"+e,"update"+e,"delete"+e,"reorder"+e,"processing"+e,"endProcessing"+e)}registerDependency(e,t,s){const n=JSON.stringify([e,t]);let r=this.dependencies.get(n);r||this.dependencies.set(n,r=[]),r.push(s)}registerTriggerBefore(e,t){let s=this.triggers.before.get(e);s||this.triggers.before.set(e,s=[]),s.push(t)}registerTriggerAfter(e,t){let s=this.triggers.after.get(e);s||this.triggers.after.set(e,s=[]),s.push(t)}startBatchRecord(e){if(this.batch)throw new Error("Invalid call to startBatchRecord: the engine is already in batch mode");this.batch={httpMethod:e,list:[],deferred:new L}}async sendBatchRecord(){if(!this.batch)throw new Error("Invalid call to sendBatchRecord: the engine is not in batch mode");const e=this.batch;this.batch=null,e.list.length>0&&await e.deferred.pipeTo(Fs(e.httpMethod,this.baseUrl+"/api/model/batch",e.list))}cancelBatchRecord(e){this.batch&&(this.batch.deferred.reject(e||new Error("Batch record is canceled")),this.batch=null)}exec(e,t,s){return this.bgManager.add(this.doExec(e,t,s),`${e} ${t}`).promise}isProcessing(e,t){return this.processing.has(JSON.stringify([t,e]))}reorder(e,t){return this.bgManager.add(this.doReorder(e,t),"reorder "+e).promise}async doReorder(e,t){const s=Object(Ss.getFragmentMeta)(e).orderFieldName;if(!s)throw new Error(`Cannot reorder type ${e}, missing orderFieldName in meta`);if(0===t.idList.length)return[];const n=this.getExecDependencies("reorder",e,t);return await this.httpSendAndUpdate("POST",this.baseUrl+"/api/model/exec",{cmd:"reorder",type:e,...t,dependencies:n,frontendId:this.frontendId},"none"),t.idList.map(t=>({id:t,frag:this.getFragment({id:t,type:e})})).sort((e,t)=>e.frag[s]-t.frag[s]).map(e=>e.id)}fetch(e,t){return this.bgManager.add(this.doFetch(e,t),"fetch "+e).promise}async doFetch(e,t){const s={cmd:"fetch",type:e};t&&(s.filters=t);const n=await this.httpSendAndUpdate("POST",this.baseUrl+"/api/model/query",s,"fragments");return Object(Ss.getFragmentMeta)(e),Os(n.map(t=>this.getModel(e,Object(Ss.toIdentifier)(t,e))),e)}getModel(e,t){const s=this.getTypeStorage(e),n=s.entities.get(t);if(!n)throw new Error(`Unknown ID "${t}" in type: ${e}`);return n.model||(n.model=s.modelMaker(()=>{if(n.deleted)throw new Error(`Cannot access to the deleted model ${e}.${t}`);return n.fragment})),n.model}getModels(e,t=[]){const s=this.findIdentifiersFromIndex(e),n=[];if(s){for(const t of s)n.push(this.getModel(e.type,t));if(e.orderBy){const t=Array.isArray(e.orderBy)?Ds(e.orderBy):e.orderBy;n.sort(t)}}return 0===n.length?Array.isArray(t)?Os(t,e.type):t:Os(n,e.type)}getAllModels(e,t){const s=this.getTypeStorage(e).entities.keys(),n=[];for(const t of s)n.push(this.getModel(e,t));if(t){const e=Array.isArray(t)?Ds(t):t;n.sort(e)}return Os(n,e)}countModels(e){const t=this.findIdentifiersFromIndex(e);return t?t.size:0}findSingleFromIndex(e){const t=this.findIdentifiersFromIndex(e);if(t){if(t.size>1)throw new Error(`Invalid call to "findSingleFromIndex", there are ${t.size} results`);for(const s of t)return this.getModel(e.type,s)}}removeFrontendModels(e){const t=this.findIdentifiersFromIndex(e);t&&this.deleteFromStore({[e.type]:t})}emitEvents(e,t){const s=this;for(const[n,r]of Object.entries(e)){this.getTypeStorage(n);for(const e of r)this.dash.emit(["change",""+t,"change"+n,`${t}${n}`],{type:n,cmd:t,id:e,get model(){return"delete"===t?void 0:s.getModel(n,e)}})}}processModelUpdate(e){this.processModelUpdateTriggers("before",e),e.fragments&&this.updateStore(e.fragments),e.partial&&this.updateStoreFromPartial(e.partial),e.deleted&&(this.deleteFromStore(e.deleted),this.emitEvents(e.deleted,"delete")),e.updated&&this.emitEvents(e.updated,"update"),e.created&&this.emitEvents(e.created,"create"),e.reordered&&this.emitEventReordered(e.reordered),this.processModelUpdateTriggers("after",e)}async doExec(e,t,s){const n=this.getExecDependencies(e,t,s),r="delete"===e;let i,o;"delete"!==e&&"update"!==e||(o=Object(Ss.toIdentifier)(s,t),i=this.startProcessing(t,e,o));try{const a=await this.httpSendAndUpdate("POST",this.baseUrl+"/api/model/exec",{cmd:e,type:t,frag:s,dependencies:n,frontendId:this.frontendId},r?"none":"fragment");if(!r)return this.getModel(t,Object(Ss.toIdentifier)(a,t))}finally{i&&this.endProcessing(t,e,o,i)}}endProcessing(e,t,s,n){const r=this;this.processing.delete(n),this.dash.emit(["endProcessing","endProcessing"+e],{type:e,cmd:t,id:s,get model(){return"delete"===t?void 0:r.getModel(e,s)}})}startProcessing(e,t,s){const n=JSON.stringify([e,s]),r=this;return this.processing.add(n),this.dash.emit(["processing","processing"+e],{type:e,cmd:t,id:s,get model(){return"delete"===t?void 0:r.getModel(e,s)}}),n}getExecDependencies(e,t,s){const n=JSON.stringify([e,t]),r=this.dependencies.get(n);if(!r)return;const i=[];for(const e of r){const t=e(s);t&&i.push(t)}return i.length>0?i:void 0}findIdentifiersFromIndex({type:e,index:t,key:s,indexCb:n}){t=function(e,t){"string"==typeof e&&(e=[e]);return(e=t?[...e,...Object.keys(t)]:[...e]).sort(),e}(t,n);const r=this.getTypeStorage(e);let i=r.indexes.get(t);return i||(function(e,t){const s=Object(Ss.getFragmentMeta)(e);for(const n of t)if(!s.fields[n])throw new Error(`Unknown field ${n} in ${e}`)}(e,Is(t,n)),r.indexes.set(t,i={map:Object(Ts.makeHKMap)(),indexCb:n}),function(e,t,s){for(const[n,r]of e.entities)js(t,s,n,r.fragment)}(r,t,i)),i.map.get(s)}getTypeStorage(e){const t=this.store.get(e);if(!t)throw new Error("Unknown type: "+e);return t}updateStore(e){for(const[t,s]of Object.entries(e)){const e=this.getTypeStorage(t);Object(Ss.getFragmentMeta)(t);for(const n of s){const s=Object(Ss.toIdentifier)(n,t),r=e.entities.get(s);r?(r.deleted&&(r.deleted=!1),r.fragment=n):e.entities.set(s,{fragment:n}),Ps(e,s,n,!!r)}}}updateStoreFromPartial(e){for(const[t,s]of Object.entries(e)){const e=this.getTypeStorage(t);for(const n of s){const s=Object(Ss.toIdentifier)(n,t),r=e.entities.get(s);r&&!r.deleted&&Ns(e,s,n,r)}}}deleteFromStore(e){for(const[t,s]of Object.entries(e)){if(!s)continue;const n=this.getTypeStorage(t);for(const e of s){const t=n.entities.get(e);t&&(n.entities.delete(e),t.deleted=!0,t.model=void 0)}Bs(n,e[t])}}execTriggers(e,t,s){const n=this.triggers[e];for(const[e,r]of Object.entries(s)){if(!r)continue;const s=n.get(e);if(s)for(const e of s)for(const s of r)e(t,s)}}emitEventReordered(e){const t="reorder";for(const[s,n]of Object.entries(e))this.getTypeStorage(s),this.dash.emit(["change",""+t,"change"+s,`${t}${s}`],{type:s,cmd:t,orderedIds:n})}getFragment(e){const t=this.getTypeStorage(e.type).entities.get(e.id);if(!t)throw new Error(`[${e.type}] Missing data for: ${JSON.stringify(e.id)}`);return t.fragment}getFragments(e){const t=this.getTypeStorage(e.type),s=[];for(const n of e.list){const r=t.entities.get(n);if(!r)throw new Error(`[${e.type}] Missing data for: ${JSON.stringify(n)}`);s.push(r.fragment)}return s}async httpSendAndUpdate(e,t,s,n){const r=await this.httpSendOrBatch(e,t,s);if(r.modelUpd&&this.processModelUpdate(r.modelUpd),!r.done)throw console.log("Error on server",r.displayError,r.debugData),new Error("Error on server");if(r.result){if(n&&n!==r.result.type)throw new Error(`Result type "${n}" doesn't match with cargo: ${JSON.stringify(r)}`);switch(r.result.type){case"data":return r.result.val;case"fragment":if(!r.result.val)throw new Error("Missing fragment result for HTTP query");return this.getFragment(r.result.val);case"fragments":return r.result.val?this.getFragments(r.result.val):[]}}if(n&&"none"!==n)throw new Error(`Result type "${n}" doesn't match with cargo: ${JSON.stringify(r)}`)}processModelUpdateTriggers(e,t){t.deleted&&this.execTriggers(e,"delete",t.deleted),t.updated&&this.execTriggers(e,"update",t.updated),t.created&&this.execTriggers(e,"create",t.created)}httpSendOrBatch(e,t,s){if(!this.batch)return Fs(e,t,s);(!this.batch.httpMethod||"GET"===this.batch.httpMethod&&"POST"===e)&&(this.batch.httpMethod=e);const n=this.batch.list.length;return this.batch.list.push(s),this.batch.deferred.promise.then(e=>{if(0===n&&e.modelUpd&&this.processModelUpdate(e.modelUpd),!e.responses||e.responses.length<=n)throw new Error("The batch command is canceled due to a previous command error");return e.responses[n]})}}function Ms(e,t,s){const n=Object(Ss.getFragmentMeta)(t);for(const t of Object.keys(n.fields))Object.defineProperty(e,t,{get:()=>s()[t],configurable:!1})}function Ls(e,t,s,n,r){e.updateTools={},r.processing&&Object.defineProperty(e.updateTools,"processing",{get:()=>n.isProcessing(Object(Ss.toIdentifier)(s(),t),t),configurable:!1}),r.whoUse&&(e.updateTools.whoUse=()=>n.bgManager.add((async()=>{const e=await Fs("POST",this.baseUrl+"/api/model/who-use",{type:t,id:Object(Ss.toIdentifier)(s(),t)});if(!e.done)throw new Error("Error on server: "+e.error);return e.result||null})(),"who-use "+t).promise),r.toFragment&&(e.updateTools.toFragment=e=>{const n=s(),r={},i=Object(Ss.getFragmentMeta)(t,e);for(const e of Object.keys(i.fields))r[e]=n[e];return r}),r.diffToUpdate&&(e.updateTools.isModified=e=>{const n=s(),r=Object(Ss.getFragmentMeta)(t,"update");for(const t of Object.keys(r.fields))if(void 0!==e[t]&&e[t]!==n[t])return!0;return!1},e.updateTools.getDiffToUpdate=e=>{const n=s(),r={},i=Object(Ss.getFragmentMeta)(t,"update");for(const t of Object.keys(i.fields))void 0!==e[t]&&e[t]!==n[t]&&(r[t]=e[t]);return r})}function Is(e,t){const s="string"==typeof e?[e]:e;return t?s.filter(e=>!t[e]):s}function Ps(e,t,s,n=!1){n&&Bs(e,[t]);for(const[n,r]of e.indexes)js(n,r,t,s)}function js(e,t,s,n){if(t.indexCb&&!function(e,t){for(const s of Object.keys(t))if(t.hasOwnProperty(s)&&!t[s](e))return!1;return!0}(n,t.indexCb))return;const r=Is(e,t.indexCb),i={};for(const e of r)i[e]=n[e];let o=t.map.get(i);o||t.map.set(i,o=Object(Ts.makeHKSet)()),o.add(s)}function Bs(e,t){for(const[,s]of e.indexes)for(const e of s.map.values())for(const s of t)e.delete(s)}function Ns(e,t,s,n){for(const e of Object.keys(s))null===s[e]?delete n.fragment[e]:n.fragment[e]=s[e];Ps(e,t,s,!0)}function Ds([e,t]){return function(s,n){const r=s[e]-n[e];return"asc"===t?r:-r}}async function Fs(e,t,s){const n=await fetch(t,{method:e,credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:s?JSON.stringify(s):void 0});return await n.json()}function Os(e,t){let s;const n=e;return n.get=n=>{if(!s){s=Object(Ts.makeHKMap)();for(const n of e)s.set(Object(Ss.toIdentifier)(n,t),n)}return s.get(n)},n.has=e=>void 0!==n.get(e),n}class $s{constructor(e,t){var s,n,r;this.dash=e,this.engine=new xs(e,e.app.baseUrl,t.frontendId),this.bgManager=this.engine.bgManager,(s=this.engine).registerType("Account",(function(e){const t={get avatar(){const t=e().avatarId;return void 0===t?void 0:s.getModel("Media",t)}};return Ms(t,"Account",e),Ls(t,"Account",e,s,{processing:!0,whoUse:!0,toFragment:!0,diffToUpdate:!0}),t})),function(e){e.registerType("Comment",(function(t){const s={get task(){return e.getModel("Task",t().taskId)},get writtenBy(){return e.getModel("Account",t().writtenById)}};return Ms(s,"Comment",t),Ls(s,"Account",t,e,{processing:!0,toFragment:!0,diffToUpdate:!0}),s}))}(this.engine),function(e){e.registerType("Flag",(function(t){const s={};return Ms(s,"Flag",t),Ls(s,"Flag",t,e,{processing:!0,whoUse:!0,toFragment:!0,diffToUpdate:!0}),s}))}(this.engine),function(e){e.registerType("TaskLogEntry",(function(t){const s={get task(){return e.getModel("Task",t().taskId)},get step(){return e.getModel("Step",t().stepId)},get account(){return e.getModel("Account",t().accountId)}};return Ms(s,"TaskLogEntry",t),s}))}(this.engine),function(e){e.registerType("Project",(function(t){const s={get rootTask(){return e.getModel("Task",t().rootTaskId)},get steps(){return Os(t().stepIds.map(t=>e.getModel("Step",t)).filter(e=>null!==e.orderNum),"Step")},get specialSteps(){return Os(t().stepIds.map(t=>e.getModel("Step",t)).filter(e=>null===e.orderNum),"Step")},get allSteps(){return Os(t().stepIds.map(t=>e.getModel("Step",t)),"Step")},get tasks(){return this.rootTask.children},getTask(s){const n=e.getModel("Task",s);if(n.projectId!==t().id)throw new Error(`The task ${s} is in the project ${n.projectId}, current project: ${t().id}`);return n},hasTaskForStep:s=>void 0!==e.getModels({type:"Task",index:"projectId",key:{projectId:t().id}}).find(e=>e.curStepId===s)};return Ms(s,"Project",t),Ls(s,"Project",t,e,{processing:!0,whoUse:!0,toFragment:!0,diffToUpdate:!0}),s})),e.registerDependency("reorder","Step",(function(){return{type:"Project",idList:e.getAllModels("Project").map(e=>e.id)}}))}(this.engine),function(e){e.registerType("Task",(function(t){const s={get project(){return e.getModel("Project",t().projectId)},get currentStep(){return e.getModel("Step",t().curStepId)},get parent(){const s=t().parentTaskId;if(void 0!==s)return e.getModel("Task",s)},get children(){return e.getModels({type:"Task",index:"parentTaskId",key:{parentTaskId:t().id},orderBy:["orderNum","asc"]},void 0)},get createdBy(){return e.getModel("Account",t().createdById)},get affectedTo(){const s=t();if(!s.affectedToIds)return;return Os(s.affectedToIds.map(t=>e.getModel("Account",t)),"Account")},get flags(){const s=t().flagIds;if(!s)return;return Os(s.map(t=>e.getModel("Flag",t)),"Flag")},getComments:()=>e.fetch("Comment",{taskId:t().id}),getLogEntries:()=>e.fetch("TaskLogEntry",{taskId:t().id}),get attachedMedias(){const s=t().attachedMediaIds;if(!s)return;return Os(s.map(t=>e.getModel("Media",t)),"Media")},get gitCommits(){const s=t().gitCommitIds;if(!s)return;return Os(s.map(t=>e.getModel("GitCommit",t)),"GitCommit")}};return Ms(s,"Task",t),Ls(s,"Task",t,e,{processing:!0,whoUse:!0,toFragment:!0,diffToUpdate:!0}),s})),e.registerDependency("reorder","Flag",()=>({type:"Task",idList:e.getAllModels("Task").filter(e=>!!e.flagIds).map(e=>e.id)}))}(this.engine),function(e){e.registerType("Step",(function(t){const s={get isSpecial(){return null===t().orderNum}};return Ms(s,"Step",t),Ls(s,"Step",t,e,{processing:!0,whoUse:!0,toFragment:!0,diffToUpdate:!0}),s}))}(this.engine),function(e){e.registerType("Media",(function(t){const s={get variants(){return e.getModels({type:"MediaVariant",index:"mediaId",key:{mediaId:t().id}},[])},getVariant(e){const t=this.variants,s=t.find(t=>t.code===e);return s||(t.length>=1?t[0]:void 0)}};return Ms(s,"Media",t),s})),e.registerTriggerBefore("Media",(t,s)=>{"delete"!==t&&"update"!==t||e.removeFrontendModels({type:"MediaVariant",index:"mediaId",key:{mediaId:s}})})}(this.engine),function(e){e.registerType("MediaVariant",(function(t){const s={get media(){return e.getModel("Media",t().mediaId)}};return Ms(s,"MediaVariant",t),s}))}(this.engine),function(e){e.registerType("GitCommit",(function(e){const t={};return Ms(t,"GitCommit",e),t}))}(this.engine),this.global=function(e,t){const s=new _s(t);s.fetch("Step"),s.fetch("Flag"),s.fetch("Account"),s.fetch("Project",{archived:!1});let n=!1;const r=s.sendAll().then(()=>{n=!0}),i={steps:{type:"Step",factory:()=>t.getAllModels("Step",["orderNum","asc"]).filter(e=>null!==e.orderNum)},specialSteps:{type:"Step",factory:()=>t.getAllModels("Step",["orderNum","asc"]).filter(e=>null===e.orderNum)},allSteps:{type:"Step",factory:()=>t.getAllModels("Step",["orderNum","asc"])},flags:{type:"Flag",factory:()=>t.getAllModels("Flag",["orderNum","asc"])},accounts:{type:"Account",factory:()=>t.getAllModels("Account",["name","asc"])},projects:{type:"Project",factory:()=>t.getAllModels("Project",["name","asc"]).filter(e=>!e.archived)}},o=new Map,a={};for(const[t,s]of Object.entries(i))a[t]={configurable:!1,enumerable:!0,get(){if(!n)throw new Error('Model "global" is not ready');let e=o.get(t);return e||o.set(t,e=s.factory()),e}},e.listenTo("change"+s.type,()=>o.delete(t));const l={isReady:n,loading:r};return Object.defineProperties(l,a),l}(this.dash,this.engine),this.session=(n=this.global,r=t.accountId,{get account(){const e=n.accounts.get(r);if(!e)throw new Error(`Unknown session account "${r}"`);return e}})}exec(e,t,s){return this.engine.exec(e,t,s)}fetch(e,t){return this.engine.fetch(e,t)}reorder(e,t,s,n){return this.engine.reorder(e,{idList:t,groupName:s,groupId:n})}createCommandBatch(){return new _s(this.engine)}processModelUpdate(e){this.engine.processModelUpdate(e)}findTaskByCode(e){const t=this.engine.getModels({type:"Task",index:"code",key:{code:e}});if(1===t.length)return t[0]}}s(44);class Us{constructor(e,t){this.dash=e,this.flag=t,this.el=function(){const e=document.createElement("span");e.setAttribute("class","TaskFlag WithTooltip"),e.setAttribute("data-tooltip","");const t={};return{root:e,refs:t,ref:e=>{if(!t[e])throw new Error(`Missing handle: '${e}'`);return t[e]},update:()=>{}}}().root,this.el.dataset.tooltip=t.label,this.el.style.backgroundColor=t.color,this.dash.listenToModel("updateFlag",e=>{e.model.id===this.flag.id&&(this.el.style.color=this.flag.color,this.el.dataset.tooltip=this.flag.label)})}}s(45);class zs{constructor(e,t){this.dash=e,this.task=t,this.model=this.dash.app.model;const{root:s,ref:n}=function(){const e=document.createElement("div");e.setAttribute("class","TaskBox");const t=document.createElement("div");e.appendChild(t),t.setAttribute("class","TaskBox-top");const s=document.createElement("div");e.appendChild(s),s.setAttribute("class","TaskBox-bottom TaskBoxBottom");const n=document.createElement("span");t.appendChild(n);const r=document.createElement("button");t.appendChild(r),r.setAttribute("class","TaskBox-openBtn RightOpenBtn"),r.setAttribute("type","button");const i=document.createElement("div");s.appendChild(i),i.setAttribute("class","TaskBoxBottom-col1");const o=document.createElement("div");s.appendChild(o),o.setAttribute("class","TaskBoxBottom-col2");const a=document.createElement("div");s.appendChild(a),a.setAttribute("class","TaskBoxBottom-col3");const l=document.createTextNode("▶");r.appendChild(l);const c=document.createElement("span");o.appendChild(c),c.setAttribute("class","TaskCommentCounter"),c.setAttribute("title","Number of comments");const d={lbl:n,openBtn:r,flags:i,avatars:a,comments:c};return{root:e,refs:d,ref:e=>{if(!d[e])throw new Error(`Missing handle: '${e}'`);return d[e]},update:()=>{}}}(),r=n("lbl");this.el=s,r.textContent=this.task.label,this.avatarsEl=n("avatars"),this.addAccountAvatars(),this.flagsEl=n("flags"),this.addTaskFlags();n("comments").textContent=(this.task.commentCount||0).toString(),this.dash.listenToModel("updateTask",e=>{e.model===this.task&&(r.textContent=this.task.label,p(this.flagsEl),this.addTaskFlags(),p(this.avatarsEl),this.addAccountAvatars())}),this.dash.listenToModel("reorderFlag",()=>{p(this.flagsEl),this.addTaskFlags()}),n("openBtn").addEventListener("click",()=>this.dash.emit("taskBoxSelected",this.task))}get id(){return this.task.id}setWithFocus(e){e?this.el.classList.add("focus"):this.el.classList.remove("focus")}addAccountAvatars(){if(this.task.affectedToIds)for(const e of this.task.affectedToIds){const t=this.model.global.accounts.get(e);if(t){const e=this.dash.create(fs,{account:t,width:16,height:16});this.avatarsEl.appendChild(e.el)}}}addTaskFlags(){if(this.task.flagIds)for(const e of this.task.flagIds){const t=this.model.global.flags.get(e);if(t){const e=this.dash.create(Us,t);this.flagsEl.appendChild(e.el)}}}}class Rs{constructor({onChangeStatus:e,action:t,delayMs:s,maxDelayMs:n,logError:r}){this.delaying=!1,this.running=!1,this.waitSeq=0,this.saveSeq=0,this.opt={action:t,onChangeStatus:null!=e?e:()=>{},logError:r,delayMs:s||2e3,maxDelayMs:n||1e4}}get delayedStatus(){return this.delaying?"delaying":!!this.running&&"running"}reset({flush:e=!1}={}){e&&this.delaying&&this.opt.action().catch(e=>this.opt.logError(e)),this.maxNextSaveTs=void 0,this.nextSaveTs=void 0,this.delaying=!1,this.running=!1}async flush(){++this.saveSeq,await this.save()}delay(){this.delayFor(this.opt.delayMs)}delayFor(e){const t=Date.now();if(this.nextSaveTs=t+e,this.maxNextSaveTs?this.nextSaveTs=Math.min(this.nextSaveTs,this.maxNextSaveTs):this.maxNextSaveTs=t+this.opt.maxDelayMs,this.delaying){if(t<this.maxNextSaveTs)return;e=0}this.opt.onChangeStatus("delaying"),this.delaying=!0;const s=++this.waitSeq;(function(e){return new Promise(t=>setTimeout(t,e))})(e).then(()=>{if(s!==this.waitSeq||!this.nextSaveTs)return;this.delaying=!1;const e=Date.now();if(e<this.nextSaveTs)return void this.delayFor(this.nextSaveTs-e);if(this.running&&(!this.maxNextSaveTs||e<this.maxNextSaveTs))return void this.delayFor(e+this.opt.delayMs);this.maxNextSaveTs=void 0,this.running=!0;const t=++this.saveSeq;this.save().then(()=>{t===this.saveSeq&&(this.running=!1)})})}async save(){this.opt.onChangeStatus("running");try{await this.opt.action()}catch(e){this.opt.logError(e)}this.opt.onChangeStatus(!1)}}s(46);class Hs{constructor(e){const{root:t,ref:s}=function(){const e=document.createElement("div");e.setAttribute("class","AccountSelectionComponent");const t=document.createElement("div");e.appendChild(t);const s={selector:t};return{root:e,refs:s,ref:e=>{if(!s[e])throw new Error(`Missing handle: '${e}'`);return s[e]},update:()=>{}}}();this.el=t,this.selector=e.create(Es,{title:"Accounts",createItem:t=>e.create(gs,t)});const n=e.app.model;e.listenToModel("changeAccount",()=>this.selector.fillWith(n.global.accounts)),this.selector.fillWith(n.global.accounts),s("selector").appendChild(this.selector.el)}selectAccounts(e){this.selector.selectItems(e)}selectedAccounts(){return this.selector.getSelected()}}s(47);class Ws{constructor(e){this.dash=e,this.model=this.dash.app.model;const{root:t,ref:s}=function(){const e=document.createElement("div");e.setAttribute("class","AccountSelector");const t=document.createElement("header");e.appendChild(t),t.setAttribute("class","AccountSelector-header");const s=document.createElement("div");e.appendChild(s);const n=document.createElement("button");e.appendChild(n),n.setAttribute("class","AccountSelector-button");const r=document.createTextNode("Affected to:");t.appendChild(r);const i=document.createTextNode("\n    Select accounts ");n.appendChild(i);const o=document.createElement("span");n.appendChild(o),o.setAttribute("class","fa fa-eye fa-1x");const a={boxlist:s,btn:n};return{root:e,refs:a,ref:e=>{if(!a[e])throw new Error(`Missing handle: '${e}'`);return a[e]},update:()=>{}}}();this.el=t,s("btn").addEventListener("click",async()=>{this.task&&(this.dialog.content.selectAccounts(this.task.affectedTo||[]),await this.dialog.open(),this.boxList.clear(),this.dialog.content.selectedAccounts().forEach(e=>this.addBoxFor(e)))}),this.boxList=this.dash.create(Vt,{sort:!0,inline:!0,noHeader:!0}),s("boxlist").appendChild(this.boxList.el),this.dialog=this.dash.create(j,{content:this.dash.create(Hs),title:"Select Accounts"}),this.dash.listenToModel("deleteAccount",e=>{const t=e.id;this.boxList.removeBox(t)})}refresh(){if(this.boxList.clear(),this.task&&this.task.affectedTo)for(const e of this.task.affectedTo)this.addBoxFor(e)}getTask(){return this.task}setTask(e){this.task=void 0,this.boxList.clear(),this.task=e,e&&e.affectedToIds&&e.affectedToIds.forEach(e=>{const t=this.model.global.accounts.get(e);t&&this.addBoxFor(t)})}get selectedAccountIds(){return this.task?this.boxList.getOrder():[]}addBoxFor(e){const t=this.dash.create(gs,e);this.boxList.addBox(t)}}class Vs{constructor(e){this.dash=e;const t=e.app.model;this.selector=e.create(Es,{title:"Flags",createItem:t=>e.create(ws,t)}),e.listenToModel(["changeFlag","reorderFlag"],()=>{this.selector.fillWith(t.global.flags),this.task&&this.task.flags&&this.selector.selectItems(this.task.flags)}),this.selector.fillWith(t.global.flags)}get el(){return this.selector.el}setTask(e){this.task=e,this.selector.selectItems(e&&e.flagIds&&e.flags||[]),this.el.style.pointerEvents=e?"auto":"none"}getSelectedFlagIds(){return this.selector.getSelected().map(e=>e.id)}}s(48);class Gs{constructor(e,t){this.dash=e,this.options=t;const{root:s}=function(){const e=document.createElement("span");e.setAttribute("class","FileThumbnail");const t={};return{root:e,refs:t,ref:e=>{if(!t[e])throw new Error(`Missing handle: '${e}'`);return t[e]},update:()=>{}}}();this.el=s,this.el.style.width=t.width+"px",this.el.style.height=t.height+"px",this.chosenVariant=ms(t.media,t.width,t.height)||t.media.variants[0],this.createThumbnail()}createThumbnail(){const e=function(e){const t=e.variants[0].mediaType,s=t.indexOf("/");return t.substr(0,s)}(this.options.media);"image"===e?this.displayImageThumbnail():"video"===e?this.el.classList.add("fas","fa-file-video"):"audio"===e?function(e){e.classList.add("fas","fa-file-audio")}(this.el):"application/pdf"===this.chosenVariant.mediaType?function(e){e.classList.add("fas","fa-file-pdf")}(this.el):function(e){e.classList.add("fas","fa-file-alt")}(this.el)}displayImageThumbnail(){this.el.style.backgroundImage=`url('${this.chosenVariant.url}')`}}s(49);class qs{constructor(e){this.dash=e,this.model=this.dash.app.model,this.log=this.dash.app.log;const{root:t,ref:s}=function(){const e=document.createElement("div");e.setAttribute("class","TaskAttachmentManager");const t=document.createElement("header");e.appendChild(t),t.setAttribute("class","TaskAttachmentManager-header");const s=document.createElement("ul");e.appendChild(s),s.setAttribute("class","TaskAttachementManager-ul");const n=document.createElement("form");e.appendChild(n),n.setAttribute("action",""),n.setAttribute("method","post"),n.setAttribute("enctype","multipart/form-data");const r=document.createElement("div");t.appendChild(r),r.setAttribute("class","TaskAttachmentManager-headerLeft");const i=document.createElement("div");t.appendChild(i),i.setAttribute("class","TaskAttachmentManager-headerRight");const o=document.createElement("input");n.appendChild(o),o.setAttribute("name","f"),o.setAttribute("type","file");const a=document.createElement("button");n.appendChild(a),a.setAttribute("class","TaskAttachmentManager-uploadButton"),a.setAttribute("type","submit");const l=document.createTextNode("Attached files");r.appendChild(l);const c=document.createTextNode("\n      Send file\n      ");a.appendChild(c);const d=document.createElement("span");a.appendChild(d),d.setAttribute("class","fa fa-upload fa-1x");const h={ul:s,form:n,input:o,upload:a,spinner:d};return{root:e,refs:h,ref:e=>{if(!h[e])throw new Error(`Missing handle: '${e}'`);return h[e]},update:()=>{}}}();this.el=t,this.listEl=s("ul"),this.formEl=s("form"),this.inputEl=s("input"),this.spinnerEl=s("spinner"),this.formEl.onsubmit=e=>{e.preventDefault(),this.onFormSubmit().catch(e=>this.dash.log.error(e))},this.dash.listenToModel("updateTask",e=>{this.currentTask&&this.currentTask.id===e.id&&this.refreshMediaList()})}get task(){return this.currentTask}setTask(e){this.currentTask=e,this.inputEl.value="",this.refreshMediaList()}refreshMediaList(){p(this.listEl),this.listAttachedMedias()}listAttachedMedias(){if(this.currentTask&&this.currentTask.attachedMedias)for(const e of this.currentTask.attachedMedias)this.displayMedia(e)}displayMedia(e){const{root:t,ref:s,update:n}=function(e){const t=new Map,s=document.createElement("li"),n=document.createElement("span");s.appendChild(n);const r=document.createElement("button");s.appendChild(r),r.setAttribute("title","Click to download");const i=document.createTextNode("  \n  ");s.appendChild(i);const o=document.createElement("button");s.appendChild(o),o.setAttribute("style","color: red"),o.setAttribute("title","Click to delete file");const a=document.createTextNode("");r.appendChild(a),(e=>{let s=t.get(e);return s||(s=[],t.set(e,s)),s})("name").push(e=>a.nodeValue=e);const l=document.createElement("span");o.appendChild(l),l.setAttribute("class","fa fa-times fa-1x");const c={thumbnail:n,download:r,remove:o},d=e=>{for(const[s,n]of t.entries())s in e&&n.forEach(t=>t(e[s]))};return e&&d(e),{root:s,refs:c,ref:e=>{if(!c[e])throw new Error(`Missing handle: '${e}'`);return c[e]},update:d}}(),r=this.dash.create(Gs,{media:e,width:24,height:24});s("thumbnail").appendChild(r.el),s("download").addEventListener("click",()=>{const t=e.getVariant("orig");t&&window.open(t.url+"?download=1")}),s("remove").addEventListener("click",()=>{const s=this.model.session.account.id;e.ownerId===s&&this.removeTaskAttachment(e.id)&&this.listEl.removeChild(t)}),n({name:e.originalName||e.baseName}),this.listEl.appendChild(t)}async onFormSubmit(){this.inputEl.files&&0!==this.inputEl.files.length&&(this.showSpinner(),await this.doUpload(),this.hideSpinner())}async doUpload(){if(!this.currentTask)return;const e={ref:{type:"task",id:this.currentTask.id}},t=new FormData(this.formEl);t.append("meta",JSON.stringify(e));try{const e=await fetch(this.dash.app.baseUrl+"/medias/upload",{method:"post",credentials:"same-origin",body:t});if(!e.ok)return void await this.dash.create(I).show("Request was not processed by server.");const s=await e.json();s.modelUpd&&this.model.processModelUpdate(s.modelUpd),s.done?this.inputEl.value="":this.log.error("Error while uploading image.")}catch(e){this.log.warn(e)}}async removeTaskAttachment(e){if(!this.currentTask)return!1;let t=!1;try{const s=await fetch(this.dash.app.baseUrl+"/medias/delete",{method:"post",credentials:"same-origin",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({mediaId:e})});if(!s.ok)return this.log.error("Unable to get a response from server..."),!1;const n=await s.json();n.modelUpd&&this.model.processModelUpdate(n.modelUpd),n.done?t=!0:this.log.warn("Attachment not deleted")}catch(e){this.log.warn(e)}return t}showSpinner(){this.spinnerEl.hidden=!1}hideSpinner(){this.spinnerEl.hidden=!0}}var Qs=s(5);s(50);class Js{constructor(e,t){this.dash=e,this.comment=t,this.state={author:"",date:"",text:""},this.showIfEditElements=[],this.showIfNotEditElements=[],this.model=this.dash.app.model,this.log=this.dash.app.log;const s=this.dash.app.model.session.account.id,n=new Date(this.comment.updateTs);this.state.author=this.comment.writtenBy.login,this.state.date=`${n.toLocaleDateString()}@${n.toLocaleTimeString()}`,this.state.text=t.body;const{root:r,ref:i,update:o}=function(e){const t=new Map,s=e=>{let s=t.get(e);return s||(s=[],t.set(e,s)),s},n=document.createElement("div");n.setAttribute("class","TaskComment");const r=document.createElement("div");n.appendChild(r),r.setAttribute("class","TaskComment-left");const i=document.createElement("div");n.appendChild(i),i.setAttribute("class","TaskComment-right");const o=document.createElement("div");r.appendChild(o),o.setAttribute("class","TaskComment-content");const a=document.createElement("textarea");r.appendChild(a),a.setAttribute("class","TaskComment-textarea"),s("text").push(e=>a.setAttribute("value",e));const l=document.createElement("span");o.appendChild(l);const c=document.createElement("div");o.appendChild(c);const d=document.createTextNode("");l.appendChild(d),s("author").push(e=>d.nodeValue=e);const h=document.createTextNode(", ");l.appendChild(h);const u=document.createTextNode("");l.appendChild(u),s("date").push(e=>u.nodeValue=e);const p={ifCanEdit:i,text:a,markdown:c},m=e=>{for(const[s,n]of t.entries())s in e&&n.forEach(t=>t(e[s]))};return e&&m(e),{root:n,refs:p,ref:e=>{if(!p[e])throw new Error(`Missing handle: '${e}'`);return p[e]},update:m}}(this.state);this.el=r,this.textareaEl=i("text"),this.mdEl=i("markdown"),this.showIfEditElements.push(this.textareaEl);if(s===t.writtenById){const{root:e,ref:t}=function(){const e=document.createElement("span"),t=document.createElement("button");e.appendChild(t),t.setAttribute("class","TaskComment-saveButton"),t.setAttribute("title","Save changes");const s=document.createElement("button");e.appendChild(s),s.setAttribute("class","TaskComment-cancelButton"),s.setAttribute("title","Undo changes ");const n=document.createElement("button");e.appendChild(n),n.setAttribute("class","TaskComment-editButton"),n.setAttribute("title","Edit comment");const r=document.createElement("button");e.appendChild(r),r.setAttribute("class","TaskComment-deleteButton"),r.setAttribute("title","Delete comment");const i={save:t,cancel:s,edit:n,delete:r};return{root:e,refs:i,ref:e=>{if(!i[e])throw new Error(`Missing handle: '${e}'`);return i[e]},update:()=>{}}}();i("ifCanEdit").appendChild(e),t("edit").addEventListener("click",()=>this.setEditMode(!0)),t("save").addEventListener("click",()=>this.onBtnSaveClick()),t("cancel").addEventListener("click",()=>this.setEditMode(!1)),t("delete").addEventListener("click",()=>this.onBtnDeleteClick()),this.showIfEditElements.push(t("save"),t("cancel")),this.showIfNotEditElements.push(t("edit"),t("delete"))}this.converter=new Qs.Converter,this.mdEl.innerHTML=this.converter.makeHtml(this.comment.body),this.dash.listenToModel("updateComment",e=>{if(e.id!==this.comment.id)return;const t=new Date(this.comment.updateTs);this.state.date=`${t.toLocaleDateString()}@${t.toLocaleTimeString()}`,this.state.text=this.comment.body,o(this.state),this.mdEl.innerHTML=this.converter.makeHtml(this.comment.body)})}setEditMode(e){this.showIfEditElements.forEach(t=>t.hidden=!e),this.showIfNotEditElements.forEach(t=>t.hidden=e)}async onBtnSaveClick(){const e=this.textareaEl.value.trim();if(0!==e.length)try{await this.model.exec("update","Comment",{id:this.comment.id,body:e}),this.setEditMode(!1)}catch(e){this.log.error("Unable to update comment...")}}async onBtnDeleteClick(){if(await this.dash.create(Yt).show("Do you really want to remove this comment?"))try{await this.model.exec("delete","Comment",{id:this.comment.id})}catch(e){this.log.error("Cannot delete comment with ID "+this.comment.id)}}}s(51);class Xs{constructor(e){this.dash=e,this.listItems=new Map,this.showText=!1,this.model=this.dash.app.model,this.log=this.dash.app.log;const{root:t,ref:s,update:n}=function(e){const t=new Map,s=document.createElement("div");s.setAttribute("class","TaskCommentEditor");const n=document.createElement("header");s.appendChild(n),n.setAttribute("class","TaskCommentEditor-header");const r=document.createElement("ul");s.appendChild(r),r.setAttribute("class","TaskCommentEditor-ul");const i=document.createElement("button");s.appendChild(i),i.setAttribute("class","Btn TaskCommentEditor-button");const o=document.createElement("div");s.appendChild(o);const a=document.createTextNode("Comments");n.appendChild(a);const l=document.createTextNode("");i.appendChild(l),(e=>{let s=t.get(e);return s||(s=[],t.set(e,s)),s})("btnLabel").push(e=>l.nodeValue=e);const c=document.createElement("textarea");o.appendChild(c),c.setAttribute("class","TaskCommentEditor-textarea"),c.setAttribute("rows","10"),c.setAttribute("cols","25");const d=document.createElement("button");o.appendChild(d),d.setAttribute("class","TaskCommentEditor-button Btn WithLoader -right"),d.setAttribute("type","button");const h=document.createTextNode("\n      Save comment\n      ");d.appendChild(h);const u=document.createElement("span");d.appendChild(u),u.setAttribute("class","WithLoader-l"),u.setAttribute("hidden","");const p={ul:r,btnToggle:i,showIfText:o,textarea:c,btnAdd:d,spinner:u},m=e=>{for(const[s,n]of t.entries())s in e&&n.forEach(t=>t(e[s]))};return e&&m(e),{root:s,refs:p,ref:e=>{if(!p[e])throw new Error(`Missing handle: '${e}'`);return p[e]},update:m}}();this.el=t,this.update=n,this.showIfTextEl=s("showIfText"),this.listEl=s("ul"),this.textEl=s("textarea"),this.spinnerEl=s("spinner"),s("btnAdd").addEventListener("click",()=>{this.task&&this.onSubmit().catch(e=>this.dash.log.error(e))}),s("btnToggle").addEventListener("click",()=>{this.setShowText(!this.showText)}),this.dash.listenToModel("createComment",e=>{if(!this.task)return;const t=e.model;t.taskId===this.task.id&&this.addComment(t)}),this.dash.listenToModel("deleteComment",e=>{if(!this.task)return;const t=e.id,s=this.listItems.get(t);s&&(this.listEl.removeChild(s),this.listItems.delete(t))})}addComment(e){const t=document.createElement("li");this.listItems.set(e.id,t),t.appendChild(this.dash.create(Js,e).el),this.listEl.appendChild(t)}getTask(){return this.task}setTask(e){this.task=e,this.textEl.value="",p(this.listEl),this.loadComments().catch(e=>this.dash.log.error(e))}setShowText(e){this.showText=e,this.update({btnLabel:e?"Hide ▴":"Add comment ▾"}),this.showIfTextEl.hidden=!e}async onSubmit(){if(!this.task)return;const e=this.textEl.value.trim();if(0===e.length)return;const t={body:e,taskId:this.task.id};this.spinnerEl.hidden=!1;try{await this.model.exec("create","Comment",t),this.textEl.value=""}catch(e){this.log.error("Unable to create new comment")}this.spinnerEl.hidden=!0}async loadComments(){if(this.task)try{const e=await this.task.getComments();for(const t of e)this.addComment(t)}catch(e){this.log.error("Unable to get task comments...",e)}}}class Ys{constructor(e){this.dash=e,this.log=this.dash.app.log;const{root:t,ref:s}=function(){const e=document.createElement("div");e.setAttribute("class","TaskCommitViewer");const t=document.createElement("table");e.appendChild(t);const s=document.createElement("thead");t.appendChild(s);const n=document.createElement("tbody");t.appendChild(n);const r=document.createElement("tr");s.appendChild(r);const i=document.createElement("td");r.appendChild(i);const o=document.createElement("td");r.appendChild(o);const a=document.createElement("td");r.appendChild(a);const l=document.createElement("td");r.appendChild(l);const c=document.createTextNode("Author");i.appendChild(c);const d=document.createTextNode("Message");o.appendChild(d);const h=document.createTextNode("Date");a.appendChild(h);const u=document.createTextNode("URL");l.appendChild(u);const p={table:t};return{root:e,refs:p,ref:e=>{if(!p[e])throw new Error(`Missing handle: '${e}'`);return p[e]},update:()=>{}}}();this.el=t,this.tableEl=s("table")}setTask(e){if(this.task=e,p(this.tableEl.tBodies[0]),e&&e.gitCommits&&0!==e.gitCommits.length)for(const t of e.gitCommits)this.showCommit(t)}showCommit(e){const t=this.tableEl.tBodies[0].insertRow();t.insertCell().textContent=e.authorName,t.insertCell().textContent=e.message,t.insertCell().textContent=new Date(e.ts).toDateString();const s=document.createElement("a");s.href=e.url,s.target="_blank",s.textContent="Visit",t.insertCell().appendChild(s)}}s(52);class Ks{constructor(e){this.dash=e,this.model=this.dash.app.model,this.log=this.dash.app.log;const{root:t,ref:s}=function(){const e=document.createElement("div");e.setAttribute("class","TaskLogViewer");const t=document.createElement("div");e.appendChild(t),t.setAttribute("class","TaskLogViewerLoader");const s=document.createElement("table");e.appendChild(s),s.setAttribute("class","TaskLogViewer-table");const n=document.createElement("p");t.appendChild(n);const r=document.createElement("div");t.appendChild(r),r.setAttribute("class","TaskLogViewerLoader-l LoaderBg");const i=document.createElement("thead");s.appendChild(i);const o=document.createElement("tbody");s.appendChild(o);const a=document.createTextNode("Loading logs");n.appendChild(a);const l=document.createElement("tr");i.appendChild(l);const c=document.createElement("td");l.appendChild(c);const d=document.createElement("td");l.appendChild(d);const h=document.createElement("td");l.appendChild(h);const u=document.createElement("td");l.appendChild(u);const p=document.createTextNode("ID");c.appendChild(p);const m=document.createTextNode("Date");d.appendChild(m);const f=document.createTextNode("Step");h.appendChild(f);const g=document.createTextNode("Account");u.appendChild(g);const b={loader:t,table:s};return{root:e,refs:b,ref:e=>{if(!b[e])throw new Error(`Missing handle: '${e}'`);return b[e]},update:()=>{}}}();this.el=t,this.loadIndicatorEl=s("loader"),this.tableEl=s("table"),this.dash.listenTo(this.model,"createTaskLogEntry",e=>{const t=e.model;this.task&&this.task.id===t.taskId&&this.addEntry(t)})}getTask(){return this.task}setTask(e){this.task=e,p(this.tableEl.tBodies[0]),this.loadTaskLogEntries().catch(e=>this.dash.log.error(e))}addEntry(e){const t=this.tableEl.tBodies[0].insertRow();t.insertCell().textContent=e.id,t.insertCell().textContent=new Date(e.entryTs).toLocaleTimeString(),t.insertCell().textContent=e.step.label,t.insertCell().textContent=e.account.login}async loadTaskLogEntries(){if(this.task){this.loadIndicatorEl.hidden=!1;try{const e=await this.task.getLogEntries();for(const t of e)this.addEntry(t)}catch(e){this.log.error("Cannot get log entries for task "+this.task.id)}this.loadIndicatorEl.hidden=!0}}}class Zs{constructor(e,t){this.dash=e,this.model=this.dash.app.model,this.log=this.dash.app.log,this.options={noArchiveBtn:t&&t.noArchiveBtn||!1,noPostponeBtn:t&&t.noPostponeBtn||!1},this.delayedSave=new Rs({action:()=>this.updateTask(),onChangeStatus:e=>{this.spinnerEl.hidden=!e,"delaying"===e?this.spinnerEl.classList.add("-delaying"):this.spinnerEl.classList.remove("-delaying")},logError:e=>this.log.error(e)});const{root:s,ref:n,update:r}=function(e){const t=new Map,s=e=>{let s=t.get(e);return s||(s=[],t.set(e,s)),s},n=document.createElement("div");n.setAttribute("class","TaskForm"),n.setAttribute("hidden","");const r=document.createElement("fieldset");n.appendChild(r);const i=document.createElement("header");r.appendChild(i),i.setAttribute("class","TitleBar2");const o=document.createElement("div");r.appendChild(o),o.setAttribute("class","FieldGroup");const a=document.createTextNode("");i.appendChild(a),s("code").push(e=>a.nodeValue=e);const l=document.createElement("span");i.appendChild(l),l.setAttribute("class","LoaderBg"),l.setAttribute("hidden","");const c=document.createElement("label");o.appendChild(c),c.setAttribute("class","FieldGroup-item Field");const d=document.createElement("label");o.appendChild(d),d.setAttribute("class","FieldGroup-item Field");const h=document.createElement("div");o.appendChild(h),h.setAttribute("class","FieldGroup-item");const u=document.createElement("div");o.appendChild(u),u.setAttribute("class","FieldGroup-item");const p=document.createElement("div");o.appendChild(p),p.setAttribute("class","FieldGroup-action");const m=document.createElement("div");o.appendChild(m),m.setAttribute("class","FieldGroup-item");const f=document.createElement("div");o.appendChild(f),f.setAttribute("class","FieldGroup-item");const g=document.createElement("div");o.appendChild(g),g.setAttribute("class","FieldGroup-action");const b=document.createElement("div");o.appendChild(b),b.setAttribute("class","FieldGroup-action");const w=document.createElement("span");c.appendChild(w),w.setAttribute("class","Field-lbl");const v=document.createElement("input");c.appendChild(v),v.setAttribute("class","Field-input"),v.setAttribute("type","text"),s("label").push(e=>v.setAttribute("value",e));const y=document.createElement("span");d.appendChild(y),y.setAttribute("class","Field-lbl");const E=document.createElement("textarea");d.appendChild(E),E.setAttribute("class","Field-input -textarea"),s("description").push(e=>E.setAttribute("value",e)),E.setAttribute("rows","4"),E.setAttribute("placeholder","Task description");const k=document.createElement("button");p.appendChild(k),k.setAttribute("class","Btn WithLoader -right"),k.setAttribute("type","button");const C=document.createElement("button");p.appendChild(C),C.setAttribute("class","Btn"),C.setAttribute("type","button");const _=document.createElement("button");p.appendChild(_),_.setAttribute("class","Btn"),_.setAttribute("type","button");const T=document.createElement("button");g.appendChild(T),T.setAttribute("class","Btn");const S=document.createElement("button");g.appendChild(S),S.setAttribute("class","Btn");const A=document.createElement("button");g.appendChild(A),A.setAttribute("class","Btn");const x=document.createElement("button");b.appendChild(x),x.setAttribute("class","Btn WithLoader -right");const M=document.createTextNode("Label");w.appendChild(M);const L=document.createTextNode("Description");y.appendChild(L);const I=document.createTextNode("\n          Submit ");k.appendChild(I);const P=document.createElement("span");k.appendChild(P),P.setAttribute("class","WithLoader-l"),P.setAttribute("hidden","");const j=document.createTextNode("Archive task");C.appendChild(j);const B=document.createTextNode("");_.appendChild(B),s("postponeLabel").push(e=>B.nodeValue=e);const N=document.createTextNode("Sub-tasks");T.appendChild(N);const D=document.createTextNode("Show logs");S.appendChild(D);const F=document.createTextNode("Show commits");A.appendChild(F);const O=document.createTextNode("\n          Delete task ");x.appendChild(O);const $=document.createElement("span");x.appendChild($),$.setAttribute("class","WithLoader-l"),$.setAttribute("hidden","");const U={fieldset:r,spinner:l,flag:h,account:u,comment:m,attachment:f,label:v,description:E,submit:k,archiveBtn:C,postponeBtn:_,toggleBtn:T,logBtn:S,commitsBtn:A,btnDelete:x,submitSpinner:P,deleteSpinner:$},z=e=>{for(const[s,n]of t.entries())s in e&&n.forEach(t=>t(e[s]))};return e&&z(e),{root:n,refs:U,ref:e=>{if(!U[e])throw new Error(`Missing handle: '${e}'`);return U[e]},update:z}}();this.el=s,this.update=r,this.spinnerEl=n("spinner"),this.labelEl=n("label"),this.descriptionEl=n("description"),this.submitSpinnerEl=n("submitSpinner"),this.archiveBtnEl=n("archiveBtn"),this.postponeBtnEl=n("postponeBtn"),this.updateView(),this.options.noPostponeBtn||this.postponeBtnEl.addEventListener("click",()=>{this.currentTask&&"2"!==this.currentTask.curStepId&&("1"===this.currentTask.curStepId?this.reactivateTask().catch(e=>this.dash.log.error(e)):this.putTaskOnHold().catch(e=>this.dash.log.error(e)))}),this.options.noArchiveBtn||this.archiveBtnEl.addEventListener("click",()=>this.archiveTask()),n("submit").addEventListener("click",()=>this.updateTask()),n("toggleBtn").addEventListener("click",()=>{this.currentTask&&this.dash.emit("showStepSwitcher",this.currentTask)}),n("logBtn").addEventListener("click",()=>{this.currentTask&&this.logViewer.open().catch(e=>this.dash.log.error(e))}),n("btnDelete").addEventListener("click",()=>{this.currentTask&&this.deleteTask().catch(e=>this.dash.log.error(e))}),n("commitsBtn").addEventListener("click",()=>{this.currentTask&&this.commitViewer.open().catch(e=>this.dash.log.error(e))}),this.flagSelector=this.dash.create(Vs),n("flag").appendChild(this.flagSelector.el),this.accountSelector=this.dash.create(Ws),n("account").appendChild(this.accountSelector.el),this.commentEditor=this.dash.create(Xs),n("comment").appendChild(this.commentEditor.el),this.attachmentMgr=this.dash.create(qs),n("attachment").appendChild(this.attachmentMgr.el),this.commitViewer=this.dash.create(j,{content:this.dash.create(Ys),title:"Task commits"}),this.logViewer=this.dash.create(j,{content:this.dash.create(Ks),title:"Task logs"}),this.dash.listenToModel("deleteTask",e=>{void 0!==this.currentTask&&this.currentTask.id===e.id&&this.setTask()}),this.dash.listenToModel("updateTask",e=>{this.currentTask&&this.currentTask.id===e.id&&this.updateView()}),this.labelEl.addEventListener("input",()=>this.delayedSave.delay()),this.descriptionEl.addEventListener("input",()=>this.delayedSave.delay()),this.dash.listenTo("change",()=>this.delayedSave.delay())}get task(){return this.currentTask}setTask(e){this.delayedSave.reset({flush:!0}),this.flagSelector.setTask(e),this.accountSelector.setTask(e),this.commentEditor.setTask(e),this.attachmentMgr.setTask(e),this.logViewer.content.setTask(e),this.commitViewer.content.setTask(e),this.currentTask=e,this.updateView(),this.el.hidden=!e}async deleteTask(){if(this.currentTask&&!((this.currentTask.children||[]).length>0)&&confirm("Do you really want to remove this task?"))try{await this.model.exec("delete","Task",{id:this.currentTask.id})}catch(e){this.log.info("Unable to delete task",e)}}async updateTask(){if(!this.currentTask||this.currentTask.currentStep.isSpecial)return;const e=this.labelEl.value.trim();if(e.length<4)this.log.info("Cannot update task with a label with less than 1 characters.");else{this.showSpinner();try{await this.model.exec("update","Task",{id:this.currentTask.id,label:e.trim(),description:this.descriptionEl.value.trim()||"",flagIds:this.flagSelector.getSelectedFlagIds(),affectedToIds:this.accountSelector.selectedAccountIds})}catch(e){this.refresh()}this.hideSpinner()}}refresh(){this.currentTask&&(this.updateView(),this.flagSelector.setTask(this.task),this.accountSelector.refresh())}async archiveTask(){if(!this.currentTask||"2"===this.currentTask.curStepId)return!1;const e=`Do you really want to archive task ${this.currentTask.code}?`;if(!await this.dash.create(Yt).show(e,"Confirm action"))return;this.showSpinner();let t=!1;try{await this.model.exec("update","Task",{id:this.currentTask.id,curStepId:"2"}),t=!0}catch(e){this.log.error("Unable to archive task",e)}return this.hideSpinner(),t&&this.setTask(),t}async putTaskOnHold(){if(!this.currentTask||this.currentTask.currentStep.isSpecial)return!1;const e=`Do you really want to put task ${this.currentTask.code} on hold?`;if(!await this.dash.create(Yt).show(e,"Confirm action"))return;this.showSpinner();let t=!1;try{await this.model.exec("update","Task",{id:this.currentTask.id,curStepId:"1"}),t=!0}catch(e){this.log.error("Unable to put task on hold",e)}return this.hideSpinner(),t&&this.setTask(),t}async reactivateTask(){if(!this.currentTask||"1"!==this.currentTask.curStepId)return!1;const e=`Do you really want to activate task ${this.currentTask.code}?`;if(!await this.dash.create(Yt).show(e,"Confirm action"))return;const t=this.currentTask.project.stepIds;if(0===t.length)return;this.showSpinner();let s=!1;try{await this.model.exec("update","Task",{id:this.currentTask.id,curStepId:t[0]}),s=!0}catch(e){this.log.error("Unable to reactivate task",e)}return this.hideSpinner(),s&&this.setTask(),s}showSpinner(){this.submitSpinnerEl.hidden=!1}hideSpinner(){this.submitSpinnerEl.hidden=!0}updateView(){const e=this.currentTask,t=e?e.code:"",s=e?e.label:"",n=e&&e.description?e.description:"",r=e&&"1"===e.curStepId?"Activate":"Postpone",i=!this.options.noArchiveBtn,o=!this.options.noPostponeBtn;this.archiveBtnEl.hidden=!i,this.postponeBtnEl.hidden=!o,this.update({code:t,label:s,description:n,postponeLabel:r})}}class en{constructor(e,t){this.dash=e,this.project=t,this.model=this.dash.app.model,this.log=this.dash.app.log;const{root:s,ref:n}=function(){const e=document.createElement("div");e.setAttribute("class","ArchivedTaskBoard");const t=document.createElement("div");e.appendChild(t),t.setAttribute("class","ArchivedTaskBoard-left");const s=document.createElement("div");e.appendChild(s),s.setAttribute("class","ArchivedTaskBoard-right");const n={left:t,right:s};return{root:e,refs:n,ref:e=>{if(!n[e])throw new Error(`Missing handle: '${e}'`);return n[e]},update:()=>{}}}();this.el=s,this.boxList=this.dash.create(Vt,{id:"taskList",title:"Tasks",sort:!1}),n("left").appendChild(this.boxList.el),this.taskForm=this.dash.create(Zs,{noArchiveBtn:!0}),n("right").appendChild(this.taskForm.el),this.dash.listenTo("taskBoxSelected",e=>this.taskForm.setTask(e)),this.dash.listenToModel("updateTask",e=>{const t=e.model;t.projectId!==this.project.id||"2"!==t.curStepId||this.boxList.hasBox(t.id)||this.addTaskBox(t)})}async refresh(){this.boxList.clear();const e=await this.fetchTasks();e&&this.displayTasks(e)}displayTasks(e){for(const t of e)t.id!==t.project.rootTaskId&&this.addTaskBox(t)}addTaskBox(e){const t=this.dash.create(zs,e);this.boxList.addBox(t)}async fetchTasks(){let e;try{e=await this.model.fetch("Task",{projectId:this.project.id,curStepId:"2"})}catch(e){this.log.error("Cannot fetch on hold tasks for project",this.project.id)}return e}}s(53);class tn{constructor(e,t){this.dash=e,this.project=t,this.model=this.dash.app.model,this.log=this.dash.app.log;const{root:s,ref:n}=function(){const e=document.createElement("div");e.setAttribute("class","OnHoldTaskBoard");const t=document.createElement("div");e.appendChild(t),t.setAttribute("class","OnHoldTaskBoard-left");const s=document.createElement("div");e.appendChild(s),s.setAttribute("class","OnHoldTaskBoard-right");const n=document.createElement("div");e.appendChild(n),n.setAttribute("class","OnHoldTaskBoardOverlay");const r={left:t,right:s,overlay:n};return{root:e,refs:r,ref:e=>{if(!r[e])throw new Error(`Missing handle: '${e}'`);return r[e]},update:()=>{}}}();this.el=s,this.overlayEl=n("overlay"),this.boxList=this.dash.create(Vt,{id:"taskList",title:"Tasks",sort:!1}),n("left").appendChild(this.boxList.el),this.taskForm=this.dash.create(Zs),n("right").appendChild(this.taskForm.el),this.dash.listenTo("taskBoxSelected",e=>this.taskForm.setTask(e)),this.dash.listenToModel("updateTask",e=>{const t=e.model;t.projectId!==this.project.id||"1"!==t.curStepId||this.boxList.hasBox(t.id)||this.addTaskBox(t)})}async refresh(){this.showOverlay(),this.boxList.clear();const e=await this.fetchTasks();e&&this.displayTasks(e),this.hideOverlay()}displayTasks(e){for(const t of e)t.id!==t.project.rootTaskId&&this.addTaskBox(t)}addTaskBox(e){this.boxList.addBox(this.dash.create(zs,e))}async fetchTasks(){let e;try{e=await this.model.fetch("Task",{projectId:this.project.id,curStepId:"1"})}catch(e){this.log.error("Cannot fetch on hold tasks for project",this.project.id)}return e}showOverlay(){this.overlayEl.hidden=!1}hideOverlay(){this.overlayEl.hidden=!0}}s(54);class sn{constructor(e,t){this.dash=e,this.collapsibleElVisible=!0,this.visible=!0,this.boxLists=new Map,this.taskBoxes=new Map,this.model=e.app.model,this.log=e.app.log,this.parentTask=t.parentTask,this.project=t.parentTask.project;const{root:s,ref:n}=function(){const e=document.createElement("section");e.setAttribute("class","StepSwitcher");const t=document.createElement("header");e.appendChild(t),t.setAttribute("class","StepSwitcherHeader TitleBar Row -spaced");const s=document.createElement("div");e.appendChild(s),s.setAttribute("class","StepSwitcher-foldableContent");const n=document.createElement("div");t.appendChild(n),n.setAttribute("class","Row");const r=document.createElement("div");t.appendChild(r),r.setAttribute("class","Row");const i=document.createElement("div");s.appendChild(i),i.setAttribute("class","AutoColumns");const o=document.createElement("div");s.appendChild(o),o.setAttribute("class","StepSwitcher-bottom InputAndBtn");const a=document.createElement("span");n.appendChild(a);const l=document.createElement("div");n.appendChild(l),l.setAttribute("class","DropdownMenuWrapper -asSuffix");const c=document.createElement("span");r.appendChild(c),c.setAttribute("class","LoaderBg"),c.setAttribute("hidden","");const d=document.createElement("button");r.appendChild(d),d.setAttribute("class","StepSwitcherHeader-btn"),d.setAttribute("title","Fold/Unfold");const h=document.createElement("button");r.appendChild(h),h.setAttribute("class","StepSwitcherHeader-btn"),h.setAttribute("title","Close");const u=document.createElement("input");o.appendChild(u),u.setAttribute("class","InputAndBtn-input"),u.setAttribute("type","text"),u.setAttribute("maxlength","255"),u.setAttribute("placeholder","Task name");const p=document.createElement("button");o.appendChild(p),p.setAttribute("class","InputAndBtn-btn Btn WithLoader -right"),p.setAttribute("type","button");const m=document.createTextNode("X");h.appendChild(m);const f=document.createTextNode("\n        Add task\n        ");p.appendChild(f);const g=document.createElement("span");p.appendChild(g),g.setAttribute("class","WithLoader-l"),g.setAttribute("hidden","");const b={foldable:s,boxLists:i,bottom:o,title:a,menu:l,indicator:c,toggleBtn:d,closeBtn:h,taskName:u,addBtn:p,spinner:g};return{root:e,refs:b,ref:e=>{if(!b[e])throw new Error(`Missing handle: '${e}'`);return b[e]},update:()=>{}}}();this.el=s,this.foldableEl=n("foldable"),this.listContainerEl=n("boxLists"),this.taskNameEl=n("taskName"),this.toggleBtnEl=n("toggleBtn"),this.spinnerEl=n("spinner"),this.busyIndicatorEl=n("indicator"),this.bottomEl=n("bottom"),t.dropdownMenu&&n("menu").appendChild(t.dropdownMenu.btnEl),this.toggleBtnEl.textContent="▲",n("title").textContent=t.parentTask.label;const r=t.parentTask.id===this.project.rootTaskId,i=n("closeBtn");t.parentTask.children&&t.parentTask.children.length>0&&(i.hidden=!0),i.addEventListener("click",()=>{const e=t.parentTask.children&&0!==t.parentTask.children.length;r||e||this.setVisible(!1)}),n("addBtn").addEventListener("click",()=>this.onAddtaskClick()),this.taskNameEl.addEventListener("keyup",e=>{"Enter"===e.key&&this.onAddtaskClick().catch(e=>this.dash.log.error(e))}),n("toggleBtn").addEventListener("click",()=>this.toggleFoldableContent()),this.createBoxLists(),this.fillBoxLists(),this.addModelListeners(),this.dash.listenTo("boxListItemAdded",e=>this.onTaskBoxMove(e)),this.dash.listenTo("boxListSortingUpdated",e=>this.onTaskReorder(e))}showBusyIcon(){this.busyIndicatorEl.hidden=!1}hideBusyIcon(){this.busyIndicatorEl.hidden=!0}setVisible(e){e!==this.visible&&(this.el.hidden=!e,this.visible=e)}isVisible(){return this.visible}enable(e=!1){this.foldableEl.style.pointerEvents=this.el.style.pointerEvents="auto",this.foldableEl.style.opacity="1.0",e&&this.hideBusyIcon()}disable(e=!1){this.foldableEl.style.pointerEvents=this.el.style.pointerEvents="none",this.foldableEl.style.opacity="0.4",e&&this.showBusyIcon()}addModelListeners(){this.dash.listenToModel("updateStep",e=>{const t=e.model;if(this.parentTask.project.allSteps.has(t.id)){const e=this.boxLists.get(t.id);e&&e.setTitle(t.label)}}),this.dash.listenToModel("updateProject",e=>{e.id===this.project.id&&this.reset()}),this.dash.listenTo(this.model,"reorderStep",()=>this.reset()),this.dash.listenToModel("createTask",e=>{const t=e.model;if(t.projectId!==this.project.id||t.parentTaskId!==this.parentTask.id)return;const s=this.boxLists.get(t.curStepId);if(s){const e=this.createTaskBoxFor(t);s.addBox(e)}}),this.dash.listenToModel("updateTask",e=>{const t=e.model;if(t.currentStep.isSpecial&&this.parentTask.children&&this.parentTask.children.has(t.id)){for(const e of this.boxLists.values())if(e.removeBox(t.id))break;this.taskBoxes.delete(t.id)}}),this.dash.listenToModel("deleteTask",e=>{const t=e.id;if(!this.taskBoxes.get(t))return;const s=[...this.boxLists.values()].find(e=>e.hasBox(t));s&&s.removeBox(t),this.taskBoxes.delete(t)})}toggleFoldableContent(){this.collapsibleElVisible?(this.toggleBtnEl.textContent="▼",this.foldableEl.hidden=!0):(this.toggleBtnEl.textContent="▲",this.foldableEl.hidden=!1),this.collapsibleElVisible=!this.collapsibleElVisible}reset(){this.dash.children().forEach(e=>this.dash.getPublicDashOf(e).destroy()),p(this.listContainerEl),this.createBoxLists(),this.fillBoxLists()}createBoxLists(){for(const e of this.project.steps)this.listContainerEl.appendChild(this.createBoxListFor(e).el)}createBoxListFor(e){const t=this.dash.create(Vt,{id:e.id,group:this.parentTask.code,title:e.label,sort:!0});return this.boxLists.set(e.id,t),t}createTaskBoxFor(e){const t=this.dash.create(zs,e);return this.dash.addToGroup(t,"items"),this.taskBoxes.set(e.id,t),t}async onTaskBoxMove(e){const t=this.taskBoxes.get(e.boxId),s=this.project.steps.get(e.boxListId);if(!t)throw new Error(`Unable to find task with ID "${e.boxId}" in StepSwitcher`);if(!s)throw new Error(`Unable to find step with ID "${e.boxListId}" in StepSwitcher`);this.disable(!0);try{await this.model.exec("update","Task",{id:t.task.id,curStepId:s.id}),this.sortBoxListContent(s)}catch(e){const n=t.task.id,r=this.parentTask.label;this.log.error(`Unable to update task "${n}" in StepSwitcher "${r}"`),this.restoreTaskBoxPosition(t,s.id)}this.enable(!0)}sortBoxListContent(e){const t=this.boxLists.get(e.id),s=Array.from(this.parentTask.children||[]);t&&(s.filter(t=>t.curStepId===e.id),s.sort((e,t)=>(e.orderNum||0)-(t.orderNum||0)),t.sort(s.map(e=>e.id)))}restoreTaskBoxPosition(e,t){const s=this.parentTask.label,n=this.boxLists.get(t),r=e.task.curStepId,i=this.boxLists.get(e.task.currentStep.id);n?i?(n.removeBox(e.task.id),i.addBox(e)):this.log.error(`Cannot find BoxList with ID "${r}" in StepSwitcher "${s}"`):this.log.error(`Cannot find BoxList with ID "${t}" in StepSwitcher "${s}"`)}fillBoxLists(){if(this.parentTask.children)for(const e of this.parentTask.children){if(e.currentStep.isSpecial)continue;const t=this.boxLists.get(e.currentStep.id);if(t){const s=this.createTaskBoxFor(e);t.addBox(s)}else this.log.info(`Missing step "${e.currentStep.id}" in StepSwitcher`,this)}}async onAddtaskClick(){const e=this.taskNameEl.value.trim();return e.length<2?(this.log.warn("Impossible to create a new task. Invalid name..."),await this.dash.app.alert("Impossible to create a new task. Name should have 2 characters."),void this.taskNameEl.focus()):0===this.project.steps.length?(this.log.warn("Impossible to create a new task. Project has no step."),void this.taskNameEl.focus()):(this.bottomEl.style.pointerEvents="none",this.spinnerEl.hidden=!1,await this.createTask(e)&&(this.taskNameEl.value=""),this.spinnerEl.hidden=!0,this.bottomEl.style.pointerEvents="auto",void this.taskNameEl.focus())}async onTaskReorder(e){const t=e.boxListId,s=this.parentTask.label,n=this.boxLists.get(t);if(n){n.disable(!0);try{await this.model.reorder("Task",e.boxIds,"childOf",this.parentTask.id)}catch(e){this.log.error(`Impossible to reorder tasks in StepSwitcher "${s}"`),this.restoreBoxListOrder(t)}n.enable(!0)}else this.log.error(`Unknown BoxList with ID ${t} in StepSwitcher ${s}`)}restoreBoxListOrder(e){const t=this.parentTask.label,s=this.boxLists.get(e);if(!s)return void this.log.error(`Cannot restore order in list "${e}" in StepSwitcher "${t}"`);const n=[];for(const t of this.parentTask.children||[])t.currentStep.id===e&&n.push(t.id);s.sort(n)}async createTask(e){let t=!1;try{const s=this.project.steps;if(0===s.length)throw new Error("Cannot create task, there is no steps!");await this.model.exec("create","Task",{label:e,parentTaskId:this.parentTask.id,curStepId:s[0].id}),t=!0}catch(e){this.log.error("Unable to create task",e)}return t}}class nn{constructor(e,t){this.dash=e,this.options=t,this.stepSwitcherMap=new Map;const{root:s,ref:n}=function(){const e=document.createElement("div");e.setAttribute("class","SelEditBoard");const t=document.createElement("div");e.appendChild(t),t.setAttribute("class","SelEditBoard-sel");const s=document.createElement("div");e.appendChild(s),s.setAttribute("class","SelEditBoard-edit");const n={sel:t,edit:s};return{root:e,refs:n,ref:e=>{if(!n[e])throw new Error(`Missing handle: '${e}'`);return n[e]},update:()=>{}}}();this.el=s,this.selEl=n("sel"),this.taskForm=this.dash.create(Zs),n("edit").appendChild(this.taskForm.el);const r=this.createStepSwitcher(t.rootTask,t.dropdownMenu);this.selEl.appendChild(r.el),this.createStepSwitchersForChildren(t.rootTask),this.addDashListeners(),this.addModelListeners()}setTask(e){this.taskForm.setTask(e)}hide(){this.el.hidden=!0}show(){this.el.hidden=!1}addDashListeners(){this.dash.listenTo("taskBoxSelected",e=>this.dash.app.navigate(`/prj-${e.project.id}/${e.code}`)),this.dash.listenTo("showStepSwitcher",e=>{e.id!==this.options.rootTask.id&&this.showStepSwitcher(e)})}addModelListeners(){this.dash.listenToModel("deleteTask",e=>{const t=e.id;this.removeStepSwitcherOf(t)}),this.dash.listenToModel("updateTask",e=>{const t=e.model;t.currentStep.isSpecial&&this.options.rootTask.children&&this.options.rootTask.children.has(t.id)&&this.removeLineageStepSwitchers(t)})}removeStepSwitcherOf(e){const t=this.stepSwitcherMap.get(e);t&&(this.selEl.removeChild(t.el),this.stepSwitcherMap.delete(e))}createStepSwitcher(e,t){const s=this.dash.create(sn,{parentTask:e,dropdownMenu:t});return this.stepSwitcherMap.set(e.id,s),s}createStepSwitchersForChildren(e){e.children&&0!==e.children.length&&e.children.filter(e=>e.children&&0!==e.children.length).forEach(e=>{const t=this.createStepSwitcher(e);this.selEl.appendChild(t.el),this.createStepSwitchersForChildren(e)})}removeLineageStepSwitchers(e){const t=e.children||[];for(const e of t)this.removeLineageStepSwitchers(e);this.removeStepSwitcherOf(e.id)}showStepSwitcher(e){let t=this.stepSwitcherMap.get(e.id);if(t)return void t.setVisible(!0);const s=e.parent;if(!s||!s.children)throw new Error(`Task without a parent or invalid parent: task ${e} parent: ${s}`);const n=this.stepSwitcherMap.get(s.id);if(!n)throw new Error(`Unable to find StepSwitcher with ID ${s.id} in TaskBoard`);const r=s.children.findIndex(t=>t.id===e.id);if(r<0)throw new Error(`Unable to find task in its parent children: task: ${e.label} parent: ${s.label}`);let i;for(const e of s.children.slice(0,r))if(i=this.stepSwitcherMap.get(e.id),void 0!==i)break;t=this.createStepSwitcher(e);const o=this.selEl,a=i?i.el:n.el;o.insertBefore(t.el,a.nextSibling)}}s(55);class rn{constructor(e,t){this.dash=e,this.project=t,this.model=this.dash.app.model,this.dropdownMenu=this.createDropdownMenu(),this.taskBoard=this.dash.create(nn,{rootTask:this.project.rootTask,dropdownMenu:this.createDropdownMenu()}),this.onHoldTaskBoard=this.dash.create(tn,this.project),this.archivedTaskBoard=this.dash.create(en,this.project),this.form=this.dash.create(Cs),this.form.setProject(this.project),this.childRouter=ts(),this.childRouter.addAsyncErrorListener(t=>e.log.error(t)),this.childRouter.map({route:":task",activate:t=>{const s=t.routeParams.task,n=e.app.model.findTaskByCode(s);n&&this.taskBoard.setTask(n)},title:"My Profile"})}activate(e){this.ctrl=e,e.setContentEl(this.taskBoard.el).setTitle(this.project.name).setTitleRightEl(this.dropdownMenu.btnEl).showTitleBar(!1)}async deleteProject(){if(this.project.tasks&&0!==this.project.tasks.length)await this.dash.create(Xt).show("Sorry. The project can not be deleted. It contains tasks.");else if(confirm("Are you sure you want to delete this project"))try{await this.model.exec("delete","Project",{id:this.project.id})}catch(e){await this.dash.create(I).show("Unable to delete project. Try again later.")}}createDropdownMenu(){const e=this.dash.create(O,{btnEl:ps(),align:"left"});return e.entries.createNavBtn({label:"Edit project",onClick:()=>{this.ctrl&&this.ctrl.setContentEl(this.form.el).setTitle("Edit: "+this.project.name)}},{label:"Show taskboard",onClick:()=>{this.ctrl&&this.ctrl.setContentEl(this.taskBoard.el).setTitle(this.project.name).showTitleBar(!1)}},{label:"Delete project",onClick:()=>this.deleteProject()},{label:"Show on hold tasks",onClick:()=>{this.ctrl&&(this.ctrl.setContentEl(this.onHoldTaskBoard.el),this.ctrl.setTitle(this.project.name+": on hold tasks"),this.onHoldTaskBoard.refresh().catch(e=>this.dash.log.error(e)))}},{label:"Show archived tasks",onClick:()=>{this.ctrl&&(this.ctrl.setContentEl(this.archivedTaskBoard.el),this.ctrl.setTitle(this.project.name+": archived tasks"),this.archivedTaskBoard.refresh().catch(e=>this.dash.log.error(e)))}}),e}}s(56);class on{constructor(e){this.dash=e,this.model=this.dash.app.model,this.log=this.dash.app.log;const{root:t,ref:s,update:n}=function(e){const t=new Map,s=document.createElement("div");s.setAttribute("class","StepForm");const n=document.createElement("header");s.appendChild(n),n.setAttribute("class","StepForm-header BlockTitle");const r=document.createElement("div");s.appendChild(r);const i=document.createElement("span");n.appendChild(i);const o=document.createElement("div");n.appendChild(o);const a=document.createElement("fieldset");r.appendChild(a),a.setAttribute("class","FieldGroup");const l=document.createTextNode("Step");i.appendChild(l);const c=document.createElement("label");a.appendChild(c),c.setAttribute("class","FieldGroup-item Field");const d=document.createElement("div");a.appendChild(d),d.setAttribute("class","FieldGroup-action");const h=document.createElement("span");c.appendChild(h),h.setAttribute("class","Field-lbl");const u=document.createElement("input");c.appendChild(u),u.setAttribute("class","Field-input"),u.setAttribute("type","text"),u.setAttribute("required",""),(e=>{let s=t.get(e);return s||(s=[],t.set(e,s)),s})("name").push(e=>u.setAttribute("value",e));const p=document.createElement("button");d.appendChild(p),p.setAttribute("class","Btn WithLoader -right"),p.setAttribute("type","button"),p.setAttribute("disabled","");const m=document.createTextNode("\n         \n        ");d.appendChild(m);const f=document.createElement("button");d.appendChild(f),f.setAttribute("type","button");const g=document.createTextNode("Name");h.appendChild(g);const b=document.createTextNode("\n          Submit\n          ");p.appendChild(b);const w=document.createElement("span");p.appendChild(w),w.setAttribute("class","WithLoader-l"),w.setAttribute("hidden","");const v=document.createTextNode("Cancel");f.appendChild(v);const y={form:r,menu:o,fieldset:a,name:u,submitBtn:p,cancelBtn:f,spinner:w},E=e=>{for(const[s,n]of t.entries())s in e&&n.forEach(t=>t(e[s]))};return e&&E(e),{root:s,refs:y,ref:e=>{if(!y[e])throw new Error(`Missing handle: '${e}'`);return y[e]},update:E}}();this.update=n,this.el=t,this.fieldsetEl=s("fieldset"),this.nameEl=s("name"),this.spinnerEl=s("spinner"),this.dropdownMenu=this.dash.create(O,{btnEl:ps()}),this.dropdownMenu.entries.createNavBtn({label:"Delete step",onClick:()=>this.deleteCurrentStep()}),s("menu").appendChild(this.dropdownMenu.btnEl);const r=s("submitBtn");r.addEventListener("click",()=>{const e=this.nameEl.value.trim();0!==e.length?this.updateStep(e).catch(e=>this.dash.log.error(e)):this.log.warn("The name of the step should contain more characters.")}),s("cancelBtn").addEventListener("click",()=>{this.clearContent(),r.setAttribute("disabled","true"),this.step&&this.updateView()}),this.nameEl.addEventListener("keyup",e=>{r.getAttribute("disabled")||"Enter"!==e.key||r.click()}),this.nameEl.addEventListener("input",()=>r.removeAttribute("disabled")),this.dash.listenToModel("deleteStep",e=>{this.step&&this.step.id===e.id&&this.reset()}),this.dash.listenTo(this.model,"endProcessingStep",e=>this.onEndProcessing(e)),this.dash.listenTo(this.model,"processingStep",e=>this.onProcessing(e))}reset(){this.step=void 0,this.clearContent(),this.unlockForm()}getStep(){return this.step}setStep(e){this.reset(),this.step=e,this.updateView(),this.step.updateTools.processing&&this.lockForm()}onEndProcessing(e){this.step&&this.step.id===e.id&&(this.updateView(),this.unlockForm())}onProcessing(e){this.step&&this.step.id===e.id&&this.lockForm()}async updateStep(e){if(!this.step)return;const t=this.step.id,s=this.step.updateTools.getDiffToUpdate({id:t,label:e});!s||0===Object.keys(s).length&&s.constructor===Object||await this.model.exec("update","Step",{...s,id:t})}async deleteCurrentStep(){if(this.step)try{if(await this.step.updateTools.whoUse())return void await this.dash.create(Xt).show("Can't delete step.");await this.model.exec("delete","Step",{id:this.step.id})}catch(e){this.log.error("Error while deleting Step with ID "+this.step.id)}}updateView(){this.step&&this.update({name:this.step.label,orderNum:(this.step.orderNum||"").toString()})}clearContent(){this.update({name:"",orderNum:""})}lockForm(){this.fieldsetEl.disabled=!0,this.dropdownMenu.disable(),this.showSpinner()}unlockForm(){this.fieldsetEl.disabled=!1,this.dropdownMenu.enable(),this.hideSpinner()}showSpinner(){this.spinnerEl.hidden=!1}hideSpinner(){this.spinnerEl.hidden=!0}}class an{constructor(e){this.dash=e,this.model=this.dash.app.model,this.log=this.dash.app.log;const{root:t,ref:s}=function(){const e=document.createElement("div");e.setAttribute("class","SelEditBoard");const t=document.createElement("div");e.appendChild(t),t.setAttribute("class","SelEditBoard-sel");const s=document.createElement("div");e.appendChild(s),s.setAttribute("class","SelEditBoard-edit");const n=document.createElement("div");t.appendChild(n);const r=document.createElement("div");t.appendChild(r),r.setAttribute("class","InputAndBtn");const i=document.createElement("input");r.appendChild(i),i.setAttribute("class","InputAndBtn-input"),i.setAttribute("type","text"),i.setAttribute("required","");const o=document.createElement("button");r.appendChild(o),o.setAttribute("class","InputAndBtn-btn Btn WithLoader -right"),o.setAttribute("type","button");const a=document.createTextNode("\n        Add\n        ");o.appendChild(a);const l=document.createElement("span");o.appendChild(l),l.setAttribute("class","WithLoader-l"),l.setAttribute("hidden","");const c={edit:s,sel:n,add:r,input:i,btn:o,spinner:l};return{root:e,refs:c,ref:e=>{if(!c[e])throw new Error(`Missing handle: '${e}'`);return c[e]},update:()=>{}}}();this.el=t,this.nameEl=s("input"),this.spinnerEl=s("spinner");const n=s("btn");n.addEventListener("click",()=>this.onAdd()),this.nameEl.addEventListener("keyup",e=>{"Enter"===e.key&&n.click()}),this.boxList=this.dash.create(Vt,{sort:!0}),s("sel").appendChild(this.boxList.el),this.form=this.dash.create(on),s("edit").appendChild(this.form.el),this.fillBoxList(),this.dash.listenTo("stepBoxSelected",e=>{this.form.setStep(e)}),this.dash.listenTo("boxListSortingUpdated",e=>this.scheduleStepOrderUpdate(e)),this.dash.listenToModel("createStep",e=>{const t=e.model,s=this.dash.create(ks,t);this.boxList.addBox(s)}),this.dash.listenToModel("deleteStep",e=>this.boxList.removeBox(e.id))}activate(e){e.setContentEl(this.el).setTitle("Steps")}onAdd(){const e=this.nameEl.value.trim();e.length>0?this.addStep(e).catch(e=>this.dash.log.error(e)):(this.log.warn("The name you entered for the step is invalid."),this.nameEl.focus())}scheduleStepOrderUpdate(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.doStepOrderUpdate(e.boxIds).catch(e=>this.dash.log.error(e))},2e3)}async doStepOrderUpdate(e){const t=this.boxList.getOrder();this.boxList.disable(!0);try{const t=await this.dash.app.model.reorder("Step",e);u(t,e)||(this.log.error("Sorry. Server rejected new order of steps.",t,e),this.boxList.sort(t))}catch(e){this.log.info("Sorry. Unable to save the new order of steps on server.",e),this.boxList.sort(t)}this.boxList.enable(!0),this.form.reset()}fillBoxList(){for(const e of this.model.global.steps)e.isSpecial||this.boxList.addBox(this.dash.create(ks,e))}async addStep(e){this.spinnerEl.hidden=!1;try{await this.model.exec("create","Step",{label:e}),this.nameEl.value=""}catch(e){this.log.error("Unable to create new step...")}this.spinnerEl.hidden=!0,this.nameEl.focus()}}s(57);class ln{constructor(e){this.dash=e,this.model=this.dash.app.model;const{root:t,ref:s}=function(){const e=document.createElement("div");e.setAttribute("class","SearchWorkspace");const t=document.createElement("div");e.appendChild(t),t.setAttribute("class","SearchWorkspace-searchDiv");const s=document.createElement("div");e.appendChild(s),s.setAttribute("class","SearchWorkspace-body");const n=document.createElement("input");t.appendChild(n),n.setAttribute("type","text"),n.setAttribute("placeholder","Search tasks"),n.setAttribute("class","SearchWorkspace-searchInput");const r=document.createElement("div");s.appendChild(r),r.setAttribute("class","SearchWorkspace-bodyLeft");const i=document.createElement("div");s.appendChild(i),i.setAttribute("class","SearchWorkspace-bodyRight");const o={input:n,left:r,right:i};return{root:e,refs:o,ref:e=>{if(!o[e])throw new Error(`Missing handle: '${e}'`);return o[e]},update:()=>{}}}();this.el=t,this.inputEl=s("input"),this.inputEl.addEventListener("keypress",e=>this.onSearch(e)),this.boxList=this.dash.create(Vt,{title:"Search results"}),s("left").appendChild(this.boxList.el),this.taskForm=this.dash.create(Zs),s("right").appendChild(this.taskForm.el),this.dash.listenTo("taskBoxSelected",e=>{this.taskForm.setTask(e)})}activate(e){e.setContentEl(this.el).setTitle("Search tasks")}async onSearch(e){if("Enter"!==e.key)return;const t=this.inputEl.value.trim();if(0!==t.length){this.boxList.clear(),this.taskForm.setTask();try{const e=await this.model.fetch("Task",{search:t});this.fillBoxList(e)}catch(e){this.dash.log.error("Unable to get search results",e)}}}fillBoxList(e){for(const t of e){const e=this.dash.create(zs,t);this.boxList.addBox(e)}}}class cn{constructor(e,t){this.dash=e,this.project=t.project;const{root:s,update:n}=function(e){const t=new Map,s=e=>{let s=t.get(e);return s||(s=[],t.set(e,s)),s},n=document.createElement("button");n.setAttribute("class","ProjectBtn"),n.setAttribute("type","button");const r=document.createElement("i");n.appendChild(r),r.setAttribute("class","ProjectBtn-code");const i=document.createTextNode("\n  –\n  ");n.appendChild(i);const o=document.createElement("span");n.appendChild(o),o.setAttribute("class","ProjectBtn-name");const a=document.createTextNode("");r.appendChild(a),s("code").push(e=>a.nodeValue=e);const l=document.createTextNode("");o.appendChild(l),s("name").push(e=>l.nodeValue=e);const c={},d=e=>{for(const[s,n]of t.entries())s in e&&n.forEach(t=>t(e[s]))};return e&&d(e),{root:n,refs:c,ref:e=>{if(!c[e])throw new Error(`Missing handle: '${e}'`);return c[e]},update:d}}();this.el=s,f(this.el,t.cssClass),this.el.addEventListener("click",m(()=>{this.dash.app.navigate("/prj-"+this.project.id)})),n(this.project),e.listenTo(e.app.model,"updateProject",e=>{e.id===this.project.id&&n(this.project)})}addCssClass(e){f(this.el,e)}}s(58);class dn{constructor(e){this.dash=e,this.buttons=new Map;const{root:t,ref:s}=function(){const e=document.createElement("section");e.setAttribute("class","Sidebar FlexBar -column");const t=document.createElement("div");e.appendChild(t),t.setAttribute("class","-grow");const s=document.createElement("div");e.appendChild(s),s.setAttribute("class","Sidebar-bottom");const n=document.createElement("h1");t.appendChild(n),n.setAttribute("class","Sidebar-h1");const r=document.createElement("div");t.appendChild(r);const i=document.createTextNode("Dashboard");n.appendChild(i);const o={bottom:s,top:r};return{root:e,refs:o,ref:e=>{if(!o[e])throw new Error(`Missing handle: '${e}'`);return o[e]},update:()=>{}}}();this.el=t,this.menu=e.create(F,{direction:"column"}),s("top").appendChild(this.menu.el),s("bottom").appendChild(e.create(N,{label:"New project",onClick:()=>e.app.navigate("/new-project"),cssClass:["-newProject","ProjectBtn"]}).el),e.listenTo(e.app,"navigate",e=>{let t=e.processedQueryString||"";const s=t.length-1;if(s<0)return;if("/"===t.charAt(s)&&(t=t.slice(0,-1)),!t)return;Array.from(this.buttons.values()).forEach(e=>e.el.classList.remove("-current"));const n=this.buttons.get(t);n&&n.el.classList.add("-current")})}addProject(e,t){const s=this.dash.create(cn,{project:e});this.buttons.set(t,s),this.menu.addItem(s)}}s(59);class hn{constructor(e){this.dash=e,this.model=e.app.model;const{root:t,ref:s}=function(){const e=document.createElement("div");e.setAttribute("class","AppFrame");const t=document.createElement("div");e.appendChild(t),t.setAttribute("class","AppFrame-wrapper");const s=document.createElement("div");t.appendChild(s),s.setAttribute("class","AppFrame-top");const n=document.createElement("div");t.appendChild(n),n.setAttribute("class","AppFrame-content");const r=document.createElement("div");t.appendChild(r),r.setAttribute("class","AppFrame-side");const i=document.createElement("div");t.appendChild(i),i.setAttribute("class","AppFrame-bottom");const o={top:s,content:n,side:r,bottom:i};return{root:e,refs:o,ref:e=>{if(!o[e])throw new Error(`Missing handle: '${e}'`);return o[e]},update:()=>{}}}();this.el=t,s("top").appendChild(this.createHeaderBar().el);const n=this.dash.create(Jt),r=this.dash.create(B);n.addItem(r.buttonEl),s("bottom").appendChild(n.el),this.sidebar=this.dash.create(dn),s("side").appendChild(this.sidebar.el),this.viewer=this.createWorkspaceViewer(),s("content").appendChild(this.viewer.el)}createWorkspaceViewer(){const e=this.dash.create(os);return this.createWorkspaces(e),e.start(),e}createWorkspaces(e){e.addWorkspace("/new-project","dropdown","New project",this.dash.create(Cs,!0)),e.addWorkspace("/settings/steps","dropdown","Manage steps",this.dash.create(an)),e.addWorkspace("/settings/accounts","dropdown","Accounts",this.dash.create(bs)),e.addWorkspace("/settings/flags","dropdown","Flags",this.dash.create(ys)),e.addWorkspace("/search","dropdown","Search",this.dash.create(ln)),e.add404Workspace("404 Not Found",this.dash.create(es)),e.addHomeWorkspace("Home",this.dash.create(U)),"admin"===this.model.session.account.role&&(e.addWorkspace("/settings/invitations","dropdown","Invite accounts",this.dash.create(Qt)),e.addWorkspace("/setting/webhooks","dropdown","Manage webhooks",this.dash.create(Zt)));const t=this.dash.create(us,this.model.session.account);e.addHomeWorkspace("Personal space",t,"/settings/my-profile");const s=this.model.global.projects;for(const t of s)this.addProject(e,t);this.dash.listenToModel("createProject",t=>this.addProject(e,t.model)),this.dash.listenToModel("deleteProject",t=>e.removeWorkspace("/prj-"+t.id))}addProject(e,t){const s="/prj-"+t.id;e.addWorkspace(s,"main",t.code,this.dash.create(rn,t)),this.sidebar.addProject(t,s)}createHeaderBar(){const e=this.dash.create($),t=this.dash.create(N,{label:"Notifications",icon22:{position:"right",cssClass:"-notif"},canHaveAlert:!0,onClick:()=>{this.dash.log.debug("Notifications to implement...")}});return e.entries.addItem(t),e.entries.addItem(this.createSettingsMenu()),e.entries.addItem(this.createSessionMenu()),e}createSettingsMenu(){const e=this.dash.create(N,{label:"Settings",icon22:{position:"right",cssClass:"-setting"},withWrapper:!0}),t=this.dash.create(O,{btnEl:e.btnEl,align:"left"});return t.entries.createNavBtn({label:"Steps",onClick:()=>this.dash.app.navigate("/settings/steps"),icon22:{position:"left",cssClass:"-step"}},{label:"Accounts",onClick:()=>this.dash.app.navigate("/settings/accounts")},{label:"Flags",onClick:()=>this.dash.app.navigate("/settings/flags")},{label:"Search",onClick:()=>this.dash.app.navigate("/search")}),"admin"===this.model.session.account.role&&(t.entries.createNavBtn({label:"Invitations",onClick:()=>this.dash.app.navigate("/settings/invitations")}),t.entries.createNavBtn({label:"Webhooks",onClick:()=>this.dash.app.navigate("/setting/webhooks")})),e}createSessionMenu(){const e=this.dash.create(N,{withWrapper:!0,innerEl:{position:"left"}});un(e,this.dash.app.model.session.account),this.dash.listenToModel("updateAccount",t=>{t.model===this.dash.app.model.session.account&&un(e,this.dash.app.model.session.account)});return this.dash.create(O,{btnEl:e.btnEl,align:"right"}).entries.createNavBtn({label:"My profile",onClick:()=>this.dash.app.navigate("/settings/my-profile"),icon22:{position:"left",cssClass:"-profile"}},{label:"Log out",onClick:()=>this.dash.app.disconnect(),icon22:{position:"left",cssClass:"-logout"}}),e}}function un(e,t){e.setLabel(t.name);const s=t.avatar&&t.avatar.getVariant("34x34");e.innerEl.style.backgroundImage=t.avatar?`url("${s?s.url:void 0}")`:""}async function pn(){return new Promise((e,t)=>{const{host:s,protocol:n}=window.location,r=new WebSocket(`${"https:"===n?"wss":"ws"}://${s}/subscribe`);r.addEventListener("error",()=>t("Unable to create websocket client."),{once:!0}),r.addEventListener("open",()=>e(r))})}s(60);class mn{constructor(e){this.dash=e,this.enabled=!0;const{root:t,ref:s}=function(){const e=document.createElement("dialog");e.setAttribute("class","LoginDialog");const t=document.createElement("header");e.appendChild(t),t.setAttribute("class","LoginDialog-header");const s=document.createElement("main");e.appendChild(s),s.setAttribute("class","LoginDialog-box");const n=document.createElement("h1");s.appendChild(n),n.setAttribute("class","LoginDialog-h1 SimpleTitle");const r=document.createElement("div");s.appendChild(r),r.setAttribute("class","FieldGroup");const i=document.createElement("p");s.appendChild(i),i.setAttribute("class","LoginDialog-p Text");const o=document.createTextNode("Login to your account");n.appendChild(o);const a=document.createElement("label");r.appendChild(a),a.setAttribute("class","FieldGroup-item Field");const l=document.createElement("label");r.appendChild(l),l.setAttribute("class","FieldGroup-item -gap Field");const c=document.createElement("button");r.appendChild(c),c.setAttribute("class","FieldGroup-action Btn WithLoader -right"),c.setAttribute("type","button");const d=document.createTextNode("Forgot your password? ");i.appendChild(d);const h=document.createElement("a");i.appendChild(h),h.setAttribute("href","#");const u=document.createTextNode(".");i.appendChild(u);const p=document.createElement("span");a.appendChild(p),p.setAttribute("class","Field-deco -icon -profile -leftBlue");const m=document.createElement("span");l.appendChild(m),m.setAttribute("class","Field-deco -icon -lock -leftBlue");const f=document.createTextNode("\n        Submit\n        ");c.appendChild(f);const g=document.createElement("span");c.appendChild(g),g.setAttribute("class","WithLoader-l"),g.setAttribute("hidden","");const b=document.createTextNode("Click here");h.appendChild(b);const w=document.createElement("input");p.appendChild(w),w.setAttribute("class","Field-input"),w.setAttribute("type","text"),w.setAttribute("placeholder","Username");const v=document.createElement("input");m.appendChild(v),v.setAttribute("class","Field-input"),v.setAttribute("type","password"),v.setAttribute("placeholder","Password");const y={submitBtn:c,pwdReset:h,spinner:g,username:w,password:v};return{root:e,refs:y,ref:e=>{if(!y[e])throw new Error(`Missing handle: '${e}'`);return y[e]},update:()=>{}}}();this.el=t,this.nameEl=s("username"),this.passwordEl=s("password"),this.spinnerEl=s("spinner"),M.registerDialog(this.el);const n=s("submitBtn");n.addEventListener("click",()=>this.onSubmit()),this.el.addEventListener("keyup",e=>{"Enter"===e.key&&this.enabled&&n.click()}),s("pwdReset").addEventListener("click",()=>this.onPasswordReset()),this.el.addEventListener("cancel",e=>e.preventDefault()),document.body.appendChild(this.el)}open(){return this.el.showModal(),this.curDfd=new L,this.curDfd.promise}removeWarnings(){this.nameEl.style.borderColor="gray",this.passwordEl.style.borderColor="gray"}async onSubmit(){this.removeWarnings();const e=this.nameEl.value.trim(),t=this.passwordEl.value;if(0===e.length)this.nameEl.focus();else if(0===t.length)this.passwordEl.focus();else{this.enabled=!1,this.showSpinner();const s=await this.tryToLogin(e,t);if(this.hideSpinner(),this.enabled=!0,!s||!this.curDfd)return;this.el.close(),this.curDfd.resolve(s),this.curDfd=void 0}}onPasswordReset(){this.curDfd&&(this.el.close(),this.curDfd.resolve({accountId:"0"}),this.curDfd=void 0)}async tryToLogin(e,t){try{const s=await fetch(this.dash.app.baseUrl+"/api/session/connect",{method:"post",credentials:"same-origin",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({login:e,password:t})}).then(e=>{if(!e.ok)throw new Error("Unable to fulfill login request");return e.json()});if(s.done)return s.info;await this.dash.create(P).show(["Wrong username or password."])}catch(e){await this.dash.create(I).show(["Something went wrong. We could not process fulfill your request.","Please, try again."])}}showSpinner(){this.spinnerEl.hidden=!1}hideSpinner(){this.spinnerEl.hidden=!0}}s(61);class fn{constructor(e){this.dash=e;const{root:t,ref:s}=function(){const e=document.createElement("dialog");e.setAttribute("class","PasswordRequestDialog");const t=document.createElement("p");e.appendChild(t);const s=document.createElement("div");e.appendChild(s);const n=document.createTextNode("\n    Please enter the email address you have been registered with.");t.appendChild(n);const r=document.createElement("br");t.appendChild(r);const i=document.createTextNode("\n    An email with a link to reset the password will be sent to that address.\n  ");t.appendChild(i);const o=document.createElement("input");s.appendChild(o),o.setAttribute("type","email"),o.setAttribute("required","");const a=document.createElement("button");s.appendChild(a),a.setAttribute("class","Btn WithLoader -right"),a.setAttribute("type","button");const l=document.createElement("button");s.appendChild(l),l.setAttribute("type","button");const c=document.createTextNode("\n      Request email\n      ");a.appendChild(c);const d=document.createElement("span");a.appendChild(d),d.setAttribute("class","WithLoader-l"),d.setAttribute("hidden","");const h=document.createTextNode("Cancel");l.appendChild(h);const u={email:o,submit:a,cancel:l,spinner:d};return{root:e,refs:u,ref:e=>{if(!u[e])throw new Error(`Missing handle: '${e}'`);return u[e]},update:()=>{}}}();this.el=t,this.emailEl=s("email"),this.spinnerEl=s("spinner"),M.registerDialog(this.el);const n=s("submit");n.addEventListener("click",()=>this.onSubmit()),s("cancel").addEventListener("click",()=>this.onCancel()),this.el.addEventListener("keyup",e=>{"Enter"===e.key&&n.click()}),this.el.addEventListener("cancel",e=>e.preventDefault()),document.body.appendChild(this.el)}open(){return this.el.showModal(),this.curDfd=new L,this.curDfd.promise}async onSubmit(){this.disable(),this.showSpinner();const e=this.emailEl.value;e&&await this.makeApiCall(e)&&this.curDfd&&(this.curDfd.resolve(void 0),this.curDfd=void 0,this.el.close()),this.enable(),this.hideSpinner()}async makeApiCall(e){try{const t=await fetch(this.dash.app.baseUrl+"/api/registration/send-password-reset-mail",{method:"post",credentials:"same-origin",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({email:e})});if(!t.ok)return await this.dash.create(I).show("Unable to get a response from server."),!1;const s=await t.json();if(s.done){const e="Request received by server. Your should receive an email in order to complete the process.";return await this.dash.create(Xt).show(e),!0}await this.dash.create(I).show("There was an problem while processing your resquest.\n"+s.reason)}catch(e){await this.dash.create(I).show("There was an problem while processing your resquest."),this.dash.log.error("Error while requesting password reset mail",e)}return!1}onCancel(){this.curDfd&&(this.el.close(),this.curDfd.resolve(void 0),this.curDfd=void 0)}enable(){this.el.style.pointerEvents="auto"}disable(){this.el.style.pointerEvents="none"}showSpinner(){this.spinnerEl.hidden=!1}hideSpinner(){this.spinnerEl.hidden=!0}}class gn{constructor(e){var t,s;this.dash=e,this.log=e.log,this.baseUrl=null!==(t=document.documentElement.dataset.baseUrl)&&void 0!==t?t:"";const n=null!==(s=document.documentElement.dataset.env)&&void 0!==s?s:"prod";this.dash.listenTo("log",e=>{console&&("local"!==n&&"error"!==e.level&&"warn"!==e.level||(console[e.level]?console[e.level](...e.messages):console.log(`[${e.level}]`,...e.messages)))}),this.dash.addDashAugmentation(e=>({listenToModel:(t,s,n)=>e.listenTo(this.model,t,s,n)}))}async alert(e){await this.dash.create(P).show(e)}get model(){if(!this._model)throw new Error("The application is still not initialized");return this._model}async navigate(e){this.appFrame&&await this.appFrame.viewer.router.navigate(e)}async connect(){let e;try{const t=await fetch(this.baseUrl+"/api/session/current",{method:"post",credentials:"same-origin",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({})}).then(e=>{if(!e.ok)throw new Error("Unable to get information about user session.");return e.json()});e=t.done?t.info:void 0}catch(e){this.log.warn(e)}return null!=e?e:await this.dash.create(mn).open()}async disconnect(){try{await fetch(this.baseUrl+"/api/session/disconnect",{method:"post",credentials:"same-origin",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({})}).then(e=>{if(!e.ok)throw new Error("Unable to make a disconnection request.");return e.json()}).then(e=>{if(!e.done)throw new Error("Unable to end session.");return!0}),await this.doCleanup()}catch(e){const t=this.dash.create(I);await t.show(["Something went wrong. We could not disconnect you.","Please try again."])}}async doCleanup(){this.ws&&function(e){if(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)return;const t=setInterval(()=>{0===e.bufferedAmount&&e.close()},5e3);e.addEventListener("close",()=>clearInterval(t),{once:!0})}(this.ws),await this.navigate(""),document.location.reload(!1)}async showPasswordResetDialog(){const e=this.dash.create(fn);try{await e.open()}catch(e){this.log.error(e)}}async start(e,t){const{frontendId:s}=e;await this.initModel(e),this.registerWs(t,e.accountId),t.addEventListener("error",e=>{this.log.error("Error with websocket client:",e),pn().then(e=>{this.log.debug("Websocket recreated with success."),this.registerWs(e,s)}).catch(()=>{this.log.error("Error while attempting to recreate websocket.")})}),t.addEventListener("close",e=>this.log.debug("ws closed",e));const n=document.querySelector(".js-app");n&&(p(n),this.appFrame=this.dash.create(hn),n.appendChild(this.appFrame.el))}registerWs(e,t){this.ws=e,e.addEventListener("message",e=>{try{const s=JSON.parse(e.data);s.modelUpd&&s.frontendId!==t&&this.model.processModelUpdate(s.modelUpd)}catch(t){this.log.error("Received bad JSON from ws server:",e.data)}})}async initModel(e){this._model=this.dash.create($s,e);const t=this.dash.getPublicDashOf(this.model);t.unmanagedListeners.on("change",e=>{"orderedIds"in e?this.log.debug(`[MODEL] ${e.cmd} ${e.type}`,e.orderedIds):this.log.debug(`[MODEL] ${e.cmd} ${e.type} ${e.id}`,e.model)}),t.unmanagedListeners.on("bgCommandAdded",e=>{this.log.debug("[BG] Add: "+e.label)}),t.unmanagedListeners.on("bgCommandDone",e=>{this.log.debug("[BG] Done: "+e.label)}),t.unmanagedListeners.on("bgCommandError",e=>{this.log.debug("[BG] Error: "+e.label,e.errorMessage)}),t.unmanagedListeners.on("processing",e=>{this.log.debug(`[PROCESSING] start ${e.cmd} ${e.type} ${e.id}`,e.model)}),t.unmanagedListeners.on("endProcessing",e=>{this.log.debug(`[PROCESSING] end ${e.cmd} ${e.type} ${e.id}`,e.model)}),await this.model.global.loading}}s(7),s(8),document.addEventListener("DOMContentLoaded",(async function(){try{const e=function(e,t){return new h(e,!1,t).root.getInstance()}(gn),t=await e.connect();if("0"===t.accountId)await e.showPasswordResetDialog();else{const s=await pn();await e.start(t,s)}}catch(e){console.log(e)}}))}]);